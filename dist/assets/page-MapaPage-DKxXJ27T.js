import{r as x,j as e,ah as Ds,ai as At,aj as Os,ak as Dt,al as Ye,am as Is,an as Fs,ao as Ot,ap as It,aq as Ft,ar as gr,as as Mt,at as jr,au as $t,av as Lt,aw as vr,ax as br,ay as Nr,az as qt,aA as Vt,aB as zt,aC as _r,aD as Bt,aE as Ut,aF as Jt,aG as Ht,a7 as st,aH as Kt,aI as yr,aJ as Gt,aK as Wt,aL as wr,aM as Cr,aN as Se,J as cs,S as Sr,aO as Qt,aP as Tr,aQ as Er,aR as Zt,aS as Rr,$ as Xt,aT as Pr,aU as kr,aV as Ar,aW as Yt,aX as Dr,C as ms,aY as Or,aZ as ea,a_ as Ir,a$ as sa,b0 as Fr,b1 as Mr,b2 as ta,l as aa,b3 as ra,b4 as oa,b5 as na,b6 as $r,b7 as Lr,b8 as qr,b9 as ia,ba as la,bb as ca,bc as da,bd as ma,be as ua,bf as es,bg as Vr,L as ds,t as He,bh as ha,bi as xa,ae as gs,bj as zr,bk as Br,bl as Ke,v as $e,bm as Js,bn as Ur,bo as Jr,bp as Hr,bq as Kr,br as tt,bs as Hs,o as Cs,V as Gr,x as at,bt as Wr,Z as Qr,ab as Ss,O as pa,bu as Le,bv as Zr,i as Ie,ac as Ks,D as fa,a0 as $s,bw as Xr,u as rt,af as ze,U as js,bx as Yr,by as Ts,bz as eo,E as Gs,bA as so,P as Ws,bB as to,bC as ao,bD as ro,e as ga,bE as xt,p as oo,bF as no,k as pt,bG as io,bH as lo,bI as ja,bJ as co,bK as mo,bL as uo,ag as ho,F as xo,d as po,bM as fo,aa as ft,bN as gt}from"./vendor-BIe5zH3B.js";import{k as _,m as go,y as jo,z as va,D as ke,a as L,B as P,o as De,q as Oe,s as Fe,C as le,b as _e,c as ye,n as rs,d as he,_ as vo,u as us,E as Pe,w as Re,Z as Es,F as bo,G as Ls,H as No,I as _o,J as yo,A as wo,f as jt,g as vt,h as bt}from"./page-About-BlYnpLxn.js";import{L as Ne,I as We,T as ba,a as Na,b as Rs,c as Ps,w as _a,l as Ce,u as Co}from"./page-Login-CfUEEn7u.js";import{P as ya,a as wa,b as Ca,T as Sa,c as Ta,d as Qe,e as be,f as Ea,g as xe}from"./page-DemoMapaTestemunhas-Dib0UK8t.js";const Ra=Ot,Ii=It,So=At,Pa=x.forwardRef(({className:s,...t},a)=>e.jsx(Ds,{ref:a,className:_("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t}));Pa.displayName=Ds.displayName;const ot=x.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(So,{children:[e.jsx(Pa,{}),e.jsxs(Os,{ref:r,className:_("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a,children:[t,e.jsxs(Dt,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));ot.displayName=Os.displayName;const ka=({className:s,...t})=>e.jsx("div",{className:_("flex flex-col space-y-1.5 text-center sm:text-left",s),...t});ka.displayName="DialogHeader";const To=({className:s,...t})=>e.jsx("div",{className:_("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});To.displayName="DialogFooter";const Aa=x.forwardRef(({className:s,...t},a)=>e.jsx(Is,{ref:a,className:_("text-lg font-semibold leading-none tracking-tight",s),...t}));Aa.displayName=Is.displayName;const Da=x.forwardRef(({className:s,...t},a)=>e.jsx(Fs,{ref:a,className:_("text-sm text-muted-foreground",s),...t}));Da.displayName=Fs.displayName;const nt=x.forwardRef(({className:s,...t},a)=>e.jsx(Ft,{className:_("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...t,ref:a,children:e.jsx(gr,{className:_("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));nt.displayName=Ft.displayName;const ks=x.forwardRef(({className:s,value:t,...a},r)=>e.jsx(Mt,{ref:r,className:_("relative h-2 w-full overflow-hidden rounded-full bg-secondary",s),...a,children:e.jsx(jr,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));ks.displayName=Mt.displayName;const Ge=x.forwardRef(({className:s,orientation:t="horizontal",decorative:a=!0,...r},o)=>e.jsx($t,{ref:o,decorative:a,orientation:t,className:_("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...r}));Ge.displayName=$t.displayName;const Oa=Ot,Eo=It,Ro=At,Ia=x.forwardRef(({className:s,...t},a)=>e.jsx(Ds,{className:_("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));Ia.displayName=Ds.displayName;const Po=go("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),it=x.forwardRef(({side:s="right",className:t,children:a,...r},o)=>e.jsxs(Ro,{children:[e.jsx(Ia,{}),e.jsxs(Os,{ref:o,className:_(Po({side:s}),t),...r,children:[a,e.jsxs(Dt,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));it.displayName=Os.displayName;const lt=({className:s,...t})=>e.jsx("div",{className:_("flex flex-col space-y-2 text-center sm:text-left",s),...t});lt.displayName="SheetHeader";const ct=x.forwardRef(({className:s,...t},a)=>e.jsx(Is,{ref:a,className:_("text-lg font-semibold text-foreground",s),...t}));ct.displayName=Is.displayName;const dt=x.forwardRef(({className:s,...t},a)=>e.jsx(Fs,{ref:a,className:_("text-sm text-muted-foreground",s),...t}));dt.displayName=Fs.displayName;const Fa=vr,ps=br,fs=Nr,is=x.forwardRef(({className:s,sideOffset:t=4,...a},r)=>e.jsx(Lt,{ref:r,sideOffset:t,className:_("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a}));is.displayName=Lt.displayName;const bs=wr,Ns=Cr,ko=x.forwardRef(({className:s,inset:t,children:a,...r},o)=>e.jsxs(qt,{ref:o,className:_("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",s),...r,children:[a,e.jsx(Vt,{className:"ml-auto h-4 w-4"})]}));ko.displayName=qt.displayName;const Ao=x.forwardRef(({className:s,...t},a)=>e.jsx(zt,{ref:a,className:_("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t}));Ao.displayName=zt.displayName;const hs=x.forwardRef(({className:s,sideOffset:t=4,...a},r)=>e.jsx(_r,{children:e.jsx(Bt,{ref:r,sideOffset:t,className:_("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...a})}));hs.displayName=Bt.displayName;const ss=x.forwardRef(({className:s,inset:t,...a},r)=>e.jsx(Ut,{ref:r,className:_("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",s),...a}));ss.displayName=Ut.displayName;const Ma=x.forwardRef(({className:s,children:t,checked:a,...r},o)=>e.jsxs(Jt,{ref:o,className:_("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:a,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ht,{children:e.jsx(st,{className:"h-4 w-4"})})}),t]}));Ma.displayName=Jt.displayName;const Do=x.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(Kt,{ref:r,className:_("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ht,{children:e.jsx(yr,{className:"h-2 w-2 fill-current"})})}),t]}));Do.displayName=Kt.displayName;const Oo=x.forwardRef(({className:s,inset:t,...a},r)=>e.jsx(Gt,{ref:r,className:_("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",s),...a}));Oo.displayName=Gt.displayName;const Qs=x.forwardRef(({className:s,...t},a)=>e.jsx(Wt,{ref:a,className:_("-mx-1 my-1 h-px bg-muted",s),...t}));Qs.displayName=Wt.displayName;const mt=x.forwardRef(({className:s,...t},a)=>e.jsx(Se,{ref:a,className:_("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s),...t}));mt.displayName=Se.displayName;const Fi=({children:s,...t})=>e.jsx(Ra,{...t,children:e.jsx(ot,{className:"overflow-hidden p-0 shadow-lg",children:e.jsx(mt,{className:"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5",children:s})})}),Io=x.forwardRef(({className:s,...t},a)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(cs,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(Se.Input,{ref:a,className:_("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s),...t})]}));Io.displayName=Se.Input.displayName;const $a=x.forwardRef(({className:s,...t},a)=>e.jsx(Se.List,{ref:a,className:_("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...t}));$a.displayName=Se.List.displayName;const La=x.forwardRef((s,t)=>e.jsx(Se.Empty,{ref:t,className:"py-6 text-center text-sm",...s}));La.displayName=Se.Empty.displayName;const qa=x.forwardRef(({className:s,...t},a)=>e.jsx(Se.Group,{ref:a,className:_("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...t}));qa.displayName=Se.Group.displayName;const Fo=x.forwardRef(({className:s,...t},a)=>e.jsx(Se.Separator,{ref:a,className:_("-mx-1 h-px bg-border",s),...t}));Fo.displayName=Se.Separator.displayName;const Va=x.forwardRef(({className:s,...t},a)=>e.jsx(Se.Item,{ref:a,className:_("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",s),...t}));Va.displayName=Se.Item.displayName;const za=x.forwardRef(({...s},t)=>e.jsx("nav",{ref:t,"aria-label":"breadcrumb",...s}));za.displayName="Breadcrumb";const Ba=x.forwardRef(({className:s,...t},a)=>e.jsx("ol",{ref:a,className:_("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",s),...t}));Ba.displayName="BreadcrumbList";const Zs=x.forwardRef(({className:s,...t},a)=>e.jsx("li",{ref:a,className:_("inline-flex items-center gap-1.5",s),...t}));Zs.displayName="BreadcrumbItem";const Xs=x.forwardRef(({asChild:s,className:t,...a},r)=>{const o=s?Sr:"a";return e.jsx(o,{ref:r,className:_("transition-colors hover:text-foreground",t),...a})});Xs.displayName="BreadcrumbLink";const Ua=x.forwardRef(({className:s,...t},a)=>e.jsx("span",{ref:a,role:"link","aria-disabled":"true","aria-current":"page",className:_("font-normal text-foreground",s),...t}));Ua.displayName="BreadcrumbPage";const Ja=({children:s,className:t,...a})=>e.jsx("li",{role:"presentation","aria-hidden":"true",className:_("[&>svg]:size-3.5",t),...a,children:s??e.jsx(Vt,{})});Ja.displayName="BreadcrumbSeparator";const Ha=x.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(Qt,{ref:r,className:_("relative overflow-hidden",s),...a,children:[e.jsx(Tr,{className:"h-full w-full rounded-[inherit] min-h-0",children:t}),e.jsx(Ka,{}),e.jsx(Er,{})]}));Ha.displayName=Qt.displayName;const Ka=x.forwardRef(({className:s,orientation:t="vertical",...a},r)=>e.jsx(Zt,{ref:r,orientation:t,className:_("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...a,children:e.jsx(Rr,{className:"relative flex-1 rounded-full bg-border"})}));Ka.displayName=Zt.displayName;const Mo=Xt()(Pr((s,t)=>({notifications:[],unreadCount:0,addNotification:a=>{const r=`notification-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,o={...a,id:r,createdAt:new Date,read:!1,duration:a.duration??5e3};return s(n=>({notifications:[o,...n.notifications],unreadCount:n.unreadCount+1})),o.duration&&setTimeout(()=>{t().removeNotification(r)},o.duration),r},removeNotification:a=>{s(r=>{const o=r.notifications.find(i=>i.id===a),n=o&&!o.read;return{notifications:r.notifications.filter(i=>i.id!==a),unreadCount:n?r.unreadCount-1:r.unreadCount}})},markAsRead:a=>{s(r=>{const o=r.notifications.map(i=>i.id===a?{...i,read:!0}:i),n=o.filter(i=>!i.read).length;return{notifications:o,unreadCount:n}})},markAllAsRead:()=>{s(a=>({notifications:a.notifications.map(r=>({...r,read:!0})),unreadCount:0}))},clearAll:()=>{s({notifications:[],unreadCount:0})},clearRead:()=>{s(a=>({notifications:a.notifications.filter(r=>!r.read),unreadCount:a.unreadCount}))}}),{name:"assistjur-notifications",partialize:s=>({notifications:s.notifications.slice(0,50)})})),$o=()=>{const{addNotification:s,...t}=Mo();return{...t,success:(a,r,o)=>s({type:"success",title:a,message:r,...o}),error:(a,r,o)=>s({type:"error",title:a,message:r,duration:void 0,...o}),warning:(a,r,o)=>s({type:"warning",title:a,message:r,...o}),info:(a,r,o)=>s({type:"info",title:a,message:r,...o}),addNotification:s}},Ze=kr,Xe=Ar,Be=x.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(Yt,{ref:r,className:_("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...a,children:[t,e.jsx(Dr,{asChild:!0,children:e.jsx(ms,{className:"h-4 w-4 opacity-50"})})]}));Be.displayName=Yt.displayName;const Ga=x.forwardRef(({className:s,...t},a)=>e.jsx(ta,{ref:a,className:_("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(aa,{className:"h-4 w-4"})}));Ga.displayName=ta.displayName;const Wa=x.forwardRef(({className:s,...t},a)=>e.jsx(ra,{ref:a,className:_("flex cursor-default items-center justify-center py-1",s),...t,children:e.jsx(ms,{className:"h-4 w-4"})}));Wa.displayName=ra.displayName;const Ue=x.forwardRef(({className:s,children:t,position:a="popper",...r},o)=>e.jsx(Or,{children:e.jsxs(ea,{ref:o,className:_("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...r,children:[e.jsx(Ga,{}),e.jsx(Ir,{className:_("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),e.jsx(Wa,{})]})}));Ue.displayName=ea.displayName;const Lo=x.forwardRef(({className:s,...t},a)=>e.jsx(oa,{ref:a,className:_("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...t}));Lo.displayName=oa.displayName;const ge=x.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(sa,{ref:r,className:_("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Fr,{children:e.jsx(st,{className:"h-4 w-4"})})}),e.jsx(Mr,{children:t})]}));ge.displayName=sa.displayName;const qo=x.forwardRef(({className:s,...t},a)=>e.jsx(na,{ref:a,className:_("-mx-1 my-1 h-px bg-muted",s),...t}));qo.displayName=na.displayName;var ys={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var Vo=ys.exports,Nt;function zo(){return Nt||(Nt=1,(function(s,t){((a,r)=>{s.exports=r()})(Vo,function a(){var r=typeof self<"u"?self:typeof window<"u"?window:r!==void 0?r:{},o,n=!r.document&&!!r.postMessage,i=r.IS_PAPA_WORKER||!1,d={},h=0,u={};function b(l){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(c){var m=H(c);m.chunkSize=parseInt(m.chunkSize),c.step||c.chunk||(m.chunkSize=null),this._handle=new f(m),(this._handle.streamer=this)._config=m}.call(this,l),this.parseChunk=function(c,m){var j=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<j){let q=this._config.newline;q||(w=this._config.quoteChar||'"',q=this._handle.guessLineEndings(c,w)),c=[...c.split(q).slice(j)].join(q)}this.isFirstChunk&&z(this._config.beforeFirstChunk)&&(w=this._config.beforeFirstChunk(c))!==void 0&&(c=w),this.isFirstChunk=!1,this._halted=!1;var j=this._partialLine+c,w=(this._partialLine="",this._handle.parse(j,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(c=w.meta.cursor,j=(this._finished||(this._partialLine=j.substring(c-this._baseIndex),this._baseIndex=c),w&&w.data&&(this._rowCount+=w.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),i)r.postMessage({results:w,workerId:u.WORKER_ID,finished:j});else if(z(this._config.chunk)&&!m){if(this._config.chunk(w,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=w=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(w.data),this._completeResults.errors=this._completeResults.errors.concat(w.errors),this._completeResults.meta=w.meta),this._completed||!j||!z(this._config.complete)||w&&w.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),j||w&&w.meta.paused||this._nextChunk(),w}this._halted=!0},this._sendError=function(c){z(this._config.error)?this._config.error(c):i&&this._config.error&&r.postMessage({workerId:u.WORKER_ID,error:c,finished:!1})}}function g(l){var c;(l=l||{}).chunkSize||(l.chunkSize=u.RemoteChunkSize),b.call(this,l),this._nextChunk=n?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(m){this._input=m,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(c=new XMLHttpRequest,this._config.withCredentials&&(c.withCredentials=this._config.withCredentials),n||(c.onload=J(this._chunkLoaded,this),c.onerror=J(this._chunkError,this)),c.open(this._config.downloadRequestBody?"POST":"GET",this._input,!n),this._config.downloadRequestHeaders){var m,j=this._config.downloadRequestHeaders;for(m in j)c.setRequestHeader(m,j[m])}var w;this._config.chunkSize&&(w=this._start+this._config.chunkSize-1,c.setRequestHeader("Range","bytes="+this._start+"-"+w));try{c.send(this._config.downloadRequestBody)}catch(q){this._chunkError(q.message)}n&&c.status===0&&this._chunkError()}},this._chunkLoaded=function(){c.readyState===4&&(c.status<200||400<=c.status?this._chunkError():(this._start+=this._config.chunkSize||c.responseText.length,this._finished=!this._config.chunkSize||this._start>=(m=>(m=m.getResponseHeader("Content-Range"))!==null?parseInt(m.substring(m.lastIndexOf("/")+1)):-1)(c),this.parseChunk(c.responseText)))},this._chunkError=function(m){m=c.statusText||m,this._sendError(new Error(m))}}function C(l){(l=l||{}).chunkSize||(l.chunkSize=u.LocalChunkSize),b.call(this,l);var c,m,j=typeof FileReader<"u";this.stream=function(w){this._input=w,m=w.slice||w.webkitSlice||w.mozSlice,j?((c=new FileReader).onload=J(this._chunkLoaded,this),c.onerror=J(this._chunkError,this)):c=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var w=this._input,q=(this._config.chunkSize&&(q=Math.min(this._start+this._config.chunkSize,this._input.size),w=m.call(w,this._start,q)),c.readAsText(w,this._config.encoding));j||this._chunkLoaded({target:{result:q}})},this._chunkLoaded=function(w){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(w.target.result)},this._chunkError=function(){this._sendError(c.error)}}function T(l){var c;b.call(this,l=l||{}),this.stream=function(m){return c=m,this._nextChunk()},this._nextChunk=function(){var m,j;if(!this._finished)return m=this._config.chunkSize,c=m?(j=c.substring(0,m),c.substring(m)):(j=c,""),this._finished=!c,this.parseChunk(j)}}function K(l){b.call(this,l=l||{});var c=[],m=!0,j=!1;this.pause=function(){b.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){b.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(w){this._input=w,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){j&&c.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),c.length?this.parseChunk(c.shift()):m=!0},this._streamData=J(function(w){try{c.push(typeof w=="string"?w:w.toString(this._config.encoding)),m&&(m=!1,this._checkIsFinished(),this.parseChunk(c.shift()))}catch(q){this._streamError(q)}},this),this._streamError=J(function(w){this._streamCleanUp(),this._sendError(w)},this),this._streamEnd=J(function(){this._streamCleanUp(),j=!0,this._streamData("")},this),this._streamCleanUp=J(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function f(l){var c,m,j,w,q=Math.pow(2,53),ne=-q,pe=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,je=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,$=this,se=0,k=0,de=!1,F=!1,V=[],N={data:[],errors:[],meta:{}};function R(O){return l.skipEmptyLines==="greedy"?O.join("").trim()==="":O.length===1&&O[0].length===0}function v(){if(N&&j&&(Q("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),j=!1),l.skipEmptyLines&&(N.data=N.data.filter(function(A){return!R(A)})),E()){let A=function(ae,ie){z(l.transformHeader)&&(ae=l.transformHeader(ae,ie)),V.push(ae)};if(N)if(Array.isArray(N.data[0])){for(var O=0;E()&&O<N.data.length;O++)N.data[O].forEach(A);N.data.splice(0,1)}else N.data.forEach(A)}function y(A,ae){for(var ie=l.header?{}:[],Z=0;Z<A.length;Z++){var G=Z,I=A[Z],I=((ve,p)=>(D=>(l.dynamicTypingFunction&&l.dynamicTyping[D]===void 0&&(l.dynamicTyping[D]=l.dynamicTypingFunction(D)),(l.dynamicTyping[D]||l.dynamicTyping)===!0))(ve)?p==="true"||p==="TRUE"||p!=="false"&&p!=="FALSE"&&((D=>{if(pe.test(D)&&(D=parseFloat(D),ne<D&&D<q))return 1})(p)?parseFloat(p):je.test(p)?new Date(p):p===""?null:p):p)(G=l.header?Z>=V.length?"__parsed_extra":V[Z]:G,I=l.transform?l.transform(I,G):I);G==="__parsed_extra"?(ie[G]=ie[G]||[],ie[G].push(I)):ie[G]=I}return l.header&&(Z>V.length?Q("FieldMismatch","TooManyFields","Too many fields: expected "+V.length+" fields but parsed "+Z,k+ae):Z<V.length&&Q("FieldMismatch","TooFewFields","Too few fields: expected "+V.length+" fields but parsed "+Z,k+ae)),ie}var te;N&&(l.header||l.dynamicTyping||l.transform)&&(te=1,!N.data.length||Array.isArray(N.data[0])?(N.data=N.data.map(y),te=N.data.length):N.data=y(N.data,0),l.header&&N.meta&&(N.meta.fields=V),k+=te)}function E(){return l.header&&V.length===0}function Q(O,y,te,A){O={type:O,code:y,message:te},A!==void 0&&(O.row=A),N.errors.push(O)}z(l.step)&&(w=l.step,l.step=function(O){N=O,E()?v():(v(),N.data.length!==0&&(se+=O.data.length,l.preview&&se>l.preview?m.abort():(N.data=N.data[0],w(N,$))))}),this.parse=function(O,y,te){var A=l.quoteChar||'"',A=(l.newline||(l.newline=this.guessLineEndings(O,A)),j=!1,l.delimiter?z(l.delimiter)&&(l.delimiter=l.delimiter(O),N.meta.delimiter=l.delimiter):((A=((ae,ie,Z,G,I)=>{var ve,p,D,X;I=I||[",","	","|",";",u.RECORD_SEP,u.UNIT_SEP];for(var re=0;re<I.length;re++){for(var ee,Me=I[re],ue=0,fe=0,ce=0,me=(D=void 0,new Y({comments:G,delimiter:Me,newline:ie,preview:10}).parse(ae)),we=0;we<me.data.length;we++)Z&&R(me.data[we])?ce++:(ee=me.data[we].length,fe+=ee,D===void 0?D=ee:0<ee&&(ue+=Math.abs(ee-D),D=ee));0<me.data.length&&(fe/=me.data.length-ce),(p===void 0||ue<=p)&&(X===void 0||X<fe)&&1.99<fe&&(p=ue,ve=Me,X=fe)}return{successful:!!(l.delimiter=ve),bestDelimiter:ve}})(O,l.newline,l.skipEmptyLines,l.comments,l.delimitersToGuess)).successful?l.delimiter=A.bestDelimiter:(j=!0,l.delimiter=u.DefaultDelimiter),N.meta.delimiter=l.delimiter),H(l));return l.preview&&l.header&&A.preview++,c=O,m=new Y(A),N=m.parse(c,y,te),v(),de?{meta:{paused:!0}}:N||{meta:{paused:!1}}},this.paused=function(){return de},this.pause=function(){de=!0,m.abort(),c=z(l.chunk)?"":c.substring(m.getCharIndex())},this.resume=function(){$.streamer._halted?(de=!1,$.streamer.parseChunk(c,!0)):setTimeout($.resume,3)},this.aborted=function(){return F},this.abort=function(){F=!0,m.abort(),N.meta.aborted=!0,z(l.complete)&&l.complete(N),c=""},this.guessLineEndings=function(ae,A){ae=ae.substring(0,1048576);var A=new RegExp(B(A)+"([^]*?)"+B(A),"gm"),te=(ae=ae.replace(A,"")).split("\r"),A=ae.split(`
`),ae=1<A.length&&A[0].length<te[0].length;if(te.length===1||ae)return`
`;for(var ie=0,Z=0;Z<te.length;Z++)te[Z][0]===`
`&&ie++;return ie>=te.length/2?`\r
`:"\r"}}function B(l){return l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Y(l){var c=(l=l||{}).delimiter,m=l.newline,j=l.comments,w=l.step,q=l.preview,ne=l.fastMode,pe=null,je=!1,$=l.quoteChar==null?'"':l.quoteChar,se=$;if(l.escapeChar!==void 0&&(se=l.escapeChar),(typeof c!="string"||-1<u.BAD_DELIMITERS.indexOf(c))&&(c=","),j===c)throw new Error("Comment character same as delimiter");j===!0?j="#":(typeof j!="string"||-1<u.BAD_DELIMITERS.indexOf(j))&&(j=!1),m!==`
`&&m!=="\r"&&m!==`\r
`&&(m=`
`);var k=0,de=!1;this.parse=function(F,V,N){if(typeof F!="string")throw new Error("Input must be a string");var R=F.length,v=c.length,E=m.length,Q=j.length,O=z(w),y=[],te=[],A=[],ae=k=0;if(!F)return ue();if(ne||ne!==!1&&F.indexOf($)===-1){for(var ie=F.split(m),Z=0;Z<ie.length;Z++){if(A=ie[Z],k+=A.length,Z!==ie.length-1)k+=m.length;else if(N)return ue();if(!j||A.substring(0,Q)!==j){if(O){if(y=[],X(A.split(c)),fe(),de)return ue()}else X(A.split(c));if(q&&q<=Z)return y=y.slice(0,q),ue(!0)}}return ue()}for(var G=F.indexOf(c,k),I=F.indexOf(m,k),ve=new RegExp(B(se)+B($),"g"),p=F.indexOf($,k);;)if(F[k]===$)for(p=k,k++;;){if((p=F.indexOf($,p+1))===-1)return N||te.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:y.length,index:k}),ee();if(p===R-1)return ee(F.substring(k,p).replace(ve,$));if($===se&&F[p+1]===se)p++;else if($===se||p===0||F[p-1]!==se){G!==-1&&G<p+1&&(G=F.indexOf(c,p+1));var D=re((I=I!==-1&&I<p+1?F.indexOf(m,p+1):I)===-1?G:Math.min(G,I));if(F.substr(p+1+D,v)===c){A.push(F.substring(k,p).replace(ve,$)),F[k=p+1+D+v]!==$&&(p=F.indexOf($,k)),G=F.indexOf(c,k),I=F.indexOf(m,k);break}if(D=re(I),F.substring(p+1+D,p+1+D+E)===m){if(A.push(F.substring(k,p).replace(ve,$)),Me(p+1+D+E),G=F.indexOf(c,k),p=F.indexOf($,k),O&&(fe(),de))return ue();if(q&&y.length>=q)return ue(!0);break}te.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:y.length,index:k}),p++}}else if(j&&A.length===0&&F.substring(k,k+Q)===j){if(I===-1)return ue();k=I+E,I=F.indexOf(m,k),G=F.indexOf(c,k)}else if(G!==-1&&(G<I||I===-1))A.push(F.substring(k,G)),k=G+v,G=F.indexOf(c,k);else{if(I===-1)break;if(A.push(F.substring(k,I)),Me(I+E),O&&(fe(),de))return ue();if(q&&y.length>=q)return ue(!0)}return ee();function X(ce){y.push(ce),ae=k}function re(ce){var me=0;return me=ce!==-1&&(ce=F.substring(p+1,ce))&&ce.trim()===""?ce.length:me}function ee(ce){return N||(ce===void 0&&(ce=F.substring(k)),A.push(ce),k=R,X(A),O&&fe()),ue()}function Me(ce){k=ce,X(A),A=[],I=F.indexOf(m,k)}function ue(ce){if(l.header&&!V&&y.length&&!je){var me=y[0],we=Object.create(null),ts=new Set(me);let os=!1;for(let qe=0;qe<me.length;qe++){let Te=me[qe];if(we[Te=z(l.transformHeader)?l.transformHeader(Te,qe):Te]){let Ve,ns=we[Te];for(;Ve=Te+"_"+ns,ns++,ts.has(Ve););ts.add(Ve),me[qe]=Ve,we[Te]++,os=!0,(pe=pe===null?{}:pe)[Ve]=Te}else we[Te]=1,me[qe]=Te;ts.add(Te)}os&&console.warn("Duplicate headers found and renamed."),je=!0}return{data:y,errors:te,meta:{delimiter:c,linebreak:m,aborted:de,truncated:!!ce,cursor:ae+(V||0),renamedHeaders:pe}}}function fe(){w(ue()),y=[],te=[]}},this.abort=function(){de=!0},this.getCharIndex=function(){return k}}function U(l){var c=l.data,m=d[c.workerId],j=!1;if(c.error)m.userError(c.error,c.file);else if(c.results&&c.results.data){var w={abort:function(){j=!0,W(c.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:oe,resume:oe};if(z(m.userStep)){for(var q=0;q<c.results.data.length&&(m.userStep({data:c.results.data[q],errors:c.results.errors,meta:c.results.meta},w),!j);q++);delete c.results}else z(m.userChunk)&&(m.userChunk(c.results,w,c.file),delete c.results)}c.finished&&!j&&W(c.workerId,c.results)}function W(l,c){var m=d[l];z(m.userComplete)&&m.userComplete(c),m.terminate(),delete d[l]}function oe(){throw new Error("Not implemented.")}function H(l){if(typeof l!="object"||l===null)return l;var c,m=Array.isArray(l)?[]:{};for(c in l)m[c]=H(l[c]);return m}function J(l,c){return function(){l.apply(c,arguments)}}function z(l){return typeof l=="function"}return u.parse=function(l,c){var m=(c=c||{}).dynamicTyping||!1;if(z(m)&&(c.dynamicTypingFunction=m,m={}),c.dynamicTyping=m,c.transform=!!z(c.transform)&&c.transform,!c.worker||!u.WORKERS_SUPPORTED)return m=null,u.NODE_STREAM_INPUT,typeof l=="string"?(l=(j=>j.charCodeAt(0)!==65279?j:j.slice(1))(l),m=new(c.download?g:T)(c)):l.readable===!0&&z(l.read)&&z(l.on)?m=new K(c):(r.File&&l instanceof File||l instanceof Object)&&(m=new C(c)),m.stream(l);(m=(()=>{var j;return!!u.WORKERS_SUPPORTED&&(j=(()=>{var w=r.URL||r.webkitURL||null,q=a.toString();return u.BLOB_URL||(u.BLOB_URL=w.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",q,")();"],{type:"text/javascript"})))})(),(j=new r.Worker(j)).onmessage=U,j.id=h++,d[j.id]=j)})()).userStep=c.step,m.userChunk=c.chunk,m.userComplete=c.complete,m.userError=c.error,c.step=z(c.step),c.chunk=z(c.chunk),c.complete=z(c.complete),c.error=z(c.error),delete c.worker,m.postMessage({input:l,config:c,workerId:m.id})},u.unparse=function(l,c){var m=!1,j=!0,w=",",q=`\r
`,ne='"',pe=ne+ne,je=!1,$=null,se=!1,k=((()=>{if(typeof c=="object"){if(typeof c.delimiter!="string"||u.BAD_DELIMITERS.filter(function(V){return c.delimiter.indexOf(V)!==-1}).length||(w=c.delimiter),typeof c.quotes!="boolean"&&typeof c.quotes!="function"&&!Array.isArray(c.quotes)||(m=c.quotes),typeof c.skipEmptyLines!="boolean"&&typeof c.skipEmptyLines!="string"||(je=c.skipEmptyLines),typeof c.newline=="string"&&(q=c.newline),typeof c.quoteChar=="string"&&(ne=c.quoteChar),typeof c.header=="boolean"&&(j=c.header),Array.isArray(c.columns)){if(c.columns.length===0)throw new Error("Option columns is empty");$=c.columns}c.escapeChar!==void 0&&(pe=c.escapeChar+ne),c.escapeFormulae instanceof RegExp?se=c.escapeFormulae:typeof c.escapeFormulae=="boolean"&&c.escapeFormulae&&(se=/^[=+\-@\t\r].*$/)}})(),new RegExp(B(ne),"g"));if(typeof l=="string"&&(l=JSON.parse(l)),Array.isArray(l)){if(!l.length||Array.isArray(l[0]))return de(null,l,je);if(typeof l[0]=="object")return de($||Object.keys(l[0]),l,je)}else if(typeof l=="object")return typeof l.data=="string"&&(l.data=JSON.parse(l.data)),Array.isArray(l.data)&&(l.fields||(l.fields=l.meta&&l.meta.fields||$),l.fields||(l.fields=Array.isArray(l.data[0])?l.fields:typeof l.data[0]=="object"?Object.keys(l.data[0]):[]),Array.isArray(l.data[0])||typeof l.data[0]=="object"||(l.data=[l.data])),de(l.fields||[],l.data||[],je);throw new Error("Unable to serialize unrecognized input");function de(V,N,R){var v="",E=(typeof V=="string"&&(V=JSON.parse(V)),typeof N=="string"&&(N=JSON.parse(N)),Array.isArray(V)&&0<V.length),Q=!Array.isArray(N[0]);if(E&&j){for(var O=0;O<V.length;O++)0<O&&(v+=w),v+=F(V[O],O);0<N.length&&(v+=q)}for(var y=0;y<N.length;y++){var te=(E?V:N[y]).length,A=!1,ae=E?Object.keys(N[y]).length===0:N[y].length===0;if(R&&!E&&(A=R==="greedy"?N[y].join("").trim()==="":N[y].length===1&&N[y][0].length===0),R==="greedy"&&E){for(var ie=[],Z=0;Z<te;Z++){var G=Q?V[Z]:Z;ie.push(N[y][G])}A=ie.join("").trim()===""}if(!A){for(var I=0;I<te;I++){0<I&&!ae&&(v+=w);var ve=E&&Q?V[I]:I;v+=F(N[y][ve],I)}y<N.length-1&&(!R||0<te&&!ae)&&(v+=q)}}return v}function F(V,N){var R,v;return V==null?"":V.constructor===Date?JSON.stringify(V).slice(1,25):(v=!1,se&&typeof V=="string"&&se.test(V)&&(V="'"+V,v=!0),R=V.toString().replace(k,pe),(v=v||m===!0||typeof m=="function"&&m(V,N)||Array.isArray(m)&&m[N]||((E,Q)=>{for(var O=0;O<Q.length;O++)if(-1<E.indexOf(Q[O]))return!0;return!1})(R,u.BAD_DELIMITERS)||-1<R.indexOf(w)||R.charAt(0)===" "||R.charAt(R.length-1)===" ")?ne+R+ne:R)}},u.RECORD_SEP="",u.UNIT_SEP="",u.BYTE_ORDER_MARK="\uFEFF",u.BAD_DELIMITERS=["\r",`
`,'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!n&&!!r.Worker,u.NODE_STREAM_INPUT=1,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=Y,u.ParserHandle=f,u.NetworkStreamer=g,u.FileStreamer=C,u.StringStreamer=T,u.ReadableStreamStreamer=K,r.jQuery&&((o=r.jQuery).fn.parse=function(l){var c=l.config||{},m=[];return this.each(function(q){if(!(o(this).prop("tagName").toUpperCase()==="INPUT"&&o(this).attr("type").toLowerCase()==="file"&&r.FileReader)||!this.files||this.files.length===0)return!0;for(var ne=0;ne<this.files.length;ne++)m.push({file:this.files[ne],inputElem:this,instanceConfig:o.extend({},c)})}),j(),this;function j(){if(m.length===0)z(l.complete)&&l.complete();else{var q,ne,pe,je,$=m[0];if(z(l.before)){var se=l.before($.file,$.inputElem);if(typeof se=="object"){if(se.action==="abort")return q="AbortError",ne=$.file,pe=$.inputElem,je=se.reason,void(z(l.error)&&l.error({name:q},ne,pe,je));if(se.action==="skip")return void w();typeof se.config=="object"&&($.instanceConfig=o.extend($.instanceConfig,se.config))}else if(se==="skip")return void w()}var k=$.instanceConfig.complete;$.instanceConfig.complete=function(de){z(k)&&k(de,$.file,$.inputElem),w()},u.parse($.file,$.instanceConfig)}}function w(){m.splice(0,1),j()}}),i&&(r.onmessage=function(l){l=l.data,u.WORKER_ID===void 0&&l&&(u.WORKER_ID=l.workerId),typeof l.input=="string"?r.postMessage({workerId:u.WORKER_ID,results:u.parse(l.input,l.config),finished:!0}):(r.File&&l.input instanceof File||l.input instanceof Object)&&(l=u.parse(l.input,l.config))&&r.postMessage({workerId:u.WORKER_ID,results:l,finished:!0})}),(g.prototype=Object.create(b.prototype)).constructor=g,(C.prototype=Object.create(b.prototype)).constructor=C,(T.prototype=Object.create(T.prototype)).constructor=T,(K.prototype=Object.create(b.prototype)).constructor=K,u})})(ys)),ys.exports}var Bo=zo();const Qa=jo(Bo),Uo=$r,Mi=Lr,Jo=qr,Za=x.forwardRef(({className:s,...t},a)=>e.jsx(ua,{className:_("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a}));Za.displayName=ua.displayName;const Xa=x.forwardRef(({className:s,...t},a)=>e.jsxs(Jo,{children:[e.jsx(Za,{}),e.jsx(ia,{ref:a,className:_("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]}));Xa.displayName=ia.displayName;const Ya=({className:s,...t})=>e.jsx("div",{className:_("flex flex-col space-y-2 text-center sm:text-left",s),...t});Ya.displayName="AlertDialogHeader";const er=({className:s,...t})=>e.jsx("div",{className:_("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t});er.displayName="AlertDialogFooter";const sr=x.forwardRef(({className:s,...t},a)=>e.jsx(la,{ref:a,className:_("text-lg font-semibold",s),...t}));sr.displayName=la.displayName;const tr=x.forwardRef(({className:s,...t},a)=>e.jsx(ca,{ref:a,className:_("text-sm text-muted-foreground",s),...t}));tr.displayName=ca.displayName;const ar=x.forwardRef(({className:s,...t},a)=>e.jsx(ma,{ref:a,className:_(va(),s),...t}));ar.displayName=ma.displayName;const rr=x.forwardRef(({className:s,...t},a)=>e.jsx(da,{ref:a,className:_(va({variant:"outline"}),"mt-2 sm:mt-0",s),...t}));rr.displayName=da.displayName;function Ho(s){return s&&s.replace(/(\d{3})\.\d{3}\.\d{3}-(\d{2})/,"$1.***.***-$2")}function Ko(s){return s&&s.replace(/(\d{2})\.\d{3}\.\d{3}\/\d{4}-(\d{2})/,"$1.***.***/**-$2")}function Go(s){if(!s)return s;const[t,a]=s.split("@");return t.length<=2?`${t}***@${a}`:`${t.slice(0,2)}***@${a}`}function Wo(s){return s&&s.replace(/(\d{2})\d{4,5}(\d{4})/,"$1****$2")}function Qo(s){return s&&s.replace(/(\d{2,3})\d+/,"$1***")}function Zo(s){if(!s)return s;let t=s;return t=t.replace(/\d{3}\.\d{3}\.\d{3}-\d{2}/g,a=>Ho(a)),t=t.replace(/\d{2}\.\d{3}\.\d{3}\/\d{4}-\d{2}/g,a=>Ko(a)),t=t.replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,a=>Go(a)),t=t.replace(/\(\d{2}\)\s?\d{4,5}-?\d{4}/g,a=>Wo(a)),t=t.replace(/OAB[-/]?\s?\d{3,6}/gi,a=>{const r=a.match(/\d{3,6}/)?.[0]||"";return a.replace(r,Qo(r))}),t}function Je(s,t){if(!t||!s)return s;if(typeof s=="string")return Zo(s);if(Array.isArray(s))return s.map(a=>Je(a,t));if(typeof s=="object"){const a={};for(const[r,o]of Object.entries(s))a[r]=Je(o,t);return a}return s}function as({items:s,maxVisible:t=2,isPiiMasked:a=!1}){const{toast:r}=ke();if(!s||s.length===0)return e.jsx("span",{className:"text-muted-foreground",children:"—"});const o=Je(s,a),n=o.slice(0,t),i=s.length-t,d=async()=>{try{await navigator.clipboard.writeText(s.join(`
`)),r({title:"Copiado!",description:"Lista copiada para a área de transferência."})}catch{r({title:"Erro ao copiar",description:"Não foi possível copiar a lista.",variant:"destructive"})}};return s.length<=t?e.jsx("div",{className:"flex flex-wrap gap-1",children:n.map((h,u)=>e.jsx(L,{variant:"secondary",className:"text-xs",children:h},u))}):e.jsxs("div",{className:"flex items-center gap-1",children:[n.map((h,u)=>e.jsx(L,{variant:"secondary",className:"text-xs",children:h},u)),i>0&&e.jsxs(ya,{children:[e.jsx(wa,{asChild:!0,children:e.jsxs(P,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",children:["+",i," ",e.jsx(ms,{className:"ml-1 h-3 w-3"})]})}),e.jsx(Ca,{className:"w-80",align:"start",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium",children:["Lista completa (",s.length," itens)"]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:d,className:"h-8 px-2",children:e.jsx(es,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap gap-1 max-h-48 overflow-y-auto",children:o.map((h,u)=>e.jsx(L,{variant:"outline",className:"text-xs",children:h},u))})]})})]})]})}const Xo=["⏱ Mapeando conexões de testemunhas…","🔎 Checando histórico probatório…","⚖️ Analisando padrões de triangulação…","📋 Identificando riscos processuais…","👥 Cruzando dados do polo ativo…","🎯 Gerando insights estratégicos…","📊 Compilando relatório executivo…"],S=Xt(s=>({processos:[],testemunhas:[],activeTab:"processos",selectedProcesso:null,selectedTestemunha:null,isDetailDrawerOpen:!1,isImportModalOpen:!1,isLoading:!1,isPiiMasked:!1,hasError:!1,errorMessage:"",lastUpdate:null,processoFilters:{},testemunhaFilters:{},columnVisibility:{processos:{cnj:!0,uf:!0,comarca:!0,fase:!0,status:!0,reclamante:!0,qtdDepos:!0,testemunhas:!0,classificacao:!0,acoes:!0},testemunhas:{nome:!0,qtdDepo:!0,ambosPolos:!0,jaReclamante:!0,cnjs:!0,classificacao:!0,acoes:!0}},savedViews:{},activeView:null,processosPage:1,testemunhasPage:1,pageSize:100,totalProcessos:0,totalTestemunhas:0,hasMoreProcessos:!1,hasMoreTestemunhas:!1,chatKind:"processo",chatInput:"",chatMessages:[],chatStatus:"idle",agentOnline:!0,chatResult:null,loadingHints:Xo,currentHintIndex:0,density:"comfortable",navigationHistory:[{label:"Mapa de Testemunhas",path:"/mapa-testemunhas"}],setActiveTab:t=>s(a=>a.activeTab===t?a:{activeTab:t}),setProcessos:t=>s(a=>JSON.stringify(a.processos)===JSON.stringify(t)?a:{processos:t}),setTestemunhas:t=>s(a=>JSON.stringify(a.testemunhas)===JSON.stringify(t)?a:{testemunhas:t}),setSelectedProcesso:t=>s(a=>a.selectedProcesso?.cnj===t?.cnj?a:{selectedProcesso:t}),setSelectedTestemunha:t=>s(a=>a.selectedTestemunha?.nome_testemunha===t?.nome_testemunha?a:{selectedTestemunha:t}),setIsDetailDrawerOpen:t=>s(a=>a.isDetailDrawerOpen===t?a:{isDetailDrawerOpen:t}),setIsImportModalOpen:t=>s(a=>a.isImportModalOpen===t?a:{isImportModalOpen:t}),setIsLoading:t=>s(a=>a.isLoading===t?a:{isLoading:t}),setIsPiiMasked:t=>s(a=>a.isPiiMasked===t?a:{isPiiMasked:t}),setError:(t,a="")=>s(r=>r.hasError===t&&r.errorMessage===a?r:{hasError:t,errorMessage:a}),setLastUpdate:t=>s(a=>a.lastUpdate?.getTime()===t?.getTime()?a:{lastUpdate:t}),setProcessoFilters:t=>s(a=>{const r={...a.processoFilters,...t};return Object.keys(t).forEach(o=>{t[o]===void 0&&delete r[o]}),{processoFilters:r,processosPage:1}}),setTestemunhaFilters:t=>s(a=>{const r={...a.testemunhaFilters,...t};return Object.keys(t).forEach(o=>{t[o]===void 0&&delete r[o]}),{testemunhaFilters:r,testemunhasPage:1}}),setColumnVisibility:(t,a,r)=>s(o=>({columnVisibility:{...o.columnVisibility,[t]:{...o.columnVisibility[t],[a]:r}}})),saveView:(t,a)=>s(r=>{const o={...r.savedViews,[t]:{processoFilters:r.processoFilters,testemunhaFilters:r.testemunhaFilters,columnVisibility:r.columnVisibility}};return typeof window<"u"&&typeof localStorage<"u"&&(localStorage.setItem(`mapaViews_${a}`,JSON.stringify(o)),localStorage.setItem(`mapaActiveView_${a}`,t)),{savedViews:o,activeView:t}}),loadViews:t=>{if(typeof window>"u"||typeof localStorage>"u")return;const a=localStorage.getItem(`mapaViews_${t}`),r=a?JSON.parse(a):{},o=localStorage.getItem(`mapaActiveView_${t}`);s({savedViews:r,activeView:o}),o&&r[o]&&s({processoFilters:r[o].processoFilters,testemunhaFilters:r[o].testemunhaFilters,columnVisibility:r[o].columnVisibility})},setActiveViewName:(t,a)=>s(r=>{const o=r.savedViews[t];return o?(typeof window<"u"&&typeof localStorage<"u"&&localStorage.setItem(`mapaActiveView_${a}`,t),{activeView:t,processoFilters:o.processoFilters,testemunhaFilters:o.testemunhaFilters,columnVisibility:o.columnVisibility}):{}}),setProcessosPage:t=>s({processosPage:t}),setTestemunhasPage:t=>s({testemunhasPage:t}),setTotalProcessos:t=>s({totalProcessos:t}),setTotalTestemunhas:t=>s({totalTestemunhas:t}),setHasMoreProcessos:t=>s({hasMoreProcessos:t}),setHasMoreTestemunhas:t=>s({hasMoreTestemunhas:t}),loadMoreProcessos:()=>s(t=>({processosPage:t.processosPage+1})),loadMoreTestemunhas:()=>s(t=>({testemunhasPage:t.testemunhasPage+1})),removeProcesso:t=>{let a=null;return s(r=>{const o=r.processos.findIndex(i=>i.cnj===t);if(o===-1)return{};a=r.processos[o];const n=[...r.processos];return n.splice(o,1),{processos:n,totalProcessos:r.totalProcessos-1}}),a},restoreProcesso:t=>s(a=>({processos:[t,...a.processos],totalProcessos:a.totalProcessos+1})),removeTestemunha:t=>{let a=null;return s(r=>{const o=r.testemunhas.findIndex(i=>i.nome_testemunha===t);if(o===-1)return{};a=r.testemunhas[o];const n=[...r.testemunhas];return n.splice(o,1),{testemunhas:n,totalTestemunhas:r.totalTestemunhas-1}}),a},restoreTestemunha:t=>s(a=>({testemunhas:[t,...a.testemunhas],totalTestemunhas:a.totalTestemunhas+1})),resetFilters:()=>s({processoFilters:{},testemunhaFilters:{},processosPage:1,testemunhasPage:1}),setChatKind:t=>s({chatKind:t}),setChatInput:t=>s({chatInput:t}),addChatMessage:t=>{const a={...t,id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:new Date};return s(r=>({chatMessages:[...r.chatMessages,a]})),a.id},updateChatMessage:(t,a)=>s(r=>({chatMessages:r.chatMessages.map(o=>o.id===t?{...o,...a}:o)})),setChatStatus:t=>s({chatStatus:t}),setAgentOnline:t=>s({agentOnline:t}),setChatResult:t=>s({chatResult:t}),resetChat:()=>s({chatInput:"",chatMessages:[],chatStatus:"idle",chatResult:null,currentHintIndex:0}),nextHint:()=>s(t=>({currentHintIndex:(t.currentHintIndex+1)%t.loadingHints.length})),setDensity:t=>s({density:t}),pushNavigation:t=>s(a=>a.navigationHistory[a.navigationHistory.length-1]?.path===t.path?{}:{navigationHistory:[...a.navigationHistory,t]}),popNavigation:t=>s(a=>({navigationHistory:a.navigationHistory.slice(0,t+1)})),clearNavigation:()=>s({navigationHistory:[{label:"Mapa de Testemunhas",path:"/mapa-testemunhas"}]})})),or=s=>s.activeTab,Yo=s=>s.processos,en=s=>s.testemunhas,sn=s=>s.isLoading,tn=s=>s.isPiiMasked,an=s=>s.hasError,rn=s=>s.errorMessage,on=s=>s.lastUpdate,nn=s=>s.processoFilters,ln=s=>s.testemunhaFilters,cn=s=>s.isImportModalOpen,ut=s=>s.columnVisibility,dn=s=>s.savedViews,mn=s=>s.activeView;function nr({score:s,riscoNivel:t,className:a}){const n=t?(i=>{switch(i){case"critico":return{level:"Crítico",color:"bg-red-600 text-white border-red-700"};case"alto":return{level:"Alto",color:"bg-destructive text-destructive-foreground"};case"medio":return{level:"Médio",color:"bg-amber-500/15 text-amber-600 border-amber-500/30"};case"baixo":return{level:"Baixo",color:"bg-emerald-500/15 text-emerald-600 border-emerald-500/30"}}})(t):s!==void 0?(i=>i>=70?{level:"VALIDAR",color:"bg-destructive text-destructive-foreground",riscoNivel:"alto"}:i>=50?{level:"AVALIAR",color:"bg-warning text-warning-foreground",riscoNivel:"medio"}:i>=30?{level:"CONHECER",color:"bg-success text-success-foreground",riscoNivel:"baixo"}:{level:"DESCARTAR",color:"bg-muted text-muted-foreground",riscoNivel:"baixo"})(s):{level:"N/A",color:"bg-muted text-muted-foreground"};return e.jsxs(L,{className:_("font-semibold px-3 py-1 shadow-sm",n.color,a),children:[n.level,s!==void 0&&!t?` (${s})`:""]})}function ir(s){const{toast:t}=ke(),a=x.useRef(new Map);return{remove:({key:o,label:n,onDelete:i,onRestore:d})=>{const h=i();if(!h)return;a.current.set(o,h);const u=()=>{const b=a.current.get(o);b&&(d(b),a.current.delete(o))};t({title:`${s} removido`,description:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:n}),e.jsxs(P,{variant:"outline",size:"sm",onClick:u,className:"ml-2 h-6 px-2 text-xs",children:[e.jsx(Vr,{className:"h-3 w-3 mr-1"}),"Desfazer"]})]}),duration:5e3}),setTimeout(()=>{a.current.delete(o)},5e3)}}}function ht({open:s,title:t,description:a,confirmText:r="Confirmar",cancelText:o="Cancelar",loading:n=!1,onConfirm:i,onCancel:d}){return e.jsx(Uo,{open:s,onOpenChange:h=>!h&&d(),children:e.jsxs(Xa,{children:[e.jsxs(Ya,{children:[e.jsx(sr,{children:t}),a&&e.jsx(tr,{children:a})]}),e.jsxs(er,{children:[e.jsx(rr,{disabled:n,children:o}),e.jsxs(ar,{onClick:i,disabled:n,children:[n&&e.jsx(ds,{className:"mr-2 h-4 w-4 animate-spin"}),r]})]})]})})}const lr={density:{compact:{row:"py-1",cell:"px-3 py-1",text:"text-xs",badge:"text-[10px] px-1.5 py-0",button:"h-6 w-6",icon:"h-3 w-3"},comfortable:{row:"py-3",cell:"px-4 py-3",text:"text-sm",badge:"text-xs px-2 py-0.5",button:"h-8 w-8",icon:"h-4 w-4"}}};function un({data:s}){const{setSelectedProcesso:t,setIsDetailDrawerOpen:a,isPiiMasked:r,removeProcesso:o,restoreProcesso:n,density:i}=S(),d=S(ut).processos,{remove:h}=ir("Processo"),[u,b]=x.useState(null),[g,C]=x.useState(!1),T=lr.density[i],K=56,f=40,B=x.useRef(null),[Y,U]=x.useState(0);x.useEffect(()=>{U(0)},[s.length]);const W=Math.min(Y+f,s.length),oe=x.useMemo(()=>s.slice(Y,W),[s,Y,W]),H=x.useCallback(()=>{const m=B.current;if(!m)return;const j=Math.floor(m.scrollTop/K);j!==Y&&U(j)},[Y]),J=x.useCallback(m=>{t(m),a(!0)},[t,a]),z=x.useCallback(m=>{b(m),C(!0)},[]),l=x.useCallback(()=>{u&&h({key:u.cnj,label:u.cnj,onDelete:()=>o(u.cnj),onRestore:n}),C(!1),b(null)},[u,h,o,n]),c=m=>{switch(m?.toLowerCase()){case"ativo":return"bg-success text-success-foreground";case"arquivado":return"bg-muted text-muted-foreground";case"suspenso":return"bg-warning text-warning-foreground";case"baixado":return"bg-secondary text-secondary-foreground";case"cancelado":return"bg-destructive text-destructive-foreground";default:return"bg-muted text-muted-foreground"}};return s.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:B,onScroll:H,className:"border border-border/50 rounded-2xl overflow-auto max-h-[70vh]",children:e.jsxs(Sa,{children:[e.jsx(Ta,{children:e.jsxs(Qe,{className:"bg-muted/30",children:[d.cnj&&e.jsx(be,{className:"font-semibold",children:"CNJ"}),d.uf&&e.jsx(be,{className:"font-semibold",children:"UF"}),d.comarca&&e.jsx(be,{className:"font-semibold",children:"Comarca"}),d.fase&&e.jsx(be,{className:"font-semibold",children:"Fase"}),d.status&&e.jsx(be,{className:"font-semibold",children:"Status"}),d.reclamante&&e.jsx(be,{className:"font-semibold",children:"Reclamante"}),d.qtdDepos&&e.jsx(be,{className:"font-semibold",children:"Qtd Depo Únicos"}),d.testemunhas&&e.jsx(be,{className:"font-semibold",children:"Testemunhas Ativo"}),d.classificacao&&e.jsx(be,{className:"font-semibold",children:"Classificação"}),d.acoes&&e.jsx(be,{className:"font-semibold text-center",children:"Ações"})]})}),e.jsxs(Ea,{children:[Y>0&&e.jsx(Qe,{children:e.jsx(xe,{colSpan:12,style:{height:Y*K,padding:0}})}),oe.map(m=>e.jsxs(Qe,{className:_("hover:bg-muted/20",T.row),children:[d.cnj&&e.jsx(xe,{className:_("font-mono",T.cell,T.text),children:String(Je(m.cnj,r))}),d.uf&&e.jsx(xe,{className:T.cell,children:e.jsx(L,{variant:"outline",className:T.badge,children:m.uf})}),d.comarca&&e.jsx(xe,{className:_("max-w-[150px] truncate",T.cell,T.text),title:m.comarca||"",children:String(Je(m.comarca,r)||"—")}),d.fase&&e.jsx(xe,{className:T.cell,children:e.jsx(L,{variant:"secondary",className:T.badge,children:m.fase||"—"})}),d.status&&e.jsx(xe,{className:T.cell,children:e.jsx(L,{className:_(T.badge,c(m.status)),children:m.status||"—"})}),d.reclamante&&e.jsx(xe,{className:_("max-w-[180px] truncate",T.cell,T.text),title:m.reclamante_limpo||"",children:String(Je(m.reclamante_limpo,r)||"—")}),d.qtdDepos&&e.jsx(xe,{className:_("text-center",T.cell),children:m.qtd_total_depos_unicos?e.jsx(nr,{score:m.qtd_total_depos_unicos}):"—"}),d.testemunhas&&e.jsx(xe,{className:T.cell,children:e.jsx(as,{items:m.testemunhas_ativo_limpo,maxVisible:2,isPiiMasked:r})}),d.classificacao&&e.jsx(xe,{className:T.cell,children:e.jsx(L,{variant:m.classificacao_final==="ALTO RISCO"?"destructive":"secondary",className:T.badge,children:m.classificacao_final||"—"})}),d.acoes&&e.jsx(xe,{className:T.cell,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>J(m),className:_("p-0",T.button),children:e.jsx(He,{className:T.icon})}),e.jsx(P,{variant:"ghost",size:"sm",className:_("p-0",T.button),children:e.jsx(ha,{className:T.icon})}),e.jsx(P,{variant:"ghost",size:"sm",className:_("p-0 text-destructive hover:text-destructive",T.button),onClick:()=>z(m),children:e.jsx(xa,{className:T.icon})})]})})]},m.cnj)),W<s.length&&e.jsx(Qe,{children:e.jsx(xe,{colSpan:12,style:{height:(s.length-W)*K,padding:0}})})]})]})}),e.jsx(ht,{open:g,title:"Excluir processo?",description:u?`Deseja excluir o processo ${u.cnj}?`:void 0,confirmText:"Excluir",onConfirm:l,onCancel:()=>{C(!1),b(null)}})]}):e.jsx("div",{className:"border border-border/50 rounded-2xl p-12 text-center",children:e.jsxs("div",{className:"text-muted-foreground space-y-2",children:[e.jsx("p",{className:"text-lg",children:"Nenhum processo encontrado"}),e.jsx("p",{className:"text-sm",children:"Ajuste os filtros ou importe dados via Excel"})]})})}function _t({value:s,trueLabel:t="Sim",falseLabel:a="Não",size:r="md",className:o}){return s==null?e.jsx(L,{variant:"outline",className:_("font-normal text-muted-foreground",r==="sm"?"text-[10px] px-1.5":"text-xs px-2",o),children:"—"}):s===!0?e.jsx(L,{variant:"outline",className:_("bg-green-100 text-green-800 border-green-200 font-medium","dark:bg-green-950/30 dark:text-green-400 dark:border-green-900",r==="sm"?"text-[10px] px-1.5":"text-xs px-2",o),children:t}):e.jsx(L,{variant:"outline",className:_("bg-gray-100 text-gray-600 border-gray-200 font-normal","dark:bg-gray-900/30 dark:text-gray-400 dark:border-gray-800",r==="sm"?"text-[10px] px-1.5":"text-xs px-2",o),children:a})}function hn({value:s,size:t="md"}){if(!s||s==="—"||s==="PENDENTE"||s==="")return e.jsx(L,{variant:"outline",className:_("font-normal text-muted-foreground",t==="sm"?"text-[10px] px-1.5 py-0":"text-xs"),children:"Não classificada"});const a=s.toLowerCase(),r=()=>a.includes("crítica")||a.includes("alto")||a.includes("alta")?"bg-red-100 text-red-800 border-red-200 dark:bg-red-950/30 dark:text-red-400 dark:border-red-900":a.includes("relevante")||a.includes("médio")||a.includes("media")?"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-950/30 dark:text-yellow-400 dark:border-yellow-900":a.includes("comum")||a.includes("baixo")||a.includes("baixa")?"bg-green-100 text-green-800 border-green-200 dark:bg-green-950/30 dark:text-green-400 dark:border-green-900":"bg-secondary text-secondary-foreground";return e.jsx(L,{variant:"outline",className:_("font-medium border",r(),t==="sm"?"text-[10px] px-1.5 py-0":"text-xs"),children:s})}function vs({status:s,onRetry:t,children:a}){return s==="loading"?e.jsx("div",{className:"p-8 text-center text-sm text-muted-foreground",children:"Carregando..."}):s==="error"?e.jsxs("div",{className:"p-8 text-center space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-destructive",children:[e.jsx(gs,{className:"h-4 w-4"}),e.jsx("span",{children:"Erro ao carregar"})]}),t&&e.jsx(P,{variant:"outline",size:"sm",onClick:t,children:"Tentar novamente"})]}):s==="offline"?e.jsxs("div",{className:"p-8 text-center space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-destructive",children:[e.jsx(gs,{className:"h-4 w-4"}),e.jsx("span",{children:"Sem conexão"})]}),t&&e.jsx(P,{variant:"outline",size:"sm",onClick:t,children:"Tentar novamente"})]}):s==="empty"?e.jsx("div",{className:"p-12 text-center text-muted-foreground",children:"Nenhum dado encontrado"}):e.jsx(e.Fragment,{children:a})}function xn({data:s,status:t,onRetry:a}){const{setSelectedTestemunha:r,setIsDetailDrawerOpen:o,isPiiMasked:n,removeTestemunha:i,restoreTestemunha:d,density:h}=S(),u=S(ut).testemunhas,{remove:b}=ir("Testemunha"),[g,C]=x.useState(null),[T,K]=x.useState(!1),f=lr.density[h],B=56,Y=40,U=x.useRef(null),[W,oe]=x.useState(0);x.useEffect(()=>{oe(0)},[s.length]);const H=Math.min(W+Y,s.length),J=x.useMemo(()=>s.slice(W,H),[s,W,H]),z=x.useCallback(()=>{const j=U.current;if(!j)return;const w=Math.floor(j.scrollTop/B);w!==W&&oe(w)},[W]),l=x.useCallback(j=>{r(j),o(!0)},[r,o]),c=x.useCallback(j=>{C(j),K(!0)},[]),m=x.useCallback(()=>{g&&b({key:g.nome_testemunha,label:g.nome_testemunha,onDelete:()=>i(g.nome_testemunha),onRestore:d}),K(!1),C(null)},[g,b,i,d]);return t!=="success"?e.jsx(vs,{status:t,onRetry:a}):s.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:U,onScroll:z,className:"border border-border/50 rounded-2xl overflow-auto max-h-[70vh]",children:e.jsxs(Sa,{children:[e.jsx(Ta,{children:e.jsxs(Qe,{className:"bg-muted/30",children:[u.nome&&e.jsx(be,{className:"font-semibold",children:"Nome da Testemunha"}),u.qtdDepo&&e.jsx(be,{className:"font-semibold text-center",children:"Qtd Depoimentos"}),u.ambosPolos&&e.jsx(be,{className:"font-semibold text-center",children:"Ambos os Polos"}),u.jaReclamante&&e.jsx(be,{className:"font-semibold text-center",children:"Já Foi Reclamante"}),u.cnjs&&e.jsx(be,{className:"font-semibold",children:"CNJs como Testemunha"}),u.classificacao&&e.jsx(be,{className:"font-semibold",children:"Classificação Estratégica"}),u.acoes&&e.jsx(be,{className:"font-semibold text-center",children:"Ações"})]})}),e.jsxs(Ea,{children:[W>0&&e.jsx(Qe,{children:e.jsx(xe,{colSpan:12,style:{height:W*B,padding:0}})}),J.map(j=>e.jsxs(Qe,{className:_("group hover:bg-muted/20",f.row),children:[u.nome&&e.jsx(xe,{className:_("font-medium max-w-[200px] truncate",f.cell,f.text),title:j.nome_testemunha,children:String(Je(j.nome_testemunha,n))}),u.qtdDepo&&e.jsx(xe,{className:_("text-center",f.cell),children:e.jsx(L,{variant:"secondary",className:f.badge,children:j.qtd_depoimentos||0})}),u.ambosPolos&&e.jsx(xe,{className:_("text-center",f.cell),children:e.jsx(_t,{value:j.foi_testemunha_em_ambos_polos,size:"sm"})}),u.jaReclamante&&e.jsx(xe,{className:_("text-center",f.cell),children:e.jsx(_t,{value:j.ja_foi_reclamante,size:"sm"})}),u.cnjs&&e.jsx(xe,{className:f.cell,children:e.jsx(as,{items:j.cnjs_como_testemunha??null,maxVisible:2,isPiiMasked:n})}),u.classificacao&&e.jsx(xe,{className:f.cell,children:e.jsx(hn,{value:j.classificacao||j.classificacao_estrategica,size:"sm"})}),u.acoes&&e.jsx(xe,{className:f.cell,children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>l(j),className:_("p-0 text-primary hover:bg-primary/10 hover:text-primary",f.button),title:"Visualizar detalhes",children:e.jsx(He,{className:f.icon,strokeWidth:2})}),e.jsx(P,{variant:"ghost",size:"sm",className:_("p-0 text-muted-foreground hover:text-foreground hover:bg-muted",f.button),title:"Editar",children:e.jsx(ha,{className:f.icon,strokeWidth:1.5})}),e.jsx(P,{variant:"ghost",size:"sm",className:_("p-0 opacity-0 group-hover:opacity-100 text-destructive hover:bg-destructive/10 hover:text-destructive transition-opacity",f.button),onClick:()=>c(j),title:"Excluir",children:e.jsx(xa,{className:f.icon,strokeWidth:1.5})})]})})]},j.nome_testemunha)),H<s.length&&e.jsx(Qe,{children:e.jsx(xe,{colSpan:12,style:{height:(s.length-H)*B,padding:0}})})]})]})}),e.jsx(ht,{open:T,title:"Excluir testemunha?",description:g?`Deseja excluir ${g.nome_testemunha}?`:void 0,confirmText:"Excluir",onConfirm:m,onCancel:()=>{K(!1),C(null)}})]}):e.jsx(vs,{status:"empty",onRetry:a})}const pn=["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO"],fn=["Ativo","Arquivado","Suspenso","Baixado","Cancelado"],gn=["Conhecimento","Execução","Recursal","Liquidação"];function jn(){const{processoFilters:s,setProcessoFilters:t,resetFilters:a}=S(),r=(i,d)=>{if(d===""||d===void 0||d==="TODAS"||d==="TODOS"){const h={...s};delete h[i],t(h)}else t({[i]:d})},o=()=>{a()},n=Object.keys(s).length>0;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(cs,{className:"h-5 w-5"}),"Filtros - Por Processo"]}),n&&e.jsxs(P,{variant:"ghost",size:"sm",onClick:o,children:[e.jsx(Ye,{className:"h-4 w-4 mr-1"}),"Limpar"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"search",children:"Buscar"}),e.jsx(We,{id:"search",placeholder:"CNJ, comarca, reclamante...",value:s.search||"",onChange:i=>r("search",i.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"testemunha",children:"Testemunha"}),e.jsx(We,{id:"testemunha",placeholder:"Nome da testemunha...",value:s.testemunha||"",onChange:i=>r("testemunha",i.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"uf",children:"UF"}),e.jsxs(Ze,{value:s.uf||"TODAS",onValueChange:i=>r("uf",i),children:[e.jsx(Be,{id:"uf",children:e.jsx(Xe,{placeholder:"Selecione..."})}),e.jsxs(Ue,{children:[e.jsx(ge,{value:"TODAS",children:"Todas"}),pn.map(i=>e.jsx(ge,{value:i,children:i},i))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"status",children:"Status"}),e.jsxs(Ze,{value:s.status||"TODOS",onValueChange:i=>r("status",i),children:[e.jsx(Be,{id:"status",children:e.jsx(Xe,{placeholder:"Selecione..."})}),e.jsxs(Ue,{children:[e.jsx(ge,{value:"TODOS",children:"Todos"}),fn.map(i=>e.jsx(ge,{value:i,children:i},i))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"fase",children:"Fase"}),e.jsxs(Ze,{value:s.fase||"TODAS",onValueChange:i=>r("fase",i),children:[e.jsx(Be,{id:"fase",children:e.jsx(Xe,{placeholder:"Selecione..."})}),e.jsxs(Ue,{children:[e.jsx(ge,{value:"TODAS",children:"Todas"}),gn.map(i=>e.jsx(ge,{value:i,children:i},i))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"qtdMin",children:"Qtd Depo Únicos (Mín)"}),e.jsx(We,{id:"qtdMin",type:"number",placeholder:"0",value:s.qtdDeposMin||"",onChange:i=>r("qtdDeposMin",i.target.value?Number(i.target.value):void 0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"qtdMax",children:"Qtd Depo Únicos (Máx)"}),e.jsx(We,{id:"qtdMax",type:"number",placeholder:"∞",value:s.qtdDeposMax||"",onChange:i=>r("qtdDeposMax",i.target.value?Number(i.target.value):void 0)})]})]})]})}function vn(){const{testemunhaFilters:s,setTestemunhaFilters:t,resetFilters:a}=S(),r=(i,d)=>{if(d===""||d===void 0||d==="TODOS"){const h={...s};delete h[i],t(h)}else t({[i]:d})},o=()=>{a()},n=Object.keys(s).length>0;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(cs,{className:"h-5 w-5"}),"Filtros - Por Testemunha"]}),n&&e.jsxs(P,{variant:"ghost",size:"sm",onClick:o,children:[e.jsx(Ye,{className:"h-4 w-4 mr-1"}),"Limpar"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"search",children:"Buscar"}),e.jsx(We,{id:"search",placeholder:"Nome da testemunha...",value:s.search||"",onChange:i=>r("search",i.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"ambosPolos",children:"Em Ambos os Polos"}),e.jsxs(Ze,{value:s.ambosPolos!==void 0?s.ambosPolos.toString():"TODOS",onValueChange:i=>r("ambosPolos",i==="TODOS"?void 0:i==="true"),children:[e.jsx(Be,{id:"ambosPolos",children:e.jsx(Xe,{placeholder:"Selecione..."})}),e.jsxs(Ue,{children:[e.jsx(ge,{value:"TODOS",children:"Todos"}),e.jsx(ge,{value:"true",children:"Sim"}),e.jsx(ge,{value:"false",children:"Não"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"jaFoiReclamante",children:"Já Foi Reclamante"}),e.jsxs(Ze,{value:s.jaFoiReclamante!==void 0?s.jaFoiReclamante.toString():"TODOS",onValueChange:i=>r("jaFoiReclamante",i==="TODOS"?void 0:i==="true"),children:[e.jsx(Be,{id:"jaFoiReclamante",children:e.jsx(Xe,{placeholder:"Selecione..."})}),e.jsxs(Ue,{children:[e.jsx(ge,{value:"TODOS",children:"Todos"}),e.jsx(ge,{value:"true",children:"Sim"}),e.jsx(ge,{value:"false",children:"Não"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"temTriangulacao",children:"Participou Triangulação"}),e.jsxs(Ze,{value:s.temTriangulacao!==void 0?s.temTriangulacao.toString():"TODOS",onValueChange:i=>r("temTriangulacao",i==="TODOS"?void 0:i==="true"),children:[e.jsx(Be,{id:"temTriangulacao",children:e.jsx(Xe,{placeholder:"Selecione..."})}),e.jsxs(Ue,{children:[e.jsx(ge,{value:"TODOS",children:"Todos"}),e.jsx(ge,{value:"true",children:"Sim"}),e.jsx(ge,{value:"false",children:"Não"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"temTroca",children:"Participou Troca"}),e.jsxs(Ze,{value:s.temTroca!==void 0?s.temTroca.toString():"TODOS",onValueChange:i=>r("temTroca",i==="TODOS"?void 0:i==="true"),children:[e.jsx(Be,{id:"temTroca",children:e.jsx(Xe,{placeholder:"Selecione..."})}),e.jsxs(Ue,{children:[e.jsx(ge,{value:"TODOS",children:"Todos"}),e.jsx(ge,{value:"true",children:"Sim"}),e.jsx(ge,{value:"false",children:"Não"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"qtdMin",children:"Qtd Depoimentos (Mín)"}),e.jsx(We,{id:"qtdMin",type:"number",placeholder:"0",value:s.qtdDeposMin||"",onChange:i=>r("qtdDeposMin",i.target.value?Number(i.target.value):void 0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{htmlFor:"qtdMax",children:"Qtd Depoimentos (Máx)"}),e.jsx(We,{id:"qtdMax",type:"number",placeholder:"∞",value:s.qtdDeposMax||"",onChange:i=>r("qtdDeposMax",i.target.value?Number(i.target.value):void 0)})]})]})]})}function bn({open:s,onOpenChange:t}){const a=S(n=>n.activeTab),[r,o]=x.useState(a==="processos"?"processos":"testemunhas");return x.useEffect(()=>{o(a==="processos"?"processos":"testemunhas")},[a]),e.jsx(Oa,{open:s,onOpenChange:t,children:e.jsxs(it,{side:"right",className:"w-[600px] sm:w-[700px] overflow-y-auto",children:[e.jsxs(lt,{children:[e.jsx(ct,{children:"Filtros Avançados"}),e.jsx(dt,{children:"Refine sua busca com filtros específicos por processo ou testemunha"})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(ba,{value:r,onValueChange:o,children:[e.jsxs(Na,{className:"grid w-full grid-cols-2",children:[e.jsx(Rs,{value:"processos",children:"Por Processo"}),e.jsx(Rs,{value:"testemunhas",children:"Por Testemunha"})]}),e.jsx(Ps,{value:"processos",className:"mt-4",children:e.jsx(jn,{})}),e.jsx(Ps,{value:"testemunhas",className:"mt-4",children:e.jsx(vn,{})})]})})]})})}function Nn(){const s=S(or),t=S(ut),a=S(n=>n.setColumnVisibility),r=s==="processos"?[{key:"cnj",label:"CNJ"},{key:"uf",label:"UF"},{key:"comarca",label:"Comarca"},{key:"fase",label:"Fase"},{key:"status",label:"Status"},{key:"reclamante",label:"Reclamante"},{key:"qtdDepos",label:"Qtd Depo Únicos"},{key:"testemunhas",label:"Testemunhas Ativo"},{key:"classificacao",label:"Classificação"},{key:"acoes",label:"Ações"}]:[{key:"nome",label:"Nome da Testemunha"},{key:"qtdDepo",label:"Qtd Depoimentos"},{key:"ambosPolos",label:"Ambos os Polos"},{key:"jaReclamante",label:"Já Foi Reclamante"},{key:"cnjs",label:"CNJs como Testemunha"},{key:"classificacao",label:"Classificação Estratégica"},{key:"acoes",label:"Ações"}],o=t[s];return e.jsxs(bs,{children:[e.jsx(Ns,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(zr,{className:"h-4 w-4"})," Colunas"]})}),e.jsx(hs,{align:"end",children:r.map(n=>e.jsx(Ma,{checked:o[n.key],onCheckedChange:i=>a(s,n.key,i),children:n.label},n.key))})]})}function _n({userId:s}){const t=S(dn),a=S(mn),r=S(i=>i.saveView),o=S(i=>i.setActiveViewName),n=()=>{const i=window.prompt("Nome da visualização");i&&r(i,s)};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ze,{value:a||"",onValueChange:i=>o(i,s),children:[e.jsx(Be,{className:"w-[200px]",children:e.jsx(Xe,{placeholder:"Visualizações"})}),e.jsx(Ue,{children:Object.keys(t).map(i=>e.jsx(ge,{value:i,children:i},i))})]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:n,className:"flex items-center gap-2",children:[e.jsx(Br,{className:"h-4 w-4"})," Salvar visão"]})]})}const cr=({shouldScaleBackground:s=!0,...t})=>e.jsx(Ke.Root,{shouldScaleBackground:s,...t});cr.displayName="Drawer";const yn=Ke.Portal,dr=x.forwardRef(({className:s,...t},a)=>e.jsx(Ke.Overlay,{ref:a,className:_("fixed inset-0 z-50 bg-black/80",s),...t}));dr.displayName=Ke.Overlay.displayName;const mr=x.forwardRef(({className:s,children:t,...a},r)=>e.jsxs(yn,{children:[e.jsx(dr,{}),e.jsxs(Ke.Content,{ref:r,className:_("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",s),...a,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),t]})]}));mr.displayName="DrawerContent";const ur=({className:s,...t})=>e.jsx("div",{className:_("grid gap-1.5 p-4 text-center sm:text-left",s),...t});ur.displayName="DrawerHeader";const hr=x.forwardRef(({className:s,...t},a)=>e.jsx(Ke.Title,{ref:a,className:_("text-lg font-semibold leading-none tracking-tight",s),...t}));hr.displayName=Ke.Title.displayName;const wn=x.forwardRef(({className:s,...t},a)=>e.jsx(Ke.Description,{ref:a,className:_("text-sm text-muted-foreground",s),...t}));wn.displayName=Ke.Description.displayName;function Cn(){const{isDetailDrawerOpen:s,setIsDetailDrawerOpen:t,selectedProcesso:a,selectedTestemunha:r,isPiiMasked:o}=S(),{toast:n}=ke(),i=async(u,b)=>{const g=String(Je(u,o));try{await navigator.clipboard.writeText(g),n({title:"Copiado!",description:`${b} copiado para a área de transferência.`})}catch{n({title:"Erro ao copiar",description:`Não foi possível copiar ${b}.`,variant:"destructive"})}},d=({value:u,label:b})=>e.jsxs("div",{className:"flex items-center gap-2",children:[u===null?e.jsx("span",{className:"text-muted-foreground",children:"—"}):u?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-4 w-4 text-success"}),e.jsx("span",{children:"Sim"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Js,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:"Não"})]}),b&&e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>i(u?.toString()||"N/A",b),className:"h-6 w-6 p-0",children:e.jsx(es,{className:"h-3 w-3"})})]}),h=({label:u,value:b,copyable:g=!1})=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:u}),g&&b&&e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>i(b.toString(),u),className:"h-6 w-6 p-0",children:e.jsx(es,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"font-mono text-sm break-all",children:b?String(Je(b.toString(),o)):"—"})]});return!s||!a&&!r?null:e.jsx(cr,{open:s,onOpenChange:t,children:e.jsxs(mr,{className:"max-w-4xl mx-auto",children:[e.jsx(ur,{children:e.jsx(hr,{children:a?`Processo ${a.cnj}`:`Testemunha ${r?.nome_testemunha}`})}),e.jsxs(Ha,{className:"h-[80vh] px-6 pb-6",children:[a&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-muted/20 rounded-xl p-4",children:e.jsx(L,{variant:"outline",className:"mb-2",children:"Conteúdo assistivo. Revisão humana obrigatória."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(h,{label:"CNJ",value:a.cnj,copyable:!0}),e.jsx(h,{label:"Status",value:a.status}),e.jsx(h,{label:"UF",value:a.uf}),e.jsx(h,{label:"Comarca",value:a.comarca,copyable:!0}),e.jsx(h,{label:"Fase",value:a.fase}),e.jsx(h,{label:"Reclamante",value:a.reclamante_limpo,copyable:!0})]}),e.jsx(Ge,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Advogados Parte Ativa"}),e.jsx(as,{items:a.advogados_parte_ativa,maxVisible:5,isPiiMasked:o})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Testemunhas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Polo Ativo"}),e.jsx(as,{items:a.testemunhas_ativo_limpo,maxVisible:5,isPiiMasked:o})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Polo Passivo"}),e.jsx(as,{items:a.testemunhas_passivo_limpo,maxVisible:5,isPiiMasked:o})]})]})]}),e.jsx(Ge,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Reclamante foi Testemunha"}),e.jsx(d,{value:a.reclamante_foi_testemunha})]}),e.jsx(h,{label:"Qtd Vezes Reclamante foi Testemunha",value:a.qtd_vezes_reclamante_foi_testemunha}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Troca Direta"}),e.jsx(d,{value:a.troca_direta})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Triangulação Confirmada"}),e.jsx(d,{value:a.triangulacao_confirmada})]})]}),e.jsx(Ge,{}),e.jsx(h,{label:"Classificação Final",value:a.classificacao_final}),e.jsx(h,{label:"Insight Estratégico",value:a.insight_estrategico,copyable:!0})]}),r&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-muted/20 rounded-xl p-4",children:e.jsx(L,{variant:"outline",className:"mb-2",children:"Conteúdo assistivo. Revisão humana obrigatória."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(h,{label:"Nome da Testemunha",value:r.nome_testemunha,copyable:!0}),e.jsx(h,{label:"Quantidade de Depoimentos",value:r.qtd_depoimentos})]}),e.jsx(Ge,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Já Foi Reclamante"}),e.jsx(d,{value:r.ja_foi_reclamante})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Foi Testemunha em Ambos os Polos"}),e.jsx(d,{value:r.foi_testemunha_em_ambos_polos})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Participou Troca Favor"}),e.jsx(d,{value:r.participou_troca_favor})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Participou Triangulação"}),e.jsx(d,{value:r.participou_triangulacao})]})]}),e.jsx(Ge,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"CNJs como Testemunha"}),e.jsx(as,{items:r.cnjs_como_testemunha??null,maxVisible:5,isPiiMasked:o})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"CNJs como Reclamante"}),e.jsx(as,{items:r.cnjs_como_reclamante??null,maxVisible:5,isPiiMasked:o})]}),e.jsx(Ge,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(h,{label:"Classificação",value:r.classificacao??null}),e.jsx(h,{label:"Classificação Estratégica",value:r.classificacao_estrategica??null})]})]})]})]})})}const Sn=Ur,Tn=Jr,En=Hr;function Rn(s,t="Você tem alterações não salvas. Deseja sair?"){x.useEffect(()=>{if(!s)return;const a=r=>(r.preventDefault(),r.returnValue=t,t);return window.addEventListener("beforeunload",a),()=>{window.removeEventListener("beforeunload",a)}},[s,t])}const Ys=s=>String(s??"").replace(/\D/g,""),yt=s=>Ys(s).length===20,wt=s=>{const t=String(s??"").trim();if(!t||t==="[]")return[];if(t.startsWith("[")&&t.endsWith("]"))try{return JSON.parse(t.replace(/'/g,'"')).map(a=>String(a).trim()).filter(Boolean)}catch{}return t.split(/[;,]/).map(a=>a.trim()).filter(Boolean)},Pn=["Nome_Testemunha","CNJs_Como_Testemunha"],kn=["CNJ","Reclamante_Limpo","Reu_Nome"],Ct=(s,t)=>(t.utils.sheet_to_json(s,{header:1,blankrows:!1})[0]||[]).map(r=>String(r||"").trim()),St=(s,t)=>{const a=new Set(s.map(o=>o.toLowerCase())),r=t.filter(o=>!a.has(o.toLowerCase()));return{ok:r.length===0,missing:r}},An=({currentStep:s,validationResults:t,isProcessing:a})=>{const r=[{id:"upload",title:"Upload do Arquivo",icon:Hs,description:"Selecione o arquivo Excel"},{id:"validation",title:"Validação",icon:Cs,description:"Verificação da qualidade dos dados"},{id:"preview",title:"Prévia",icon:He,description:"Visualização antes da importação"},{id:"publish",title:"Importação",icon:$e,description:"Processamento final"}],o=i=>{const d=r.findIndex(u=>u.id===s),h=r.findIndex(u=>u.id===i);return a&&i===s?"processing":h<d?"completed":h===d?i==="validation"&&(t?.errors?.length??0)>0?"error":"current":"pending"},n=(i,d)=>{const h=i.icon;return d==="processing"?e.jsx(pa,{className:"h-5 w-5 animate-pulse"}):d==="completed"?e.jsx($e,{className:"h-5 w-5"}):d==="error"?e.jsx(gs,{className:"h-5 w-5"}):e.jsx(h,{className:"h-5 w-5"})};return e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"flex items-center justify-between",children:r.map((i,d)=>{const h=o(i.id),u=h==="current"||h==="processing",b=h==="completed",g=h==="error";return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`
                  flex items-center justify-center w-12 h-12 rounded-full border-2 
                  ${b?"bg-green-100 border-green-500 text-green-700 dark:bg-green-950 dark:border-green-400 dark:text-green-300":""}
                  ${u&&!g?"bg-primary/10 border-primary text-primary":""}
                  ${g?"bg-red-100 border-red-500 text-red-700 dark:bg-red-950 dark:border-red-400 dark:text-red-300":""}
                  ${h==="pending"?"bg-muted border-muted-foreground/25 text-muted-foreground":""}
                  transition-all duration-200
                `,children:n(i,h)}),e.jsxs("div",{className:"mt-3 text-center",children:[e.jsx("span",{className:`text-sm font-medium ${u?"text-foreground":b?"text-green-700 dark:text-green-300":g?"text-red-700 dark:text-red-300":"text-muted-foreground"}`,children:i.title}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:i.description})]})]}),d<r.length-1&&e.jsx("div",{className:`
                  w-16 h-0.5 mx-4 
                  ${d<r.findIndex(C=>C.id===s)?"bg-green-500":"bg-muted-foreground/25"}
                  transition-colors duration-200
                `})]},i.id)})})})},Dn=({validationResults:s,fileName:t})=>{const{toast:a}=ke();x.useState("empty"),x.useState(!1);const r=()=>{_a(async()=>{const i=[["Linha","Coluna","Tipo","Mensagem","Valor"].join(","),`"Resumo","Total: ${s.totalRows}","Válidos: ${s.validRows}","Erros: ${s.errors.length}","Avisos: ${s.warnings.length}"`,"",...s.errors.map(u=>[u.row,`"${u.column}"`,"Erro",`"${u.message}"`,`"${u.value||""}"`].join(",")),...s.warnings.map(u=>[u.row,`"${u.column}"`,"Aviso",`"${u.message}"`,`"${u.value||""}"`].join(","))].join(`
`),d=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8;"}),h=document.createElement("a");h.href=URL.createObjectURL(d),h.download=`relatorio-validacao-${t.replace(/\.[^/.]+$/,"")}-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(h),h.click(),document.body.removeChild(h),a({title:"Relatório CSV gerado",description:"Download iniciado com sucesso"})},"ImportModal.generateCSVReport")};return e.jsxs(le,{children:[e.jsxs(_e,{children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-5 w-5"}),"Relatório de Validação"]}),e.jsx(rs,{children:"Gere relatórios detalhados dos erros e avisos encontrados"})]}),e.jsxs(he,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold",children:s.totalRows.toLocaleString()}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total de linhas"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:s.validRows.toLocaleString()}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Linhas válidas"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:s.errors.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Erros"})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-bold text-orange-600",children:s.warnings.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Avisos"})]})]}),e.jsxs(P,{variant:"outline",onClick:r,className:"flex items-center gap-2",children:[e.jsx(Zr,{className:"h-4 w-4"}),"Exportar Relatório CSV"]})]})]})};function On(){const s=S(cn),t=S(N=>N.setIsImportModalOpen),{toast:a}=ke(),[r,o]=x.useState("upload"),[n,i]=x.useState(null),[d,h]=x.useState(!1),[u,b]=x.useState(0),[g,C]=x.useState(null),[T,K]=x.useState(null),[f,B]=x.useState("empty"),[Y,U]=x.useState(!1),[W,oe]=x.useState(!1),H=()=>{o("upload"),i(null),h(!1),b(0),C(null),K(null),B("empty"),U(!1)},J=!!n||r!=="upload";Rn(J);const z=N=>{N?t(!0):J?oe(!0):(H(),t(!1))},l=x.useCallback(N=>{const R=N[0];R&&(i(R),C(null),K(null),o("upload"),w(R))},[]),{getRootProps:c,getInputProps:m,isDragActive:j}=Kr({onDrop:l,accept:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"application/vnd.ms-excel":[".xls"]},maxFiles:1}),w=N=>{h(!0),b(0);const R=setInterval(()=>{b(v=>v>=95?(clearInterval(R),95):v+Math.random()*15)},200);pe(N)},q=N=>{const R=[];return N.forEach((v,E)=>{(!v.nome_testemunha||String(v.nome_testemunha).trim()==="")&&R.push({row:E+2,column:"Nome_Testemunha",message:"Nome_Testemunha é obrigatório",type:"error"});const Q=Array.isArray(v.cnjs_como_testemunha)?v.cnjs_como_testemunha:wt(v.cnjs_como_testemunha);Q.length||R.push({row:E+2,column:"CNJs_Como_Testemunha",message:"Lista de CNJs vazia",type:"error"}),Q.some(yt)||R.push({row:E+2,column:"CNJs_Como_Testemunha",message:"Nenhum CNJ com 20 dígitos na lista",type:"error"})}),R},ne=N=>{const R=[];return N.forEach((v,E)=>{(!v.cnj||!yt(v.cnj))&&R.push({row:E+2,column:"CNJ",message:"CNJ deve ter 20 dígitos (removendo máscara)",value:v.cnj,type:"error"}),(!v.reclamante_limpo||String(v.reclamante_limpo).trim()==="")&&R.push({row:E+2,column:"Reclamante_Limpo",message:"Reclamante_Limpo é obrigatório",type:"error"}),(!v.reu_nome||String(v.reu_nome).trim()==="")&&R.push({row:E+2,column:"Reu_Nome",message:"Reu_Nome é obrigatório",type:"error"})}),R},pe=async N=>{await _a(async()=>{const{porProcesso:R,porTestemunha:v,errors:E,warnings:Q}=await je(N),O=R.length+v.length,y=O-E.length;C({totalRows:O,validRows:y,errors:E,warnings:Q||[],processos:R,testemunhas:v}),o("validation")},"ImportModal.processFileValidation").finally(()=>{h(!1),b(100)})},je=async N=>{const R=await vo(()=>import("./xlsx-PER9UG_v.js"),[]);return new Promise((v,E)=>{const Q=new FileReader;Q.onload=O=>{try{const y=new Uint8Array(O.target?.result),te=R.read(y,{type:"array"}),A=te.Sheets["Por Processo"],ae=te.Sheets["Por Testemunha"];if(!A&&!ae)throw new Error('Arquivo deve conter ao menos uma aba: "Por Processo" ou "Por Testemunha".');const ie=[],Z=[];let G=[];if(A){const I=Ct(A,R),{ok:ve,missing:p}=St(I,kn);if(!ve)throw new Error(`Modo Processo: faltam colunas: ${p.join(", ")}`);R.utils.sheet_to_json(A,{defval:""}).forEach(X=>{const re=String(X.CNJ??"").trim(),ee={cnj:re,cnj_digits:Ys(re),reclamante_limpo:String(X.Reclamante_Limpo??""),reu_nome:String(X.Reu_Nome??""),comarca:String(X.Comarca??""),fase:String(X.Fase??""),status:String(X.Status??"")};ie.push(ee)}),G=G.concat(ne(ie))}if(ae){const I=Ct(ae,R),{ok:ve,missing:p}=St(I,Pn);if(!ve)throw new Error(`Modo Testemunha: faltam colunas: ${p.join(", ")}`);R.utils.sheet_to_json(ae,{defval:""}).forEach(X=>{const re=wt(X.CNJs_Como_Testemunha),ee={nome_testemunha:String(X.Nome_Testemunha??""),cnjs_como_testemunha:re};Z.push(ee)}),G=G.concat(q(Z))}v({porProcesso:ie,porTestemunha:Z,errors:G})}catch(y){E(y)}},Q.onerror=()=>E(new Error("Erro ao ler arquivo")),Q.readAsArrayBuffer(N)})},$=async()=>{if(g){if(!navigator.onLine){B("offline"),U(!0);return}h(!0),b(0),o("publish"),B("loading");try{const N=setInterval(()=>{b(O=>O>=90?(clearInterval(N),90):O+Math.random()*10)},300),R=g.testemunhas.flatMap(O=>O.cnjs_como_testemunha.map(y=>({nome_testemunha:O.nome_testemunha,cnj:y,cnj_digits:Ys(y)}))),v={};g.processos.length&&(v.processos=g.processos),R.length&&(v.testemunhas=R);const{data:E,error:Q}=await Fe.functions.invoke("import-mapa-testemunhas",{body:v});if(b(100),Q)throw Q;K(E),B("success"),U(!1),a({title:"Importação concluída!",description:`${E?.upserts??0} registros processados com sucesso.`})}catch(N){console.error("Import error:",N),B(navigator.onLine?"error":"offline"),U(!0);const R=N instanceof Error?N.message:"Ocorreu um erro durante a importação.";a({title:"Erro na importação",description:R,variant:"destructive"})}finally{h(!1),b(100)}}},se=()=>{t(!1),i(null),C(null),K(null),o("upload"),b(0)},k=()=>e.jsxs(le,{children:[e.jsxs(_e,{children:[e.jsxs(ye,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hs,{className:"h-5 w-5"}),"Upload de Arquivo Excel"]}),e.jsxs(Sn,{children:[e.jsx(Tn,{asChild:!0,children:e.jsxs(P,{variant:"ghost",size:"sm",className:"text-muted-foreground",children:[e.jsx(Gr,{className:"h-4 w-4 mr-2"}),"Precisa de ajuda?",e.jsx(ms,{className:"h-4 w-4 ml-2"})]})}),e.jsx(En,{className:"absolute z-10 mt-2 p-4 bg-background border rounded-lg shadow-lg max-w-md right-0",children:e.jsx("div",{className:"space-y-3",children:e.jsxs(De,{className:"border-blue-200 bg-blue-50 dark:bg-blue-950",children:[e.jsx(at,{className:"h-4 w-4 text-blue-600"}),e.jsxs(Oe,{className:"text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Formato requerido:"})," Arquivo Excel (.xlsx) com abas:",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Por Processo:"})," CNJ, Reclamante_Limpo, Reu_Nome",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Por Testemunha:"})," Nome_Testemunha, CNJs_Como_Testemunha"]})]})})})]})]}),e.jsx(rs,{children:"Faça upload do arquivo Excel com os dados do mapa de testemunhas"})]}),e.jsxs(he,{children:[e.jsxs("div",{...c(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${j?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary"}`,children:[e.jsx("input",{...m()}),e.jsx(Hs,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),j?e.jsx("p",{className:"text-lg",children:"Solte o arquivo aqui..."}):e.jsxs("div",{children:[e.jsx("p",{className:"text-lg mb-2",children:"Arraste e solte o arquivo aqui"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"ou clique para selecionar"}),e.jsx(P,{variant:"outline",children:"Selecionar Arquivo"})]})]}),n&&e.jsxs("div",{className:"mt-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:n.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(n.size/1024/1024).toFixed(2)," MB • Excel"]})]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>{i(null),C(null),o("upload")},children:e.jsx(Wr,{className:"h-4 w-4"})})]}),d&&e.jsxs("div",{className:"mt-3",children:[e.jsx(ks,{value:u,className:"w-full"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1 flex items-center gap-2",children:[e.jsx(Qr,{className:"h-3 w-3 animate-pulse"}),u<95?`Enviando arquivo... ${Math.round(u)}%`:"Processando e validando dados..."]})]})]})]})]}),de=()=>e.jsxs(le,{children:[e.jsxs(_e,{children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"h-5 w-5"}),"Validação e Normalização"]}),e.jsx(rs,{children:"Verificando a qualidade e consistência dos dados"})]}),e.jsx(he,{children:g?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold",children:g.totalRows?.toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Linhas analisadas"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-950 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:g.validRows?.toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Linhas válidas"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 dark:bg-red-950 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:g.errors?.length||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Erros"})]}),e.jsxs("div",{className:"text-center p-4 bg-orange-50 dark:bg-orange-950 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:g.warnings?.length||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Avisos"})]})]}),g.errors?.length===0&&g.validRows>0&&e.jsxs(De,{className:"border-green-200 bg-green-50 dark:bg-green-950 dark:border-green-800",children:[e.jsx($e,{className:"h-4 w-4 text-green-600"}),e.jsxs(Oe,{className:"text-green-800 dark:text-green-200",children:["✅ Arquivo pronto para importação!"," ",g.validRows," registros serão processados."]})]}),g.errors?.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Erros Encontrados:"}),g.errors.slice(0,5).map((N,R)=>e.jsxs(De,{variant:"destructive",children:[e.jsx(gs,{className:"h-4 w-4"}),e.jsxs(Oe,{children:[e.jsxs("strong",{children:["Linha ",N.row,":"]})," ",N.message," (",N.column,")"]})]},R)),g.errors.length>5&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["... e mais ",g.errors.length-5," erros"]})]}),(g.errors?.length>0||g.warnings?.length>0)&&e.jsx(Dn,{validationResults:g,fileName:n?.name||"arquivo"}),e.jsxs("div",{className:"flex gap-2 justify-between",children:[e.jsx(P,{variant:"outline",onClick:()=>o("upload"),children:"Voltar"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(P,{onClick:()=>o("preview"),disabled:g.validRows===0||(g.errors?.length||0)>0,children:g.errors?.length>0?"Corrigir Erros Primeiro":"Continuar para Prévia"})})]})]}):e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ss,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{children:"Validando arquivo..."})]})})})]}),F=()=>e.jsxs(le,{children:[e.jsxs(_e,{children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"h-5 w-5"}),"Prévia dos Dados"]}),e.jsx(rs,{children:"Visualização dos dados processados e normalizados"})]}),e.jsx(he,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold",children:g?.processos.length||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Processos"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold",children:g?.testemunhas.length||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Testemunhas"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[g?Math.round(g.validRows/g.totalRows*100):0,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Taxa de sucesso"})]})]}),e.jsxs(De,{className:"border-blue-200 bg-blue-50 dark:bg-blue-950 dark:border-blue-800",children:[e.jsx(He,{className:"h-4 w-4 text-blue-600"}),e.jsxs(Oe,{className:"text-blue-800 dark:text-blue-200",children:[e.jsx("strong",{children:"Prévia da Importação:"})," ",g?.validRows||0," registros serão processados e inseridos no mapa de testemunhas."]})]}),(g?.processos?.length??0)>0&&e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left",children:"CNJ"}),e.jsx("th",{className:"p-3 text-left",children:"Reclamante"}),e.jsx("th",{className:"p-3 text-left",children:"Réu"})]})}),e.jsx("tbody",{children:g?.processos?.slice(0,3).map((N,R)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3 font-mono text-sm",children:N.cnj}),e.jsx("td",{className:"p-3",children:N.reclamante_limpo}),e.jsx("td",{className:"p-3",children:N.reu_nome})]},R))})]})}),e.jsxs("div",{className:"flex gap-2 justify-between",children:[e.jsx(P,{variant:"outline",onClick:()=>o("validation"),children:"Voltar para Validação"}),e.jsx(P,{onClick:$,className:"bg-green-600 hover:bg-green-700",disabled:(g?.errors?.length||0)>0,children:"Confirmar Importação"})]})]})})]}),V=()=>e.jsxs(le,{children:[e.jsxs(_e,{children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5"}),"Importação"]}),e.jsx(rs,{children:"Processamento dos dados no sistema"})]}),e.jsx(he,{children:e.jsx("div",{className:"space-y-4",children:T?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(De,{className:"border-green-200 bg-green-50 dark:bg-green-950",children:[e.jsx($e,{className:"h-4 w-4 text-green-600"}),e.jsxs(Oe,{className:"text-green-800 dark:text-green-200",children:[e.jsx("strong",{children:"Importação concluída com sucesso!"}),e.jsx("br",{}),"• Registros processados: ",T.upserts,T.errors?.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),"• Erros: ",T.errors.length]})]})]}),e.jsx(P,{className:"w-full",onClick:se,children:"Fechar"})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ss,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"font-medium",children:"Importando dados..."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Processando e inserindo registros no mapa de testemunhas."}),e.jsxs("div",{className:"mt-4",children:[e.jsx(ks,{value:u,className:"w-full"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:u<100?"Processando...":"Finalizando..."})]})]})})})]});return e.jsxs(e.Fragment,{children:[e.jsx(Ra,{open:s,onOpenChange:z,children:e.jsxs(ot,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(ka,{children:[e.jsxs(Aa,{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"h-5 w-5"}),"Importar Mapa de Testemunhas"]}),e.jsx(Da,{children:'Importe dados do Excel com as abas "Por Processo" e/ou "Por Testemunha"'})]}),Y&&e.jsx(De,{variant:"destructive",className:"mb-4",children:e.jsx(Oe,{children:"Integração CNJ indisponível"})}),f!=="empty"&&f!=="success"&&e.jsx(vs,{status:f,onRetry:$}),e.jsx(An,{currentStep:r,validationResults:g??void 0,isProcessing:d}),e.jsxs("div",{className:"space-y-6",children:[r==="upload"&&k(),r==="validation"&&de(),r==="preview"&&F(),r==="publish"&&V()]})]})}),e.jsx(ht,{open:W,title:"Descartar alterações?",description:"Você possui alterações não salvas. Deseja realmente sair?",confirmText:"Sair",onConfirm:()=>{oe(!1),H(),t(!1)},onCancel:()=>oe(!1)})]})}const In=()=>{const s=S(a=>a.isPiiMasked),t=S(a=>a.setIsPiiMasked);return e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(nt,{id:"mask-pii",checked:s,onCheckedChange:t}),e.jsx(Ne,{htmlFor:"mask-pii",className:"text-sm font-medium cursor-pointer flex items-center gap-1",children:s?e.jsxs(e.Fragment,{children:[e.jsx(Ks,{className:"h-3 w-3"}),"Mascarar PII"]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-3 w-3"}),"Mostrar PII"]})})]})]})};function Fn(s){if(s.length!==18)throw new Error("CNJ without check digits must have exactly 18 digits");const t=[2,3,4,5,6,7,8,9,2,3,4,5,6,7,8,9,2,3];let a=0;const r=s.split("").map(Number);for(let i=0;i<r.length;i++)a+=r[i]*t[i];return(98-a%97).toString().padStart(2,"0")}function Mn(s){const t=s?.year||2018+Math.floor(Math.random()*8),a=s?.sequential||String(Math.floor(Math.random()*9999999)+1).padStart(7,"0"),r=s?.justice,o=s?.tribunal,n=s?.origin||String(Math.floor(Math.random()*9999)+1).padStart(4,"0"),i=a+t+r+o+n,d=Fn(i);return`${a}-${d}.${t}.${r}.${o}.${n}`}function $n(s,t=2024){const a=[];for(let o=0;o<s;o++){const n=String(1e6+o).padStart(7,"0");a.push(Mn({sequential:n,year:t,justice:"5",tribunal:"02",origin:String(1e3+o).padStart(4,"0")}))}return a}const Ae=$n(12,2024),$i=[{Aba:"Por Processo",Campo:"CNJ",Tipo:"texto",Obrigatorio:"Sim",Regra:"String com 20 dígitos (preserva formato original). Validação interna remove pontuação.",Exemplo:Ae[0]},{Aba:"Por Processo",Campo:"reclamante_nome",Tipo:"texto",Obrigatorio:"Sim (legado)",Regra:"Nome principal do reclamante (campo de compatibilidade)",Exemplo:"Ana Lima"},{Aba:"Por Processo",Campo:"reu_nome",Tipo:"texto",Obrigatorio:"Sim (legado)",Regra:"Nome do réu/empresa (campo de compatibilidade)",Exemplo:"Empresa XYZ Ltda"},{Aba:"Por Processo",Campo:"Status",Tipo:"texto",Obrigatorio:"Não",Regra:"Status atual do processo",Exemplo:"Em andamento"},{Aba:"Por Processo",Campo:"Fase",Tipo:"texto",Obrigatorio:"Não",Regra:"Fase processual atual",Exemplo:"Instrução"},{Aba:"Por Processo",Campo:"UF",Tipo:"texto",Obrigatorio:"Sim",Regra:"Sigla de 2 letras do estado",Exemplo:"SP"},{Aba:"Por Processo",Campo:"Comarca",Tipo:"texto",Obrigatorio:"Sim",Regra:"Nome da comarca",Exemplo:"São Paulo"},{Aba:"Por Processo",Campo:"Reclamantes",Tipo:"lista",Obrigatorio:"Sim",Regra:"Lista separada por ; (ponto e vírgula). Não usar []",Exemplo:"Ana Lima; Pedro Santos"},{Aba:"Por Processo",Campo:"Advogados_Ativo",Tipo:"lista",Obrigatorio:"Sim",Regra:"Lista separada por ; (primeiro é principal na UI)",Exemplo:"Dr. Xavier Silva; Dra. Yasmim Oliveira"},{Aba:"Por Processo",Campo:"Testemunhas_Ativo",Tipo:"lista",Obrigatorio:"Não",Regra:"Lista separada por ; ou — se vazio",Exemplo:"João Pereira; Carlos Costa"},{Aba:"Por Processo",Campo:"Testemunhas_Passivo",Tipo:"lista",Obrigatorio:"Não",Regra:"Lista separada por ; ou — se vazio",Exemplo:"Ana Silva"},{Aba:"Por Processo",Campo:"Todas_Testemunhas",Tipo:"lista",Obrigatorio:"Sim",Regra:"União de todas as testemunhas, separadas por ;",Exemplo:"João Pereira; Beatriz Nunes; Carlos Costa"},{Aba:"Por Processo",Campo:"Reclamante_Foi_Testemunha",Tipo:"boolean",Obrigatorio:"Não",Regra:"true/false",Exemplo:"true"},{Aba:"Por Processo",Campo:"Qtd_Reclamante_Testemunha",Tipo:"número",Obrigatorio:"Não",Regra:"Quantidade de vezes que reclamante foi testemunha",Exemplo:"1"},{Aba:"Por Processo",Campo:"CNJs_Reclamante_Testemunha",Tipo:"lista",Obrigatorio:"Não",Regra:"Lista de CNJs separados por ; ou — se vazio",Exemplo:`${Ae[9]}`},{Aba:"Por Processo",Campo:"Reclamante_Testemunha_Polo_Passivo",Tipo:"boolean",Obrigatorio:"Não",Regra:"true/false",Exemplo:"false"},{Aba:"Por Processo",Campo:"CNJs_Passivo",Tipo:"lista",Obrigatorio:"Não",Regra:"CNJs onde reclamante foi testemunha do polo passivo",Exemplo:"—"},{Aba:"Por Processo",Campo:"Triangulacao_Confirmada",Tipo:"boolean",Obrigatorio:"Não",Regra:"true/false",Exemplo:"true"},{Aba:"Por Processo",Campo:"Desenho_Triangulacao",Tipo:"texto",Obrigatorio:"Não",Regra:"Padrão da triangulação (A→B→C→A) ou — se não houver",Exemplo:"A→B→C→A"},{Aba:"Por Processo",Campo:"CNJs_Triangulacao",Tipo:"lista",Obrigatorio:"Não",Regra:"CNJs envolvidos na triangulação, separados por ;",Exemplo:`${Ae[1]}; ${Ae[2]}; ${Ae[3]}`},{Aba:"Por Processo",Campo:"Contem_Prova_Emprestada",Tipo:"boolean",Obrigatorio:"Não",Regra:"true/false",Exemplo:"true"},{Aba:"Por Processo",Campo:"Testemunhas_Prova_Emprestada",Tipo:"lista",Obrigatorio:"Não",Regra:"Nomes das testemunhas de prova emprestada, separados por ;",Exemplo:"João Pereira"},{Aba:"Por Processo",Campo:"Classificacao_Final",Tipo:"texto",Obrigatorio:"Não",Regra:"Classificação de risco (Risco Alto, Risco Médio, Risco Baixo)",Exemplo:"Risco Alto"},{Aba:"Por Processo",Campo:"Insight_Estrategico",Tipo:"texto",Obrigatorio:"Não",Regra:"Resumo dos principais achados",Exemplo:"Triangulação + prova emprestada"},{Aba:"Por Testemunha",Campo:"Nome_Testemunha",Tipo:"texto",Obrigatorio:"Sim",Regra:"Nome completo da testemunha",Exemplo:"João Pereira"},{Aba:"Por Testemunha",Campo:"Qtd_Depoimentos",Tipo:"número",Obrigatorio:"Sim",Regra:"Quantidade total de depoimentos",Exemplo:"12"},{Aba:"Por Testemunha",Campo:"CNJs_Como_Testemunha",Tipo:"lista",Obrigatorio:"Sim",Regra:"Lista de CNJs separados por ;",Exemplo:`${Ae[0]}; ${Ae[9]}`},{Aba:"Por Testemunha",Campo:"Ja_Foi_Reclamante",Tipo:"boolean",Obrigatorio:"Não",Regra:"true/false",Exemplo:"false"},{Aba:"Por Testemunha",Campo:"CNJs_Como_Reclamante",Tipo:"lista",Obrigatorio:"Não",Regra:"CNJs onde foi reclamante, separados por ; ou — se vazio",Exemplo:"—"},{Aba:"Por Testemunha",Campo:"Foi_Testemunha_Ativo",Tipo:"boolean",Obrigatorio:"Não",Regra:"true/false",Exemplo:"true"},{Aba:"Por Testemunha",Campo:"Foi_Testemunha_Passivo",Tipo:"boolean",Obrigatorio:"Não",Regra:"true/false",Exemplo:"false"},{Aba:"Por Testemunha",Campo:"CNJs_Passivo",Tipo:"lista",Obrigatorio:"Não",Regra:"CNJs onde foi testemunha do polo passivo",Exemplo:"—"},{Aba:"Por Testemunha",Campo:"Foi_Ambos_Polos",Tipo:"boolean",Obrigatorio:"Não",Regra:"true/false",Exemplo:"false"},{Aba:"Por Testemunha",Campo:"Participou_Troca_Favor",Tipo:"boolean",Obrigatorio:"Não",Regra:"true/false",Exemplo:"true"},{Aba:"Por Testemunha",Campo:"CNJs_Troca_Favor",Tipo:"lista",Obrigatorio:"Não",Regra:"Padrão CNJ_A↔CNJ_B ou lista separada por ;",Exemplo:`${Ae[4]}↔${Ae[5]}`},{Aba:"Por Testemunha",Campo:"Participou_Triangulacao",Tipo:"boolean",Obrigatorio:"Não",Regra:"true/false",Exemplo:"true"},{Aba:"Por Testemunha",Campo:"CNJs_Triangulacao",Tipo:"lista",Obrigatorio:"Não",Regra:"CNJs da triangulação, separados por ;",Exemplo:`${Ae[1]}; ${Ae[2]}; ${Ae[3]}`},{Aba:"Por Testemunha",Campo:"E_Prova_Emprestada",Tipo:"boolean",Obrigatorio:"Não",Regra:"true/false",Exemplo:"true"},{Aba:"Por Testemunha",Campo:"Classificacao",Tipo:"texto",Obrigatorio:"Não",Regra:"ALTA, MÉDIA, BAIXA",Exemplo:"ALTA"},{Aba:"Por Testemunha",Campo:"Classificacao_Estrategica",Tipo:"texto",Obrigatorio:"Não",Regra:"CRÍTICO, ATENÇÃO, NORMAL",Exemplo:"CRÍTICO"}];function Ee(s){if(!s||s.length===0)return"—";const t=s.map(a=>String(a).trim()).filter(a=>a.length>0);return t.length>0?t.join("; "):"—"}const Ln=s=>({CNJ:s.cnj||"—",Status:s.status||"—",Fase:s.fase||"—",UF:s.uf||"—",Comarca:s.comarca||"—",Reclamantes:s.reclamante_limpo||"—",Advogados_Ativo:Ee(s.advogados_parte_ativa||[]),Testemunhas_Ativo:Ee(s.testemunhas_ativo_limpo||[]),Testemunhas_Passivo:Ee(s.testemunhas_passivo_limpo||[]),Todas_Testemunhas:Ee(s.todas_testemunhas||[]),Reclamante_Foi_Testemunha:s.reclamante_foi_testemunha||!1,Qtd_Reclamante_Testemunha:s.qtd_vezes_reclamante_foi_testemunha||0,CNJs_Reclamante_Testemunha:Ee(s.cnjs_em_que_reclamante_foi_testemunha||[]),Reclamante_Testemunha_Polo_Passivo:s.reclamante_testemunha_polo_passivo||!1,CNJs_Passivo:Ee(s.cnjs_passivo||[]),Triangulacao_Confirmada:s.triangulacao_confirmada||!1,Desenho_Triangulacao:s.desenho_triangulacao||"—",CNJs_Triangulacao:Ee(s.cnjs_triangulacao||[]),Contem_Prova_Emprestada:s.contem_prova_emprestada||!1,Testemunhas_Prova_Emprestada:Ee(s.testemunhas_prova_emprestada||[]),Classificacao_Final:s.classificacao_final||"—",Insight_Estrategico:s.insight_estrategico||"—"}),qn=s=>({Nome_Testemunha:s.nome_testemunha,Qtd_Depoimentos:s.qtd_depoimentos||0,CNJs_Como_Testemunha:Ee(s.cnjs_como_testemunha||[]),Ja_Foi_Reclamante:s.ja_foi_reclamante||!1,CNJs_Como_Reclamante:Ee(s.cnjs_como_reclamante||[]),Foi_Testemunha_Ativo:s.foi_testemunha_ativo||!1,Foi_Testemunha_Passivo:s.foi_testemunha_passivo||!1,CNJs_Passivo:Ee(s.cnjs_passivo||[]),Foi_Ambos_Polos:s.foi_testemunha_em_ambos_polos||!1,Participou_Troca_Favor:s.participou_troca_favor||!1,CNJs_Troca_Favor:Ee(s.cnjs_troca_favor||[]),Participou_Triangulacao:s.participou_triangulacao||!1,CNJs_Triangulacao:Ee(s.cnjs_triangulacao||[]),E_Prova_Emprestada:s.e_prova_emprestada||!1,Classificacao:s.classificacao||"—",Classificacao_Estrategica:s.classificacao_estrategica||"—"}),Vn=s=>{if(!s)return"";const t=s.replace(/\D/g,"");return t.length===11?t.replace(/(\d{3})\d{6}(\d{2})/,"$1******$2"):t.length>=3?t.substring(0,2)+"*".repeat(Math.max(1,t.length-4))+t.slice(-2):"*".repeat(s.length)},zn=s=>{if(!s)return"";const t=s.replace(/\D/g,"");return t.length===14?t.replace(/(\d{2})\d{9}(\d{4})/,"$1*********$2"):t.length>=6?t.substring(0,2)+"*".repeat(Math.max(1,t.length-6))+t.slice(-4):"*".repeat(s.length)},Bn=s=>{if(!s)return"";const[t,a]=s.split("@");if(!t||!a)return s;const r=Math.min(2,t.length);return`${t.substring(0,r)+"*".repeat(Math.max(1,t.length-r))}@${a}`},Un=s=>{if(!s)return"";const t=s.replace(/\D/g,"");return t.length>=8?t.length===11?t.replace(/(\d{2})(\d{1})\d{4}(\d{2})/,"($1) $2****-**$3"):t.length===10?t.replace(/(\d{2})\d{4}(\d{2})/,"($1) ****-**$2"):t.substring(0,2)+"*".repeat(t.length-4)+t.slice(-2):"*".repeat(s.length)},Jn=s=>{if(!s)return"";const t=s.replace(/\D/g,"");return t.length>=4?s.replace(/\d/g,(a,r,o)=>{const n=o.substring(0,r+1).replace(/\D/g,"").length-1;return n===0||n===t.length-1?a:"*"}):s.replace(/\d/g,"*")},ls=s=>{if(!s)return"";let t=s;return t=t.replace(/\b\d{3}\.?\d{3}\.?\d{3}-?\d{2}\b/g,a=>Vn(a)),t=t.replace(/\b\d{2}\.?\d{3}\.?\d{3}\/?\d{4}-?\d{2}\b/g,a=>zn(a)),t=t.replace(/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g,a=>Bn(a)),t=t.replace(/\(\d{2}\)?\s*\d{4,5}-?\d{4}\b/g,a=>Un(a)),t=t.replace(/\bOAB\/?\w{2}\s*\d+/gi,a=>Jn(a)),t},Hn=(s,t={})=>{const{filename:a=`processos-${new Date().toISOString().split("T")[0]}.csv`,maskPII:r=!1,selectedOnly:o=!1,selectedIds:n=[]}=t;let i=s;o&&n.length>0&&(i=s.filter(C=>n.includes(C.cnj)));const d=i.map(C=>{const T=Ln(C);return r?{...T,Reclamantes:ls(T.Reclamantes),Todas_Testemunhas:ls(T.Todas_Testemunhas),Insight_Estrategico:ls(T.Insight_Estrategico)}:T}),u="\uFEFF"+Qa.unparse(d,{delimiter:",",header:!0}),b=new Blob([u],{type:"text/csv;charset=utf-8;"}),g=document.createElement("a");if(g.download!==void 0){const C=URL.createObjectURL(b);g.setAttribute("href",C),g.setAttribute("download",a),g.style.visibility="hidden",document.body.appendChild(g),g.click(),document.body.removeChild(g)}return d.length},Kn=(s,t={})=>{const{filename:a=`testemunhas-${new Date().toISOString().split("T")[0]}.csv`,maskPII:r=!1,selectedOnly:o=!1,selectedIds:n=[]}=t;let i=s;o&&n.length>0&&(i=s.filter(C=>n.includes(C.nome_testemunha)));const d=i.map(C=>{const T=qn(C);return r?{...T,Nome_Testemunha:ls(T.Nome_Testemunha),CNJs_Como_Testemunha:ls(T.CNJs_Como_Testemunha),CNJs_Como_Reclamante:ls(T.CNJs_Como_Reclamante)}:T}),u="\uFEFF"+Qa.unparse(d,{delimiter:",",header:!0}),b=new Blob([u],{type:"text/csv;charset=utf-8;"}),g=document.createElement("a");if(g.download!==void 0){const C=URL.createObjectURL(b);g.setAttribute("href",C),g.setAttribute("download",a),g.style.visibility="hidden",document.body.appendChild(g),g.click(),document.body.removeChild(g)}return d.length},Gn=(s,t=!0)=>{const r=s*(t?500:350);return r<1024?`${r} bytes`:r<1024*1024?`${(r/1024).toFixed(1)} KB`:`${(r/(1024*1024)).toFixed(1)} MB`},Wn=(s,t=!1)=>s===0?{isValid:!1,message:t?"Nenhum registro selecionado para exportação.":"Nenhum registro encontrado para exportação.",maxRecords:5e3}:s>5e3?{isValid:!1,message:`Limite de exportação excedido. Máximo permitido: ${5e3.toLocaleString()} registros. ${t?"Selecione menos registros":"Aplique filtros para reduzir o resultado"}.`,maxRecords:5e3}:{isValid:!0,maxRecords:5e3},Qn=({data:s,fileName:t,disabled:a=!1})=>{const[r,o]=x.useState(!1),n=S(tn),i=b=>b.length>0&&"cnj"in b[0]&&"reclamante_limpo"in b[0],d=async()=>{o(!0);try{const b=s.length,g=Wn(b,!1);if(!g.isValid){$s.error("Erro na exportação",{description:g.message});return}let C=0;const T=i(s)?"processos.csv":"testemunhas.csv";if(i(s)){const K=s.map(f=>({cnj:f.cnj,status:f.status||null,uf:f.uf||null,comarca:f.comarca||null,fase:f.fase||null,reclamante_limpo:f.reclamante_limpo||null,advogados_parte_ativa:f.advogados_parte_ativa||null,testemunhas_ativo_limpo:f.testemunhas_ativo_limpo||null,testemunhas_passivo_limpo:f.testemunhas_passivo_limpo||null,todas_testemunhas:f.todas_testemunhas||null,reclamante_foi_testemunha:f.reclamante_foi_testemunha||null,qtd_vezes_reclamante_foi_testemunha:f.qtd_vezes_reclamante_foi_testemunha||null,cnjs_em_que_reclamante_foi_testemunha:f.cnjs_em_que_reclamante_foi_testemunha||null,reclamante_testemunha_polo_passivo:f.reclamante_testemunha_polo_passivo||null,cnjs_passivo:f.cnjs_passivo||null,troca_direta:f.troca_direta||null,desenho_troca_direta:f.desenho_troca_direta||null,cnjs_troca_direta:f.cnjs_troca_direta||null,triangulacao_confirmada:f.triangulacao_confirmada||null,desenho_triangulacao:f.desenho_triangulacao||null,cnjs_triangulacao:f.cnjs_triangulacao||null,testemunha_do_reclamante_ja_foi_testemunha_antes:f.testemunha_do_reclamante_ja_foi_testemunha_antes||null,qtd_total_depos_unicos:f.qtd_total_depos_unicos||null,cnjs_depos_unicos:f.cnjs_depos_unicos||null,contem_prova_emprestada:f.contem_prova_emprestada||null,testemunhas_prova_emprestada:f.testemunhas_prova_emprestada||null,classificacao_final:f.classificacao_final||null,insight_estrategico:f.insight_estrategico||null,org_id:f.org_id||null,created_at:f.created_at||new Date().toISOString(),updated_at:f.updated_at||new Date().toISOString()}));C=Hn(K,{filename:t||T,maskPII:n,selectedOnly:!1,selectedIds:[]})}else{const K=s.map(f=>({nome_testemunha:f.nome_testemunha??"",qtd_depoimentos:f.qtd_depoimentos??0,foi_testemunha_em_ambos_polos:f.foi_testemunha_em_ambos_polos??!1,ja_foi_reclamante:f.ja_foi_reclamante??!1,participou_triangulacao:f.participou_triangulacao??!1,participou_troca_favor:f.participou_troca_favor??!1,classificacao:f.classificacao??null,classificacao_estrategica:f.classificacao_estrategica??null,cnjs_como_testemunha:f.cnjs_como_testemunha??null,cnjs_como_reclamante:f.cnjs_como_reclamante??null,foi_testemunha_ativo:f.foi_testemunha_ativo??null,cnjs_ativo:f.cnjs_ativo??null,foi_testemunha_passivo:f.foi_testemunha_passivo??null,cnjs_passivo:f.cnjs_passivo??null,cnjs_troca_favor:f.cnjs_troca_favor??null,cnjs_triangulacao:f.cnjs_triangulacao??null,e_prova_emprestada:f.e_prova_emprestada??null,org_id:f.org_id??null,created_at:f.created_at??new Date().toISOString(),updated_at:f.updated_at??new Date().toISOString()}));C=Kn(K,{filename:t||T,maskPII:n,selectedOnly:!1,selectedIds:[]})}$s.success("Exportação concluída!",{description:`${C} registros exportados com sucesso.`})}catch(b){console.error("Export error:",b),$s.error("Erro na exportação",{description:"Não foi possível exportar os dados. Tente novamente."})}finally{o(!1)}},u=(()=>{const b=Math.min(s.length,5e3),g=i(s);return{count:b,size:Gn(b,g)}})();return e.jsxs(bs,{children:[e.jsx(Ns,{asChild:!0,children:e.jsxs(P,{variant:"outline",disabled:a||r||s.length===0,className:"gap-2","aria-label":"Exportar dados como CSV",children:[r?e.jsx(ds,{className:"h-4 w-4 animate-spin","aria-hidden":"true"}):e.jsx(fa,{className:"h-4 w-4","aria-hidden":"true"}),"Exportar CSV"]})}),e.jsxs(hs,{align:"end",className:"w-56",children:[e.jsx("div",{className:"px-3 py-2 text-xs text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx(tt,{className:"h-3 w-3","aria-hidden":"true"}),"Exportar como CSV"]})}),e.jsx(Qs,{}),e.jsx(ss,{onClick:d,disabled:r,children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"Todos os registros"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:u.count.toLocaleString()})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:u.size})]})}),s.length>5e3&&e.jsxs(e.Fragment,{children:[e.jsx(Qs,{}),e.jsx("div",{className:"px-3 py-2 text-xs text-warning",children:"⚠️ Máximo de 5.000 registros por exportação"})]})]})]})};function et(s,t){const[a,r]=x.useState(s);return x.useEffect(()=>{const o=setTimeout(()=>{r(s)},t);return()=>{clearTimeout(o)}},[s,t]),a}const As=s=>{if(!/^\d{4}-\d{2}-\d{2}$/.test(s))return!1;const t=new Date(s);return!isNaN(t.valueOf())},qs="mapa-testemunhas-processos",Vs="mapa-testemunhas-testemunhas",xr=us({page:Pe.number().int().min(1).default(1),limit:Pe.number().int().min(1).max(1e3).default(20)}),Zn=us({search:Re().trim().optional(),data_inicio:Re().trim().optional().refine(s=>!s||As(s),{message:"data inválida"}),data_fim:Re().trim().optional().refine(s=>!s||As(s),{message:"data inválida"}),uf:Re().trim().optional(),status:Re().trim().optional(),fase:Re().trim().optional(),testemunha:Re().trim().optional(),qtd_depoimentos_min:Pe.number().int().optional(),qtd_depoimentos_max:Pe.number().int().optional(),tem_triangulacao:Pe.boolean().optional(),tem_troca:Pe.boolean().optional(),tem_prova_emprestada:Pe.boolean().optional()}).superRefine((s,t)=>{s.data_inicio&&s.data_fim&&new Date(s.data_inicio)>new Date(s.data_fim)&&t.addIssue({code:Es.custom,message:"data_inicio deve ser menor ou igual a data_fim",path:["data_inicio"]}),s.qtd_depoimentos_min!==void 0&&s.qtd_depoimentos_max!==void 0&&s.qtd_depoimentos_min>s.qtd_depoimentos_max&&t.addIssue({code:Es.custom,message:"qtd_depoimentos_min deve ser menor ou igual a qtd_depoimentos_max",path:["qtd_depoimentos_min"]})}).default({}),Xn=us({paginacao:xr.default({page:1,limit:20}),filtros:Zn}).default(()=>({paginacao:{page:1,limit:20},filtros:{}})),Yn=us({nome:Re().trim().optional(),documento:Re().trim().optional(),search:Re().trim().optional(),data_inicio:Re().trim().optional().refine(s=>!s||As(s),{message:"data inválida"}),data_fim:Re().trim().optional().refine(s=>!s||As(s),{message:"data inválida"}),ambos_polos:Pe.boolean().optional(),ja_foi_reclamante:Pe.boolean().optional(),qtd_depoimentos_min:Pe.number().int().optional(),qtd_depoimentos_max:Pe.number().int().optional(),tem_triangulacao:Pe.boolean().optional(),tem_troca:Pe.boolean().optional()}).superRefine((s,t)=>{s.data_inicio&&s.data_fim&&new Date(s.data_inicio)>new Date(s.data_fim)&&t.addIssue({code:Es.custom,message:"data_inicio deve ser menor ou igual a data_fim",path:["data_inicio"]}),s.qtd_depoimentos_min!==void 0&&s.qtd_depoimentos_max!==void 0&&s.qtd_depoimentos_min>s.qtd_depoimentos_max&&t.addIssue({code:Es.custom,message:"qtd_depoimentos_min deve ser menor ou igual a qtd_depoimentos_max",path:["qtd_depoimentos_min"]})}).default({}),ei=us({paginacao:xr.default({page:1,limit:20}),filtros:Yn}).default(()=>({paginacao:{page:1,limit:20},filtros:{}}));us({items:No(_o()),page:Ls().int().min(1),limit:Ls().int().min(1).max(1e3),total:Ls().int().nonnegative(),next_cursor:bo().default(null),requestId:Re()});const zs="assistjur_debug_mode",M={isEnabled(){return typeof window>"u"?!1:typeof localStorage<"u"&&localStorage.getItem(zs)==="true"},enable(){typeof window>"u"||typeof localStorage>"u"||(localStorage.setItem(zs,"true"),console.log("🐛 Debug mode ATIVADO"))},disable(){typeof window>"u"||typeof localStorage>"u"||(localStorage.setItem(zs,"false"),console.log("🐛 Debug mode DESATIVADO"))},toggle(){const s=!this.isEnabled();return s?this.enable():this.disable(),s},log(s,...t){this.isEnabled()&&console.log(`[DEBUG] ${s}`,...t)},warn(s,...t){this.isEnabled()&&console.warn(`[DEBUG] ${s}`,...t)},error(s,...t){this.isEnabled()?console.error(`[DEBUG] ${s}`,...t):console.error(s,...t)}};function pr(s){const t={temTriangulacao:"tem_triangulacao",temTroca:"tem_troca",temProvaEmprestada:"tem_prova_emprestada",qtdDeposMin:"qtd_depoimentos_min",qtdDeposMax:"qtd_depoimentos_max",ambosPolos:"ambos_polos",jaFoiReclamante:"ja_foi_reclamante"};return Object.fromEntries(Object.entries(s??{}).filter(([a,r])=>!(r==null||typeof r=="string"&&r.trim()==="")).map(([a,r])=>[t[a]??a,r]))}async function fr(s,t=3,a=1e3){let r=null;for(let o=0;o<t;o++)try{return await s()}catch(n){if(r=n,o<t-1){const i=a*Math.pow(2,o);console.warn(`Tentativa ${o+1} falhou, aguardando ${i}ms...`),await new Promise(d=>setTimeout(d,i))}}throw r}function Tt(s,t){console.warn("⚠️ MODO FALLBACK: Usando dados mock para testemunhas (API não disponível)"),M.isEnabled()&&console.table({mode:"FALLBACK",type:"TESTEMUNHAS",page:s,limit:t});const a=[{nome_testemunha:"Maria Silva Santos",qtd_depoimentos:8,foi_testemunha_em_ambos_polos:!0,ja_foi_reclamante:!0,participou_triangulacao:!0,participou_troca_favor:!0,classificacao:"ALTO_RISCO"},{nome_testemunha:"João Paulo Oliveira",qtd_depoimentos:5,foi_testemunha_em_ambos_polos:!1,ja_foi_reclamante:!1,participou_triangulacao:!0,participou_troca_favor:!1,classificacao:"MEDIO_RISCO"},{nome_testemunha:"Ana Costa Ferreira",qtd_depoimentos:12,foi_testemunha_em_ambos_polos:!0,ja_foi_reclamante:!0,participou_triangulacao:!1,participou_troca_favor:!0,classificacao:"ALTO_RISCO"}],r=(s-1)*t,o=r+t;return{data:a.slice(r,o),total:a.length}}async function si(s){const t=Math.random().toString(36).substring(7),a=s.filters?.search;M.log(`🔍 [${t}] fetchTestemunhas iniciado`,{page:s.page,limit:s.limit,filters:s.filters,searchTerm:a,timestamp:new Date().toISOString()});try{const{data:r}=await Fe.auth.getSession();if(!r?.session?.access_token)return M.error(`❌ [${t}] Usuário não autenticado`),Tt(s.page||1,s.limit||20);M.log(`✅ [${t}] Sessão válida`,{userId:r.session.user?.id,hasToken:!!r.session.access_token});const o=pr(s.filters??{}),n={paginacao:{page:s.page||1,limit:s.limit||50},filtros:o};a&&console.log(`🎯 [${t}] SEARCH DETECTADO:`,{searchTerm:a,filtrosEnviados:n.filtros,hasSearchInFiltros:"search"in n.filtros||"nome"in n.filtros}),M.log(`📦 [${t}] Payload preparado`,n),ei.parse(n);const i=await fr(async()=>{M.log(`🚀 [${t}] ===== CHAMANDO EDGE FUNCTION =====`),M.log(`🚀 [${t}] Function: ${Vs}`),M.log(`🚀 [${t}] URL: <<MANTER>>/functions/v1/${Vs}`),M.log(`🚀 [${t}] Body:`,n),M.log(`🚀 [${t}] Auth Token presente: ${!!r.session.access_token}`);const d=performance.now(),{data:h,error:u}=await Fe.functions.invoke(Vs,{body:n}),b=performance.now()-d;if(M.log(`⏱️ [${t}] Tempo de resposta: ${b.toFixed(2)}ms`),u)throw M.error(`❌ [${t}] ===== ERRO NA EDGE FUNCTION =====`),M.error(`❌ [${t}] Error object:`,u),M.error(`❌ [${t}] Error message:`,u.message),M.error(`❌ [${t}] Error context:`,u.context),new Error(`Erro ao buscar testemunhas: ${u.message}`);if(!h||!h.items)return M.log(`✅ [${t}] ===== DATASET VAZIO (VÁLIDO) =====`),M.log(`✅ [${t}] Empty dataset (0 records) - this is valid, not an error`),{data:[],total:0};M.log(`✅ [${t}] ===== RESPOSTA RECEBIDA COM SUCESSO =====`),M.log(`✅ [${t}] Data structure:`,{hasData:!!h,dataKeys:h?Object.keys(h):[],itemsCount:h.items?.length||0,total:h.total,hasNextCursor:!!h.next_cursor});const g=h.items.map(C=>({nome_testemunha:C.nome_testemunha||"",qtd_depoimentos:Number(C.qtd_depoimentos)||0,foi_testemunha_em_ambos_polos:!!C.foi_testemunha_em_ambos_polos,ja_foi_reclamante:!!C.ja_foi_reclamante,participou_triangulacao:!!C.participou_triangulacao,participou_troca_favor:!!C.participou_troca_favor,classificacao:C.classificacao||null,classificacao_estrategica:C.classificacao_estrategica||null,cnjs_como_testemunha:C.cnjs_como_testemunha||null,cnjs_como_reclamante:C.cnjs_como_reclamante||null,foi_testemunha_ativo:!!C.foi_testemunha_ativo,cnjs_ativo:C.cnjs_ativo||null,foi_testemunha_passivo:!!C.foi_testemunha_passivo,cnjs_passivo:C.cnjs_passivo||null,cnjs_troca_favor:C.cnjs_troca_favor||null,cnjs_triangulacao:C.cnjs_triangulacao||null,e_prova_emprestada:!!C.e_prova_emprestada,org_id:C.org_id||null,created_at:C.created_at,updated_at:C.updated_at}));return M.log(`✅ [${t}] Transformed ${g.length} items`),g.length>0&&M.log(`✅ [${t}] Sample item:`,g[0]),{data:g,total:h.total||0}});return M.log(`🎉 [${t}] fetchTestemunhas concluído com sucesso`),i}catch(r){return M.error(`💥 [${t}] Erro fatal ao buscar testemunhas:`,r),{...Tt(s.page||1,s.limit||20),error:r instanceof Error?r.message:"Erro desconhecido ao buscar testemunhas"}}}function Et(s,t){console.warn("⚠️ MODO FALLBACK: Usando dados mock para processos (API não disponível)"),M.isEnabled()&&console.table({mode:"FALLBACK",type:"PROCESSOS",page:s,limit:t});const a=[{cnj:"0001234-56.2024.5.02.0001",reclamante:"EMPRESA XYZ LTDA",reclamada:"FORNECEDOR ABC S.A.",testemunhas_ativo:["Maria Silva Santos","João Paulo Oliveira"],testemunhas_passivo:["Ana Costa Ferreira"],tem_triangulacao:!0,tem_troca:!0,tem_prova_emprestada:!1,comarca:"São Paulo",vara:"1ª Vara do Trabalho"},{cnj:"0007890-12.2024.5.02.0002",reclamante:"TECH SOLUTIONS LTDA",reclamada:"CLIENTE SERVIÇOS S.A.",testemunhas_ativo:["Ana Costa Ferreira"],testemunhas_passivo:["Maria Silva Santos","João Paulo Oliveira"],tem_triangulacao:!1,tem_troca:!0,tem_prova_emprestada:!0,comarca:"Rio de Janeiro",vara:"3ª Vara do Trabalho"}],r=(s-1)*t,o=r+t;return{data:a.slice(r,o),total:a.length}}async function ti(s){const t=Math.random().toString(36).substring(7);M.log(`🔍 [${t}] fetchProcessos iniciado`,{page:s.page,limit:s.limit,filters:s.filters,timestamp:new Date().toISOString()});try{const{data:a}=await Fe.auth.getSession();if(!a?.session?.access_token)return M.error(`❌ [${t}] Usuário não autenticado`),Et(s.page||1,s.limit||20);M.log(`✅ [${t}] Sessão válida`,{userId:a.session.user?.id,hasToken:!!a.session.access_token});const r=pr(s.filters),o={paginacao:{page:s.page||1,limit:s.limit||50},filtros:r};M.log(`📦 [${t}] Payload preparado`,o),Xn.parse(o);const n=await fr(async()=>{M.log(`🚀 [${t}] ===== CHAMANDO EDGE FUNCTION =====`),M.log(`🚀 [${t}] Function: ${qs}`),M.log(`🚀 [${t}] URL: <<MANTER>>/functions/v1/${qs}`),M.log(`🚀 [${t}] Body:`,o),M.log(`🚀 [${t}] Auth Token presente: ${!!a.session.access_token}`);const i=performance.now(),{data:d,error:h}=await Fe.functions.invoke(qs,{body:o}),u=performance.now()-i;if(M.log(`⏱️ [${t}] Tempo de resposta: ${u.toFixed(2)}ms`),h)throw M.error(`❌ [${t}] ===== ERRO NA EDGE FUNCTION =====`),M.error(`❌ [${t}] Error object:`,h),M.error(`❌ [${t}] Error message:`,h.message),M.error(`❌ [${t}] Error context:`,h.context),new Error(`Erro ao buscar processos: ${h.message}`);if(!d||!d.items)return M.log(`✅ [${t}] ===== DATASET VAZIO (VÁLIDO) =====`),M.log(`✅ [${t}] Empty dataset (0 records) - this is valid, not an error`),{data:[],total:0};M.log(`✅ [${t}] ===== RESPOSTA RECEBIDA COM SUCESSO =====`),M.log(`✅ [${t}] Data structure:`,{hasData:!!d,dataKeys:d?Object.keys(d):[],itemsCount:d.items?.length||0,total:d.total,hasNextCursor:!!d.next_cursor});const b=Array.isArray(d.items)?d.items:[],g=isFinite(d.total)?d.total:b.length;return{data:b,total:g}});return M.log(`🎉 [${t}] fetchProcessos concluído com sucesso`),n}catch(a){return M.error(`💥 [${t}] Erro fatal ao buscar processos:`,a),{...Et(s.page||1,s.limit||20),error:a instanceof Error?a.message:"Erro desconhecido ao buscar processos"}}}function Bs(s,t){if(!s||typeof s!="object")return 0;const r=t.filter(d=>{const h=s[d];return h!=null&&h!==""&&h!=="nan"}).length/t.length;let o=0;return o=["cnj","reclamante","status","classificacao"].filter(d=>t.includes(d)&&s[d]).length*.05,Math.min(1,r+o)}function ai(s){return!s||s==="null"||s==="undefined"?"Em andamento":s}function ri(s){return!s||s==="null"||s==="undefined"?"Normal":s}function oi(s){if(s.situacao)return{status:s.situacao,inferido:!1};if(s.categoria)return{status:s.categoria,inferido:!1};const t=(s.classificacao_final||"").toLowerCase();if(t.includes("descartar"))return{status:"Arquivado",inferido:!0};if(t.includes("conhecer"))return{status:"Aguardando movimentação",inferido:!0};const a=s.quantidade_movimentos||0,r=s.quantidade_documentos||0;return a===0&&r===0?{status:"Aguardando distribuição",inferido:!0}:a>10?{status:"Em fase instrutória",inferido:!0}:{status:"Em andamento",inferido:!0}}function Rt(s){if(!s)return"Normal";const t=String(s).replace(/[\[\]]/g,"").trim().toLowerCase();return t.charAt(0).toUpperCase()+t.slice(1)}function Us(s,t,a){if(t!=null)return t>=85?"critico":t>=70?"alto":t>=50?"medio":"baixo";if(a){const o=a.toLowerCase();if(o.includes("triangulação")||o.includes("troca de favor"))return"critico";if(o.includes("já foi testemunha")||o.includes("ambos polos"))return"alto";if(o.includes("prova emprestada"))return"medio"}const r=ri(s).toLowerCase();return r.includes("crítico")||r.includes("alto")?"alto":r.includes("médio")||r.includes("medio")?"medio":"baixo"}const ni=s=>typeof s=="object"&&s!==null&&("status"in s||"message"in s);function ii(){const{toast:s}=ke(),{error:t}=$o(),{chatStatus:a,chatResult:r,agentOnline:o,selectedProcesso:n,selectedTestemunha:i,setChatStatus:d,setChatResult:h,addChatMessage:u,updateChatMessage:b,setAgentOnline:g}=S(),C=x.useCallback(f=>{switch(f){case"processo":return"process_analysis";case"testemunha":return"witness_analysis";case"reclamante":return"claimant_analysis";default:return"risk_analysis"}},[]),T=x.useCallback((f,B)=>[{type:"executive",title:"📌 Resumo Executivo",icon:"Sparkles",data:{cnj:B.match(/\d{7}-\d{2}\.\d{4}\.\d{1}\.\d{2}\.\d{4}/)?B:"1000000-09.2024.5.02.1000",reclamante:f==="reclamante"?B:"Maria Silva Santos",reu:"Empresa ABC Ltda",status:"Em andamento",observacoes:"Processo com potencial risco de triangulação detectado.",riscoNivel:"alto",confianca:.85,alerta:"Testemunhas conectadas em múltiplos processos"},meta:{status:"Em andamento",observacoes:"Processo com potencial risco de triangulação detectado.",riscoNivel:"alto",confidence:.85},citations:[{source:"por_processo",ref:"1000000-09.2024.5.02.1000"},{source:"por_testemunha",ref:"João Santos"}]},{type:"details",title:"📋 Análise Detalhada",icon:"FileText",data:{secoes:[{titulo:"Vínculos Identificados",conteudo:"Foram identificadas 3 testemunhas que aparecem em processos similares.",evidencias:["João Santos: 5 processos","Maria Oliveira: 3 processos"]},{titulo:"Padrões Temporais",conteudo:"Concentração de depoimentos entre Jan-Mar 2024.",evidencias:["Janeiro: 8 depoimentos","Fevereiro: 12 depoimentos"]}],textoOriginal:B}},{type:"alerts",title:"⚠️ Alertas Estratégicos",icon:"AlertTriangle",data:{suspiciousPatterns:["Triangulação detectada entre 3 testemunhas","Depoimentos com narrativas similares","Mesmo advogado em processos conexos"]}},{type:"strategies",title:"🎯 Polo Ativo & Estratégias",icon:"Target",data:{estrategias:[{texto:"Questionar vínculos entre testemunhas",prioridade:"ALTA"},{texto:"Investigar histórico de depoimentos",prioridade:"MÉDIA"}],proximosPassos:["Solicitar certidões de processos anteriores","Preparar questionário específico para audiência"]}}],[]);return{runAnalysis:x.useCallback(async(f,B)=>{if(!f.trim()){s({title:"Campo obrigatório",description:"Digite uma consulta para executar a análise.",variant:"destructive"});return}if(!o){s({title:"Agente indisponível",description:"O assistente está temporariamente em manutenção.",variant:"destructive"});return}d("loading"),s({title:"Análise iniciada",description:"Processando sua consulta..."});const Y=u({role:"assistant",content:"",blocks:[]});try{const U={message:f,queryType:C(B)};if(n&&(B==="processo"||f.match(/\d{7}-\d{2}\.\d{4}\.\d\.\d{2}\.\d{4}/))){const l=oi(n),c=Rt(n.classificacao_final),m=Us(n.classificacao_final,n.score_risco,n.insight_estrategico),j=Bs(n,["cnj","reclamante_nome","reu_nome","status","classificacao_final"]);U.context={type:"processo",data:{cnj:n.cnj||n.numero_cnj,reclamante:n.reclamante_nome,reu:n.reu_nome,status:l.status,statusInferido:l.inferido,fase:n.fase,uf:n.uf,comarca:n.comarca,testemunhas_ativo:n.testemunhas_ativo,testemunhas_passivo:n.testemunhas_passivo,classificacao:c,classificacao_final:n.classificacao_final,score_risco:n.score_risco,insight_estrategico:n.insight_estrategico,riscoNivel:m},meta:{status:l.status,statusInferido:l.inferido,classificacao:c,riscoNivel:m,confidence:j}}}else if(i&&B==="testemunha"){const l=Rt(i.classificacao_final),c=Us(i.classificacao_final,i.score_risco,null),m=Bs(i,["nome_testemunha","qtd_depoimentos","classificacao_final"]);U.context={type:"testemunha",data:{nome:i.nome_testemunha,qtd_depoimentos:i.qtd_depoimentos,processos_cnj:i.processos_cnj,foi_testemunha_em_ambos_polos:i.foi_testemunha_em_ambos_polos,ja_foi_reclamante:i.ja_foi_reclamante,classificacao_final:l,score_risco:i.score_risco},meta:{status:i.foi_testemunha_em_ambos_polos?"Ativo em ambos polos":"Normal",statusInferido:!1,classificacao:l,riscoNivel:c,confidence:m}}}console.log("🚀 [PAYLOAD] Enviando para chat-legal:",{message:U.message,queryType:U.queryType,hasContext:!!U.context,contextType:U.context?.type,hasMeta:!!U.context?.meta,meta:U.context?.meta,dataKeys:U.context?.data?Object.keys(U.context.data):[]});const{data:W,error:oe}=await Fe.functions.invoke("chat-legal",{body:U});if(oe){if(ni(oe)&&(oe.status===402||oe.message?.includes("Workspace out of credits"))){const l=`https://${yo()}.functions.supabase.co/chat-legal`;console.warn(`Lovable API ${oe.status} at ${l}`),t("Limite de créditos atingido","As funções de chat/assistente estão temporariamente indisponíveis. Tente novamente mais tarde.",{duration:void 0}),g(!1),b(Y,{content:"Créditos esgotados. Função indisponível."}),d("error");return}throw oe}const H=W?.data||W?.content||"";console.log("🔍 [FRONTEND] Raw AI Response type:",typeof H),console.log("🔍 [FRONTEND] Response length:",H.length),console.log("🔍 [FRONTEND] First 300 chars:",H.substring(0,300));let J=[];try{const l=JSON.parse(H);console.log("✅ [FRONTEND] Parsed JSON, type:",typeof l),l.blocks&&Array.isArray(l.blocks)?(J=l.blocks,console.log("✅ [FRONTEND] Extracted blocks array with",J.length,"items")):Array.isArray(l)&&l.length>0?(J=l,console.log("✅ [FRONTEND] Direct array with",J.length,"blocks")):l.type?(J=[l],console.log("✅ [FRONTEND] Single block object")):console.warn("⚠️ [FRONTEND] Parsed JSON but unexpected structure:",Object.keys(l))}catch(l){console.error("❌ [FRONTEND] JSON parse failed:",l);try{const c=H.match(/\{[\s\S]*"blocks"[\s\S]*\}/);c&&(J=JSON.parse(c[0]).blocks||[],console.log("✅ [FRONTEND] Extracted blocks from text:",J.length))}catch(c){console.error("❌ [FRONTEND] Extraction failed:",c)}}(!J||J.length===0)&&(console.log("🔧 [FRONTEND] Gerando fallback blocks para input:",f),J=[{type:"executive",title:"📊 Resumo Executivo",icon:"FileText",data:{cnj:f.match(/\d{7}-\d{2}\.\d{4}\.\d\.\d{2}\.\d{4}/)?f:"0000000-00.0000.0.00.0000",reclamante:n?.reclamante_nome||"Aguardando dados...",reu:n?.reu_nome||"Aguardando dados...",status:ai(n?.status),observacoes:n?.observacoes||`Análise iniciada para: ${f.substring(0,100)}${f.length>100?"...":""}`,riscoNivel:Us(n?.classificacao_final,n?.score_risco),confianca:n?Bs(n,["cnj","reclamante_nome","reu_nome","status"]):.5,alerta:void 0,citacoes:[]}},{type:"details",title:"🔍 Análise Detalhada",icon:"Search",data:{secoes:[{titulo:"Informações Disponíveis",conteudo:`Consulta realizada: ${f}`,evidencias:[]},{titulo:"Análise",conteudo:"Aguardando processamento completo pelo sistema. Por favor, tente novamente em alguns instantes.",evidencias:[]},{titulo:"Recomendações",conteudo:"Ações sugeridas:",evidencias:["Verificar se os dados estão disponíveis no sistema","Confirmar formato da consulta (CNJ, nome, etc)","Aguardar alguns instantes e tentar novamente"]}]}}],console.log("✅ [FRONTEND] Fallback blocks gerados:",J.length));const z=J.map(l=>({...l,context:U.context,meta:U.context?.meta}));b(Y,{content:z.length>0?"Análise concluída":H,blocks:z}),h(z),d("success"),s({title:"Análise concluída",description:`Análise ${B==="processo"?"por processo":B==="testemunha"?"por testemunha":"por reclamante"} executada com sucesso.`})}catch(U){console.error("Error in analysis:",U),b(Y,{content:"Erro ao executar análise. Tente novamente."}),d("error"),s({title:"Erro na análise",description:U instanceof Error?U.message:"Erro desconhecido ao executar análise.",variant:"destructive"})}},[o,C,T,d,h,u,b,s,t,g]),chatStatus:a,chatResult:r,agentOnline:o}}function li(s,t="all",a=!0){const r=et(s,250);return Xr({queryKey:["unified-search",r,t],queryFn:async()=>{if(!r||r.length<2)return{query:r,parsed:r,filters:{},scope:t,results:[],total:0};const{data:o,error:n}=await Fe.functions.invoke("search",{body:{q:r,scope:t,limit:20}});if(n)throw n;return o},enabled:a&&r.length>=2,staleTime:3e4})}const Pt={process:"Processo",witness:"Testemunha",claimant:"Reclamante",lawyer:"Advogado",comarca:"Comarca"},ci={process:"bg-blue-500/10 text-blue-700 dark:text-blue-300",witness:"bg-purple-500/10 text-purple-700 dark:text-purple-300",claimant:"bg-green-500/10 text-green-700 dark:text-green-300",lawyer:"bg-orange-500/10 text-orange-700 dark:text-orange-300",comarca:"bg-gray-500/10 text-gray-700 dark:text-gray-300"},di=[{scope:"all",label:"Tudo",icon:cs},{scope:"process",label:"Processos",icon:Le},{scope:"witness",label:"Testemunhas",icon:js},{scope:"claimant",label:"Reclamantes",icon:Ts}],mi={process:Le,witness:js,claimant:Ts,lawyer:Ts,comarca:eo};function ui(){const s=x.useRef(null),[t,a]=x.useState(!1),[r,o]=x.useState("all"),[n,i]=x.useState(""),[d,h]=x.useState(!1),[u,b]=x.useState(0),g=rt(),{toast:C}=ke(),{chatKind:T,chatStatus:K,agentOnline:f,selectedProcesso:B,selectedTestemunha:Y,setChatInput:U,setChatKind:W,setSelectedProcesso:oe,setSelectedTestemunha:H,processos:J,testemunhas:z}=S(),{runAnalysis:l}=ii(),c=n,{data:m,isLoading:j}=li(c,r,t&&c.length>=2),w=["Digite um nome... Ex: João Silva","Busque por CNJ... Ex: 0001234-56.2024.5.02.0001","Use operadores... Ex: risco:alto uf:RS","Filtros avançados... Ex: depoimentos:>3 comarca:POA"];x.useEffect(()=>{const v=setInterval(()=>{b(E=>(E+1)%w.length)},3e3);return()=>clearInterval(v)},[]);const q=w[u];x.useEffect(()=>{/\d{7}-\d{2}\.\d{4}\.\d{1}\.\d{2}\.\d{4}/.test(n)&&(o("process"),W("processo"))},[n,W]),x.useEffect(()=>{n.length>=2?a(!0):a(!1)},[n]),x.useEffect(()=>{const v=E=>{E.key==="k"&&E.ctrlKey&&(E.preventDefault(),s.current?.focus())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[]);const ne=v=>{switch(a(!1),i(v.title),U(v.title),v.type){case"process":{const E=J.find(Q=>Q.cnj===v.title||Q.numero_cnj===v.title);E&&(oe(E),C({title:"Processo selecionado",description:E.cnj||E.numero_cnj})),W("processo"),g(`/mapa-testemunhas?tab=processos&cnj=${encodeURIComponent(v.title)}`);break}case"witness":{const E=z.find(Q=>Q.nome_testemunha?.toLowerCase()===v.title.toLowerCase());E&&(H(E),C({title:"Testemunha selecionada",description:E.nome_testemunha})),W("testemunha"),g(`/mapa-testemunhas?tab=testemunhas&nome=${encodeURIComponent(v.title)}`);break}case"claimant":{W("reclamante"),g(`/mapa-testemunhas?tab=processos&reclamante=${encodeURIComponent(v.title)}`);break}}},pe=(v,E)=>{E.stopPropagation(),navigator.clipboard.writeText(v),C({title:"CNJ copiado",description:v})},je=()=>{oe(null),H(null),U(""),i("")},$=B||Y,se=B?`Processo: ${B.cnj||B.numero_cnj}`:Y?`Testemunha: ${Y.nome_testemunha}`:null,k=async()=>{if(!n.trim()||N||!f)return;a(!1),U(n);const v=T||(r==="process"?"processo":r==="witness"?"testemunha":"reclamante");W(v),await l(n.trim(),v)},de=v=>{v.key==="Enter"&&(v.ctrlKey||v.metaKey)&&(v.preventDefault(),k())},F=m&&m.results.length>0,V=m?.isAmbiguous||!1,N=V&&n.length>=2,R=n.trim().length>0&&!N&&f;return e.jsxs("div",{className:"w-full mx-auto max-w-7xl p-6 space-y-6",children:[!d&&e.jsxs(De,{className:"border-yellow-200 bg-yellow-50 dark:bg-yellow-950/20",children:[e.jsx(ze,{className:"h-4 w-4 text-yellow-600 dark:text-yellow-500"}),e.jsxs(Oe,{className:"flex items-center justify-between gap-4",children:[e.jsxs("span",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{className:"font-semibold",children:"Conteúdo assistivo."})," ","Revisão humana obrigatória. Dados tratados conforme LGPD."," ",e.jsx("a",{href:"/privacy",className:"underline hover:no-underline",children:"Política de Privacidade"})]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>h(!0),className:"shrink-0 hover:bg-yellow-100 dark:hover:bg-yellow-900/30",children:e.jsx(Ye,{className:"h-4 w-4"})})]})]}),V&&m?.suggestions&&e.jsxs(De,{className:"border-blue-200 bg-blue-50 dark:bg-blue-950/20 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(at,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"}),e.jsx(Oe,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:m.suggestions.message}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(m.suggestions.counts).map(([v,E])=>e.jsxs(L,{variant:"secondary",className:"text-xs",children:[v,": ",E]},v))})]})})]}),$&&se&&e.jsxs("div",{className:"flex items-center gap-2 bg-primary/10 border border-primary/20 rounded-lg px-4 py-3 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsxs(L,{variant:"default",className:"gap-1.5 text-xs",children:[B&&e.jsx(Le,{className:"h-3 w-3"}),Y&&e.jsx(js,{className:"h-3 w-3"}),"Contexto Selecionado"]}),e.jsx("span",{className:"text-sm font-medium text-foreground flex-1",children:se}),e.jsxs(P,{variant:"ghost",size:"sm",onClick:je,className:"h-7 px-2 hover:bg-destructive/10 gap-1.5",children:[e.jsx(Ye,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:"Limpar"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(cs,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Busca Inteligente Unificada"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pesquise por processo, testemunha ou reclamante em um único lugar"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Online"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Yr,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Manutenção"})]})})]}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:di.map(v=>{const E=v.icon;return e.jsxs(P,{variant:r===v.scope?"default":"outline",size:"sm",onClick:()=>o(v.scope),className:"gap-2 h-8 transition-all hover:scale-105",children:[e.jsx(E,{className:"h-3.5 w-3.5",strokeWidth:1.5}),v.label]},v.scope)})})]}),e.jsx("div",{className:"relative",children:e.jsxs(ya,{open:t,onOpenChange:a,children:[e.jsx(wa,{asChild:!0,children:e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/20 to-primary/10 rounded-lg blur-sm group-hover:blur-md transition-all opacity-0 group-hover:opacity-100"}),e.jsxs("div",{className:"relative",children:[e.jsx(cs,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground pointer-events-none z-10"}),e.jsx(We,{ref:s,value:n,onChange:v=>i(v.target.value),onKeyDown:de,placeholder:q,className:"pl-12 pr-12 h-14 text-base border-2 focus:border-primary/50 transition-all shadow-sm hover:shadow-md"}),n&&e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>i(""),className:"absolute right-2 top-1/2 -translate-y-1/2 h-9 w-9 p-0 rounded-full hover:bg-destructive/10",children:e.jsx(Ye,{className:"h-4 w-4"})})]})]})}),e.jsx(Ca,{className:"w-[--radix-popover-trigger-width] p-0",align:"start",onOpenAutoFocus:v=>v.preventDefault(),children:e.jsx(mt,{children:e.jsxs($a,{children:[j&&e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(ds,{className:"h-5 w-5 animate-spin text-muted-foreground"})}),!j&&F&&e.jsxs(e.Fragment,{children:[V&&m?.suggestions&&e.jsx("div",{className:"px-3 py-2 border-b bg-muted/50",children:e.jsx("p",{className:"text-xs font-medium text-foreground",children:m.suggestions.message})}),["process","witness","claimant"].map(v=>{const E=m.results.filter(y=>y.type===v);if(E.length===0)return null;const Q=mi[v],O=Pt[v];return e.jsx(qa,{heading:e.jsxs("div",{className:"flex items-center justify-between w-full pr-2",children:[e.jsx("span",{children:O}),e.jsx(L,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:E.length})]}),children:E.map(y=>e.jsxs(Va,{onSelect:()=>ne(y),className:_("flex items-start gap-3 py-3 cursor-pointer transition-colors",V&&"hover:bg-blue-50 dark:hover:bg-blue-950/30"),children:[e.jsx("div",{className:"mt-0.5",children:e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium truncate",children:y.title}),e.jsx(L,{variant:"secondary",className:`text-[10px] px-1.5 py-0 ${ci[y.type]}`,children:Pt[y.type]})]}),y.subtitle&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:y.subtitle}),y.type==="process"&&y.meta&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-[10px] text-muted-foreground",children:[y.meta.status&&e.jsxs("span",{children:["Status: ",y.meta.status]}),y.meta.comarca&&e.jsxs("span",{children:["· ",y.meta.comarca]}),y.meta.classificacao&&e.jsx(L,{variant:"outline",className:"text-[9px] px-1 py-0",children:y.meta.classificacao})]}),y.type==="witness"&&y.meta&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-[10px]",children:[e.jsxs("span",{className:"text-muted-foreground",children:[y.meta.depoimentos," depoimentos"]}),y.meta.ambosPoles&&e.jsx(L,{variant:"destructive",className:"text-[9px] px-1 py-0",children:"⚠ Ambos polos"}),y.meta.classificacao&&e.jsx(L,{variant:"outline",className:"text-[9px] px-1 py-0",children:y.meta.classificacao})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[y.type==="process"&&e.jsx(P,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-muted",onClick:te=>pe(y.title,te),title:"Copiar CNJ",children:e.jsx(es,{className:"h-3 w-3"})}),e.jsx(P,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 hover:bg-muted",title:"Abrir detalhes",children:e.jsx(Gs,{className:"h-3 w-3"})})]})]},y.id))},v)})]}),!j&&!F&&n.length>=2&&e.jsx(La,{children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhum resultado encontrado."}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Tente operadores:"," ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"p:"})," ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"w:"})," ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"uf:RS"})]})]})})]})})})]})}),e.jsxs("div",{className:"flex items-center justify-between gap-4 pt-2",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground bg-muted/50 px-3 py-1.5 rounded-lg",children:[e.jsx(so,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[e.jsx("kbd",{className:"px-1.5 py-0.5 text-xs rounded bg-background shadow-sm",children:"Ctrl"}),e.jsx("span",{className:"mx-1",children:"+"}),e.jsx("kbd",{className:"px-1.5 py-0.5 text-xs rounded bg-background shadow-sm",children:"K"})]})]}),n.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center gap-1.5 animate-in fade-in slide-in-from-left-2 duration-300",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"}),c.length>=2?`${m?.total||0} resultados`:"Digite para buscar"]})]}),e.jsx(P,{onClick:k,disabled:!R||K==="loading",size:"lg",className:_("gap-2 min-w-[180px] shadow-md hover:shadow-lg transition-all hover:scale-105 font-semibold",$&&"bg-primary/90 hover:bg-primary ring-2 ring-primary/20"),children:K==="loading"?e.jsxs(e.Fragment,{children:[e.jsx(ds,{className:"h-5 w-5 animate-spin",strokeWidth:2}),e.jsx("span",{children:"Analisando dados..."})]}):N?e.jsxs(e.Fragment,{children:[e.jsx(gs,{className:"h-5 w-5",strokeWidth:2}),e.jsx("span",{children:"Refinar busca"})]}):$?e.jsxs(e.Fragment,{children:[e.jsx(Ws,{className:"h-5 w-5",strokeWidth:2}),e.jsx("span",{children:"⚡ Análise Contextual"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ws,{className:"h-5 w-5",strokeWidth:2}),e.jsx("span",{children:"⚡ Executar Análise"})]})})]})]})}function _s({label:s,value:t,type:a="default"}){const r=()=>{switch(a){case"reclamante":return"text-blue-700 font-medium";case"reu":return"text-red-700 font-medium";case"status":return"text-green-700";case"observacoes":return"text-muted-foreground text-sm";default:return"text-foreground"}},o=()=>{switch(a){case"status":return t.toLowerCase().includes("ativo")?"default":"secondary";default:return"outline"}};return e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:s}),e.jsx("div",{className:_("font-medium",r()),children:a==="status"&&t!=="Não informado"?e.jsx(L,{variant:o(),className:"text-xs",children:t}):e.jsx("span",{children:t})})]})}function hi({cnj:s,reclamante:t,reu:a,status:r="Não informado",observacoes:o="Sem observações registradas",riscoNivel:n,confianca:i,alerta:d,citacoes:h}){console.log("📊 [ExecutiveSummaryCard] Props recebidas:",{cnj:s,status:r,observacoes:o,riscoNivel:n,confianca:typeof i=="number"?`${i}%`:i,hasObservacoes:!!o&&o!=="Sem observações registradas",hasStatus:!!r&&r!=="Não informado",isDefaultData:r==="Não informado"&&o==="Sem observações registradas"});const{toast:u}=ke(),[b,g]=x.useState(!1),C=typeof i=="number"&&!isNaN(i)&&isFinite(i)?Math.max(0,Math.min(1,i)):0,T=Math.round(C*100),K=3,f=h.length>K,B=b?h:h.slice(0,K),Y=h.length-K,U=async()=>{const H=`Resumo Executivo - ${s}

Reclamante: ${t}
Réu: ${a}
Status: ${r}
Observações: ${o}

Risco: ${n.toUpperCase()}
Confiança: ${T}%
${d?`Alerta: ${d}`:""}

Citações:
${h.map(J=>`• ${J.label}`).join(`
`)}`;try{await navigator.clipboard.writeText(H),u({title:"Copiado!",description:"Resumo executivo copiado para a área de transferência."})}catch{u({title:"Erro ao copiar",description:"Não foi possível copiar o conteúdo.",variant:"destructive"})}},W=()=>{window.print(),u({title:"PDF",description:"Abrindo diálogo de impressão..."})},oe=()=>{const H={cnj:s,reclamante:t,reu:a,status:r,observacoes:o,riscoNivel:n,confianca:i,alerta:d,citacoes:h},J=new Blob([JSON.stringify(H,null,2)],{type:"application/json"}),z=URL.createObjectURL(J),l=document.createElement("a");l.href=z,l.download=`resumo-executivo-${s.replace(/[^\w]/g,"-")}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(z),u({title:"JSON exportado",description:"Arquivo JSON baixado com sucesso."})};return e.jsxs(le,{className:"rounded-2xl border-border/50 transition-shadow hover:shadow-sm","aria-labelledby":"executive-summary",children:[e.jsx(_e,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ye,{id:"executive-summary",className:"text-base font-semibold flex items-center gap-2",children:[e.jsx(Ws,{className:"h-4 w-4 text-violet-600","aria-hidden":"true"}),"Resumo Executivo"]}),e.jsxs(bs,{children:[e.jsx(Ns,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0","aria-label":"Ações do resumo",children:e.jsx(to,{className:"h-4 w-4"})})}),e.jsxs(hs,{align:"end",children:[e.jsxs(ss,{onClick:U,children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),"Copiar resumo"]}),e.jsxs(ss,{onClick:W,children:[e.jsx(ao,{className:"h-4 w-4 mr-2"}),"Exportar PDF"]}),e.jsxs(ss,{onClick:oe,children:[e.jsx(ro,{className:"h-4 w-4 mr-2"}),"Exportar JSON"]})]})]})]})}),e.jsxs(he,{className:"pt-0 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_s,{label:"Reclamante",value:t,type:"reclamante"}),e.jsx(_s,{label:"Réu",value:a,type:"reu"}),e.jsx(_s,{label:"Status",value:r,type:"status"}),e.jsx(_s,{label:"Observações",value:o,type:"observacoes"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Nível de Risco"}),e.jsx(nr,{riscoNivel:n})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Confiança"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ks,{value:T,className:"w-16 h-2"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[T,"%"]})]})]})]}),d&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted/50 rounded-lg","aria-live":"polite",children:[e.jsx(ga,{className:"h-4 w-4 text-violet-600","aria-hidden":"true"}),e.jsx("span",{className:"text-sm font-medium",children:d})]})]}),h.length>0&&e.jsxs("div",{className:"pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(xt,{className:"h-3 w-3 text-muted-foreground","aria-hidden":"true"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Citações:"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[B.map((H,J)=>e.jsxs(L,{variant:"secondary",className:_("text-xs flex items-center gap-1 cursor-pointer hover:bg-secondary/80",H.href&&"underline"),onClick:H.onClick||(()=>H.href&&window.open(H.href,"_blank")),children:[e.jsx(xt,{className:"h-3 w-3","aria-hidden":"true"}),H.label]},J)),f&&e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>g(!b),className:"h-6 px-2 text-xs text-muted-foreground hover:text-foreground",children:b?e.jsxs(e.Fragment,{children:[e.jsx(aa,{className:"h-3 w-3 mr-1"}),"Menos"]}):e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"h-3 w-3 mr-1"}),"+",Y]})})]})]})]})]})}function xi({secoes:s,textoOriginal:t}){const a=o=>{switch(o){case"alta":return e.jsx(L,{variant:"destructive",className:"text-xs",children:"Alta"});case"media":return e.jsx(L,{variant:"secondary",className:"text-xs",children:"Média"});case"baixa":return e.jsx(L,{variant:"outline",className:"text-xs",children:"Baixa"});default:return null}},r=Array.isArray(s)?s:[];return e.jsx("div",{className:"space-y-4",children:e.jsxs(wo,{type:"multiple",className:"w-full",children:[r.map((o,n)=>e.jsxs(jt,{value:`secao-${n}`,children:[e.jsx(vt,{className:"text-left",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:o.titulo}),o.evidencias&&o.evidencias.length>0&&e.jsxs(L,{variant:"outline",className:"text-xs",children:[o.evidencias.length," evidência",o.evidencias.length>1?"s":""]})]})}),e.jsx(bt,{children:e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:o.conteudo})}),o.evidencias&&o.evidencias.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Evidências"}),e.jsx("div",{className:"grid gap-2",children:o.evidencias.map((i,d)=>typeof i=="string"?e.jsx(le,{className:"p-3 bg-muted/30",children:e.jsx("p",{className:"text-sm",children:i})},d):e.jsx(le,{className:"p-3 bg-muted/30",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[i.tipo&&e.jsx("div",{className:"text-xs text-muted-foreground font-medium mb-1",children:i.tipo}),e.jsx("p",{className:"text-sm",children:i.descricao})]}),i.relevancia&&a(i.relevancia)]})},d))})]}),o.metadados&&e.jsx("div",{className:"pt-2 border-t border-muted",children:e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs text-muted-foreground",children:[o.metadados.fonte&&e.jsxs("span",{children:[e.jsx("strong",{children:"Fonte:"})," ",o.metadados.fonte]}),o.metadados.confiabilidade&&e.jsxs("span",{children:[e.jsx("strong",{children:"Confiabilidade:"})," ",Math.round(o.metadados.confiabilidade*100),"%"]}),o.metadados.timestamp&&e.jsxs("span",{children:[e.jsx("strong",{children:"Processado:"})," ",new Date(o.metadados.timestamp).toLocaleString("pt-BR")]})]})})]})})]},n)),t&&e.jsxs(jt,{value:"texto-original",children:[e.jsx(vt,{className:"text-left",children:e.jsx("span",{className:"font-medium",children:"Consulta Original"})}),e.jsx(bt,{children:e.jsx(le,{className:"p-4 bg-muted/30",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap font-mono text-muted-foreground",children:t})})})]})]})})}function ws({citations:s}){if(!s.length)return null;const t=r=>{switch(r){case"por_processo":return e.jsx(Le,{className:"h-3 w-3"});case"por_testemunha":return e.jsx(Ts,{className:"h-3 w-3"});default:return e.jsx(Gs,{className:"h-3 w-3"})}},a=r=>{switch(r){case"por_processo":return"default";case"por_testemunha":return"secondary";default:return"outline"}};return e.jsxs("div",{className:"pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Gs,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Citações:"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.map((r,o)=>e.jsxs(L,{variant:a(r.source),className:"text-xs flex items-center gap-1",children:[t(r.source),r.ref]},o))})]})}function pi({onToggle:s,isAnonymized:t,variant:a="default",className:r=""}){const[o,n]=x.useState(!1),i=async()=>{n(!0);try{await new Promise(d=>setTimeout(d,300)),s(!t)}finally{n(!1)}};return a==="minimal"?e.jsx(P,{variant:t?"default":"outline",size:"sm",onClick:i,disabled:o,className:r,children:t?e.jsxs(e.Fragment,{children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),"Dados Anonimizados"]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"Dados Completos"]})}):e.jsxs(bs,{children:[e.jsx(Ns,{asChild:!0,children:e.jsxs(P,{variant:"outline",className:r,children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Privacidade",e.jsx(ms,{className:"h-4 w-4 ml-2"})]})}),e.jsxs(hs,{align:"end",className:"w-56",children:[e.jsx(ss,{onClick:i,disabled:o,children:t?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Mostrar Dados Completos"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Revelar CPFs e nomes reais"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ks,{className:"h-4 w-4 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Anonimizar Dados"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Mascarar informações sensíveis"})]})]})}),e.jsxs(ss,{disabled:!0,className:"border-t mt-1 pt-2",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Conforme Art. 6º, VII da LGPD"})]})]})]})}function fi({variant:s="compact",showDetails:t=!1,className:a=""}){return s==="badge"?e.jsx(Fa,{children:e.jsxs(ps,{children:[e.jsx(fs,{asChild:!0,children:e.jsxs(L,{variant:"secondary",className:`bg-success/10 text-success border-success/20 ${a}`,children:[e.jsx(Ie,{className:"h-3 w-3 mr-1"}),"LGPD Ready"]})}),e.jsx(is,{children:e.jsx("p",{children:"Documento em conformidade com a LGPD"})})]})}):s==="compact"?e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-2 bg-success/10 border border-success/20 rounded-lg ${a}`,children:[e.jsx(Ie,{className:"h-4 w-4 text-success"}),e.jsx("span",{className:"text-sm font-medium text-success",children:"LGPD Compliant"}),e.jsx($e,{className:"h-3 w-3 text-success"})]}):e.jsxs("div",{className:`border border-success/20 rounded-lg p-4 bg-success/5 ${a}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-success/10 rounded-full",children:e.jsx(Ie,{className:"h-5 w-5 text-success"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-success",children:"Documento LGPD-Ready"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conforme Lei 13.709/2018"})]}),e.jsx($e,{className:"h-5 w-5 text-success ml-auto"})]}),t&&e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(oo,{className:"h-3 w-3"}),e.jsx("span",{children:"Dados criptografados em trânsito e repouso"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(He,{className:"h-3 w-3"}),e.jsx("span",{children:"Informações sensíveis anonimizadas por padrão"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Le,{className:"h-3 w-3"}),e.jsx("span",{children:"Base legal: Execução regular de direitos (Art. 7º, VI)"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-success/20",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Aviso:"})," Este documento contém análise assistida por IA. Validação jurídica humana é obrigatória antes do uso processual."]})})]})}function gi({onExport:s,showPrint:t=!0,disabled:a=!1,showAnonymizeOption:r=!0,isAnonymized:o=!1,onAnonymizeToggle:n,className:i=""}){const{toast:d}=ke(),h=()=>{window.print(),d({title:"Imprimindo",description:"Preparando documento para impressão..."})},u=b=>{s(b,o);const g=o?" (dados anonimizados)":" (dados completos)";d({title:"Exportando",description:`Gerando arquivo ${b.toUpperCase()}${g}... Será registrado no log de auditoria.`})};return e.jsxs("div",{className:`space-y-3 ${i}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(fi,{variant:"badge"}),r&&n&&e.jsx(pi,{isAnonymized:o,onToggle:n,variant:"minimal"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsxs(P,{variant:"outline",size:"sm",onClick:h,disabled:a,className:"gap-2",children:[e.jsx(no,{className:"h-4 w-4"}),"Imprimir",o&&e.jsx(Ie,{className:"h-3 w-3 text-success"})]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>u("pdf"),disabled:a,className:"gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"PDF",o&&e.jsx(Ie,{className:"h-3 w-3 text-success"})]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>u("csv"),disabled:a,className:"gap-2",children:[e.jsx(tt,{className:"h-4 w-4"}),"CSV",o&&e.jsx(Ie,{className:"h-3 w-3 text-success"})]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>u("docx"),disabled:a,className:"gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"DOCX",o&&e.jsx(Ie,{className:"h-3 w-3 text-success"})]}),e.jsxs(P,{variant:"outline",size:"sm",onClick:()=>u("json"),disabled:a,className:"gap-2",children:[e.jsx(fa,{className:"h-4 w-4"}),"JSON",o&&e.jsx(Ie,{className:"h-3 w-3 text-success"})]})]})]})}function ji({blocks:s}){const{toast:t}=ke(),a=()=>{window.print(),t({title:"PDF",description:"Abrindo diálogo de impressão..."})},r=()=>{const i=["Tipo,Conteudo",...s.map(b=>({Tipo:b.title,Conteudo:JSON.stringify(b.data)})).map(b=>`"${b.Tipo}","${b.Conteudo}"`)].join(`
`),d=new Blob([i],{type:"text/csv;charset=utf-8;"}),h=document.createElement("a"),u=URL.createObjectURL(d);h.setAttribute("href",u),h.setAttribute("download",`analise-${Date.now()}.csv`),document.body.appendChild(h),h.click(),document.body.removeChild(h),t({title:"CSV exportado",description:"Arquivo CSV baixado com sucesso."})},o=()=>{const n={timestamp:new Date().toISOString(),blocks:s},i=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),d=URL.createObjectURL(i),h=document.createElement("a");h.href=d,h.download=`analise-completa-${Date.now()}.json`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(d),t({title:"JSON exportado",description:"Arquivo JSON baixado com sucesso."})};return!s||s.length===0?null:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-brand-ink",children:"Resultado da Análise"}),e.jsx(gi,{onExport:n=>{switch(n){case"pdf":a();break;case"csv":r();break;case"json":o();break}},showPrint:!0})]}),e.jsx("div",{className:"space-y-4",children:s.map((n,i)=>{switch(n.type){case"executive":return e.jsx(hi,{cnj:n.data?.cnj||n.data?.processo||(n.context?.type==="testemunha","N/A"),reclamante:n.data?.reclamante||n.context?.data?.nome||n.data?.reclamada||"Não informado",reu:n.data?.reu||n.data?.reclamada||(n.context?.type==="testemunha"?"N/A":"Não informado"),status:n.data?.status||n.meta?.status||n.context?.meta?.status||"Não informado",observacoes:n.data?.observacoes||n.meta?.observacoes||"Análise contextual em progresso",riscoNivel:n.data?.riscoNivel||n.meta?.riscoNivel||n.context?.meta?.riscoNivel||"baixo",confianca:typeof n.data?.confianca=="number"?n.data.confianca:typeof n.meta?.confidence=="number"?Math.round(n.meta.confidence*100):typeof n.context?.meta?.confidence=="number"?Math.round(n.context.meta.confidence*100):typeof n.data?.score=="number"?n.data.score:0,alerta:n.data?.alerta,citacoes:n.citations?.map(d=>({label:d.ref,onClick:()=>{console.log("Citation clicked:",d)}}))||[]},i);case"details":return e.jsxs(le,{className:"rounded-2xl border-border/50",children:[e.jsx(_e,{children:e.jsxs(ye,{className:"text-base font-semibold flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-primary"}),n.title]})}),e.jsxs(he,{children:[e.jsx(xi,{secoes:n.data.secoes,textoOriginal:n.data.textoOriginal}),n.citations&&e.jsx(ws,{citations:n.citations})]})]},i);case"alerts":return e.jsxs(le,{className:"rounded-2xl border-status-critical/30 bg-status-critical/5",children:[e.jsx(_e,{children:e.jsxs(ye,{className:"text-base font-semibold flex items-center gap-2",children:[e.jsx(ze,{className:"h-4 w-4 text-destructive"}),n.title]})}),e.jsxs(he,{className:"space-y-3",children:[e.jsxs(De,{className:"border-destructive/30 bg-destructive/10",children:[e.jsx(ze,{className:"h-4 w-4 text-destructive"}),e.jsxs(Oe,{className:"text-destructive-foreground",children:[e.jsx("strong",{children:"Triangulação Detectada"})," - Padrões suspeitos identificados entre testemunhas"]})]}),e.jsxs(De,{className:"border-status-warning/30 bg-status-warning/10",children:[e.jsx(ze,{className:"h-4 w-4 text-status-warning"}),e.jsxs(Oe,{className:"text-status-warning",children:[e.jsx("strong",{children:"Depoimentos Repetidos"})," - Narrativas similares encontradas"]})]}),n.data.suspiciousPatterns?.map((d,h)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-destructive/10 rounded-lg",children:[e.jsx(ze,{className:"h-3 w-3 text-destructive"}),e.jsx("span",{className:"text-sm text-destructive-foreground",children:d})]},h)),e.jsx("div",{className:"mt-4 p-3 bg-muted/50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["⚠️ ",e.jsx("strong",{children:"Atenção:"})," Possível coordenação entre depoimentos de testemunhas. Recomenda-se investigação detalhada dos vínculos identificados."]})}),n.citations&&e.jsx(ws,{citations:n.citations})]})]},i);case"strategies":return e.jsx(vi,{block:n},i);default:return e.jsxs(le,{className:"rounded-2xl border-border/50",children:[e.jsx(_e,{children:e.jsx(ye,{className:"text-base font-semibold",children:n.title})}),e.jsxs(he,{children:[e.jsx("pre",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:JSON.stringify(n.data,null,2)}),n.citations&&e.jsx(ws,{citations:n.citations})]})]},i)}})}),e.jsxs("div",{className:"text-xs text-muted-foreground text-center pt-4 border-t",children:["Relatório gerado às ",new Date().toLocaleTimeString("pt-BR")," • Dados sujeitos à verificação manual conforme LGPD"]})]})}function vi({block:s}){const{toast:t}=ke(),a=async o=>{try{await navigator.clipboard.writeText(o),t({title:"Copiado!",description:"Recomendação copiada para a área de transferência."})}catch{t({title:"Erro ao copiar",description:"Não foi possível copiar o conteúdo.",variant:"destructive"})}},r=o=>{switch(o?.toUpperCase()){case"ALTA":return"bg-status-critical/15 text-status-critical border-status-critical/30";case"MÉDIA":return"bg-status-warning/15 text-status-warning border-status-warning/30";case"BAIXA":return"bg-status-success/15 text-status-success border-status-success/30";default:return"bg-muted text-muted-foreground border-border"}};return e.jsxs(le,{className:"rounded-2xl border-status-success/30 bg-status-success/10",children:[e.jsx(_e,{children:e.jsxs(ye,{className:"text-base font-semibold flex items-center gap-2",children:[e.jsx(pt,{className:"h-4 w-4 text-emerald-600"}),s.title]})}),e.jsxs(he,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-emerald-800",children:"Estratégias Ativas"}),e.jsx(L,{variant:"secondary",className:"text-xs",children:"Polo Ativo"})]}),s.data.estrategias?.map((o,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/70 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:_("text-xs",r(o.prioridade)),children:o.prioridade}),e.jsx("span",{className:"text-sm",children:o.texto})]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>a(o.texto),className:"h-8 w-8 p-0 shrink-0",children:e.jsx(es,{className:"h-3 w-3"})})]},n))]}),s.data.acoesDefensivas&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-emerald-800",children:"Ações Defensivas"}),s.data.acoesDefensivas.map((o,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/70 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:_("text-xs",r(o.prioridade)),children:o.prioridade}),e.jsx("span",{className:"text-sm",children:o.texto})]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>a(o.texto),className:"h-8 w-8 p-0 shrink-0",children:e.jsx(es,{className:"h-3 w-3"})})]},n))]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"h-4 w-4 text-emerald-600"}),e.jsx("h4",{className:"font-medium text-emerald-800",children:"Próximos Passos"})]}),s.data.proximosPassos?.map((o,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/70 rounded-lg border",children:[e.jsx("span",{className:"text-sm",children:o}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>a(o),className:"h-8 w-8 p-0 shrink-0",children:e.jsx(es,{className:"h-3 w-3"})})]},n))]}),s.citations&&e.jsx(ws,{citations:s.citations})]})]})}function bi(){const{loadingHints:s,currentHintIndex:t,nextHint:a}=S(),r=x.useRef(null);return x.useEffect(()=>(r.current&&clearInterval(r.current),r.current=setInterval(()=>{a()},800),()=>{r.current&&clearInterval(r.current)}),[a]),e.jsxs("div",{className:"flex gap-4 animate-fade-in",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(io,{className:"h-4 w-4 text-primary animate-pulse"})}),e.jsx("div",{className:"flex-1 max-w-4xl",children:e.jsx(le,{className:"bg-card border-primary/20 shadow-sm",children:e.jsxs(he,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ds,{className:"h-4 w-4 animate-spin text-primary"}),e.jsx("span",{className:"text-sm text-foreground font-medium transition-opacity duration-200",children:s[t]||"Carregando..."},t)]}),e.jsx("div",{className:"mt-3 flex gap-1",children:Array.from({length:3}).map((o,n)=>e.jsx("div",{className:"h-1 w-8 rounded-full bg-primary/20 animate-pulse",style:{animationDelay:`${n*.2}s`,animationDuration:"1s"}},n))})]})})})]})}const kt=({isLoading:s,hasError:t,errorMessage:a,isConnected:r,dataCount:o,dataType:n})=>s?e.jsx(le,{className:"mb-4 border-blue-200 bg-blue-50/50",children:e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ds,{className:"h-5 w-5 text-blue-600 animate-spin"}),e.jsx("span",{className:"text-sm text-blue-800",children:"Conectando com servidor..."})]})})}):t&&!r?e.jsx(le,{className:"mb-4 border-orange-200 bg-orange-50/50",children:e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(lo,{className:"h-5 w-5 text-orange-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-orange-800",children:"Servidor indisponível - Exibindo dados simulados"}),a&&e.jsx("p",{className:"text-xs text-orange-700 mt-1",children:a})]}),e.jsx(L,{variant:"outline",className:"text-orange-700 border-orange-300",children:"Mock"})]})})}):t&&r?e.jsx(le,{className:"mb-4 border-red-200 bg-red-50/50",children:e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-red-800",children:"Erro de validação nos filtros"}),a&&e.jsx("p",{className:"text-xs text-red-700 mt-1",children:a})]}),e.jsx(L,{variant:"destructive",className:"text-xs",children:"Erro"})]})})}):r&&o>0?e.jsx(le,{className:"mb-4 border-green-200 bg-green-50/50",children:e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($e,{className:"h-5 w-5 text-green-600"}),e.jsxs("span",{className:"text-sm text-green-800",children:[o," ",n," carregados do servidor"]}),e.jsx(L,{variant:"outline",className:"text-green-700 border-green-300",children:"Online"})]})})}):null;class Ni extends x.Component{state={hasError:!1,error:null,errorInfo:null,errorCount:0};static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,a){const r=this.state.errorCount+1;Ce.error("🔴 [MapaErrorBoundary] Erro capturado",{error:t.message,stack:t.stack,componentStack:a.componentStack,errorCount:r,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,online:navigator.onLine}),this.setState({error:t,errorInfo:a,errorCount:r}),r>3&&Ce.error("⛔ [MapaErrorBoundary] Loop de erros detectado",{errorCount:r,lastError:t.message})}handleReset=()=>{Ce.info("🔄 [MapaErrorBoundary] Resetando estado de erro"),this.setState({hasError:!1,error:null,errorInfo:null,errorCount:0})};handleGoHome=()=>{Ce.info("🏠 [MapaErrorBoundary] Navegando para home"),typeof window<"u"&&(window.location.href="/")};render(){if(this.state.hasError){const{error:t,errorInfo:a,errorCount:r}=this.state;return e.jsx("div",{className:"flex items-center justify-center min-h-screen p-4 bg-background",children:e.jsxs(le,{className:"max-w-2xl w-full",children:[e.jsx(_e,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ze,{className:"h-8 w-8 text-destructive"}),e.jsxs("div",{children:[e.jsx(ye,{className:"text-2xl",children:"Erro no Mapa de Testemunhas"}),e.jsx(rs,{children:r>1?`Ocorreram ${r} erros consecutivos`:"Ocorreu um erro inesperado"})]})]})}),e.jsxs(he,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground",children:"Mensagem de Erro"}),e.jsx("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:e.jsx("p",{className:"text-sm text-destructive font-mono",children:t?.message||"Erro desconhecido"})})]}),typeof process<"u"&&!1,e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground",children:"Possíveis Causas"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Problemas de conexão com o servidor"}),e.jsx("li",{children:"Dados inconsistentes ou mal formatados"}),e.jsx("li",{children:"Erro na Edge Function do backend"}),e.jsx("li",{children:"Sessão expirada ou inválida"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[r<=3&&e.jsxs(P,{onClick:this.handleReset,className:"flex-1",children:[e.jsx(Ss,{className:"mr-2 h-4 w-4"}),"Tentar Novamente"]}),e.jsxs(P,{onClick:this.handleGoHome,variant:"outline",className:"flex-1",children:[e.jsx(ja,{className:"mr-2 h-4 w-4"}),"Voltar ao Início"]})]}),r>3&&e.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md",children:e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"⚠️ Múltiplas tentativas falharam. Por favor, entre em contato com o suporte."})})]})]})})}return this.props.children}}const _i=()=>{const[s,t]=x.useState(M.isEnabled()),{toast:a}=ke();x.useEffect(()=>{t(M.isEnabled())},[]);const r=()=>{const o=M.toggle();t(o),a({title:o?"🐛 Debug Mode Ativado":"Debug Mode Desativado",description:o?"Logs detalhados estão sendo exibidos no console":"Logs de debug foram desativados",duration:2e3})};return e.jsxs("div",{className:"flex items-center space-x-2 bg-muted/50 px-3 py-2 rounded-md border border-border/40",children:[e.jsx(co,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(Ne,{htmlFor:"debug-mode",className:"text-sm cursor-pointer",children:"Debug Mode"}),e.jsx(nt,{id:"debug-mode",checked:s,onCheckedChange:r,className:"data-[state=checked]:bg-primary"})]})};async function yi(s){const t={functionName:s,isReachable:!1,hasAuth:!1};try{const{data:{session:a},error:r}=await Fe.auth.getSession();if(r)return t.authError=r.message,Ce.error(`[EdgeDiagnostics] Erro de sessão para ${s}`,{error:r}),t;if(!a)return t.authError="Nenhuma sessão ativa",Ce.warn(`[EdgeDiagnostics] Nenhuma sessão ativa para ${s}`),t;t.hasAuth=!0,Ce.info(`[EdgeDiagnostics] Testando ${s}...`);const{data:o,error:n}=await Fe.functions.invoke(s,{body:{paginacao:{page:1,limit:1},filtros:{}}});return n?(t.testResult="error",t.errorDetails={message:n.message,context:n.context,status:n.status},Ce.error(`[EdgeDiagnostics] Erro ao testar ${s}`,{error:n,errorDetails:t.errorDetails})):(t.isReachable=!0,t.testResult="success",Ce.info(`[EdgeDiagnostics] ${s} respondeu com sucesso`,{hasData:!!o,dataKeys:o?Object.keys(o):[]})),t}catch(a){return t.testResult="error",t.errorDetails=a,Ce.error(`[EdgeDiagnostics] Exceção ao testar ${s}`,{error:a}),t}}async function wi(){Ce.info("🔍 [EdgeDiagnostics] ===== INICIANDO DIAGNÓSTICO COMPLETO =====");const s=["mapa-testemunhas-processos","mapa-testemunhas-testemunhas"],t={};for(const r of s)Ce.info(`🔍 [EdgeDiagnostics] Testando função: ${r}`),t[r]=await yi(r);Ce.info("✅ [EdgeDiagnostics] ===== DIAGNÓSTICO CONCLUÍDO =====",{results:t});const a=Object.entries(t).map(([r,o])=>({function:r,reachable:o.isReachable,authenticated:o.hasAuth,testResult:o.testResult,error:o.errorDetails?.message||o.authError||"none"}));return console.table(a),t}function Ci(){Ce.info("🔍 [EdgeDiagnostics] ===== CONFIGURAÇÃO SUPABASE =====");const s={hasSupabaseClient:!!Fe,functionsUrl:"<<MANTER>>/functions/v1",hasAuth:!!Fe?.auth};return Ce.info("🔍 [EdgeDiagnostics] Config:",s),console.table(s),s}function Si(){const[s,t]=x.useState(null),[a,r]=x.useState(!1),o=async()=>{r(!0),Ci();const n=await wi();t(n),r(!1)};return e.jsxs(le,{className:"border-dashed border-yellow-500/50 bg-yellow-50/5",children:[e.jsxs(_e,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(mo,{className:"h-4 w-4 text-yellow-600"}),e.jsx(ye,{className:"text-sm",children:"Diagnóstico de Edge Functions"})]}),e.jsx(L,{variant:"outline",className:"text-yellow-600 border-yellow-600",children:"DEV ONLY"})]}),e.jsx(rs,{className:"text-xs",children:"Teste a conectividade e configuração das Edge Functions"})]}),e.jsxs(he,{className:"space-y-3",children:[e.jsxs(P,{onClick:o,disabled:a,size:"sm",variant:"outline",className:"w-full",children:[a&&e.jsx(Ss,{className:"mr-2 h-3 w-3 animate-spin"}),a?"Executando diagnóstico...":"Executar Diagnóstico"]}),s&&e.jsx("div",{className:"space-y-2",children:Object.entries(s).map(([n,i])=>e.jsx("div",{className:"flex items-start justify-between gap-2 rounded-lg border border-border/50 bg-card/50 p-2 text-xs",children:e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("div",{className:"font-mono font-medium",children:n}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.hasAuth?e.jsxs(L,{variant:"outline",className:"text-green-600 border-green-600 text-[10px]",children:[e.jsx(Cs,{className:"mr-1 h-2 w-2"}),"Autenticado"]}):e.jsxs(L,{variant:"outline",className:"text-red-600 border-red-600 text-[10px]",children:[e.jsx(Js,{className:"mr-1 h-2 w-2"}),"Sem Auth"]}),i.isReachable?e.jsxs(L,{variant:"outline",className:"text-green-600 border-green-600 text-[10px]",children:[e.jsx(Cs,{className:"mr-1 h-2 w-2"}),"Alcançável"]}):e.jsxs(L,{variant:"outline",className:"text-red-600 border-red-600 text-[10px]",children:[e.jsx(Js,{className:"mr-1 h-2 w-2"}),"Não Alcançável"]})]}),(i.authError||i.errorDetails)&&e.jsx("div",{className:"text-[10px] text-destructive/80",children:i.authError||i.errorDetails?.message||"Erro desconhecido"})]})},n))})]})]})}function Ti(){const s=S(r=>r.density),t=S(r=>r.setDensity),a=[{value:"compact",label:"Compacto",description:"Espaçamento mínimo"},{value:"comfortable",label:"Confortável",description:"Espaçamento amplo"}];return e.jsxs(bs,{children:[e.jsx(Ns,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(uo,{className:"h-4 w-4"}),"Densidade"]})}),e.jsx(hs,{align:"end",className:"w-[200px]",children:a.map(r=>e.jsxs(ss,{onClick:()=>t(r.value),className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"text-sm font-medium",children:r.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:r.description})]}),s===r.value&&e.jsx(st,{className:"h-4 w-4 text-primary"})]},r.value))})]})}function Ei(){const s=rt(),t=S(o=>o.navigationHistory),a=S(o=>o.popNavigation),r=o=>{const n=t[o];n?.path&&(s(n.path),a(o))};return t.length<=1?null:e.jsx(za,{className:"mb-4",children:e.jsxs(Ba,{children:[e.jsx(Zs,{children:e.jsxs(Xs,{onClick:()=>r(0),className:"flex items-center gap-1 cursor-pointer",children:[e.jsx(ja,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Início"})]})}),t.slice(1).map((o,n)=>{const i=n===t.length-2,d=n+1;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ja,{}),e.jsx(Zs,{children:i?e.jsx(Ua,{className:"font-medium",children:o.label}):e.jsx(Xs,{onClick:()=>r(d),className:"cursor-pointer hover:text-foreground",children:o.label})})]},d)})]})})}const Ri=()=>{const s=rt(),[t,a]=ho(),{user:r,loading:o}=Co(),{toast:n}=ke(),i=S(or),d=S(Yo),h=S(en),u=S(sn),b=S(an),g=S(rn),C=S(on),T=S(nn),K=S(ln),f=x.useRef(null),B=x.useRef(null),Y=x.useRef(!1),U=x.useRef(!0),W=x.useRef(!1),[oe,H]=x.useState(!1),[J,z]=x.useState(!1),l=S(p=>p.chatResult),c=S(p=>p.chatStatus),m=S(p=>p.setActiveTab),j=S(p=>p.setProcessos),w=S(p=>p.setTestemunhas),q=S(p=>p.setIsLoading),ne=S(p=>p.setLastUpdate),pe=S(p=>p.setError),je=S(p=>p.setIsImportModalOpen),$=S(p=>p.loadViews),se=S(p=>p.setProcessoFilters),k=S(p=>p.setTestemunhaFilters),de=S(p=>p.setSelectedProcesso),F=S(p=>p.setSelectedTestemunha),V=S(p=>p.setHasMoreProcessos),N=S(p=>p.setHasMoreTestemunhas),[R,v]=x.useState(0),[E,Q]=x.useState(0),O=p=>p.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),y=x.useMemo(()=>{const p=Array.isArray(d)?d:[],D=Array.isArray(h)?h:[],X=p.filter(fe=>fe?.classificacao_final==="Risco Alto"||fe?.classificacao_final==="Alto").length,re=D.filter(fe=>fe?.foi_testemunha_em_ambos_polos===!0).length,ee=(fe,ce)=>{if(!isFinite(fe)||!isFinite(ce)||ce<=0)return 0;const me=Math.round(fe/ce*100);return isFinite(me)?me:0},Me=isFinite(R)&&R>0?R:p.length,ue=isFinite(E)&&E>0?E:D.length;return{totalProcessos:Me,totalTestemunhas:ue,processosAltoRisco:X,testemunhasAmbosPolos:re,pctProcAlto:ee(X,Me),pctAmbos:ee(re,ue)}},[d,h,R,E]),te=p=>u?"loading":b?navigator.onLine?"error":"offline":p.length?"success":"empty",A=te(d),ae=te(h);x.useEffect(()=>{if(!o&&!r){s("/login");return}},[r,o,s]),x.useEffect(()=>{r&&$(r.id)},[r,$]),x.useEffect(()=>{if(W.current)return;const p=t.get("tab"),D=t.get("nome"),X=t.get("cnj"),re=t.get("reclamante");if(p&&(p==="processos"||p==="testemunhas")&&p!==i&&m(p),D&&k({search:decodeURIComponent(D)}),X&&se({search:decodeURIComponent(X)}),re&&se({search:decodeURIComponent(re)}),D||X||re){W.current=!0;const ee=new URLSearchParams(t);ee.delete("nome"),ee.delete("cnj"),ee.delete("reclamante"),a(ee,{replace:!0})}},[]),x.useEffect(()=>{if(!(!W.current||Y.current)&&!(d.length===0&&h.length===0)){if(K.search&&h.length>0){const p=h.find(D=>D.nome_testemunha?.toLowerCase()===K.search?.toLowerCase());p&&!S.getState().selectedTestemunha&&(F(p),n({title:"Testemunha selecionada",description:p.nome_testemunha}))}if(T.search&&d.length>0){const p=d.find(D=>D.cnj===T.search||D.numero_cnj===T.search);p&&!S.getState().selectedProcesso&&(de(p),n({title:"Processo selecionado",description:p.cnj||p.numero_cnj}))}}},[d.length,h.length]);const ie=p=>{const D=p;m(D),a({tab:D},{replace:!0}),de(null),F(null)},Z=et(T,300),G=et(K,300),I=x.useCallback(async()=>{if(!r||Y.current)return;f.current?.abort(),B.current?.abort();const p=new AbortController,D=new AbortController;f.current=p,B.current=D,Y.current=!0,q(!0),pe(!1);try{const X=S.getState().processoFilters,re=S.getState().testemunhaFilters,{processosPage:ee,testemunhasPage:Me,pageSize:ue,processos:fe,testemunhas:ce}=S.getState(),[me,we]=await Promise.all([ti({page:ee||1,limit:ue||50,filters:X}),si({page:Me||1,limit:ue||50,filters:re})]);if(p.signal.aborted||D.signal.aborted)return;const ts=Array.isArray(me.data)?me.data:[],os=Array.isArray(we.data)?we.data:[];if(S.getState().processosPage>1){const ns=[...fe,...ts],Ms=Array.from(new Map(ns.map(xs=>[xs.cnj,xs])).values());j(Ms)}else j(ts);if(S.getState().testemunhasPage>1){const ns=[...ce,...os],Ms=Array.from(new Map(ns.map(xs=>[xs.nome_testemunha,xs])).values());w(Ms)}else w(os);const qe=isFinite(me.total)?me.total:ts.length,Te=isFinite(we.total)?we.total:os.length;v(qe),Q(Te),V(qe>S.getState().processosPage*S.getState().pageSize),N(Te>S.getState().testemunhasPage*S.getState().pageSize);const Ve=me.error||we.error;Ve?(pe(!0,`Erro ao conectar: ${Ve}`),n({title:"Falha ao conectar",description:Ve,variant:"destructive"})):U.current&&(ne(new Date),U.current=!1)}catch(X){if(X?.name==="AbortError")return;const re=X instanceof Error?X.message:"Erro ao carregar dados";pe(!0,re),n({title:"Falha na conexão",description:re,variant:"destructive"})}finally{!p.signal.aborted&&!D.signal.aborted&&(Y.current=!1,q(!1))}},[r]);x.useEffect(()=>(r&&I(),()=>{f.current?.abort(),B.current?.abort()}),[r,I]),x.useEffect(()=>{!U.current&&r&&I()},[Z,G,I]),x.useEffect(()=>{const p=D=>{(D.ctrlKey||D.metaKey)&&D.key==="f"&&(D.preventDefault(),H(!0))};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[]);const ve=()=>{const D=Object.entries(i==="processos"?T:K);if(D.length===0)return null;const X=re=>{if(i==="processos"){const ee={...T};delete ee[re],se(ee)}else{const ee={...K};delete ee[re],k(ee)}};return e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Filtros ativos:"}),D.map(([re,ee])=>e.jsxs(L,{variant:"secondary",className:"gap-1",children:[e.jsxs("span",{className:"text-xs",children:[re,": ",String(ee)]}),e.jsx("button",{onClick:()=>X(re),className:"ml-1 hover:bg-secondary-foreground/10 rounded-full p-0.5","aria-label":`Remover filtro ${re}`,children:e.jsx(Ye,{className:"h-3 w-3"})})]},re))]})};return o?e.jsx("div",{className:"min-h-screen flex items-center justify-center","aria-live":"polite",children:e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Verificando autenticação..."})}):r?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"border-b border-border/50 bg-card",children:e.jsxs("div",{className:"container mx-auto px-6 py-6",children:[e.jsx(Ei,{}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(xo,{className:"h-8 w-8 text-primary","aria-hidden":"true"}),"Mapa de Testemunhas",b&&e.jsx(L,{variant:"destructive",className:"text-xs",children:"Modo Fallback"})]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Análise estratégica de testemunhas e processos judiciais"}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(po,{className:"h-4 w-4","aria-hidden":"true"}),e.jsxs("span",{children:["Última atualização:"," ",C?O(C):"—"]})]}),e.jsx(Ge,{orientation:"vertical",className:"h-4"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pa,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{children:b?"Dados mock":"Dados em tempo real"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ti,{}),e.jsxs(P,{variant:"outline",onClick:()=>je(!0),className:"gap-2","aria-label":"Importar dados via Excel",children:[e.jsx(Le,{className:"h-4 w-4","aria-hidden":"true"}),"Importar Dados"]}),M.isEnabled()&&e.jsxs(Oa,{open:J,onOpenChange:z,children:[e.jsx(Eo,{asChild:!0,children:e.jsxs(P,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(fo,{className:"h-4 w-4"}),"Diagnóstico"]})}),e.jsxs(it,{side:"right",className:"w-[400px]",children:[e.jsxs(lt,{children:[e.jsx(ct,{children:"Diagnóstico do Sistema"}),e.jsx(dt,{children:"Ferramentas de desenvolvimento e diagnóstico"})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Si,{})})]})]}),e.jsx(_i,{}),e.jsx(In,{}),e.jsx(Qn,{data:i==="processos"?d:h,fileName:i==="processos"?"por_processo.csv":"por_testemunha.csv"})]})]})]})}),e.jsxs("div",{className:"container mx-auto px-6 py-6",children:[b&&e.jsx(le,{className:"rounded-2xl border-destructive/50 bg-destructive/5 mb-6",children:e.jsx(he,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(ze,{className:"h-4 w-4","aria-hidden":"true"}),e.jsx("span",{className:"font-medium",children:"Erro:"}),e.jsx("span",{className:"text-sm",children:g})]})})}),e.jsx(Fa,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(ps,{children:[e.jsx(fs,{asChild:!0,children:e.jsxs(le,{className:"rounded-2xl border-border/50 hover:shadow-md transition-shadow cursor-help",children:[e.jsx(_e,{className:"pb-3",children:e.jsxs(ye,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ft,{className:"h-4 w-4 text-primary","aria-hidden":"true"}),"Total de Processos"]})}),e.jsxs(he,{children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:y.totalProcessos.toLocaleString("pt-BR")}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Processos cadastrados"," ",d.length<y.totalProcessos&&`(exibindo ${d.length})`]})]})]})}),e.jsx(is,{children:e.jsx("p",{children:"Total de processos jurídicos cadastrados no sistema"})})]}),e.jsxs(ps,{children:[e.jsx(fs,{asChild:!0,children:e.jsxs(le,{className:"rounded-2xl border-border/50 hover:shadow-md transition-shadow cursor-help",children:[e.jsx(_e,{className:"pb-3",children:e.jsxs(ye,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(js,{className:"h-4 w-4 text-emerald-600","aria-hidden":"true"}),"Total de Testemunhas"]})}),e.jsxs(he,{children:[e.jsx("div",{className:"text-3xl font-bold text-emerald-600",children:y.totalTestemunhas.toLocaleString("pt-BR")}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Testemunhas identificadas"," ",h.length<y.totalTestemunhas&&`(exibindo ${h.length})`]})]})]})}),e.jsx(is,{children:e.jsx("p",{children:"Total de testemunhas únicas identificadas em todos os processos"})})]}),e.jsxs(ps,{children:[e.jsx(fs,{asChild:!0,children:e.jsxs(le,{className:"rounded-2xl border-border/50 hover:shadow-md transition-shadow cursor-help",children:[e.jsx(_e,{className:"pb-3",children:e.jsxs(ye,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ze,{className:"h-4 w-4 text-destructive","aria-hidden":"true"}),"Processos de Alto Risco"]})}),e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-3xl font-bold text-destructive",children:y.processosAltoRisco}),e.jsxs(L,{variant:"destructive",className:"text-xs",children:[y.pctProcAlto,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Requerem atenção especial"})]})]})}),e.jsx(is,{children:e.jsx("p",{children:"Processos classificados como alto risco que necessitam atenção imediata"})})]}),e.jsxs(ps,{children:[e.jsx(fs,{asChild:!0,children:e.jsxs(le,{className:"rounded-2xl border-border/50 hover:shadow-md transition-shadow cursor-help",children:[e.jsx(_e,{className:"pb-3",children:e.jsxs(ye,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ga,{className:"h-4 w-4 text-orange-500","aria-hidden":"true"}),"Atua nos Dois Polos"]})}),e.jsxs(he,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:y.testemunhasAmbosPolos}),e.jsxs(L,{variant:"secondary",className:"text-xs",children:[y.pctAmbos,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Testemunhas em ambos os polos"})]})]})}),e.jsx(is,{children:e.jsx("p",{children:"Testemunhas que participaram tanto como testemunha da reclamante quanto da ré"})})]})]})}),e.jsxs("div",{id:"chat-assistant-section",className:"mb-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Assistente de Análise"}),e.jsxs(De,{className:"inline-flex items-center gap-2 py-2 px-3 w-auto border-violet-200 bg-violet-50",children:[e.jsx(at,{className:"h-4 w-4 text-violet-600"}),e.jsxs(Oe,{className:"text-xs text-violet-900",children:["IA Assistiva LGPD Compliant."," ",e.jsx("a",{href:"/privacidade",className:"underline font-medium hover:text-violet-700",children:"Saiba mais"})]})]})]}),e.jsx(ui,{}),l&&e.jsx("div",{className:"mt-6",children:e.jsx(ji,{blocks:l})}),c==="loading"&&e.jsx("div",{className:"mt-6",children:e.jsx(bi,{})})]}),e.jsx("div",{className:"mt-8",children:e.jsxs(ba,{value:i,onValueChange:ie,children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6",children:[e.jsxs(Na,{className:"grid w-full lg:w-auto grid-cols-2",children:[e.jsxs(Rs,{value:"processos",className:"flex items-center gap-2",children:[e.jsx(ft,{className:"h-4 w-4","aria-hidden":"true"}),"Por Processo"]}),e.jsxs(Rs,{value:"testemunhas",className:"flex items-center gap-2",children:[e.jsx(js,{className:"h-4 w-4","aria-hidden":"true"}),"Por Testemunha"]})]}),e.jsxs("div",{className:"flex gap-2",children:[r&&e.jsx(_n,{userId:r.id}),e.jsx(Nn,{})]})]}),e.jsxs(Ps,{value:"processos",className:"space-y-6",children:[e.jsx(kt,{isLoading:u,hasError:b,errorMessage:g,isConnected:!b||d.length>3,dataCount:d.length,dataType:"processos"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(P,{variant:"outline",onClick:()=>H(!0),className:"w-full sm:w-auto gap-2",children:[e.jsx(gt,{className:"h-4 w-4"}),"Filtros Avançados",e.jsxs("kbd",{className:"ml-auto hidden sm:inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100",children:[e.jsx("span",{className:"text-xs",children:"⌘"}),"F"]})]}),ve()]}),A!=="success"?e.jsx(vs,{status:A,onRetry:I}):e.jsxs(e.Fragment,{children:[e.jsx(un,{data:d}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(P,{variant:"outline",disabled:!S.getState().hasMoreProcessos||u,onClick:()=>{S.getState().loadMoreProcessos(),I()},children:u?"Carregando...":S.getState().hasMoreProcessos?"Carregar mais":"Fim"})})]})]}),e.jsxs(Ps,{value:"testemunhas",className:"space-y-6",children:[e.jsx(kt,{isLoading:u,hasError:b,errorMessage:g,isConnected:!b||h.length>3,dataCount:h.length,dataType:"testemunhas"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(P,{variant:"outline",onClick:()=>H(!0),className:"w-full sm:w-auto gap-2",children:[e.jsx(gt,{className:"h-4 w-4"}),"Filtros Avançados",e.jsxs("kbd",{className:"ml-auto hidden sm:inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100",children:[e.jsx("span",{className:"text-xs",children:"⌘"}),"F"]})]}),ve()]}),ae!=="success"?e.jsx(vs,{status:ae,onRetry:I}):e.jsxs(e.Fragment,{children:[e.jsx(xn,{data:h,status:ae,onRetry:I}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(P,{variant:"outline",disabled:!S.getState().hasMoreTestemunhas||u,onClick:()=>{S.getState().loadMoreTestemunhas(),I()},children:u?"Carregando...":S.getState().hasMoreTestemunhas?"Carregar mais":"Fim"})})]})]})]})}),e.jsx(Cn,{}),e.jsx(On,{}),e.jsx(bn,{open:oe,onOpenChange:H})]})]}):null},Pi=()=>e.jsx(Ni,{children:e.jsx(Ri,{})}),Li=Object.freeze(Object.defineProperty({__proto__:null,default:Pi},Symbol.toStringTag,{value:"Module"}));export{Ii as $,Uo as A,Va as B,Fi as C,Ra as D,bs as E,Ns as F,hs as G,ss as H,Qs as I,$o as J,Ha as K,za as L,Ba as M,Zs as N,Ua as O,Xs as P,Ja as Q,gi as R,Ze as S,Fa as T,ks as U,vs as V,$i as W,$n as X,To as Y,Qa as Z,Da as _,Be as a,Je as a0,as as a1,Oo as a2,Li as a3,Xe as b,Ue as c,ge as d,nt as e,Mi as f,Xa as g,Ya as h,sr as i,tr as j,er as k,rr as l,ar as m,ot as n,ka as o,Aa as p,Oa as q,it as r,Ge as s,ps as t,fs as u,is as v,Io as w,$a as x,La as y,qa as z};
