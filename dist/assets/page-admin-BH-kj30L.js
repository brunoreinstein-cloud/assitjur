const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/page-About-D-sXwJf6.js","assets/vendor-Bb7CRbSf.js","assets/report-Ds-LXFSJ.js","assets/page-Login-oCSbJqZb.js","assets/page-MapaPage-DleuOcbF.js","assets/page-DemoMapaTestemunhas-JiJ-wnCn.js","assets/page-Profile-CkbL2Ipx.js","assets/page-PortalTitular-BrbzIQdb.js","assets/page-ReportDemo-B5UZDvQM.js"])))=>i.map(i=>d[i]);
import{r as g,cn as at,j as e,co as ya,cp as tt,cq as rt,cr as nt,cs as it,ct as Es,cu as ks,cv as rs,cw as la,cx as ot,cy as da,cz as wa,cA as Us,ab as Oe,t as je,cB as ns,af as me,v as Q,D as be,L as Ae,ae as re,bi as Fe,F as De,a0 as te,U as ls,cg as ct,bK as as,e as Ge,cC as Ds,h as _a,bu as ye,d as lt,cD as Os,K as Ze,x as ys,$ as dt,bq as mt,bs as Ca,br as ws,cE as Ke,ac as Sa,cF as xt,bN as Xs,bm as Hs,o as _s,aa as Pa,cG as ut,O as Te,c as Qs,V as ht,c6 as jt,w as is,i as fe,bM as Cs,cl as Ys,ad as pt,J as Aa,q as Ea,cH as gt,cI as ka,cJ as ft,cK as vt,cL as Nt,cM as bt,cN as Da,k as yt,A as wt,bT as Ts,bw as Me,bU as Pe,Z as Ss,bX as ma,cO as _t,cP as Ct,bh as Ta,p as St,cQ as Pt,cR as At,u as Et,bO as kt,M as xa,cS as Dt,cT as Tt,aA as zt,ag as Rt,bJ as It,E as Lt,ap as Bs,cU as Ot,cV as Mt,cW as Vt,a7 as qt}from"./vendor-Bb7CRbSf.js";import{k as de,C as p,b as w,c as _,n as L,d as b,D as He,B as y,o as se,q as ae,a as P,s as R,_ as os,t as F,u as zs,G as es,H as Ms,w as ge,K as Ft,y as $t}from"./page-About-D-sXwJf6.js";import{u as xe,i as Js,w as ua,C as We,T as ze,a as Re,b as J,c as X,l as ts,g as Ps,I as H,L as M,h as Vs,j as Ut}from"./page-Login-oCSbJqZb.js";import{D as $e,n as Ue,o as Ee,p as ke,Y as Zs,U as ds,Z as za,_ as ms,S as ne,a as ie,b as oe,c as ce,d as V,A as ea,g as sa,h as aa,i as ta,j as ra,k as na,l as ia,m as As,e as xs,$ as oa,f as Ra,a0 as Ns,a1 as Gs,s as ha}from"./page-MapaPage-DleuOcbF.js";import{S as ja}from"./page-Profile-CkbL2Ipx.js";import{T as we,c as _e,d as K,e as z,f as ve,g as E,P as Bt,a as Jt,b as Gt}from"./page-DemoMapaTestemunhas-JiJ-wnCn.js";import{h as Kt,A as Wt,f as Xe,p as cs}from"./page-ReportDemo-B5UZDvQM.js";import{T as Ia}from"./page-PortalTitular-BrbzIQdb.js";const Xt={light:"",dark:".dark"},La=g.createContext(null);function Oa(){const a=g.useContext(La);if(!a)throw new Error("useChart must be used within a <ChartContainer />");return a}const us=g.forwardRef(({id:a,className:n,children:s,config:r,...t},l)=>{const c=g.useId(),i=`chart-${a||c.replace(/:/g,"")}`;return e.jsx(La.Provider,{value:{config:r},children:e.jsxs("div",{"data-chart":i,ref:l,className:de("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",n),...t,children:[e.jsx(Ht,{id:i,config:r}),e.jsx(ya,{children:s})]})})});us.displayName="Chart";const Ht=({id:a,config:n})=>{const s=Object.entries(n).filter(([r,t])=>t.theme||t.color);return s.length?e.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(Xt).map(([r,t])=>`
${t} [data-chart=${a}] {
${s.map(([l,c])=>{const i=c.theme?.[r]||c.color;return i?`  --color-${l}: ${i};`:null}).join(`
`)}
}
`).join(`
`)}}):null},hs=at,Rs=g.forwardRef(({active:a,payload:n,className:s,indicator:r="dot",hideLabel:t=!1,hideIndicator:l=!1,label:c,labelFormatter:i,labelClassName:o,formatter:j,color:m,nameKey:x,labelKey:f},u)=>{const{config:v}=Oa(),h=g.useMemo(()=>{if(t||!n?.length)return null;const[d]=n,C=`${f||d.dataKey||d.name||"value"}`,T=Ks(v,d,C),q=!f&&typeof c=="string"?v[c]?.label||c:T?.label;return i?e.jsx("div",{className:de("font-medium",o),children:i(q,n)}):q?e.jsx("div",{className:de("font-medium",o),children:q}):null},[c,i,n,t,o,v,f]);if(!a||!n?.length)return null;const N=n.length===1&&r!=="dot";return e.jsxs("div",{ref:u,className:de("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",s),children:[N?null:h,e.jsx("div",{className:"grid gap-1.5",children:n.map((d,C)=>{const T=`${x||d.name||d.dataKey||"value"}`,q=Ks(v,d,T),$=m||d.payload.fill||d.color;return e.jsx("div",{className:de("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",r==="dot"&&"items-center"),children:j&&d?.value!==void 0&&d.name?j(d.value,d.name,d,C,d.payload):e.jsxs(e.Fragment,{children:[q?.icon?e.jsx(q.icon,{}):!l&&e.jsx("div",{className:de("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":r==="dot","w-1":r==="line","w-0 border-[1.5px] border-dashed bg-transparent":r==="dashed","my-0.5":N&&r==="dashed"}),style:{"--color-bg":$,"--color-border":$}}),e.jsxs("div",{className:de("flex flex-1 justify-between leading-none",N?"items-end":"items-center"),children:[e.jsxs("div",{className:"grid gap-1.5",children:[N?h:null,e.jsx("span",{className:"text-muted-foreground",children:q?.label||d.name})]}),d.value&&e.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:d.value.toLocaleString()})]})]})},d.dataKey)})})]})});Rs.displayName="ChartTooltip";const Qt=g.forwardRef(({className:a,hideIcon:n=!1,payload:s,verticalAlign:r="bottom",nameKey:t},l)=>{const{config:c}=Oa();return s?.length?e.jsx("div",{ref:l,className:de("flex items-center justify-center gap-4",r==="top"?"pb-3":"pt-3",a),children:s.map(i=>{const o=`${t||i.dataKey||"value"}`,j=Ks(c,i,o);return e.jsxs("div",{className:de("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[j?.icon&&!n?e.jsx(j.icon,{}):e.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:i.color}}),j?.label]},i.value)})}):null});Qt.displayName="ChartLegend";function Ks(a,n,s){if(typeof n!="object"||n===null)return;const r="payload"in n&&typeof n.payload=="object"&&n.payload!==null?n.payload:void 0;let t=s;return s in n&&typeof n[s]=="string"?t=n[s]:r&&s in r&&typeof r[s]=="string"&&(t=r[s]),t in a?a[t]:a[s]}const qs={low:"#10b981",medium:"#f59e0b",high:"#ef4444"},ca={requests:{label:"Consultas",color:"hsl(var(--chart-1))"},cost_cents:{label:"Custo (centavos)",color:"hsl(var(--chart-2))"},tokens_in:{label:"Tokens Entrada",color:"hsl(var(--chart-3))"},tokens_out:{label:"Tokens Saída",color:"hsl(var(--chart-4))"},avgRisk:{label:"Risco Médio",color:"hsl(var(--chart-5))"}},Ma=({data:a})=>a?.length?e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Uso da API OpenAI"}),e.jsx(L,{children:"Consultas e custos por dia"})]}),e.jsx(b,{children:e.jsx(us,{config:ca,className:"h-[300px]",children:e.jsxs(it,{data:a,children:[e.jsx(Es,{strokeDasharray:"3 3"}),e.jsx(ks,{dataKey:"date",tickFormatter:n=>new Date(n).toLocaleDateString("pt-BR",{month:"short",day:"numeric"})}),e.jsx(rs,{yAxisId:"left"}),e.jsx(rs,{yAxisId:"right",orientation:"right"}),e.jsx(hs,{content:e.jsx(Rs,{}),labelFormatter:n=>new Date(n).toLocaleDateString("pt-BR")}),e.jsx(la,{yAxisId:"left",type:"monotone",dataKey:"requests",stackId:"1",stroke:"var(--color-requests)",fill:"var(--color-requests)",fillOpacity:.6}),e.jsx(la,{yAxisId:"right",type:"monotone",dataKey:"cost_cents",stackId:"2",stroke:"var(--color-cost_cents)",fill:"var(--color-cost_cents)",fillOpacity:.3})]})})})]}):e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Uso da API OpenAI"}),e.jsx(L,{children:"Últimos 30 dias"})]}),e.jsx(b,{children:e.jsx("div",{className:"flex items-center justify-center h-[300px] text-muted-foreground",children:"Nenhum dado disponível"})})]}),Va=({data:a})=>{const n=[{name:"Baixo Risco",value:a.low,color:qs.low},{name:"Médio Risco",value:a.medium,color:qs.medium},{name:"Alto Risco",value:a.high,color:qs.high}].filter(s=>s.value>0);return n.length===0?e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Distribuição de Riscos"}),e.jsx(L,{children:"Classificação dos processos por nível de risco"})]}),e.jsx(b,{children:e.jsx("div",{className:"flex items-center justify-center h-[300px] text-muted-foreground",children:"Nenhum processo com score de risco"})})]}):e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Distribuição de Riscos"}),e.jsx(L,{children:"Classificação dos processos por nível de risco"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"h-[300px]",children:e.jsx(ya,{width:"100%",height:"100%",children:e.jsxs(tt,{children:[e.jsx(rt,{data:n,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,dataKey:"value",children:n.map((s,r)=>e.jsx(nt,{fill:s.color},`cell-${r}`))}),e.jsx(hs,{content:({active:s,payload:r})=>{if(s&&r&&r.length){const t=r[0];return e.jsx("div",{className:"rounded-lg border bg-background p-2 shadow-sm",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full",style:{backgroundColor:t.payload.color}}),e.jsx("span",{className:"font-medium",children:t.payload.name})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.value," processos (",(Number(t.value)/(n.reduce((l,c)=>l+c.value,0)||1)*100).toFixed(1),"%)"]})]})})}return null}})]})})}),e.jsx("div",{className:"flex justify-center gap-6 mt-4",children:n.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full",style:{backgroundColor:s.color}}),e.jsxs("span",{className:"text-sm",children:[s.name,": ",s.value]})]},s.name))})]})]})},qa=({data:a})=>a?.length?e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Risco por Comarca"}),e.jsx(L,{children:"Top 10 comarcas com maior risco médio"})]}),e.jsx(b,{children:e.jsx(us,{config:ca,className:"h-[400px]",children:e.jsxs(wa,{data:a,layout:"horizontal",margin:{left:120},children:[e.jsx(Es,{strokeDasharray:"3 3"}),e.jsx(ks,{type:"number",domain:[0,10]}),e.jsx(rs,{type:"category",dataKey:"comarca",width:100,tick:{fontSize:12}}),e.jsx(hs,{content:({active:n,payload:s,label:r})=>{if(n&&s&&s.length){const t=s[0].payload;return e.jsx("div",{className:"rounded-lg border bg-background p-3 shadow-sm",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"font-medium",children:r}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:["Risco Médio:"," ",e.jsx("span",{className:"font-mono",children:t.avgRisk.toFixed(1)})]}),e.jsxs("div",{children:["Total Processos:"," ",e.jsx("span",{className:"font-mono",children:t.count})]}),e.jsxs("div",{children:["Alto Risco:"," ",e.jsx("span",{className:"font-mono",children:t.highRiskCount})]})]})]})})}return null}}),e.jsx(Us,{dataKey:"avgRisk",fill:"var(--color-avgRisk)",radius:[0,4,4,0]})]})})})]}):e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Risco por Comarca"}),e.jsx(L,{children:"Top 10 comarcas com maior risco médio"})]}),e.jsx(b,{children:e.jsx("div",{className:"flex items-center justify-center h-[300px] text-muted-foreground",children:"Nenhum dado de comarca disponível"})})]}),Fa=({data:a})=>a?.length?e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Uso de Tokens"}),e.jsx(L,{children:"Tokens de entrada e saída por dia"})]}),e.jsx(b,{children:e.jsx(us,{config:ca,className:"h-[300px]",children:e.jsxs(ot,{data:a,children:[e.jsx(Es,{strokeDasharray:"3 3"}),e.jsx(ks,{dataKey:"date",tickFormatter:n=>new Date(n).toLocaleDateString("pt-BR",{month:"short",day:"numeric"})}),e.jsx(rs,{}),e.jsx(hs,{content:e.jsx(Rs,{}),labelFormatter:n=>new Date(n).toLocaleDateString("pt-BR")}),e.jsx(da,{type:"monotone",dataKey:"tokens_in",stroke:"var(--color-tokens_in)",strokeWidth:2,dot:{r:4}}),e.jsx(da,{type:"monotone",dataKey:"tokens_out",stroke:"var(--color-tokens_out)",strokeWidth:2,dot:{r:4}})]})})})]}):e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Uso de Tokens"}),e.jsx(L,{children:"Tokens de entrada e saída por dia"})]}),e.jsx(b,{children:e.jsx("div",{className:"flex items-center justify-center h-[300px] text-muted-foreground",children:"Nenhum dado disponível"})})]});function $a({orgId:a,onSuccess:n}){const[s,r]=g.useState(!1),[t,l]=g.useState(!1),[c,i]=g.useState(!0),[o,j]=g.useState(null),{toast:m}=He(),x=async u=>{if(!a){m({title:"Erro",description:"ID da organização não encontrado",variant:"destructive"});return}l(!0);try{const{data:v,error:h}=await R.functions.invoke("review-update-dados",{body:{orgId:a,dryRun:u}});if(h)throw new Error(`Erro na função: ${h.message}`);const N=v;j(N),i(u),u||(m({title:"Revisão concluída",description:`${N.flags_updated} registros atualizados, ${N.stubs_created} stubs criados`}),n?.())}catch(v){console.error("Erro na revisão:",v),m({title:"Erro na revisão",description:v instanceof Error?v.message:"Erro desconhecido",variant:"destructive"})}finally{l(!1)}},f=()=>{if(!o)return;const u={timestamp:new Date().toISOString(),dry_run:c,...o},v=new Blob([JSON.stringify(u,null,2)],{type:"application/json"}),h=URL.createObjectURL(v),N=document.createElement("a");N.href=h,N.download=`assistjur-review-${c?"preview":"applied"}-${new Date().toISOString().split("T")[0]}.json`,N.click(),URL.revokeObjectURL(h)};return e.jsxs(e.Fragment,{children:[e.jsx(y,{onClick:()=>r(!0),disabled:t,className:"gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"h-4 w-4"}),"Revisar & Atualizar"]})}),e.jsx($e,{open:s,onOpenChange:r,children:e.jsxs(Ue,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ee,{children:e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-5 w-5"}),"Revisão & Atualização de Dados - AssistJur.IA"]})}),e.jsx("div",{className:"space-y-6",children:o?e.jsxs(e.Fragment,{children:[o.errors.length>0?e.jsxs(se,{variant:"destructive",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsxs(ae,{children:[o.errors.length," erro(s) encontrado(s) durante a execução."]})]}):e.jsxs(se,{className:"border-success",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsxs(ae,{children:["Revisão ",c?"simulada":"aplicada"," com sucesso! Tempo de execução: ",o.execution_time_ms,"ms"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(p,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(_,{className:"text-sm",children:"Stubs Criados"})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold text-primary",children:o.stubs_created})})]}),e.jsxs(p,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(_,{className:"text-sm",children:"Flags Atualizadas"})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold text-success",children:o.flags_updated})})]}),e.jsxs(p,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(_,{className:"text-sm",children:"Triangulações"})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold text-warning",children:o.statistics.triangulacoes_detected})})]}),e.jsxs(p,{children:[e.jsx(w,{className:"pb-2",children:e.jsx(_,{className:"text-sm",children:"Prova Emprestada"})}),e.jsx(b,{children:e.jsx("div",{className:"text-2xl font-bold text-destructive",children:o.statistics.prova_emprestada_detected})})]})]}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{children:"Detecções Analíticas"})}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Trocas Diretas:"}),e.jsx(P,{variant:"outline",children:o.statistics.trocas_detected})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Duplo Papel:"}),e.jsx(P,{variant:"outline",children:o.statistics.duplo_papel_detected})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Total Processos:"}),e.jsx(P,{variant:"secondary",children:o.statistics.total_processos})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Total Testemunhas:"}),e.jsx(P,{variant:"secondary",children:o.statistics.total_testemunhas})]})]})})]}),o.warnings.length>0&&e.jsxs(p,{children:[e.jsx(w,{children:e.jsxs(_,{className:"text-warning",children:["Avisos (",o.warnings.length,")"]})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:o.warnings.map((u,v)=>e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded border",children:[e.jsx(me,{className:"h-4 w-4 text-warning mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{variant:"outline",className:"text-xs",children:u.type}),u.cnj&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["CNJ: ",u.cnj]})]}),e.jsx("p",{className:"text-sm mt-1",children:u.message})]})]},v))})})]}),o.errors.length>0&&e.jsxs(p,{children:[e.jsx(w,{children:e.jsxs(_,{className:"text-destructive",children:["Erros (",o.errors.length,")"]})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:o.errors.map((u,v)=>e.jsxs("div",{className:"flex items-start gap-2 p-2 rounded border border-destructive/20",children:[e.jsx(me,{className:"h-4 w-4 text-destructive mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(P,{variant:"destructive",className:"text-xs mb-1",children:u.type}),e.jsx("p",{className:"text-sm",children:u.message})]})]},v))})})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Execute uma revisão para recomputar flags analíticas, reconciliar CNJs e validar dados."}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(y,{onClick:()=>x(!0),disabled:t,variant:"outline",className:"gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Dry Run (Preview)"]}),e.jsxs(y,{onClick:()=>x(!1),disabled:t,className:"gap-2",children:[e.jsx(ns,{className:"h-4 w-4"}),"Aplicar Mudanças"]})]})]})}),e.jsxs(Zs,{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[o&&e.jsxs(y,{variant:"outline",onClick:f,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Baixar Relatório"]}),e.jsx(y,{variant:"outline",onClick:()=>r(!1),children:"Fechar"})]}),o&&c&&e.jsxs(y,{onClick:()=>x(!1),disabled:t||o.errors.length>0,className:"ml-auto",children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),"Aplicar Mudanças"]})]})]})})]})}function Yt({isRunning:a}){const n=a?65:0,s=[{id:"validate",label:"Validando operações",completed:!0},{id:"backup",label:"Criando backup",completed:!0},{id:"cleanup",label:"Executando limpeza",completed:!1,inProgress:a},{id:"verify",label:"Verificando resultados",completed:!1}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ds,{value:n,className:"w-full"}),e.jsx("div",{className:"space-y-2",children:s.map(r=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.completed?e.jsx(Q,{className:"h-4 w-4 text-success"}):r.inProgress?e.jsx(Ae,{className:"h-4 w-4 animate-spin text-primary"}):e.jsx("div",{className:"h-4 w-4 rounded-full border border-muted-foreground"}),e.jsx("span",{className:r.completed?"text-success":r.inProgress?"text-primary font-medium":"text-muted-foreground",children:r.label})]},r.id))}),a&&e.jsxs("div",{className:"bg-primary/10 border border-primary/20 rounded-lg p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Processamento em andamento"})]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"A limpeza pode levar alguns minutos dependendo do volume de dados."})]})]})}const Zt=[{id:"invalid_cnjs",label:"CNJs Inválidos",description:"Remove processos com CNJs que não têm 20 dígitos numéricos",severity:"medium",enabled:!0},{id:"empty_fields",label:"Campos Obrigatórios Vazios",description:"Remove processos sem nome do reclamante ou réu",severity:"medium",enabled:!0},{id:"duplicates",label:"Duplicatas",description:"Remove processos duplicados (mantém o mais recente)",severity:"high",enabled:!1},{id:"normalize_cnjs",label:"Normalizar CNJs",description:"Remove pontuação e padroniza formato dos CNJs válidos",severity:"low",enabled:!0},{id:"hard_delete_old",label:"Exclusão Permanente",description:"Remove permanentemente processos excluídos há mais de 30 dias",severity:"high",enabled:!1}],er=a=>{switch(a){case"low":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"high":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"}};function sr({open:a,onOpenChange:n}){const[s,r]=g.useState(null),[t,l]=g.useState(Zt),[c,i]=g.useState(!1),[o,j]=g.useState(!1),[m,x]=g.useState("preview"),{profile:f}=xe(),{toast:u}=He();g.useEffect(()=>{a&&f?.organization_id&&v()},[a,f]);const v=async()=>{Js(f?.organization_id)&&(i(!0),await ua(async()=>{const{data:S}=await R.auth.getSession(),k=S?.session?.access_token;if(!k)throw new Error("Token de autenticação não encontrado");const{data:A,error:O}=await R.functions.invoke("database-cleanup",{body:{orgId:f.organization_id,preview:!0},headers:{Authorization:`Bearer ${k}`}});if(O)throw O;if(A?.error)throw new Error(A.error);r(A?.preview)},"CleanupModal.loadPreview").finally(()=>{i(!1)}))},h=(S,k)=>{l(A=>A.map(O=>O.id===S?{...O,enabled:k}:O))},N=S=>{if(!s)return 0;switch(S){case"invalid_cnjs":return s.invalid_cnjs;case"empty_fields":return s.empty_reclamante+s.empty_reu;case"duplicates":return s.duplicates;case"normalize_cnjs":return s.invalid_cnjs;case"hard_delete_old":return s.soft_deleted;default:return 0}},d=async()=>{if(!Js(f?.organization_id))return;const S=t.filter(k=>k.enabled).map(k=>k.id);if(S.length===0){u({title:"Nenhuma operação selecionada",description:"Selecione pelo menos uma operação para continuar",variant:"destructive"});return}x("running"),j(!0);try{await ua(async()=>{const{data:k}=await R.auth.getSession(),A=k?.session?.access_token;if(!A)throw new Error("Token de autenticação não encontrado");const{data:O,error:U}=await R.functions.invoke("database-cleanup",{body:{orgId:f.organization_id,operations:S},headers:{Authorization:`Bearer ${A}`}});if(U)throw U;if(O?.error)throw new Error(O.error);if(O?.success)u({title:"Limpeza concluída",description:`${O.totalProcessed} registros processados`,variant:"default"}),n(!1),window.location.reload();else{const Z=O?.results?.filter(I=>!I.success)||[];if(Z.length>0)throw new Error(`Algumas operações falharam: ${Z.map(I=>I.message).join(", ")}`)}},"CleanupModal.executeCleanup")}catch{x("confirm")}finally{j(!1)}},C=()=>{o||(n(!1),x("preview"),r(null))},T=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ee,{children:e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5"}),"Limpeza da Base de Dados"]})}),e.jsx("div",{className:"space-y-6",children:c?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(Ae,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Carregando preview..."})]}):s?e.jsxs(e.Fragment,{children:[e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5 text-warning"}),"Resumo da Base"]}),e.jsx(L,{children:"Problemas detectados na base de dados da sua organização"})]}),e.jsx(b,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-destructive",children:s.total_issues}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"problemas detectados"})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Operações Disponíveis"}),t.map(S=>{const k=N(S.id);return e.jsx(p,{className:"border-2",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(We,{id:S.id,checked:S.enabled,onCheckedChange:A=>h(S.id,A)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("label",{htmlFor:S.id,className:"font-medium cursor-pointer",children:S.label}),e.jsx(P,{className:er(S.severity),children:S.severity}),k>0&&e.jsxs(P,{variant:"outline",children:[k," registros"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:S.description})]})]})})},S.id)})]})]}):null}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(y,{variant:"outline",onClick:C,children:"Cancelar"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"outline",onClick:v,children:"Atualizar"}),e.jsx(y,{onClick:()=>x("confirm"),disabled:!t.some(S=>S.enabled)||c,children:"Continuar"})]})]})]}),q=()=>{const S=t.filter(A=>A.enabled),k=S.reduce((A,O)=>A+N(O.id),0);return e.jsxs(e.Fragment,{children:[e.jsx(Ee,{children:e.jsxs(ke,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(re,{className:"h-5 w-5"}),"Confirmação de Limpeza"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:[e.jsx("p",{className:"font-semibold text-destructive mb-2",children:"⚠️ Atenção!"}),e.jsxs("p",{className:"text-sm",children:["Esta operação irá processar"," ",e.jsxs("strong",{children:[k," registros"]})," e pode ser irreversível. Certifique-se de que tem um backup da base de dados."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"Operações selecionadas:"}),S.map(A=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Q,{className:"h-4 w-4 text-success"}),A.label," - ",N(A.id)," registros"]},A.id))]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(y,{variant:"outline",onClick:()=>x("preview"),children:"Voltar"}),e.jsx(y,{variant:"destructive",onClick:d,children:"Confirmar Limpeza"})]})]})},$=()=>e.jsxs(e.Fragment,{children:[e.jsx(Ee,{children:e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5 animate-spin"}),"Executando Limpeza"]})}),e.jsx(Yt,{isRunning:o}),e.jsx("div",{className:"text-center text-sm text-muted-foreground",children:"Por favor, aguarde. A limpeza está em andamento..."})]});return e.jsx($e,{open:a,onOpenChange:C,children:e.jsxs(Ue,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[m==="preview"&&T(),m==="confirm"&&q(),m==="running"&&$()]})})}function ar({className:a}){const[n,s]=g.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(y,{onClick:()=>s(!0),variant:"outline",size:"sm",className:a,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Limpar Base"]}),e.jsx(sr,{open:n,onOpenChange:s})]})}const tr=()=>{const[a,n]=g.useState(!1),[s,r]=g.useState(null),[t,l]=g.useState(null),c=async()=>{n(!0),l(null),r(null);try{const{data:i,error:o}=await R.functions.invoke("process-witness-data");if(o)throw o;r(i),te.success("Dados de testemunhas processados com sucesso!")}catch(i){const o=i.message||"Erro ao processar dados de testemunhas";l(o),te.error(o)}finally{n(!1)}};return e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"Processamento de Dados de Testemunhas"]}),e.jsx(L,{children:"Processa os dados importados para extrair e popular informações de testemunhas nos processos. Esta ação deve ser executada após uma importação para garantir que os dados apareçam no mapa de testemunhas."})]}),e.jsxs(b,{className:"space-y-4",children:[t&&e.jsxs(se,{variant:"destructive",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(ae,{children:t})]}),s&&e.jsxs(se,{children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx(ae,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{children:e.jsx("strong",{children:s.message})}),e.jsxs("p",{children:["Processos processados: ",s.processedCount," de"," ",s.totalProcessos]})]})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(y,{onClick:c,disabled:a,className:"w-full",children:a?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"h-4 w-4 animate-spin mr-2"}),"Processando dados..."]}):e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Processar Dados de Testemunhas"]})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Este processo pode levar alguns minutos dependendo da quantidade de dados."})]})]})]})},rr=()=>{xe();const[a,n]=g.useState(!0),[s,r]=g.useState(null),[t,l]=g.useState(null),[c,i]=g.useState(null),[o,j]=g.useState("overview"),m=async f=>{try{const{data:u,error:v}=await R.functions.invoke("admin-analytics",{body:{type:f}});if(v)throw v;return u}catch(u){return console.error("Error fetching analytics:",u),te.error("Erro ao carregar dados analíticos"),null}};g.useEffect(()=>{(async()=>{n(!0);const u=await m("overview");u&&r(u),n(!1)})()},[]);const x=async f=>{if(f==="usage"&&!t){const u=await m("usage");u&&l(u)}else if(f==="risk_patterns"&&!c){const u=await m("risk_patterns");u&&i(u)}};return a?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard Analítico"}),e.jsx("p",{className:"text-muted-foreground",children:"Insights avançados e métricas do sistema"})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"Operações de Dados"]}),e.jsx(L,{children:"Ferramentas administrativas para manutenção e otimização da base"})]}),e.jsx(b,{children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx($a,{}),e.jsx(ar,{})]})})]}),e.jsx(tr,{}),e.jsxs(ze,{value:o,onValueChange:f=>{j(f),x(f)},className:"w-full",children:[e.jsxs(Re,{className:"grid w-full grid-cols-4",children:[e.jsx(J,{value:"overview",children:"Visão Geral"}),e.jsx(J,{value:"usage",children:"Uso & Custos"}),e.jsx(J,{value:"risk_patterns",children:"Padrões de Risco"}),e.jsx(J,{value:"performance",children:"Performance"})]}),e.jsxs(X,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Total Processos"}),e.jsx(De,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s?.counts?.processos?.toLocaleString()||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Registros na base ativa"})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Pessoas"}),e.jsx(ls,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s?.counts?.pessoas?.toLocaleString()||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Cadastros únicos"})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Conversas"}),e.jsx(ct,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s?.counts?.conversations||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Interações com IA"})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Versão Ativa"}),e.jsx(as,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["v",s?.counts?.activeVersion||"N/A"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Base de dados atual"})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx(Va,{data:s?.riskDistribution||{low:0,medium:0,high:0}}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Atividade Recente"}),e.jsx(L,{children:"Últimas interações com o sistema"})]}),e.jsx(b,{children:e.jsx("div",{className:"space-y-3",children:s?.recentActivity?.slice(0,5).map((f,u)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium",children:[f.role==="user"?"Pergunta":"Resposta"," ","- Conversa"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(f.created_at).toLocaleString("pt-BR")})]})]},u))||e.jsx("div",{className:"text-center text-muted-foreground py-4",children:"Nenhuma atividade recente"})})})]})]})]}),e.jsx(X,{value:"usage",className:"space-y-6",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Total Consultas"}),e.jsx(Ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.totalStats.totalRequests.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Últimos 30 dias"})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Custo Total"}),e.jsx(Ds,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",(t.totalStats.totalCost/100).toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"OpenAI API"})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Tokens Processados"}),e.jsx(_a,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(t.totalStats.totalTokens/1e3).toFixed(1),"K"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Entrada + Saída"})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Tempo Médio"}),e.jsx(as,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[(t.totalStats.avgResponseTime/1e3).toFixed(1),"s"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Resposta da API"})]})]})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsx(Ma,{data:t.dailyUsage}),e.jsx(Fa,{data:t.dailyUsage})]})]}):e.jsx("div",{className:"flex items-center justify-center min-h-[300px]",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-primary"})})}),e.jsx(X,{value:"risk_patterns",className:"space-y-6",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{className:"text-sm font-medium",children:"Risco Médio Geral"})}),e.jsxs(b,{children:[e.jsx("div",{className:"text-3xl font-bold",children:c.avgRisk?.toFixed(1)||"N/A"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["De ",c.totalProcessos," processos"]})]})]}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{className:"text-sm font-medium",children:"Alto Risco"})}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-3xl font-bold text-red-600",children:[c.highRiskPercentage?.toFixed(1)||0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Processos com score ≥ 8"})]})]}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{className:"text-sm font-medium",children:"Total Analisado"})}),e.jsxs(b,{children:[e.jsx("div",{className:"text-3xl font-bold",children:c.totalProcessos?.toLocaleString()||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Processos com score"})]})]})]}),e.jsx(qa,{data:c.comarcaStats})]}):e.jsx("div",{className:"flex items-center justify-center min-h-[300px]",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-primary"})})}),e.jsx(X,{value:"performance",className:"space-y-6",children:e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Métricas de Performance"}),e.jsx(L,{children:"Em desenvolvimento - métricas de sistema e performance"})]}),e.jsx(b,{children:e.jsx("div",{className:"flex items-center justify-center h-[200px] text-muted-foreground",children:"🚧 Funcionalidade em desenvolvimento"})})]})})]})]})},pn=Object.freeze(Object.defineProperty({__proto__:null,default:rr},Symbol.toStringTag,{value:"Module"})),ss=async()=>{if(typeof window>"u"||!Kt("analytics"))return!1;const{data:{user:a}}=await R.auth.getUser();return!!a},nr=()=>{const[a,n]=g.useState(!1),[s,r]=g.useState(null),[t,l]=g.useState("30d"),[c,i]=g.useState(!1),[o,j]=g.useState(null),[m,x]=g.useState(null),f=async N=>{if(await ss()){n(!0);try{const{data:d,error:C}=await R.functions.invoke("admin-analytics",{body:{type:"detailed_report",period:N}});if(C)throw C;r(d)}catch(d){console.error("Error fetching detailed analytics:",d),te.error("Erro ao carregar relatório detalhado")}finally{n(!1)}}},u=async()=>{if(await ss())try{const{data:N,error:d}=await R.functions.invoke("admin-analytics",{body:{type:"usage",period:t}});if(d)throw d;j(N)}catch(N){console.error("Error fetching usage data:",N)}},v=async()=>{if(await ss())try{const{data:N,error:d}=await R.functions.invoke("admin-analytics",{body:{type:"ai_patterns"}});if(d)throw d;x(N)}catch(N){console.error("Error fetching patterns data:",N)}},h=async N=>{if(await ss()){i(!0);try{const{data:d,error:C}=await R.functions.invoke("admin-analytics",{body:{type:"export",format:N,period:t}});if(C)throw C;const T=new Blob([JSON.stringify(d.data,null,2)],{type:"application/json"}),q=window.URL.createObjectURL(T),$=document.createElement("a");$.href=q,$.download=`analytics-report-${t}.json`,document.body.appendChild($),$.click(),document.body.removeChild($),window.URL.revokeObjectURL(q),te.success("Relatório exportado com sucesso")}catch(d){console.error("Error exporting report:",d),te.error("Erro ao exportar relatório")}finally{i(!1)}}};return g.useEffect(()=>{f(t),u(),v()},[t]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Analytics Avançado"}),e.jsx("p",{className:"text-muted-foreground",children:"Relatórios detalhados e análises de performance"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{variant:"outline",onClick:()=>f(t),disabled:a,children:[e.jsx(Oe,{className:`h-4 w-4 mr-2 ${a?"animate-spin":""}`}),"Atualizar"]}),e.jsxs(y,{variant:"outline",onClick:()=>h("excel"),disabled:c,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Excel"]}),e.jsxs(y,{variant:"outline",onClick:()=>h("pdf"),disabled:c,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"PDF"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Período:"}),["7d","30d","90d","1y"].map(N=>e.jsxs(y,{variant:t===N?"default":"outline",size:"sm",onClick:()=>l(N),children:[N==="7d"&&"7 dias",N==="30d"&&"30 dias",N==="90d"&&"90 dias",N==="1y"&&"1 ano"]},N))]}),e.jsxs(ze,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Re,{className:"grid w-full grid-cols-4",children:[e.jsx(J,{value:"overview",children:"Resumo Executivo"}),e.jsx(J,{value:"usage",children:"Análise de Uso"}),e.jsx(J,{value:"patterns",children:"Padrões Detectados"}),e.jsx(J,{value:"recommendations",children:"Recomendações"})]}),e.jsxs(X,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Queries Totais"}),e.jsx(_a,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s?.totalQueries?.toLocaleString()||0}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx(Ge,{className:"h-3 w-3 text-green-500"}),e.jsx("span",{className:"text-green-500",children:"+12.3%"}),e.jsx("span",{className:"text-muted-foreground",children:"vs período anterior"})]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Custo Total"}),e.jsx(Ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",((s?.totalCost||0)/100).toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx(Os,{className:"h-3 w-3 text-red-500"}),e.jsx("span",{className:"text-red-500",children:"-5.1%"}),e.jsx("span",{className:"text-muted-foreground",children:"custo por query"})]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Tempo Médio"}),e.jsx(Os,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[((s?.avgResponseTime||0)/1e3).toFixed(1),"s"]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx(Os,{className:"h-3 w-3 text-green-500"}),e.jsx("span",{className:"text-green-500",children:"-8.7%"}),e.jsx("span",{className:"text-muted-foreground",children:"melhoria"})]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Usuários Ativos"}),e.jsx(Ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s?.userActivity?.length||0}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx(Ge,{className:"h-3 w-3 text-green-500"}),e.jsx("span",{className:"text-green-500",children:"+23.4%"}),e.jsx("span",{className:"text-muted-foreground",children:"engajamento"})]})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Insights Principais"}),e.jsx(L,{children:"Descobertas importantes do período"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Eficiência Melhorada"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tempo médio de resposta reduziu 8.7% com otimizações de prompts"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Padrão de Alto Risco"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Comarca X apresenta 67% dos processos com risco elevado"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-orange-500 rounded-full mt-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Pico de Uso"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Terça-feira, 14h-16h é o horário de maior demanda"})]})]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Métricas de Qualidade"}),e.jsx(L,{children:"Indicadores de satisfação e precisão"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Precisão das Análises"}),e.jsx("span",{className:"font-medium",children:"94.2%"})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full w-[94%]"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Satisfação do Usuário"}),e.jsx("span",{className:"font-medium",children:"91.8%"})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full w-[92%]"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Taxa de Resolução"}),e.jsx("span",{className:"font-medium",children:"87.3%"})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-orange-500 h-2 rounded-full w-[87%]"})})]})]})]})]})]}),e.jsxs(X,{value:"usage",className:"space-y-6",children:[a?e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(ja,{className:"h-[300px]"}),e.jsx(ja,{className:"h-[300px]"})]}):e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx(Ma,{data:o?.dailyUsage||[]}),e.jsx(Fa,{data:o?.dailyUsage||[]}),e.jsx(Va,{data:s?.riskPatterns?.riskDistribution||{low:0,medium:0,high:0}}),e.jsx(qa,{data:s?.riskPatterns?.comarcaStats||[]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{className:"text-sm",children:"Total de Requests"})}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o?.totalStats?.totalRequests?.toLocaleString()||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Últimos ",t]})]})]}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{className:"text-sm",children:"Custo Total"})}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",((o?.totalStats?.totalCost||0)/100).toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Últimos ",t]})]})]}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{className:"text-sm",children:"Usuários Ativos"})}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o?.userStats?.length||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Período selecionado"})]})]})]})]}),e.jsxs(X,{value:"patterns",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Troca Direta"}),e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m?.patterns?.trocaDireta||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"casos detectados"})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Triangulação"}),e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m?.patterns?.triangulacao||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"casos detectados"})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Prova Emprestada"}),e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m?.patterns?.provaEmprestada||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"casos detectados"})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Duplo Papel"}),e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:m?.patterns?.duploPapel||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"casos detectados"})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Análise de Complexidade"}),e.jsx(L,{children:"Distribuição dos processos por complexidade de padrões"})]}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Baixa Complexidade"}),e.jsx(P,{variant:"outline",className:"bg-green-50 text-green-700",children:m?.complexityDistribution?.low||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Média Complexidade"}),e.jsx(P,{variant:"outline",className:"bg-yellow-50 text-yellow-700",children:m?.complexityDistribution?.medium||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm",children:"Alta Complexidade"}),e.jsx(P,{variant:"outline",className:"bg-red-50 text-red-700",children:m?.complexityDistribution?.high||0})]})]})})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Correlação Risco-Padrão"}),e.jsx(L,{children:"Análise estatística da correlação entre padrões e risco"})]}),e.jsx(b,{children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"text-3xl font-bold",children:(m?.riskCorrelation||0).toFixed(2)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Coeficiente de correlação"}),e.jsx("div",{className:"text-xs",children:(m?.riskCorrelation||0)>.7?e.jsx(P,{className:"bg-red-100 text-red-800",children:"Correlação Forte"}):(m?.riskCorrelation||0)>.4?e.jsx(P,{className:"bg-yellow-100 text-yellow-800",children:"Correlação Moderada"}):e.jsx(P,{className:"bg-green-100 text-green-800",children:"Correlação Fraca"})})]})})]})]}),m?.criticalCombinations>0&&e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5 text-orange-500"}),"Combinações Críticas Detectadas"]}),e.jsx(L,{children:"Processos com múltiplos padrões de risco simultâneos"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:m.criticalCombinations}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"processos com 2+ padrões críticos combinados"})]})]})]}),e.jsxs(X,{value:"recommendations",className:"space-y-6",children:[(s?.insights?.length??0)>0&&e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"h-5 w-5 text-blue-500"}),"Insights Automáticos"]}),e.jsx(L,{children:"Descobertas geradas pela análise de IA"})]}),e.jsx(b,{className:"space-y-4",children:s?.insights?.map((N,d)=>e.jsxs("div",{className:`border-l-4 pl-4 ${N.type==="warning"?"border-orange-500":N.type==="error"?"border-red-500":"border-blue-500"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[N.type==="warning"&&e.jsx(me,{className:"h-4 w-4 text-orange-500"}),N.type==="error"&&e.jsx(me,{className:"h-4 w-4 text-red-500"}),N.type==="info"&&e.jsx(ys,{className:"h-4 w-4 text-blue-500"}),e.jsx("h4",{className:"font-medium",children:N.title}),e.jsx(P,{variant:"outline",className:"text-xs",children:N.category})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:N.description})]},d))})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Recomendações Estratégicas"}),e.jsx(L,{children:"Ações sugeridas baseadas na análise completa dos dados"})]}),e.jsx(b,{className:"space-y-4",children:(s?.recommendations?.length??0)>0?s?.recommendations?.map((N,d)=>e.jsxs("div",{className:`border-l-4 pl-4 ${N.priority==="high"?"border-red-500":N.priority==="medium"?"border-orange-500":"border-green-500"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium",children:N.title}),e.jsxs(P,{variant:N.priority==="high"?"destructive":N.priority==="medium"?"default":"secondary",children:[N.priority==="high"?"Alta":N.priority==="medium"?"Média":"Baixa"," ","Prioridade"]}),e.jsx(P,{variant:"outline",className:"text-xs",children:N.category})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:N.description}),e.jsxs("p",{className:"text-xs text-green-600 font-medium",children:["Impacto esperado: ",N.expectedImpact]})]},d)):e.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[e.jsx(Q,{className:"h-12 w-12 mx-auto mb-4 text-green-500"}),e.jsx("p",{children:"Sistema funcionando dentro dos parâmetros ideais"}),e.jsx("p",{className:"text-sm",children:"Nenhuma recomendação crítica no momento"})]})})]})]})]})]})},gn=Object.freeze(Object.defineProperty({__proto__:null,default:nr},Symbol.toStringTag,{value:"Module"}));async function Ua(a){const n=a.type;if(n==="text/csv"||a.name.endsWith(".csv"))return ir(a);if(n.includes("spreadsheet")||a.name.match(/\.(xlsx?|xls)$/i))return lr(a);throw new Error("Formato de arquivo não suportado. Use CSV ou Excel (.xlsx, .xls)")}async function ir(a){return new Promise((n,s)=>{za.parse(a,{header:!0,skipEmptyLines:!0,preview:100,complete:r=>{try{r.errors.length>0&&console.warn("CSV parsing warnings:",r.errors);const t=r.meta.fields||[],l=r.data;if(t.length===0)throw new Error("Nenhuma coluna foi detectada no arquivo CSV");const c={name:a.name.replace(/\.[^/.]+$/,""),headers:t,rows:l.length,model:Ba(t),hasListColumn:Ja(t),sampleData:l.slice(0,5)};n([c])}catch(t){s(t)}},error:r=>{s(new Error(`Erro ao analisar CSV: ${r.message}`))}})})}const or=["dicionario","dictionary","docs","documentação","documentacao","info","instructions","instrucoes","readme","help","ajuda","template","exemplo","sample","metadata","config","configuracao"];function cr(a,n,s){const r=a.toLowerCase().trim();return!!(or.some(t=>r.includes(t))||s.length<2||n.length<3)}async function lr(a){const n=await os(()=>import("./xlsx-PER9UG_v.js"),[]);return new Promise((s,r)=>{const t=new FileReader;t.onload=l=>{try{const c=new Uint8Array(l.target?.result),i=n.read(c,{type:"array"}),o=[],j=[];if(i.SheetNames.forEach(m=>{const x=i.Sheets[m],f=n.utils.sheet_to_json(x,{header:1});if(f.length===0)return;const u=f[0].filter(Boolean),v=f.slice(1).filter(N=>N&&N.some(d=>d!=null&&d!==""));if(u.length===0)return;if(cr(m,u,v)){j.push(m);return}const h={name:m,headers:u,rows:v.length,model:Ba(u),hasListColumn:Ja(u),sampleData:v.slice(0,5).map(N=>{const d={};return u.forEach((C,T)=>{d[C]=N[T]||null}),d})};o.push(h)}),o.length===0)throw new Error("Nenhuma aba com dados válidos foi encontrada. Todas as abas foram ignoradas ou estão vazias.");s(o)}catch(c){r(new Error(`Erro ao analisar Excel: ${c instanceof Error?c.message:"Erro desconhecido"}`))}},t.onerror=()=>{r(new Error("Erro ao ler arquivo"))},t.readAsArrayBuffer(a)})}function Ba(a){const n=a.map(u=>u.toLowerCase().trim()),s=["nome_testemunha","cnjs_como_testemunha","qtd_depoimentos","quantidade_depoimentos"],r=["testemunha","depoimentos","como_testemunha"],t=["reclamante_nome","reu_nome","advogados_ativo","advogados_passivo","todas_testemunhas","testemunhas_todas"],l=["reclamante","reu","advogado","comarca","tribunal","vara","fase","status"],c=s.reduce((u,v)=>n.some(h=>h.includes(v))?u+3:u,0),i=r.reduce((u,v)=>n.some(h=>h.includes(v))?u+1:u,0),o=t.reduce((u,v)=>n.some(h=>h.includes(v))?u+3:u,0),j=l.reduce((u,v)=>n.some(h=>h.includes(v))?u+1:u,0),m=c+i,x=o+j;return n.some(u=>u.includes("cnj")||u.includes("numero_processo")||u.includes("processo"))?c>0&&c>=o?"testemunha":o>0&&o>c?"processo":m>x&&m>=1?"testemunha":(x>m&&x>=1,"processo"):"ambiguous"}function Ja(a){const n=["cnjs_como_testemunha","todas_testemunhas","testemunhas_todas","advogados_ativo","advogados_passivo"];return a.some(s=>n.some(r=>s.toLowerCase().includes(r.toLowerCase())))}function dr(){return`session_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}function mr({open:a,sheets:n,onComplete:s,onCancel:r}){const[t,l]=g.useState(n);g.useEffect(()=>{l(n)},[n]);const c=(m,x)=>{const f=[...t];f[m]={...f[m],model:x},l(f)},i=t.every(m=>m.model!=="ambiguous"),o=()=>t.filter(x=>x.model!=="ignore").some(x=>x.model==="processo"||x.model==="testemunha"),j=()=>{if(i&&o()){const m=t.filter(x=>x.model!=="ignore");s(m)}};return e.jsx($e,{open:a,onOpenChange:m=>!m&&r(),children:e.jsxs(Ue,{className:"max-w-2xl",children:[e.jsxs(Ee,{children:[e.jsx(ke,{children:"Mapeamento de Abas"}),e.jsx(ms,{children:"Algumas abas precisam de mapeamento manual. Selecione o tipo correto para cada aba."})]}),e.jsxs("div",{className:"space-y-4",children:[t.map((m,x)=>e.jsxs(p,{className:m.model==="ambiguous"?"border-warning":m.model==="ignore"?"border-muted opacity-75":"",children:[e.jsx(w,{className:"pb-3",children:e.jsxs(_,{className:"text-sm flex items-center gap-2",children:[m.name,m.model==="ambiguous"?e.jsxs(P,{variant:"outline",className:"text-warning border-warning",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"Requer mapeamento"]}):m.model==="ignore"?e.jsx(P,{variant:"outline",className:"text-muted-foreground border-muted",children:"Ignorada"}):e.jsxs(P,{variant:"outline",className:"text-success border-success",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"Mapeada"]})]})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[m.rows," linhas • ",m.headers.length," colunas"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tipo:"}),e.jsxs(ne,{value:m.model,onValueChange:f=>c(x,f),children:[e.jsx(ie,{className:"w-[200px]",children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(V,{value:"processo",children:"Por Processo"}),e.jsx(V,{value:"testemunha",children:"Por Testemunha"}),e.jsx(V,{value:"ignore",children:"Ignorar esta aba"})]})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Colunas detectadas:"})," ",m.headers.slice(0,5).join(", "),m.headers.length>5&&` e mais ${m.headers.length-5}...`]})]})})]},x)),!o()&&e.jsx(p,{className:"border-destructive bg-destructive/5",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:'É necessário ter pelo menos uma aba mapeada como "Por Processo" ou "Por Testemunha"'})]})})})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(y,{variant:"outline",onClick:r,children:"Cancelar"}),e.jsx(y,{onClick:j,disabled:!i||!o(),children:"Continuar"})]})]})})}const Ye=["upload","validation","preview","publish"],js=dt((a,n)=>({currentStep:"upload",session:null,file:null,validationResult:null,currentVersionId:null,versionNumber:null,isProcessing:!1,uploadProgress:0,error:null,setCurrentStep:s=>a({currentStep:s}),setSession:s=>a({session:s}),setFile:s=>a({file:s}),setValidationResult:s=>a({validationResult:s}),setIsProcessing:s=>a({isProcessing:s}),setUploadProgress:s=>a(r=>({uploadProgress:typeof s=="function"?s(r.uploadProgress):s})),setError:s=>a({error:s}),resetWizard:()=>a({currentStep:"upload",session:null,file:null,validationResult:null,currentVersionId:null,versionNumber:null,isProcessing:!1,uploadProgress:0,error:null}),setCurrentVersion:(s,r)=>a({currentVersionId:s,versionNumber:r}),createNewVersion:async()=>{try{a({isProcessing:!0,error:null});const{supabase:s}=await os(async()=>{const{supabase:l}=await import("./page-About-D-sXwJf6.js").then(c=>c.T);return{supabase:l}},__vite__mapDeps([0,1])),{data:r,error:t}=await s.functions.invoke("create-version",{body:{}});if(t)throw t;a({currentVersionId:r.versionId,versionNumber:r.number,isProcessing:!1}),ts.info("Version created successfully",{versionId:r.versionId,number:r.number},"ImportStore")}catch(s){const r=Ps.handle(s,"ImportStore.createNewVersion");throw a({error:r.userMessage||"Falha ao criar nova versão",isProcessing:!1}),r}},publishCurrentVersion:async()=>{const s=n();if(!s.currentVersionId)throw new Error("No version to publish");try{a({isProcessing:!0,error:null});const{supabase:r}=await os(async()=>{const{supabase:c}=await import("./page-About-D-sXwJf6.js").then(i=>i.T);return{supabase:c}},__vite__mapDeps([0,1])),{data:t,error:l}=await r.functions.invoke("publish-version",{body:{versionId:s.currentVersionId}});if(l)throw l;return ts.info("Version published successfully",{versionId:s.currentVersionId,number:t.number,publishedAt:t.publishedAt},"ImportStore"),a({isProcessing:!1}),t}catch(r){const t=Ps.handle(r,"ImportStore.publishCurrentVersion");throw a({error:t.userMessage||"Falha ao publicar versão",isProcessing:!1}),t}},nextStep:()=>{const{currentStep:s}=n(),r=Ye.indexOf(s);r<Ye.length-1&&a({currentStep:Ye[r+1]})},previousStep:()=>{const{currentStep:s}=n(),r=Ye.indexOf(s);r>0&&a({currentStep:Ye[r-1]})},canProceedToNext:()=>{const s=n(),{currentStep:r,session:t,file:l,validationResult:c}=s;switch(r){case"upload":return!!(t&&l);case"validation":return!!c?.normalizedData;case"preview":{if(!c?.normalizedData)return!1;const i=Array.isArray(c.normalizedData.processos)&&c.normalizedData.processos.length>0,o=Array.isArray(c.normalizedData.testemunhas)&&c.normalizedData.testemunhas.length>0;return i||o}case"publish":return!1;default:return!1}}}));function xr(){const{setSession:a,setFile:n,setCurrentStep:s,isProcessing:r,setIsProcessing:t,uploadProgress:l,setUploadProgress:c,error:i,setError:o}=js(),[j,m]=g.useState(null),[x,f]=g.useState([]),[u,v]=g.useState(!1),h=g.useCallback(async S=>{const k=S[0];if(!k)return;if(k.size>20*1024*1024){o("Arquivo muito grande. Tamanho máximo: 20MB"),F({title:"Arquivo muito grande",description:"O arquivo deve ter no máximo 20MB",variant:"destructive"});return}m(k),o(null),t(!0),c(0);const A=setTimeout(async()=>{try{const O=setInterval(()=>{c(ee=>ee>=90?(clearInterval(O),90):ee+Math.random()*15)},150);let U=[],Z=0;const I=3;for(;Z<I;)try{U=await Ua(k);break}catch(ee){if(Z++,Z===I)throw ee;await new Promise(G=>setTimeout(G,1e3*Z))}clearInterval(O),c(100),f(U),U.some(ee=>ee.model==="ambiguous")?v(!0):T(U,k)}catch(O){const U=O instanceof Error?O.message:"Erro ao processar arquivo";o(U),F({title:"Erro no processamento",description:U,variant:"destructive"})}finally{t(!1)}},300);return()=>clearTimeout(A)},[o,t,c]),{getRootProps:N,getInputProps:d,isDragActive:C}=mt({onDrop:h,accept:{"application/vnd.ms-excel":[".xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"text/csv":[".csv"]},maxFiles:1,maxSize:20*1024*1024}),T=(S,k)=>{if(!S.some(U=>U.model==="processo"||U.model==="testemunha")){o("Arquivo deve conter pelo menos uma aba válida"),F({title:"Estrutura inválida",description:"É necessário ter pelo menos uma aba com estrutura válida",variant:"destructive"});return}const O={fileName:k.name,fileSize:k.size,sheets:S,uploadedAt:new Date,sessionId:dr()};a(O),n(k),s("validation")},q=S=>{v(!1),j&&T(S,j)},$=S=>{switch(S){case"testemunha":return e.jsx(P,{className:"bg-primary/10 text-primary border-primary/20",children:"Por Testemunha"});case"processo":return e.jsx(P,{className:"bg-accent/10 text-accent border-accent/20",children:"Por Processo"});case"ambiguous":return e.jsx(P,{className:"bg-warning/10 text-warning-foreground border-warning/20",children:"Requer mapeamento"});default:return e.jsx(P,{variant:"secondary",children:"Desconhecido"})}};return e.jsxs(e.Fragment,{children:[e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Ca,{className:"h-5 w-5"}),"Upload de Arquivo"]}),e.jsx(L,{children:"Faça upload do arquivo CSV ou XLSX com os dados das testemunhas e processos"})]}),e.jsxs(b,{className:"space-y-6",children:[!j&&e.jsxs("div",{...N(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${C?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary hover:bg-muted/50"}`,children:[e.jsx("input",{...d()}),e.jsx(ws,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),C?e.jsx("p",{className:"text-lg font-medium",children:"Solte o arquivo aqui..."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium",children:"Arraste o arquivo ou clique para selecionar"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Formatos aceitos: Excel (.xlsx, .xls) e CSV • Máximo 20MB"}),e.jsx("div",{className:"mt-4",children:e.jsx(y,{variant:"outline",children:"Selecionar Arquivo"})})]})]}),j&&e.jsx(p,{className:"bg-muted/50",children:e.jsxs(b,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:j.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(j.size/1024/1024).toFixed(2)," MB"]})]})]}),!r&&x.length>0&&e.jsx(Q,{className:"h-5 w-5 text-success"})]}),r&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx(ds,{value:l,className:"w-full"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l<50?"Carregando arquivo...":l<90?"Analisando estrutura...":"Finalizando detecção..."})]})]})}),i&&e.jsxs(se,{variant:"destructive",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(ae,{children:i})]}),x.length>0&&!r&&!u&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Abas Detectadas:"}),e.jsx("div",{className:"grid gap-3",children:x.map((S,k)=>e.jsx(p,{className:"p-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:S.name}),$(S.model)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[S.rows.toLocaleString()," linhas •"," ",S.headers.length," colunas"]})]})})},k))}),e.jsx(y,{onClick:()=>j&&T(x,j),className:"w-full",disabled:!j,children:"Continuar para Validação"})]})]})]}),e.jsx(mr,{open:u,sheets:x,onComplete:q,onCancel:()=>v(!1)})]})}function ur({corrections:a,onApplyCorrections:n,onReject:s}){const[r,t]=g.useState(!1);g.useState(new Set);const l=g.useMemo(()=>a.reduce((j,m)=>(j.total+=1,m.corrections.length>0&&(j.withCorrections+=1),m.isValid&&(j.valid+=1),m.corrections.some(x=>x.correctionType==="auto_complete")&&(j.autoComplete+=1),m.corrections.some(x=>x.correctionType==="format")&&(j.format+=1),m.corrections.some(x=>x.correctionType==="infer")&&(j.inferred+=1),j),{total:0,withCorrections:0,autoComplete:0,format:0,inferred:0,valid:0}),[a]),c=j=>{switch(j){case"auto_complete":return"bg-blue-500/10 text-blue-700 border-blue-200";case"format":return"bg-green-500/10 text-green-700 border-green-200";case"infer":return"bg-amber-500/10 text-amber-700 border-amber-200";case"default":return"bg-purple-500/10 text-purple-700 border-purple-200";default:return"bg-muted text-muted-foreground"}},i=j=>{switch(j){case"auto_complete":return"Auto-completar";case"format":return"Formatação";case"infer":return"Inferência";case"default":return"Padrão";default:return j}},o=()=>{const j=a.map(m=>m.correctedData);n(j)};return e.jsxs(p,{className:"border-primary/20 bg-primary/5",children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5"}),"Correções Inteligentes Detectadas"]}),e.jsx(L,{children:"O sistema detectou e pode corrigir automaticamente alguns problemas nos dados"})]}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(p,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:l.total}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total de linhas"})]}),e.jsxs(p,{className:"p-3 text-center bg-success/5 border-success/20",children:[e.jsx("div",{className:"text-lg font-bold text-success",children:l.valid}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Serão válidas"})]}),e.jsxs(p,{className:"p-3 text-center bg-blue-500/5 border-blue-500/20",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:l.withCorrections}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Com correções"})]}),e.jsxs(p,{className:"p-3 text-center bg-amber-500/5 border-amber-500/20",children:[e.jsx("div",{className:"text-lg font-bold text-amber-600",children:l.inferred}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Inferências"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(P,{className:c("auto_complete"),children:[l.autoComplete," Auto-completar"]}),e.jsxs(P,{className:c("format"),children:[l.format," Formatação"]}),e.jsxs(P,{className:c("infer"),children:[l.inferred," Inferências"]})]}),e.jsxs(se,{className:"border-success bg-success/5",children:[e.jsx(Q,{className:"h-4 w-4 text-success"}),e.jsxs(ae,{className:"text-success",children:[e.jsx("strong",{children:"Pronto para aplicar:"})," ",l.valid," de"," ",l.total," linhas serão válidas após as correções"]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>t(!r),children:[r?e.jsx(Sa,{className:"h-4 w-4 mr-2"}):e.jsx(je,{className:"h-4 w-4 mr-2"}),r?"Ocultar Detalhes":"Ver Detalhes"]})}),r&&e.jsxs(ze,{defaultValue:"corrections",className:"w-full",children:[e.jsxs(Re,{className:"grid w-full grid-cols-2",children:[e.jsxs(J,{value:"corrections",children:["Correções (",l.withCorrections,")"]}),e.jsx(J,{value:"samples",children:"Amostras (5)"})]}),e.jsx(X,{value:"corrections",className:"space-y-4",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsxs(we,{children:[e.jsx(_e,{children:e.jsxs(K,{children:[e.jsx(z,{children:"Linha"}),e.jsx(z,{children:"Campo"}),e.jsx(z,{children:"Tipo"}),e.jsx(z,{children:"Original"}),e.jsx(z,{children:"Corrigido"}),e.jsx(z,{children:"Confiança"})]})}),e.jsx(ve,{children:a.slice(0,50).map((j,m)=>j.corrections.map((x,f)=>e.jsxs(K,{children:[e.jsx(E,{children:m+1}),e.jsx(E,{className:"font-mono text-sm",children:x.field}),e.jsx(E,{children:e.jsx(P,{className:c(x.correctionType),variant:"outline",children:i(x.correctionType)})}),e.jsx(E,{className:"max-w-32 truncate",children:e.jsx("code",{className:"text-xs bg-muted px-1 py-0.5 rounded",children:String(x.originalValue)})}),e.jsx(E,{className:"max-w-32 truncate",children:e.jsx("code",{className:"text-xs bg-success/10 px-1 py-0.5 rounded",children:String(x.correctedValue)})}),e.jsx(E,{children:e.jsxs(P,{variant:"outline",children:[Math.round(x.confidence*100),"%"]})})]},`${m}-${f}`)))})]})})}),e.jsx(X,{value:"samples",className:"space-y-4",children:e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-4",children:a.slice(0,5).map((j,m)=>e.jsxs(p,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(P,{variant:"outline",children:["Linha ",m+1]}),j.isValid?e.jsxs(P,{className:"bg-success/10 text-success border-success/20",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"Válida"]}):e.jsxs(P,{className:"bg-destructive/10 text-destructive border-destructive/20",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"Inválida"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"Dados Originais:"}),e.jsx("pre",{className:"bg-muted p-2 rounded text-xs overflow-x-auto",children:JSON.stringify(j.originalData,null,2)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-1",children:"Dados Corrigidos:"}),e.jsx("pre",{className:"bg-success/10 p-2 rounded text-xs overflow-x-auto",children:JSON.stringify(j.correctedData,null,2)})]})]}),j.corrections.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"font-medium mb-1",children:"Correções:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:j.corrections.map((x,f)=>e.jsxs(P,{className:c(x.correctionType),variant:"outline",children:[x.field,":"," ",i(x.correctionType)]},f))})]})]},m))})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(y,{variant:"outline",onClick:s,children:"Rejeitar Correções"}),e.jsxs(y,{onClick:o,className:"bg-success hover:bg-success/90",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Aplicar Correções (",l.withCorrections,")"]})]})]})]})}function hr({issues:a,onExportIssues:n}){const[s,r]=g.useState({severity:"all",sheet:"all",rule:"all",search:""}),t=g.useRef(null),l=g.useMemo(()=>[...new Set(a.map(v=>v.sheet))].sort(),[a]),c=g.useMemo(()=>[...new Set(a.map(v=>v.rule).filter(Boolean))].sort(),[a]),i=g.useMemo(()=>a.filter(v=>{if(s.severity!=="all"&&v.severity!==s.severity||s.sheet!=="all"&&v.sheet!==s.sheet||s.rule!=="all"&&v.rule!==s.rule)return!1;if(s.search){const h=s.search.toLowerCase(),N=v.message.toLowerCase().includes(h),d=v.column?.toLowerCase().includes(h),C=v.original?.toString().toLowerCase().includes(h);if(!N&&!d&&!C)return!1}return!0}),[a,s]),o=xt({count:i.length,getScrollElement:()=>t.current,estimateSize:()=>56,overscan:5}),j=v=>{switch(v){case"error":return e.jsx(Hs,{className:"h-4 w-4 text-destructive"});case"warning":return e.jsx(me,{className:"h-4 w-4 text-warning"});case"info":return e.jsx(Q,{className:"h-4 w-4 text-info"})}},m=v=>{switch(v){case"error":return"destructive";case"warning":return"default";case"info":return"secondary"}},x=()=>{const h=[["Severidade","Aba","Linha","Coluna","Regra","Mensagem","Valor Original","Valor Corrigido"].join(","),...i.map(T=>[T.severity,T.sheet,T.row||"",T.column||"",T.rule||"",`"${T.message.replace(/"/g,'""')}"`,`"${(T.original||"").toString().replace(/"/g,'""')}"`,`"${(T.fixed||"").toString().replace(/"/g,'""')}"`].join(","))].join(`
`),N=new Blob([h],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a"),C=URL.createObjectURL(N);d.setAttribute("href",C),d.setAttribute("download",`assistjur-issues-${new Date().toISOString().split("T")[0]}.csv`),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)},f=()=>{n?n():x()},u=()=>{r({severity:"all",sheet:"all",rule:"all",search:""})};return e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Xs,{className:"h-5 w-5"}),"Issues Detectadas (",i.length," de ",a.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"outline",size:"sm",onClick:u,children:"Limpar Filtros"}),e.jsxs(y,{variant:"outline",size:"sm",onClick:f,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Exportar CSV"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Severidade"}),e.jsxs(ne,{value:s.severity,onValueChange:v=>r(h=>({...h,severity:v})),children:[e.jsx(ie,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(V,{value:"all",children:"Todas"}),e.jsx(V,{value:"error",children:"Erro"}),e.jsx(V,{value:"warning",children:"Aviso"}),e.jsx(V,{value:"info",children:"Info"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Aba"}),e.jsxs(ne,{value:s.sheet,onValueChange:v=>r(h=>({...h,sheet:v})),children:[e.jsx(ie,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(V,{value:"all",children:"Todas"}),l.map(v=>e.jsx(V,{value:v,children:v},v))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Regra"}),e.jsxs(ne,{value:s.rule,onValueChange:v=>r(h=>({...h,rule:v})),children:[e.jsx(ie,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(V,{value:"all",children:"Todas"}),c.map(v=>e.jsx(V,{value:v,children:v},v))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Buscar"}),e.jsx(H,{placeholder:"Buscar na mensagem, coluna ou valor...",value:s.search,onChange:v=>r(h=>({...h,search:v.target.value}))})]})]})]}),e.jsxs(b,{children:[e.jsx("div",{ref:t,className:"rounded-md border max-h-96 overflow-y-auto",children:e.jsxs(we,{children:[e.jsx(_e,{children:e.jsxs(K,{children:[e.jsx(z,{className:"w-20",children:"Severidade"}),e.jsx(z,{className:"w-24",children:"Aba"}),e.jsx(z,{className:"w-16",children:"Linha"}),e.jsx(z,{className:"w-32",children:"Coluna"}),e.jsx(z,{className:"w-24",children:"Regra"}),e.jsx(z,{children:"Mensagem"}),e.jsx(z,{className:"w-32",children:"Valor Original"}),e.jsx(z,{className:"w-32",children:"Valor Corrigido"})]})}),i.length===0?e.jsx(ve,{children:e.jsx(K,{children:e.jsx(E,{colSpan:8,className:"text-center text-muted-foreground py-6",children:a.length===0?"Nenhuma issue detectada":"Nenhuma issue corresponde aos filtros"})})}):e.jsx(ve,{style:{height:`${o.getTotalSize()}px`,position:"relative"},children:o.getVirtualItems().map(v=>{const h=i[v.index];return e.jsxs(K,{className:"absolute top-0 left-0 w-full",style:{transform:`translateY(${v.start}px)`},children:[e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[j(h.severity),e.jsx(P,{variant:m(h.severity),className:"text-xs",children:h.severity.toUpperCase()})]})}),e.jsx(E,{className:"font-medium",children:h.sheet}),e.jsx(E,{children:h.row||"-"}),e.jsx(E,{children:h.column||"-"}),e.jsx(E,{children:h.rule&&e.jsx(P,{variant:"outline",className:"text-xs",children:h.rule})}),e.jsx(E,{className:"max-w-xs",children:e.jsx("div",{className:"truncate",title:h.message,children:h.message})}),e.jsx(E,{className:"max-w-xs",children:h.original&&e.jsx("div",{className:"truncate bg-muted px-2 py-1 rounded text-xs",title:h.original?.toString(),children:h.original?.toString()})}),e.jsx(E,{className:"max-w-xs",children:h.fixed&&e.jsx("div",{className:"truncate bg-success/10 px-2 py-1 rounded text-xs",title:h.fixed?.toString(),children:h.fixed?.toString()})})]},v.key)})})]})}),i.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:["Mostrando ",i.length," de ",a.length," issues"]})]})]})}function jr(a){let n="",s=a;for(;s>=0;)n=String.fromCharCode(65+s%26)+n,s=Math.floor(s/26)-1;return n}function pr(a,n){const s=jr(n),r=a+1;return`${s}${r}`}function fn(a){return/^[A-Z]+\d+$/.test(a)}function gr(a){if(a.length!==20)return!1;const n=a.split("").map(Number),s=n.slice(0,6),r=[2,3,4,5,6,7],t=s.reduce((m,x,f)=>m+x*r[f],0),l=t%11<2?0:11-t%11,c=n.slice(7,13),i=[2,3,4,5,6,7],o=c.reduce((m,x,f)=>m+x*i[f],0),j=o%11<2?0:11-o%11;return n[6]===l&&n[13]===j}function pa(a){return a.length!==20?a:`${a.slice(0,7)}-${a.slice(7,9)}.${a.slice(9,13)}.${a.slice(13,14)}.${a.slice(14,16)}.${a.slice(16)}`}function qe(a){return a?String(a).replace(/\D/g,""):""}function Ve(a,n="final"){const s=qe(a),r=[];if(n==="correction"){if(s.length<15)return r.push(`CNJ muito curto: ${s.length} dígitos (mínimo 15 para correção)`),{isValid:!1,formatted:s,cleaned:s,errors:r};let l=s;return s.length<20&&(l=s.padEnd(20,"0")),{isValid:!0,formatted:pa(l),cleaned:l,errors:[]}}s.length!==20&&r.push(`CNJ deve ter exatamente 20 dígitos, encontrados: ${s.length}`),s.length===20&&!gr(s)&&r.push("CNJ com dígitos verificadores inválidos");const t=r.length===0;return{isValid:t,formatted:t?pa(s):s,cleaned:s,errors:r}}function fr(a){const n=Ve(a,"correction");if(!n.isValid)return{corrected:qe(a),needsCorrection:!1,reason:n.errors.join("; ")};const s=qe(a),r=n.cleaned;return{corrected:r,needsCorrection:s!==r,reason:s!==r?`CNJ completado de ${s.length} para 20 dígitos`:void 0}}const ga={advogados_ativo:{canonical:"advogados_ativo",synonyms:["Advogados (Polo Ativo)","Advogados Polo Ativo","advogados_polo_ativo","advogados_ativo","Advogados_Ativo"],type:"array"},advogados_passivo:{canonical:"advogados_passivo",synonyms:["Advogados (Polo Passivo)","Advogados Polo Passivo","advogados_polo_passivo","advogados_passivo","Advogados_Passivo"],type:"array"},testemunhas_ativo:{canonical:"testemunhas_ativo",synonyms:["testemunhas_ativo","Testemunhas_Ativo","testemunhas_polo_ativo","Testemunhas (Polo Ativo)"],type:"array"},testemunhas_passivo:{canonical:"testemunhas_passivo",synonyms:["testemunhas_passivo","Testemunhas_Passivo","testemunhas_polo_passivo","Testemunhas (Polo Passivo)"],type:"array"},todas_testemunhas:{canonical:"todas_testemunhas",synonyms:["testemunhas_todas","Testemunhas_Todas","todas_testemunhas","Todas_Testemunhas","testemunhas_completas"],type:"array"},cnj:{canonical:"cnj",synonyms:["cnj","CNJ","numero_cnj","numero_processo"],type:"string"},reclamantes:{canonical:"reclamantes",synonyms:["reclamantes","Reclamantes","autores","requerentes","partes_ativas"],type:"array"},nome_testemunha:{canonical:"nome_testemunha",synonyms:["nome_testemunha","Nome_Testemunha","nome","testemunha","nome_completo"],type:"string"},qtd_depoimentos:{canonical:"qtd_depoimentos",synonyms:["qtd_depoimentos","quantidade_depoimentos","total_depoimentos","numero_depoimentos"],type:"number"}};function vr(a){if(ga[a])return a;const n=a.toLowerCase().trim();for(const[s,r]of Object.entries(ga))if(r.synonyms.some(l=>l.toLowerCase().trim()===n))return s;return null}function Ga(a,n){const s={};return a.forEach(r=>{const t=vr(r);t?s[t]=r:s[r]=r}),s}function Ka(a,n){if(!n)return a;const s={...a};return(!s.reu_nome||typeof s.reu_nome=="string"&&s.reu_nome.trim()==="")&&n.applyDefaultReuOnTestemunha&&n.defaultReuNome&&(s.reu_nome=n.defaultReuNome,s.__autofill={...typeof s.__autofill=="object"&&s.__autofill!==null?s.__autofill:{},reu_nome:!0}),s}function fa(a,n,s){const r=Ga(a.headers);return n.map(t=>{const l={};Object.entries(r).forEach(([m,x])=>{l[m]=t[x]}),Ka(l,s);const c=l.cnj||"",o=Ve(c,"correction").cleaned;return{cnj:o,cnj_digits:qe(o),reclamante_nome:String(l.reclamante_nome||""),reu_nome:String(l.reu_nome||""),comarca:String(l.comarca||""),tribunal:String(l.tribunal||""),vara:String(l.vara||""),fase:String(l.fase||""),status:String(l.status||""),observacoes:String(l.observacoes||"")}}).filter(t=>{const l=Ve(t.cnj,"correction"),c=t.reclamante_nome||t.reu_nome;return l.isValid||c})}function va(a,n,s){const r=Ga(a.headers);return n.map(t=>{const l={};return Object.entries(r).forEach(([c,i])=>{l[c]=t[i]}),Ka(l,s),{cnj:String(l.cnj||""),cnj_digits:qe(String(l.cnj||"")),nome_testemunha:String(l.nome_testemunha||""),reclamante_nome:String(l.reclamante_nome||""),reu_nome:String(l.reu_nome||"")}})}async function Nr(a,n){if(a.name.endsWith(".csv"))return new Promise((r,t)=>{za.parse(a,{header:!0,skipEmptyLines:!0,complete:l=>{r(l.data)},error:t})});const s=await os(()=>import("./xlsx-PER9UG_v.js"),[]);return new Promise((r,t)=>{const l=new FileReader;l.onload=c=>{try{const i=new Uint8Array(c.target?.result),j=s.read(i,{type:"array"}).Sheets[n.name];if(!j){t(new Error(`Sheet "${n.name}" not found`));return}const m=s.utils.sheet_to_json(j,{header:1}),x=m[0],u=m.slice(1).map(v=>{const h={};return x.forEach((N,d)=>{h[N]=v[d]}),h});r(u)}catch(i){t(i)}},l.onerror=t,l.readAsArrayBuffer(a)})}async function br(a,n,s=null){const r=await Nr(a,n);return n.model==="processo"?{processos:fa(n,r,s)}:n.model==="testemunha"?{testemunhas:va(n,r,s)}:n.headers.some(l=>["comarca","tribunal","vara","status"].some(c=>l.toLowerCase().includes(c)))?{processos:fa(n,r,s)}:{testemunhas:va(n,r,s)}}const Ws=[{normalized:"cnj",synonyms:["CNJ","cnj","numero_cnj","num_cnj","processo","numero_processo"],required:!0,sheet:"processo"},{normalized:"uf",synonyms:["UF","uf","estado","unidade_federativa","sigla_estado"],required:!0,sheet:"processo"},{normalized:"comarca",synonyms:["comarca","Comarca","COMARCA","municipio","cidade"],required:!0,sheet:"processo"},{normalized:"reclamante_nome",synonyms:["reclamante_nome","Reclamante_Nome","reclamante","Reclamante","Reclamante_Limpo","reclamante_limpo","nome_reclamante","autor","nome_autor","requerente","nome_requerente"],required:!0,sheet:"processo"},{normalized:"reu_nome",synonyms:["reu_nome","Reu_Nome","reu","Reu","REU","reclamado","nome_reclamado","requerido","nome_requerido"],required:!1,sheet:"processo"},{normalized:"advogados_ativo",synonyms:["advogados_ativo","Advogados_Ativo","advogados_polo_ativo","advogado_reclamante","advogados_reclamante","advogado_autor","advogados_autor","representante_legal_ativo"],required:!1,sheet:"processo"},{normalized:"todas_testemunhas",synonyms:["todas_testemunhas","Todas_Testemunhas","testemunhas_todas","testemunhas","lista_testemunhas","nomes_testemunhas","testemunhas_processo","testemunhas_envolvidas"],required:!0,sheet:"processo"},{normalized:"fase",synonyms:["fase","Fase","fase_processual","etapa","situacao_processo"],required:!1,sheet:"processo"},{normalized:"status",synonyms:["status","Status","STATUS","situacao","estado_processo"],required:!1,sheet:"processo"},{normalized:"data_audiencia",synonyms:["data_audiencia","Data_Audiencia","data_da_audiencia","audiencia","proxima_audiencia","dt_audiencia"],required:!1,sheet:"processo"},{normalized:"observacoes",synonyms:["observacoes","Observacoes","observações","Observações","obs","comentarios","notas","anotacoes"],required:!1,sheet:"processo"},{normalized:"tribunal",synonyms:["tribunal","Tribunal","TRIBUNAL","orgao_julgador"],required:!1,sheet:"processo"},{normalized:"vara",synonyms:["vara","Vara","VARA","vara_trabalhista"],required:!1,sheet:"processo"},{normalized:"nome_testemunha",synonyms:["nome_testemunha","Nome_Testemunha","testemunha","nome_da_testemunha","testemunha_nome"],required:!0,sheet:"testemunha"},{normalized:"qtd_depoimentos",synonyms:["qtd_depoimentos","Qtd_Depoimentos","quantidade_depoimentos","numero_depoimentos","total_depoimentos","qtde_depoimentos","count_depoimentos"],required:!0,sheet:"testemunha"},{normalized:"cnjs_como_testemunha",synonyms:["cnjs_como_testemunha","CNJs_Como_Testemunha","cnj_como_testemunha","processos_como_testemunha","lista_cnjs","cnjs_testemunha","cnjs_depoimento","processos_testemunha"],required:!0,sheet:"testemunha"},{normalized:"reclamante_nome",synonyms:["reclamante_nome","Reclamante_Nome","reclamante","nome_reclamante","autor"],required:!1,sheet:"testemunha"},{normalized:"reu_nome",synonyms:["reu_nome","Reu_Nome","reu","nome_reu","reclamado"],required:!1,sheet:"testemunha"}];function yr(a,n){const s=a.trim(),r=Ws.find(l=>(l.sheet===n||l.sheet==="both")&&l.synonyms.includes(s));if(r)return r.normalized;const t=Ws.find(l=>(l.sheet===n||l.sheet==="both")&&l.synonyms.some(c=>c.toLowerCase()===s.toLowerCase()));return t?t.normalized:null}function wr(a){return Ws.filter(n=>n.required&&(n.sheet===a||n.sheet==="both")).map(n=>n.normalized)}function _r(a,n){const s={},r=[],t=wr(n);a.forEach(i=>{const o=yr(i,n);o?s[i]=o:r.push(i)});const l=Object.values(s),c=t.filter(i=>!l.includes(i));return{mapped:s,unmapped:r,missing:c}}function Cr(a,n){const s=_r(a,n),r={};return s.unmapped.forEach(t=>{const l=[];n==="processo"&&(t.toLowerCase().includes("reclamante")&&l.push("reclamante_nome"),(t.toLowerCase().includes("reu")||t.toLowerCase().includes("reclamado"))&&l.push("reu_nome"),(t.toLowerCase().includes("cnj")||t.toLowerCase().includes("processo"))&&l.push("cnj")),l.length>0&&(r[t]=l)}),{...s,suggestions:r}}function Sr(a,n,s){const r=[],t={...a};let l=!0;if(s==="processo"){if(t.cnj){const c=t.cnj,i=fr(c);i.needsCorrection&&r.push({field:"cnj",originalValue:c,correctedValue:i.corrected,correctionType:"auto_complete",confidence:.7}),t.cnj=i.corrected,t.cnj_digits=qe(t.cnj)}if(["reclamante_nome","reu_nome"].forEach(c=>{if(t[c]&&typeof t[c]=="string"){const i=t[c],o=i.trim().replace(/\s+/g," ");if(o!==i&&(t[c]=o,r.push({field:c,originalValue:i,correctedValue:o,correctionType:"format",confidence:.9})),o===o.toUpperCase()||o===o.toLowerCase()){const j=o.toLowerCase().replace(/\b\w/g,m=>m.toUpperCase());t[c]=j,r.push({field:c,originalValue:o,correctedValue:j,correctionType:"format",confidence:.8})}}c==="reclamante_nome"&&(!t[c]||String(t[c]).trim()==="")&&(l=!1)}),!t.reu_nome&&t.reclamante_nome){const c=String(t.reclamante_nome||"").toLowerCase();if(c.includes("vs")||c.includes("x ")){const i=c.split(/\s+(vs?\.?|x)\s+/i);i.length>=2&&(t.reu_nome=i[1].trim(),r.push({field:"reu_nome",originalValue:null,correctedValue:t.reu_nome,correctionType:"infer",confidence:.6}))}}["advogados_ativo","advogados_passivo","testemunhas_ativo","testemunhas_passivo"].forEach(c=>{if(t[c]&&typeof t[c]=="string"){const i=t[c],o=i.split(/[;,]/).map(j=>j.trim()).filter(Boolean);o.length>0&&(t[c]=o,r.push({field:c,originalValue:i,correctedValue:o,correctionType:"format",confidence:.9}))}})}else s==="testemunha"&&((!t.nome_testemunha||String(t.nome_testemunha).trim()==="")&&(l=!1),t.cnjs_como_testemunha&&(Array.isArray(t.cnjs_como_testemunha)?t.cnjs_como_testemunha:String(t.cnjs_como_testemunha).split(/[;,]/).map(o=>o.trim())).filter(o=>Ve(o,"final").isValid).length===0&&(l=!1));return{originalData:a,correctedData:t,corrections:r,isValid:l}}async function Wa(a,n,s){if(!s)throw new Error("Arquivo é obrigatório para validação inteligente");let r=0,t=0;const l=[],c=[],i={processos:[],testemunhas:[]},o={};for(const x of a.sheets)try{const f=await br(s,x,null),u=x.model==="testemunha"?"testemunha":"processo",v=Cr(x.headers,u);v.missing.forEach(N=>{l.push({sheet:x.name,row:0,column:N,severity:"error",rule:"Campo obrigatório não encontrado",message:`Campo obrigatório "${N}" não foi encontrado nos cabeçalhos`,value:"N/A"})}),Object.entries(v.suggestions).forEach(([N,d])=>{l.push({sheet:x.name,row:0,column:N,severity:"warning",rule:"Campo não mapeado",message:`Campo "${N}" não foi mapeado. Sugestões: ${d.join(", ")}`,value:N})});const h=f.processos||f.testemunhas||[];o[x.name]=h.length,h.forEach((N,d)=>{const C=d+1;r++;const T=n.intelligentCorrections?Sr(N,d,u):{originalData:N,correctedData:N,corrections:[],isValid:!0};c.push(T);const $=Ve(T.correctedData.cnj,"correction").isValid;if(T.isValid||$){t++;const S=T.correctedData.reclamante_nome||T.correctedData.reu_nome,k=T.correctedData.nome_testemunha;S&&(u==="processo"||!k)?(i.processos||(i.processos=[]),i.processos.push(T.correctedData)):k&&(u==="testemunha"||!S)?(i.testemunhas||(i.testemunhas=[]),i.testemunhas.push(T.correctedData)):$&&(u==="processo"?(i.processos||(i.processos=[]),i.processos.push(T.correctedData)):(i.testemunhas||(i.testemunhas=[]),i.testemunhas.push(T.correctedData)));const A=qe(T.correctedData.cnj);$&&A.length<20&&l.push({sheet:x.name,row:C,column:"cnj",severity:"warning",rule:"CNJ incompleto mas preservado",message:`CNJ tem ${A.length} dígitos (recomendado: 20). Dados preservados para revisão.`,value:T.correctedData.cnj||"N/A"}),T.corrections.forEach(O=>{l.push({sheet:x.name,row:C,column:O.field,severity:"info",rule:"Correção automática aplicada",message:`${O.correctionType}: "${O.originalValue}" → "${O.correctedValue}" (confiança: ${Math.round(O.confidence*100)}%)`,value:O.originalValue})})}else u==="processo"&&(T.correctedData.reclamante_nome||l.push({sheet:x.name,row:C,column:"reclamante_nome",severity:"error",rule:"Nome do reclamante é obrigatório",message:'Campo "reclamante_nome" é obrigatório mas está vazio',value:T.correctedData.reclamante_nome||"N/A"}),T.correctedData.reu_nome||l.push({sheet:x.name,row:C,column:"reu_nome",severity:"warning",rule:"Nome do réu recomendado",message:'Campo "reu_nome" está vazio mas pode ser preenchido posteriormente',value:T.correctedData.reu_nome||"N/A"}),(!T.correctedData.cnj||!Ve(T.correctedData.cnj,"final").isValid)&&l.push({sheet:x.name,row:C,column:"cnj",severity:"error",rule:"CNJ deve ter 20 dígitos",message:"CNJ deve ter formato válido com 20 dígitos numéricos",value:T.correctedData.cnj||"N/A"}))})}catch(f){l.push({sheet:x.name,row:0,column:"sistema",severity:"error",rule:"Erro no processamento",message:`Erro ao processar aba: ${f instanceof Error?f.message:"Erro desconhecido"}`,value:"N/A"})}const j=Object.values(o).reduce((x,f)=>x+f,0);return Object.values(i).flat().length,c.filter(x=>x.corrections.length>0).length,c.reduce((x,f)=>x+f.corrections.length,0),{summary:{analyzed:j,valid:t,errors:l.filter(x=>x.severity==="error").length,warnings:l.filter(x=>x.severity==="warning").length,infos:l.filter(x=>x.severity==="info").length},issues:l,normalizedData:i,intelligentCorrections:c}}function Xa(){const[a,n]=g.useState(null),[s,r]=g.useState(!1),t=async()=>{r(!0);try{const i=await(await fetch("/template-test-exemplo.csv")).blob(),o=new File([i],"template-test-exemplo.csv",{type:"text/csv"}),j=await Ua(o),m={sessionId:crypto.randomUUID(),fileName:o.name,fileSize:o.size,sheets:j,uploadedAt:new Date},x=await Wa(m,{explodeLists:!0,standardizeCNJ:!0,applyDefaultReu:!0,intelligentCorrections:!0},o);n({success:!0,sheets:j.length,analyzed:x.summary.analyzed,valid:x.summary.valid,errors:x.summary.errors,warnings:x.summary.warnings,corrections:x.intelligentCorrections?.length||0,correctionsApplied:x.intelligentCorrections?.filter(f=>f.corrections.length>0).length||0})}catch(l){n({success:!1,error:l instanceof Error?l.message:"Erro desconhecido"})}finally{r(!1)}};return e.jsxs(p,{className:"border-primary/20 bg-primary/5",children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Teste do Corretor Inteligente"]}),e.jsx(L,{children:"Valide se o template atualizado funciona corretamente com o novo sistema"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs(y,{onClick:t,disabled:s,className:"w-full",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),s?"Testando Template...":"Testar Template Corrigido"]}),a&&e.jsxs("div",{className:"space-y-4",children:[a.success?e.jsxs(se,{className:"border-success bg-success/5",children:[e.jsx(Q,{className:"h-4 w-4 text-success"}),e.jsxs(ae,{className:"text-success",children:[e.jsx("strong",{children:"✅ Teste Aprovado!"})," Template funciona perfeitamente com o Corretor Inteligente"]})]}):e.jsxs(se,{variant:"destructive",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsxs(ae,{children:[e.jsx("strong",{children:"❌ Teste Falhou:"})," ",a.error]})]}),a.success&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(p,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:a.sheets}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Abas detectadas"})]}),e.jsxs(p,{className:"p-3 text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:a.analyzed}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Linhas analisadas"})]}),e.jsxs(p,{className:"p-3 text-center bg-success/10 border-success/20",children:[e.jsx("div",{className:"text-lg font-bold text-success",children:a.valid}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Linhas válidas"})]}),e.jsxs(p,{className:"p-3 text-center bg-blue-500/10 border-blue-500/20",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:a.correctionsApplied}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Correções aplicadas"})]})]}),a.success&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(P,{variant:"outline",className:"bg-success/10 text-success border-success/20",children:[a.errors," Erros"]}),e.jsxs(P,{variant:"outline",className:"bg-warning/10 text-warning border-warning/20",children:[a.warnings," Avisos"]}),e.jsxs(P,{variant:"outline",className:"bg-blue-500/10 text-blue-600 border-blue-500/20",children:[a.corrections," Correções Detectadas"]})]})]})]})]})}function Pr(){const{session:a,file:n,validationResult:s,setValidationResult:r,setCurrentStep:t,isProcessing:l,setIsProcessing:c,setError:i}=js(),[o,j]=g.useState(!1),[m,x]=g.useState([]),f=g.useCallback(async()=>{if(!(!a||!n)){c(!0);try{const S=await Wa(a,{explodeLists:!0,standardizeCNJ:!0,applyDefaultReu:!0,intelligentCorrections:!0},n);S.intelligentCorrections&&S.intelligentCorrections.length>0&&(x(S.intelligentCorrections),S.intelligentCorrections.filter(O=>O.corrections.length>0).length>0&&j(!0));const k={summary:S.summary,issues:S.issues,normalizedData:S.normalizedData,downloadUrls:{fixedXlsx:"",reportCsv:"",reportJson:""}};r(k),F({title:"Validação inteligente concluída",description:`${S.summary.analyzed} registros analisados, ${S.summary.valid} válidos, ${S.intelligentCorrections?.filter(A=>A.corrections.length>0).length||0} correções sugeridas`}),ts.info("Final Validation Summary",{originalFile:n.name,fileSize:n.size,sheetsDetected:a.sheets.length,analyzed:S.summary.analyzed,valid:S.summary.valid,errors:S.summary.errors,warnings:S.summary.warnings,correctionsAvailable:S.intelligentCorrections?.length||0,correctionsWithChanges:S.intelligentCorrections?.filter(A=>A.corrections.length>0).length||0},"ValidationStep")}catch(S){const k=S instanceof Error?S.message:"Erro na validação",A=Ps.handleAndNotify(S,"ValidationStep.performValidation");i(A.userMessage||k)}finally{c(!1)}}},[a,n,c,r,i]);g.useEffect(()=>{a&&n&&!s&&f()},[a,n,s,f]),g.useEffect(()=>{if(s){const S={originalRows:s.summary.analyzed,processedRows:s.summary.valid,filteredRows:s.summary.analyzed-s.summary.valid,validRows:s.summary.valid,correctedRows:m.length,errorRows:s.summary.errors,warningRows:s.summary.warnings};ts.info("Detailed Validation Stats",S,"ValidationStep")}},[s,m]);const u=g.useCallback(async S=>{const k=m.filter(A=>A.corrections.length>0).length;try{const{generateReports:A}=await os(async()=>{const{generateReports:G}=await import("./report-Ds-LXFSJ.js");return{generateReports:G}},__vite__mapDeps([2,0,1,3,4,5,6,7,8])),O=S.filter(G=>{const pe=Ve(G.cnj,"correction"),ue=G.reclamante_nome||G.reu_nome;return pe.isValid||ue}),U=S.filter(G=>{const pe=Ve(G.cnj,"correction"),ue=G.nome_testemunha;return pe.isValid||ue}),Z=new Map;m.forEach((G,pe)=>{G.corrections.forEach(ue=>{const Ce=S[0]||{},Be=Object.keys(Ce).indexOf(ue.field);if(Be>=0){const Je=pr(pe+1,Be);Z.set(Je,{address:Je,original:ue.originalValue,corrected:ue.correctedValue,reason:`${ue.correctionType}: ${ue.reason||"Correção automática"}`})}})});const I={...s,normalizedData:{processos:O.length>0?O:void 0,testemunhas:U.length>0?U:void 0},summary:{...s.summary,valid:O.length+U.length,errors:Math.max(0,s.summary.errors-k)}},le=await A(I,n?.name||"arquivo_corrigido",Z);I.downloadUrls=le,r(I),j(!1);const ee=O.length+U.length;F({title:"Correções aplicadas com sucesso",description:`${k} correções aplicadas. ${ee} registros válidos prontos para importação. Downloads disponíveis.`})}catch(A){const O=Ps.handleAndNotify(A,"ValidationStep.handleApplyCorrections");ts.error("Erro ao aplicar correções",{error:O.message,correctionsCount:m.length},"ValidationStep")}},[m,n,r,s]),v=()=>{j(!1),F({title:"Correções rejeitadas",description:"Continuando com os dados originais"})};if(!a||!n)return e.jsxs(se,{variant:"destructive",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(ae,{children:"Sessão ou arquivo não encontrado. Volte ao passo anterior."})]});if(l||!s)return e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"h-5 w-5"}),"Validação e Normalização"]}),e.jsx(L,{children:"Verificando a qualidade e consistência dos dados"})]}),e.jsx(b,{children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Oe,{className:"h-12 w-12 animate-spin mx-auto text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Validando arquivo..."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Processando dados reais para validação completa"})]})]})})})]});const{summary:h,issues:N}=s,d=h.errors>0,C=m.length>0&&m.some(S=>S.corrections.length>0),T=!o&&C,q=h.valid>0&&(!d||T),$=s.downloadUrls&&(s.downloadUrls.fixedXlsx||s.downloadUrls.reportCsv||s.downloadUrls.reportJson);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(p,{className:"text-center p-4",children:[e.jsx("div",{className:"text-2xl font-bold",children:h.analyzed.toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Linhas analisadas"})]}),e.jsxs(p,{className:"text-center p-4 bg-success/5 border-success/20",children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:h.valid.toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Linhas válidas"}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:h.analyzed>0?`${Math.round(h.valid/h.analyzed*100)}%`:"0%"})]}),e.jsxs(p,{className:"text-center p-4 bg-destructive/5 border-destructive/20",children:[e.jsx("div",{className:"text-2xl font-bold text-destructive",children:h.errors}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Erros"}),h.errors>0&&e.jsx("div",{className:"text-xs text-destructive mt-1",children:"Impedem publicação"})]}),e.jsxs(p,{className:"text-center p-4 bg-warning/5 border-warning/20",children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:h.warnings}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Avisos"}),h.warnings>0&&e.jsx("div",{className:"text-xs text-warning mt-1",children:"Permitido publicar"})]})]}),o&&C&&e.jsx(ur,{corrections:m,onApplyCorrections:u,onReject:v}),$&&e.jsxs(p,{className:"border-blue-500/20 bg-blue-500/5",children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Downloads Disponíveis"]}),e.jsx(L,{children:"Baixe os arquivos processados e relatórios de correção"})]}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.downloadUrls?.fixedXlsx&&e.jsx(y,{asChild:!0,variant:"outline",className:"justify-start",children:e.jsxs("a",{href:s.downloadUrls.fixedXlsx,download:"arquivo_corrigido.xlsx",children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Arquivo Corrigido"]})}),s.downloadUrls?.reportCsv&&e.jsx(y,{asChild:!0,variant:"outline",className:"justify-start",children:e.jsxs("a",{href:s.downloadUrls.reportCsv,download:"relatorio_erros.csv",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Relatório CSV"]})}),s.downloadUrls?.reportJson&&e.jsx(y,{asChild:!0,variant:"outline",className:"justify-start",children:e.jsxs("a",{href:s.downloadUrls.reportJson,download:"relatorio_completo.json",children:[e.jsx(ys,{className:"h-4 w-4 mr-2"}),"Relatório JSON"]})})]})})]}),q&&!o&&e.jsxs(se,{className:"border-success bg-success/5",children:[e.jsx(Q,{className:"h-4 w-4 text-success"}),e.jsxs(ae,{className:"text-success",children:["✅ Arquivo pronto para publicação! ",h.valid," registros serão importados.",C&&T&&e.jsx("div",{className:"mt-1 text-sm",children:"Correções automáticas aplicadas com sucesso."}),C&&!T&&e.jsxs(y,{variant:"link",size:"sm",className:"ml-2 p-0 h-auto text-success",onClick:()=>j(!0),children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Ver correções sugeridas"]})]})]}),d&&o&&e.jsxs(se,{variant:"destructive",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsxs(ae,{children:["❌ Corrija os erros antes de prosseguir. ",h.errors," problemas impedem a importação.",C&&e.jsxs(y,{variant:"link",size:"sm",className:"ml-2 p-0 h-auto text-destructive",onClick:()=>j(!0),children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Ver correções automáticas"]})]})]}),d&&!o&&!T&&e.jsxs(se,{variant:"destructive",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsxs(ae,{children:["❌ ",h.errors," problemas impedem a importação.",C&&e.jsxs(y,{variant:"link",size:"sm",className:"ml-2 p-0 h-auto text-destructive",onClick:()=>j(!0),children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Aplicar correções automáticas"]})]})]}),N.length>0&&e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Problemas Detectados"}),e.jsx(L,{children:"Revise e corrija os problemas antes de prosseguir"})]}),e.jsx(b,{children:e.jsx(hr,{issues:N.map(S=>({...S,message:S.message||S.rule}))})})]}),e.jsx(Xa,{}),e.jsx(p,{className:"border-blue-500/20 bg-blue-500/5",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-700",children:"Página de Teste Completa"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Acesse a página dedicada para testes detalhados do Corretor Inteligente"})]}),e.jsx(y,{asChild:!0,variant:"outline",className:"border-blue-500/20 text-blue-700",children:e.jsx("a",{href:"/admin/base-import/test",target:"_blank",rel:"noopener noreferrer",children:"Abrir Teste"})})]})})}),q&&e.jsxs(p,{className:"border-primary/20 bg-primary/5",children:[e.jsxs(w,{children:[e.jsxs(_,{className:"text-sm flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Otimização Opcional"]}),e.jsx(L,{children:"Execute uma revisão completa para detectar padrões suspeitos e otimizar a base"})]}),e.jsx(b,{children:e.jsx($a,{})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(y,{variant:"outline",onClick:()=>t("upload"),children:"Voltar"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"outline",onClick:f,disabled:l,children:[l&&e.jsx(Oe,{className:"h-4 w-4 mr-2 animate-spin"}),"Revalidar"]}),e.jsx(y,{onClick:()=>t("preview"),disabled:!q,children:d&&!T?"Corrigir Erros Primeiro":"Continuar para Prévia"})]})]})]})}function Ar(){const{validationResult:a,setCurrentStep:n}=js(),[s,r]=g.useState("processos"),t=g.useMemo(()=>{if(!a?.normalizedData)return{processos:[],testemunhas:[]};const o=Array.isArray(a.normalizedData.processos)?a.normalizedData.processos:[],j=Array.isArray(a.normalizedData.testemunhas)?a.normalizedData.testemunhas:[];return{processos:o.slice(0,10),testemunhas:j.slice(0,10)}},[a]),l=g.useMemo(()=>{if(!a?.normalizedData)return{processos:0,testemunhas:0};const o=Array.isArray(a.normalizedData.processos)?a.normalizedData.processos:[],j=Array.isArray(a.normalizedData.testemunhas)?a.normalizedData.testemunhas:[];return{processos:o.length,testemunhas:j.length}},[a]);if(!a||!a.normalizedData)return e.jsx(p,{children:e.jsxs(b,{className:"p-8 text-center",children:[e.jsx(re,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Nenhum dado de validação disponível"}),e.jsx(y,{onClick:()=>n("validation"),variant:"outline",children:"Voltar para Validação"})]})});if(!(l.processos>0||l.testemunhas>0))return e.jsx(p,{children:e.jsxs(b,{className:"p-8 text-center",children:[e.jsx(re,{className:"h-12 w-12 mx-auto mb-4 text-warning"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Nenhum dado válido encontrado"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Não foi possível processar dados válidos do arquivo enviado."}),e.jsx(y,{onClick:()=>n("upload"),variant:"outline",children:"Enviar Novo Arquivo"})]})});const{summary:i}=a;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(p,{className:"text-center p-4",children:[e.jsx("div",{className:"text-2xl font-bold",children:i.valid.toLocaleString()}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Registros válidos"})]}),e.jsxs(p,{className:"text-center p-4",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[i.analyzed>0?Math.round(i.valid/i.analyzed*100):0,"%"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Taxa de sucesso"})]}),e.jsxs(p,{className:"text-center p-4",children:[e.jsx("div",{className:"text-2xl font-bold",children:i.errors+i.warnings}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Problemas detectados"})]})]}),e.jsxs(se,{className:"border-primary bg-primary/5",children:[e.jsx(je,{className:"h-4 w-4 text-primary"}),e.jsxs(ae,{className:"text-primary",children:[e.jsx("strong",{children:"Prévia da Importação:"})," ",i.valid," registros serão processados e inseridos na base de dados. Os dados passarão por validação final e normalização antes da inserção."]})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"Prévia dos Dados"]}),e.jsx(L,{children:"Amostra dos dados processados e normalizados (primeiros 10 registros)"})]}),e.jsx(b,{children:e.jsxs(ze,{value:s,onValueChange:r,children:[e.jsxs(Re,{className:"grid w-full grid-cols-2",children:[e.jsxs(J,{value:"processos",className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-4 w-4"}),"Por Processo (",l.processos,")"]}),e.jsxs(J,{value:"testemunhas",className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4"}),"Por Testemunha (",l.testemunhas,")"]})]}),e.jsx(X,{value:"processos",className:"mt-6",children:t.processos.length>0?e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs(we,{children:[e.jsx(_e,{children:e.jsxs(K,{children:[e.jsx(z,{children:"CNJ"}),e.jsx(z,{children:"Reclamante"}),e.jsx(z,{children:"Réu"}),e.jsx(z,{children:"Comarca"}),e.jsx(z,{children:"Status"}),e.jsx(z,{children:"Flags"})]})}),e.jsx(ve,{children:t.processos.map((o,j)=>{let m="N/A";if(o.cnj_digits&&String(o.cnj_digits).length>=8)m=`****-**.${String(o.cnj_digits).slice(-8,-4)}.*.**.****`;else if(o.cnj){const x=String(o.cnj);m=x.length>8?`****${x.slice(-8)}`:x}return e.jsxs(K,{children:[e.jsx(E,{className:"font-mono text-sm",children:m}),e.jsx(E,{children:o.reclamante_nome?o.reclamante_nome.length>25?o.reclamante_nome.substring(0,25)+"...":o.reclamante_nome:"N/A"}),e.jsx(E,{children:o.reu_nome?o.reu_nome.length>25?o.reu_nome.substring(0,25)+"...":o.reu_nome:"N/A"}),e.jsx(E,{children:o.comarca||"N/A"}),e.jsx(E,{children:e.jsx(P,{variant:"secondary",children:"Pronto para importar"})}),e.jsx(E,{children:e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[o.triangulacao_confirmada&&e.jsx(P,{variant:"outline",className:"text-xs",children:"Triangulação"}),o.troca_direta&&e.jsx(P,{variant:"outline",className:"text-xs",children:"Troca Direta"}),o.prova_emprestada&&e.jsx(P,{variant:"outline",className:"text-xs",children:"Prova Emprestada"})]})})]},j)})})]})}):e.jsxs(se,{children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(ae,{children:"Nenhum processo válido encontrado para prévia."})]})}),e.jsx(X,{value:"testemunhas",className:"mt-6",children:t.testemunhas.length>0?e.jsx("div",{className:"border rounded-lg overflow-x-auto",children:e.jsxs(we,{children:[e.jsx(_e,{children:e.jsxs(K,{children:[e.jsx(z,{children:"Nome da Testemunha"}),e.jsx(z,{children:"Qtd. Depoimentos"}),e.jsx(z,{children:"CNJs como Testemunha"}),e.jsx(z,{children:"Reclamante"}),e.jsx(z,{children:"Flags"})]})}),e.jsx(ve,{children:t.testemunhas.map((o,j)=>{const m=typeof o.qtd_depoimentos=="number"?o.qtd_depoimentos:parseInt(String(o.qtd_depoimentos||"0"),10)||0;let x="N/A";return o.cnjs_como_testemunha&&(Array.isArray(o.cnjs_como_testemunha)?x=`${o.cnjs_como_testemunha.length} CNJs`:x="1 CNJ"),e.jsxs(K,{children:[e.jsx(E,{className:"font-medium",children:o.nome_testemunha||o.nome_civil||"N/A"}),e.jsx(E,{children:e.jsx(P,{variant:"outline",children:m})}),e.jsx(E,{className:"max-w-xs",children:e.jsx("div",{className:"text-sm text-muted-foreground truncate",children:x})}),e.jsx(E,{children:o.reclamante_nome?o.reclamante_nome.length>25?o.reclamante_nome.substring(0,25)+"...":o.reclamante_nome:"N/A"}),e.jsx(E,{children:e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[o.e_prova_emprestada&&e.jsx(P,{variant:"outline",className:"text-xs text-warning",children:"Prova Emprestada"}),m>10&&e.jsx(P,{variant:"outline",className:"text-xs text-primary",children:"Alta Frequência"})]})})]},j)})})]})}):e.jsxs(se,{children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(ae,{children:"Nenhuma testemunha válida encontrada para prévia."})]})})]})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(y,{variant:"outline",onClick:()=>n("validation"),children:"Voltar para Validação"}),e.jsx(y,{onClick:()=>n("publish"),className:"bg-success hover:bg-success/90",disabled:i.errors>0||i.valid===0,children:"Publicar Nova Versão"})]})]})}function Er(){const{session:a,file:n,validationResult:s,resetWizard:r,isProcessing:t,setIsProcessing:l,uploadProgress:c,setUploadProgress:i}=js(),[o,j]=g.useState(!1),[m,x]=g.useState(null),f=async(v=0)=>{if(!(!n||!s||!a)){l(!0),i(0);try{const{data:{session:h}}=await R.auth.getSession();if(!h?.access_token)throw new Error("Sem sessão");i(10);const{data:d,error:C}=await R.functions.invoke("create-version",{headers:{"x-retry-count":v.toString()}});if(C)throw new Error("Falha ao criar nova versão: "+C.message);if(!d||!d.versionId)throw new Error("Resposta inválida da criação de versão: "+JSON.stringify(d));const T=s.normalizedData?.processos||[],q=s.normalizedData?.testemunhas||[];if(T.length===0&&q.length===0)throw new Error("Nenhum dado válido encontrado para importação. Verifique se o arquivo contém dados no formato correto.");i(30);const $=R.functions.invoke("import-into-version",{body:{versionId:d.versionId,processos:T,testemunhas:q,fileChecksum:h?.user?.id||"unknown",filename:n.name}}),S=new Promise((Z,I)=>setTimeout(()=>I(new Error("Timeout na importação - arquivo muito grande ou conexão lenta")),48e4)),{data:k,error:A}=await Promise.race([$,S]);if(A){if((A.message?.includes("timeout")||A.message?.includes("network")||A.message?.includes("504")||A.message?.includes("502"))&&v<2)return F({title:"Conectividade instável",description:`Tentativa ${v+1}/3 - Tentando novamente...`}),await new Promise(Z=>setTimeout(Z,5e3)),f(v+1);throw new Error("Falha na importação: "+A.message)}if(!k||!k.summary)throw new Error("Resposta inválida da importação");i(80);const{data:O,error:U}=await R.functions.invoke("publish-version",{body:{versionId:d.versionId}});if(U)throw new Error("Falha ao publicar versão: "+U.message);i(100),x({...k,version:{id:d.versionId,number:d.number,publishedAt:O.publishedAt}}),j(!0),F({title:"Versão publicada com sucesso!",description:`Versão v${d.number} com ${k.summary?.imported||0} registros`}),localStorage.setItem("import_completed",Date.now().toString()),window.dispatchEvent(new Event("storage"))}catch(h){let N=h instanceof Error?h.message:"Falha ao publicar dados",d="Erro na publicação";h instanceof Error&&N?.includes("timeout")?(d="Timeout na operação",N="A operação demorou muito para completar. Tente novamente com um arquivo menor ou verifique sua conexão."):h instanceof Error&&N?.includes("504")&&(d="Servidor sobrecarregado",N="O servidor está processando muitos dados. Aguarde um momento e tente novamente."),F({title:d,description:N,variant:"destructive"})}finally{l(!1)}}},u=()=>{r(),F({title:"Nova importação iniciada",description:"Você pode fazer upload de um novo arquivo"})};return!a||!n||!s?e.jsxs(se,{variant:"destructive",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(ae,{children:"Dados da sessão não encontrados. Volte ao início do processo."})]}):o&&m?e.jsxs(p,{children:[e.jsxs(w,{className:"text-center",children:[e.jsxs(_,{className:"flex items-center justify-center gap-2 text-success",children:[e.jsx(ut,{className:"h-6 w-6"}),"Importação Concluída!"]}),e.jsx(L,{children:"Os dados foram importados com sucesso na base de dados"})]}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs(se,{className:"border-success bg-success/5",children:[e.jsx(Q,{className:"h-4 w-4 text-success"}),e.jsx(ae,{className:"text-success",children:"✅ Importação realizada com sucesso! Os dados estão agora disponíveis para consulta."})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Resumo da Importação:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Arquivo:"})," ",n.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Tamanho:"})," ",(n.size/1024/1024).toFixed(2)," ","MB"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Registros importados:"}),e.jsx("span",{className:"text-success font-semibold ml-1",children:m.summary?.valid_rows||s.summary.valid})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Taxa de sucesso:"}),e.jsx("span",{className:"text-success ml-1",children:s.summary.analyzed>0?`${Math.round(s.summary.valid/s.summary.analyzed*100)}%`:"0%"})]})]}),m.version&&e.jsx("div",{className:"mt-4 p-3 bg-success/10 rounded-lg border border-success/20",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Versão:"})," v",m.version.number]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ID da versão:"})," ",m.version.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Publicada em:"})," ",new Date(m.version.publishedAt).toLocaleString("pt-BR")]})]})}),m.summary&&e.jsx("div",{className:"mt-4 p-3 bg-primary/10 rounded-lg",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Processos:"})," ",m.summary.processos_count||m.imported||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Testemunhas:"})," ",m.summary.testemunhas_count||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Stubs criados:"})," ",m.summary.stubs_created||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Flags detectadas:"})," ",m.summary.flags_detected||0]})]})})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(y,{onClick:u,className:"flex-1",children:"Nova Importação"}),e.jsx(y,{variant:"outline",onClick:()=>window.location.href="/admin/versoes",className:"flex-1",children:"Ver Versões"})]})]})]}):e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5"}),"Publicar Nova Versão"]}),e.jsx(L,{children:"Confirme a publicação da nova versão da base de dados"})]}),e.jsx(b,{children:e.jsx("div",{className:"space-y-6",children:t?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Oe,{className:"h-12 w-12 animate-spin mx-auto mb-4 text-primary"}),e.jsx("p",{className:"font-medium",children:"Publicando base de dados..."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Processando e importando todos os registros. Isso pode levar alguns minutos."}),e.jsxs("div",{className:"mt-4",children:[e.jsx(ds,{value:c,className:"w-full"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:c<100?`Processando... ${Math.round(c)}%`:"Finalizando..."})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(se,{children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(ae,{children:"Esta ação irá importar os dados validados para a base ativa. Todas as consultas passarão a incluir os novos registros."})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Resumo da Importação:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Arquivo:"})," ",n.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Tamanho:"})," ",(n.size/1024/1024).toFixed(2)," MB"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Registros válidos:"}),e.jsx("span",{className:"text-success font-semibold ml-1",children:s.summary.valid.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Problemas:"}),e.jsx("span",{className:"text-warning ml-1",children:s.summary.errors+s.summary.warnings}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(",s.summary.errors," erros,"," ",s.summary.warnings," avisos)"]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-gradient-to-r from-success/10 to-primary/10 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Qualidade dos Dados:"}),e.jsx("span",{className:"text-sm font-bold text-success",children:s.summary.analyzed>0?`${Math.round(s.summary.valid/s.summary.analyzed*100)}% aprovado`:"0% aprovado"})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(y,{variant:"outline",onClick:()=>window.history.back(),children:"Cancelar"}),e.jsx(y,{onClick:()=>f(),disabled:s.summary.errors>0||s.summary.valid===0,className:"bg-success hover:bg-success/90",children:"Confirmar Publicação"})]})]})})})]})}function kr({progress:a,stage:n,stats:s={}}){const t=(()=>{switch(n){case"validating":return{title:"Validando dados",description:"Verificando estrutura e qualidade dos dados",icon:e.jsx(re,{className:"h-4 w-4 text-warning"})};case"creating-version":return{title:"Criando nova versão",description:"Preparando ambiente para importação",icon:e.jsx(De,{className:"h-4 w-4 text-primary"})};case"importing":return{title:"Importando dados",description:"Processando e salvando registros na base de dados",icon:e.jsx(Te,{className:"h-4 w-4 text-primary animate-spin"})};case"publishing":return{title:"Publicando versão",description:"Ativando nova versão da base de dados",icon:e.jsx(Q,{className:"h-4 w-4 text-success"})};case"completed":return{title:"Importação concluída",description:"Todos os dados foram processados com sucesso",icon:e.jsx(Q,{className:"h-4 w-4 text-success"})};default:return{title:"Processando...",description:"Aguarde",icon:e.jsx(Te,{className:"h-4 w-4 text-muted-foreground"})}}})();return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.icon,e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]}),e.jsxs(P,{variant:a===100?"default":"secondary",children:[Math.round(a),"%"]})]}),e.jsx(ds,{value:a,className:"w-full"}),(s.total||s.processed||s.errors)&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[s.total&&e.jsxs("div",{className:"bg-muted/50 p-2 rounded text-center",children:[e.jsx("div",{className:"font-medium",children:s.total.toLocaleString()}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total"})]}),s.processed&&e.jsxs("div",{className:"bg-success/10 p-2 rounded text-center border border-success/20",children:[e.jsx("div",{className:"font-medium text-success",children:s.processed.toLocaleString()}),e.jsx("div",{className:"text-xs text-success/80",children:"Processados"})]}),s.errors!==void 0&&e.jsxs("div",{className:"bg-destructive/10 p-2 rounded text-center border border-destructive/20",children:[e.jsx("div",{className:"font-medium text-destructive",children:s.errors.toLocaleString()}),e.jsx("div",{className:"text-xs text-destructive/80",children:"Erros"})]}),s.warnings!==void 0&&e.jsxs("div",{className:"bg-warning/10 p-2 rounded text-center border border-warning/20",children:[e.jsx("div",{className:"font-medium text-warning",children:s.warnings.toLocaleString()}),e.jsx("div",{className:"text-xs text-warning/80",children:"Avisos"})]})]}),n==="importing"&&s.processed&&s.total&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center",children:["Processando registros... (",s.processed.toLocaleString()," de"," ",s.total.toLocaleString(),")"]})]})}const gs=[{id:"upload",label:"Upload",icon:Ca},{id:"validation",label:"Validação",icon:_s},{id:"preview",label:"Prévia",icon:je},{id:"publish",label:"Publicação",icon:Q}];function Dr(){const{currentStep:a,session:n,file:s,validationResult:r,isProcessing:t,uploadProgress:l}=js(),c=g.useCallback(o=>{const j=gs.findIndex(x=>x.id===a),m=gs.findIndex(x=>x.id===o);return m<j?"completed":m===j?"current":"pending"},[a]),i=()=>{switch(a){case"upload":return e.jsx(xr,{});case"validation":return n&&s?e.jsx(Pr,{}):null;case"preview":return n&&r?e.jsx(Ar,{}):null;case"publish":return n&&r?e.jsx(Er,{}):null;default:return null}};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Importação de Dados"}),e.jsx("p",{className:"text-muted-foreground",children:"Pipeline completo de análise de testemunhas e processos com detecção de padrões"})]}),e.jsx(p,{children:e.jsx(b,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:gs.map((o,j)=>{const m=c(o.id),x=j===gs.length-1;return e.jsxs(Qs.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center border-2 transition-colors ${m==="completed"?"bg-success border-success text-success-foreground":m==="current"?"bg-primary border-primary text-primary-foreground":"bg-muted border-border text-muted-foreground"}`,children:m==="completed"?e.jsx(Q,{className:"h-6 w-6"}):e.jsx(o.icon,{className:"h-6 w-6"})}),e.jsx("div",{className:"mt-3 text-center",children:e.jsx("p",{className:`text-sm font-medium ${m==="current"?"text-primary":"text-muted-foreground"}`,children:o.label})})]}),!x&&e.jsx("div",{className:`flex-1 h-px mx-4 ${m==="completed"?"bg-success":"bg-border"}`})]},o.id)})})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:i()}),e.jsxs("div",{className:"space-y-4",children:[t&&a==="publish"&&e.jsxs(p,{className:"border-primary/20 bg-primary/5",children:[e.jsx(w,{className:"pb-3",children:e.jsxs(_,{className:"text-sm flex items-center gap-2 text-primary",children:[e.jsx(Oe,{className:"h-4 w-4 animate-spin"}),"Progresso da Importação"]})}),e.jsx(b,{children:e.jsx(kr,{progress:l,stage:l<30?"importing":l<80?"creating-version":"publishing",stats:{total:r?.summary?.analyzed||0,processed:Math.floor(l/100*(r?.summary?.valid||0)),errors:r?.summary?.errors||0,warnings:r?.summary?.warnings||0}})})]}),e.jsxs(p,{className:"border-amber-200 bg-amber-50 dark:bg-amber-950",children:[e.jsx(w,{className:"pb-3",children:e.jsxs(_,{className:"text-sm flex items-center gap-2 text-amber-800 dark:text-amber-200",children:[e.jsx(ht,{className:"h-4 w-4"}),"Compliance LGPD"]})}),e.jsxs(b,{className:"text-xs text-amber-700 dark:text-amber-300 space-y-2",children:[e.jsxs("p",{children:["🔒 ",e.jsx("strong",{children:"Dados mascarados:"})," CPFs e informações sensíveis são automaticamente mascarados para proteção."]}),e.jsxs("p",{children:["⚠️ ",e.jsx("strong",{children:"Validação obrigatória:"})," Confirmação nos autos é obrigatória antes de decisões."]})]})]}),e.jsxs(p,{children:[e.jsx(w,{className:"pb-3",children:e.jsx(_,{className:"text-sm",children:"Template"})}),e.jsx(b,{children:e.jsxs(y,{variant:"outline",size:"sm",className:"w-full",onClick:()=>{const o=document.createElement("a");o.href="/template-base-exemplo.csv",o.download="template-base-exemplo.csv",document.body.appendChild(o),o.click(),document.body.removeChild(o)},children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Baixar Template"]})})]})]})]})]})}const Tr=()=>e.jsx(Dr,{}),vn=Object.freeze(Object.defineProperty({__proto__:null,default:Tr},Symbol.toStringTag,{value:"Module"})),zr=()=>{const[a,n]=g.useState([]),[s,r]=g.useState(!0),[t,l]=g.useState(null),{user:c}=xe(),{toast:i}=He();g.useEffect(()=>{c&&o()},[c]);const o=async()=>{try{r(!0);const{data:u,error:v}=await R.from("versions").select("*").order("number",{ascending:!1});if(v)throw v;n(u||[]),l(u?.find(h=>h.status==="published")||null)}catch(u){console.error("Error fetching versions:",u),i({title:"Erro",description:"Falha ao carregar versões",variant:"destructive"})}finally{r(!1)}},j=u=>new Date(u).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),m=async u=>{try{const{error:v}=await R.functions.invoke("publish-version",{body:{versionId:u}});if(v)throw v;i({title:"Sucesso",description:"Versão publicada com sucesso"}),o()}catch(v){console.error("Error publishing version:",v),i({title:"Erro",description:"Falha ao publicar versão",variant:"destructive"})}},x=async(u,v)=>{try{const{error:h}=await R.functions.invoke("rollback-version",{body:{toVersionId:u}});if(h)throw h;i({title:"Sucesso",description:`Rollback para v${v} realizado com sucesso`}),o()}catch(h){console.error("Error rolling back:",h),i({title:"Erro",description:"Falha ao realizar rollback",variant:"destructive"})}},f=(u,v)=>{if(v&&u==="published")return e.jsx(P,{className:"bg-success text-success-foreground",children:"ATIVA"});switch(u){case"draft":return e.jsx(P,{variant:"secondary",children:"RASCUNHO"});case"published":case"archived":return e.jsx(P,{variant:"outline",children:"ARQUIVADA"});default:return e.jsx(P,{variant:"secondary",children:u?.toUpperCase()})}};return s?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Versões & Rollback"}),e.jsx("p",{className:"text-muted-foreground",children:"Carregando versões..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Versões & Rollback"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie versões da base de dados e execute rollbacks quando necessário"})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(jt,{className:"h-5 w-5"}),"Histórico de Versões"]}),e.jsx(L,{children:"Lista de todas as versões criadas e seus status"})]}),e.jsx(b,{children:e.jsxs(we,{children:[e.jsx(_e,{children:e.jsxs(K,{children:[e.jsx(z,{children:"Versão"}),e.jsx(z,{children:"Hash"}),e.jsx(z,{children:"Status"}),e.jsx(z,{children:"Registros"}),e.jsx(z,{children:"Criada em"}),e.jsx(z,{children:"Autor"}),e.jsx(z,{children:"Ações"})]})}),e.jsx(ve,{children:a.length>0?a.map(u=>e.jsxs(K,{children:[e.jsxs(E,{className:"font-medium",children:["v",u.number]}),e.jsx(E,{children:e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:u.file_checksum?.slice(0,8)||"N/A"})}),e.jsx(E,{children:f(u.status,u.status==="published")}),e.jsx(E,{children:u.summary?.imported?.toLocaleString()||"N/A"}),e.jsx(E,{children:j(u.created_at)}),e.jsx(E,{children:u.summary?.created_by||"Sistema"}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{variant:"ghost",size:"sm",title:"Visualizar",children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",title:"Baixar",children:e.jsx(be,{className:"h-4 w-4"})}),u.status==="draft"&&e.jsx(y,{variant:"ghost",size:"sm",className:"text-success hover:text-success/80",onClick:()=>m(u.id),title:"Publicar versão",children:e.jsx(Q,{className:"h-4 w-4"})}),u.status==="archived"&&e.jsx(y,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80",onClick:()=>x(u.id,u.number),title:"Fazer rollback",children:e.jsx(is,{className:"h-4 w-4"})})]})})]},u.id)):e.jsx(K,{children:e.jsx(E,{colSpan:7,className:"text-center text-muted-foreground",children:"Nenhuma versão encontrada"})})})]})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Versão Ativa"}),e.jsx(L,{children:"Informações da versão atualmente em produção"})]}),e.jsx(b,{children:t?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Versão:"}),e.jsxs(P,{className:"bg-success text-success-foreground",children:["v",t.number]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Hash:"}),e.jsx("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:t.file_checksum?.slice(0,8)||"N/A"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Registros:"}),e.jsx("span",{className:"text-sm",children:t.summary?.imported?.toLocaleString()||"N/A"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Publicada em:"}),e.jsx("span",{className:"text-sm",children:j(t.published_at)})]})]}):e.jsx("div",{className:"text-center text-muted-foreground py-4",children:"Nenhuma versão ativa encontrada"})})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Ações Rápidas"}),e.jsx(L,{children:"Operações frequentes com versões"})]}),e.jsxs(b,{className:"space-y-3",children:[e.jsxs(y,{variant:"outline",className:"w-full justify-start",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Baixar Versão Ativa"]}),e.jsxs(y,{variant:"outline",className:"w-full justify-start",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Comparar Versões"]}),a.find(u=>u.status==="archived")&&e.jsxs(y,{variant:"outline",className:"w-full justify-start text-primary hover:text-primary/80",onClick:()=>{const u=a.find(v=>v.status==="archived");u&&x(u.id,u.number)},children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"Rollback Disponível"]})]})]})]})]})},Nn=Object.freeze(Object.defineProperty({__proto__:null,default:zr},Symbol.toStringTag,{value:"Module"})),Rr=({user:a,isOpen:n,onClose:s,onRoleChange:r,loading:t})=>{const[l,c]=g.useState("VIEWER"),[i,o]=g.useState("NONE");Qs.useEffect(()=>{a&&(c(a.role),o(a.data_access_level))},[a]);const j=async()=>{a&&(await r(a.user_id,l,i),s())};if(!a)return null;const m=f=>{switch(f){case"ADMIN":return"Acesso completo ao sistema, pode gerenciar usuários e configurações";case"ANALYST":return"Pode analisar dados, criar relatórios e fazer análises";case"VIEWER":return"Visualização limitada conforme nível de acesso aos dados";default:return""}},x=f=>{switch(f){case"FULL":return"Acesso completo a todos os dados, incluindo informações sensíveis";case"MASKED":return"Acesso aos dados com informações pessoais mascaradas";case"NONE":return"Sem acesso a dados pessoais ou sensíveis";default:return""}};return e.jsx($e,{open:n,onOpenChange:s,children:e.jsxs(Ue,{className:"sm:max-w-[425px]",children:[e.jsxs(Ee,{children:[e.jsxs(ke,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5"}),"Alterar Papel e Acesso"]}),e.jsxs(ms,{children:["Configurar papel e nível de acesso aos dados para"," ",e.jsx("strong",{children:a.email})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{children:"Papel Atual"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{variant:a.role==="ADMIN"?"destructive":a.role==="ANALYST"?"default":"secondary",children:a.role}),e.jsx(P,{variant:"outline",children:a.data_access_level})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"role",children:"Novo Papel"}),e.jsxs(ne,{value:l,onValueChange:f=>c(f),children:[e.jsx(ie,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(V,{value:"VIEWER",children:"Visualizador"}),e.jsx(V,{value:"ANALYST",children:"Analista"}),e.jsx(V,{value:"ADMIN",children:"Administrador"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m(l)})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(M,{htmlFor:"dataAccess",children:"Nível de Acesso aos Dados"}),e.jsxs(ne,{value:i,onValueChange:f=>o(f),children:[e.jsx(ie,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(V,{value:"NONE",children:"Sem Acesso"}),e.jsx(V,{value:"MASKED",children:"Dados Mascarados"}),e.jsx(V,{value:"FULL",children:"Acesso Completo"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x(i)})]}),(l!==a.role||i!==a.data_access_level)&&e.jsx("div",{className:"p-3 bg-warning/10 border border-warning/20 rounded-md",children:e.jsxs("p",{className:"text-sm text-warning-foreground",children:[e.jsx("strong",{children:"Atenção:"})," Estas alterações entrarão em vigor imediatamente e afetarão o acesso do usuário ao sistema."]})})]}),e.jsxs(Zs,{children:[e.jsx(y,{variant:"outline",onClick:s,disabled:t,children:"Cancelar"}),e.jsxs(y,{onClick:j,disabled:t||l===a.role&&i===a.data_access_level,children:[t&&e.jsx(Ae,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirmar Alteração"]})]})]})})},Ir=({isOpen:a,onClose:n,onConfirm:s,title:r,description:t,confirmText:l="Confirmar",variant:c="default",loading:i=!1})=>e.jsx(ea,{open:a,onOpenChange:n,children:e.jsxs(sa,{children:[e.jsxs(aa,{children:[e.jsx(ta,{children:r}),e.jsx(ra,{children:t})]}),e.jsxs(na,{children:[e.jsx(ia,{disabled:i,children:"Cancelar"}),e.jsxs(As,{onClick:s,disabled:i,className:c==="destructive"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"",children:[i&&e.jsx(Ae,{className:"mr-2 h-4 w-4 animate-spin"}),l]})]})]})}),Lr=()=>{const{profile:a}=xe(),[n,s]=g.useState(!1),[r,t]=g.useState(""),[l,c]=g.useState("VIEWER"),[i,o]=g.useState("NONE"),[j,m]=g.useState(!0),[x,f]=g.useState(!1),[u,v]=g.useState(!1),[h,N]=g.useState(null),[d,C]=g.useState([]),[T,q]=g.useState([]),[$,S]=g.useState(""),[k,A]=g.useState("all"),[O,U]=g.useState("all"),[Z,I]=g.useState(null),[le,ee]=g.useState(!1),[G,pe]=g.useState(null);g.useEffect(()=>{a?.organization_id&&(ue(),Ce())},[a?.organization_id]);const ue=async()=>{try{const{data:D,error:Y}=await R.from("organizations").select("*").eq("id",a?.organization_id).single();if(Y)throw Y;N(D)}catch{F({title:"Erro",description:"Não foi possível carregar dados da organização",variant:"destructive"})}finally{m(!1)}},Ce=async()=>{try{const{data:D,error:Y}=await R.from("profiles").select("*").eq("organization_id",a?.organization_id).order("created_at",{ascending:!1});if(Y)throw Y;C(D||[]),q(D||[])}catch{F({title:"Erro",description:"Não foi possível carregar usuários",variant:"destructive"})}};g.useEffect(()=>{let D=d;$&&(D=D.filter(Y=>Y.email.toLowerCase().includes($.toLowerCase())||Y.user_id.toLowerCase().includes($.toLowerCase()))),k!=="all"&&(D=D.filter(Y=>k==="active"?Y.is_active:!Y.is_active)),O!=="all"&&(D=D.filter(Y=>Y.role===O)),q(D)},[d,$,k,O]);const Qe=async()=>{if(!(!h||!a?.organization_id)){f(!0);try{const{error:D}=await R.from("organizations").update({name:h.name,domain:h.domain,require_2fa:h.require_2fa,export_limit:h.export_limit,retention_months:h.retention_months}).eq("id",a.organization_id);if(D)throw D;F({title:"Sucesso",description:"Dados da organização salvos com sucesso"})}catch{F({title:"Erro",description:"Não foi possível salvar os dados",variant:"destructive"})}finally{f(!1)}}},Be=async()=>{if(!(!r||!a?.organization_id)){v(!0);try{if(h?.domain&&r.split("@")[1]!==h.domain){F({title:"Erro",description:`E-mail deve ser do domínio ${h.domain}`,variant:"destructive"});return}const{error:D}=await R.functions.invoke("user-invitations",{body:{email:r,role:l,data_access_level:i,org_id:a.organization_id}});if(D)throw D;F({title:"Convite enviado",description:`Convite enviado para ${r} com perfil ${l}`}),s(!1),t(""),c("VIEWER"),o("NONE")}catch(D){const Y=D instanceof Error?D.message:"Não foi possível enviar o convite";F({title:"Erro",description:Y,variant:"destructive"})}finally{v(!1)}}},Je=async(D,Y)=>{v(!0);try{const{data:Le,error:Se}=await R.functions.invoke("manage-user-roles",{body:{action:D,user_id:Y}});if(Se)throw Se;F({title:"Sucesso",description:Le.message}),await Ce()}catch(Le){const Se=Le instanceof Error?Le.message:"Não foi possível executar a ação";F({title:"Erro",description:Se,variant:"destructive"})}finally{v(!1),pe(null)}},Ls=async(D,Y,Le)=>{v(!0);try{const{data:Se,error:ps}=await R.functions.invoke("manage-user-roles",{body:{action:"change_role",user_id:D,role:Y,data_access_level:Le}});if(ps)throw ps;F({title:"Sucesso",description:Se.message}),await Ce()}catch(Se){const ps=Se instanceof Error?Se.message:"Não foi possível alterar o papel";F({title:"Erro",description:ps,variant:"destructive"})}finally{v(!1)}},B=(D,Y)=>{const Le={activate:{title:"Ativar Usuário",description:`Tem certeza que deseja ativar o usuário ${D.email}? Ele poderá acessar o sistema novamente.`},deactivate:{title:"Desativar Usuário",description:`Tem certeza que deseja desativar o usuário ${D.email}? Ele perderá acesso ao sistema.`},delete:{title:"Revogar Acesso",description:`Tem certeza que deseja revogar completamente o acesso de ${D.email}? Esta ação não pode ser desfeita.`}};pe({user:D,action:Y,...Le[Y]})};if(j)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(Ae,{className:"h-8 w-8 animate-spin"})});if(!h)return e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"Não foi possível carregar dados da organização"})});const W=D=>{switch(D){case"ADMIN":return e.jsx(P,{className:"bg-destructive text-destructive-foreground",children:"Admin"});case"ANALYST":return e.jsx(P,{className:"bg-primary text-primary-foreground",children:"Analista"});case"VIEWER":return e.jsx(P,{variant:"secondary",children:"Visualizador"});default:return e.jsx(P,{variant:"outline",children:D})}},Ie=D=>D?e.jsx(P,{className:"bg-success text-success-foreground",children:"Ativo"}):e.jsx(P,{variant:"secondary",children:"Inativo"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Organização & Acessos"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie dados da organização, usuários e políticas de acesso"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Cs,{className:"h-5 w-5"}),"Dados da Organização"]}),e.jsx(L,{children:"Informações básicas e configurações da organização"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"orgName",children:"Nome da Organização"}),e.jsx(H,{id:"orgName",value:h.name,onChange:D=>N({...h,name:D.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"orgCode",children:"Código"}),e.jsx(H,{id:"orgCode",value:h.code,disabled:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"domain",children:"Domínio Permitido"}),e.jsx(H,{id:"domain",value:h.domain||"",placeholder:"exemplo.com",onChange:D=>N({...h,domain:D.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"retention",children:"Retenção de Dados (meses)"}),e.jsx(H,{id:"retention",type:"number",value:h.retention_months,onChange:D=>N({...h,retention_months:parseInt(D.target.value)})})]}),e.jsxs(y,{className:"w-full",onClick:Qe,disabled:x,children:[x&&e.jsx(Ae,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvar Alterações"]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Políticas de Segurança"}),e.jsx(L,{children:"Configure políticas de acesso e segurança"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(M,{children:"Exigir Autenticação 2FA"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Obrigatório para todos os usuários"})]}),e.jsx(xs,{checked:h.require_2fa,onCheckedChange:D=>N({...h,require_2fa:D})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Limite de Export"}),e.jsxs(ne,{value:h.export_limit,onValueChange:D=>N({...h,export_limit:D}),children:[e.jsx(ie,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(V,{value:"ROLE_BASED",children:"Baseado no Papel"}),e.jsx(V,{value:"UNLIMITED",children:"Ilimitado"}),e.jsx(V,{value:"RESTRICTED",children:"Restrito"})]})]})]}),e.jsxs("div",{className:"pt-4 space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Limites por Papel:"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"VIEWER:"}),e.jsx("span",{children:"Copiar bloco"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ANALYST:"}),e.jsx("span",{children:"Export CSV"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ADMIN:"}),e.jsx("span",{children:"PDF/CSV completo"})]})]})]})]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-5 w-5"}),"Usuários & Acessos"]}),e.jsxs($e,{open:n,onOpenChange:s,children:[e.jsx(oa,{asChild:!0,children:e.jsxs(y,{children:[e.jsx(Ys,{className:"h-4 w-4 mr-2"}),"Convidar Usuário"]})}),e.jsxs(Ue,{children:[e.jsxs(Ee,{children:[e.jsx(ke,{children:"Convidar Novo Usuário"}),e.jsx(ms,{children:"Envie um convite para um novo usuário com papel específico"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{htmlFor:"email",children:"E-mail"}),e.jsx(H,{id:"email",type:"email",value:r,onChange:D=>t(D.target.value),placeholder:"usuario@exemplo.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Papel Inicial"}),e.jsxs(ne,{value:l,onValueChange:D=>c(D),children:[e.jsx(ie,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(V,{value:"VIEWER",children:"Visualizador"}),e.jsx(V,{value:"ANALYST",children:"Analista"}),e.jsx(V,{value:"ADMIN",children:"Administrador"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"Nível de Acesso aos Dados"}),e.jsxs(ne,{value:i,onValueChange:D=>o(D),children:[e.jsx(ie,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(V,{value:"NONE",children:"Sem Acesso"}),e.jsx(V,{value:"MASKED",children:"Dados Mascarados"}),e.jsx(V,{value:"FULL",children:"Acesso Completo"})]})]})]})]}),e.jsxs(Zs,{children:[e.jsx(y,{variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),e.jsxs(y,{onClick:Be,disabled:u,children:[u&&e.jsx(Ae,{className:"h-4 w-4 mr-2 animate-spin"}),!u&&e.jsx(pt,{className:"h-4 w-4 mr-2"}),"Enviar Convite"]})]})]})]})]}),e.jsx(L,{children:"Gerencie usuários, papéis e status de acesso"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Aa,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(H,{placeholder:"Buscar por e-mail ou ID...",value:$,onChange:D=>S(D.target.value),className:"pl-10"})]})}),e.jsxs(ne,{value:k,onValueChange:D=>A(D),children:[e.jsx(ie,{className:"w-[150px]",children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(V,{value:"all",children:"Todos Status"}),e.jsx(V,{value:"active",children:"Ativos"}),e.jsx(V,{value:"inactive",children:"Inativos"})]})]}),e.jsxs(ne,{value:O,onValueChange:D=>U(D),children:[e.jsx(ie,{className:"w-[150px]",children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(V,{value:"all",children:"Todos Papéis"}),e.jsx(V,{value:"ADMIN",children:"Admin"}),e.jsx(V,{value:"ANALYST",children:"Analista"}),e.jsx(V,{value:"VIEWER",children:"Visualizador"})]})]})]}),e.jsxs(we,{children:[e.jsx(_e,{children:e.jsxs(K,{children:[e.jsx(z,{children:"Usuário"}),e.jsx(z,{children:"E-mail"}),e.jsx(z,{children:"Papel & Acesso"}),e.jsx(z,{children:"Status"}),e.jsx(z,{children:"Último Acesso"}),e.jsx(z,{children:"Ações"})]})}),e.jsx(ve,{children:T.length===0?e.jsx(K,{children:e.jsx(E,{colSpan:6,className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:$||k!=="all"||O!=="all"?"Nenhum usuário encontrado com os filtros aplicados":"Nenhum usuário encontrado"})})}):T.map(D=>e.jsxs(K,{children:[e.jsx(E,{className:"font-medium",children:D.email.split("@")[0]}),e.jsx(E,{children:D.email}),e.jsx(E,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[W(D.role),e.jsx(P,{variant:"outline",className:"text-xs",children:D.data_access_level})]})}),e.jsx(E,{children:Ie(D.is_active)}),e.jsx(E,{children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:["Criado:"," ",new Date(D.created_at).toLocaleDateString("pt-BR")]}),D.last_login_at&&e.jsxs("div",{className:"text-muted-foreground text-xs",children:["Login:"," ",new Date(D.last_login_at).toLocaleDateString("pt-BR")]})]})}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[D.is_active?e.jsx(y,{variant:"ghost",size:"sm",className:"text-destructive hover:text-destructive-foreground hover:bg-destructive/10",title:"Desativar usuário",onClick:()=>B(D,"deactivate"),disabled:u||D.user_id===a?.user_id,children:e.jsx(gt,{className:"h-4 w-4"})}):e.jsx(y,{variant:"ghost",size:"sm",title:"Ativar usuário",onClick:()=>B(D,"activate"),disabled:u,children:e.jsx(Ea,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary-foreground hover:bg-primary/10",title:"Alterar papel",onClick:()=>{I(D),ee(!0)},disabled:u,children:e.jsx(fe,{className:"h-4 w-4"})})]})})]},D.id))})]})]})]}),e.jsx(Rr,{user:Z,isOpen:le,onClose:()=>{ee(!1),I(null)},onRoleChange:Ls,loading:u}),G&&e.jsx(Ir,{isOpen:!!G,onClose:()=>pe(null),onConfirm:()=>Je(G.action,G.user.user_id),title:G.title,description:G.description,confirmText:G.action==="delete"?"Revogar Acesso":"Confirmar",variant:G.action==="deactivate"||G.action==="delete"?"destructive":"default",loading:u})]})},bn=Object.freeze(Object.defineProperty({__proto__:null,default:Lr},Symbol.toStringTag,{value:"Module"})),Ne=g.forwardRef(({className:a,...n},s)=>e.jsxs(ka,{ref:s,className:de("relative flex w-full touch-none select-none items-center",a),...n,children:[e.jsx(ft,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(vt,{className:"absolute h-full bg-primary"})}),e.jsx(Nt,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Ne.displayName=ka.displayName;const Or=()=>{const[a,n]=g.useState(6),[s,r]=g.useState(!0),[t,l]=g.useState({reclamante_foi_testemunha:30,troca_direta:40,triangulacao_confirmada:20,prova_emprestada:10}),[c,i]=g.useState({viewer_limit:50,analyst_limit:1e3,admin_limit:-1}),o=()=>{F({title:"Configurações salvas",description:"Os parâmetros do sistema foram atualizados com sucesso"})},j=()=>{n(6),r(!0),l({reclamante_foi_testemunha:30,troca_direta:40,triangulacao_confirmada:20,prova_emprestada:10}),F({title:"Configurações restauradas",description:"Parâmetros voltaram aos valores padrão"})},m=Object.values(t).reduce((x,f)=>x+f,0);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Parâmetros & Regras"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure parâmetros globais do sistema e regras de negócio"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5"}),"Janela de Triangulação"]}),e.jsx(L,{children:"Período em meses considerado para análise de triangulação"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{children:["Meses: ",a]}),e.jsx(Ne,{value:[a],onValueChange:x=>n(x[0]),max:24,min:1,step:1}),e.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[e.jsx("span",{children:"1 mês"}),e.jsx("span",{children:"24 meses"})]})]}),e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Impacto:"})," Processos e testemunhas dentro de"," ",a," meses serão considerados para identificação de padrões suspeitos."]})})]})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5"}),"Configurações de Privacidade"]}),e.jsx(L,{children:"Controles de privacidade e proteção de dados"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(M,{children:"Máscara de CPF"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ocultar últimos dígitos do CPF"})]}),e.jsx(xs,{checked:s,onCheckedChange:r})]}),e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Exemplo:"})," ",s?"123.456.789-**":"123.456.789-00"]})})]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"h-5 w-5"}),"Pesos do Score de Risco"]}),e.jsx(L,{children:"Configure a importância de cada indicador no cálculo do score final"})]}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{children:["Reclamante foi Testemunha:"," ",t.reclamante_foi_testemunha,"%"]}),e.jsx(Ne,{value:[t.reclamante_foi_testemunha],onValueChange:x=>l(f=>({...f,reclamante_foi_testemunha:x[0]})),max:100,min:0,step:5})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{children:["Troca Direta: ",t.troca_direta,"%"]}),e.jsx(Ne,{value:[t.troca_direta],onValueChange:x=>l(f=>({...f,troca_direta:x[0]})),max:100,min:0,step:5})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{children:["Triangulação Confirmada:"," ",t.triangulacao_confirmada,"%"]}),e.jsx(Ne,{value:[t.triangulacao_confirmada],onValueChange:x=>l(f=>({...f,triangulacao_confirmada:x[0]})),max:100,min:0,step:5})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{children:["Prova Emprestada: ",t.prova_emprestada,"%"]}),e.jsx(Ne,{value:[t.prova_emprestada],onValueChange:x=>l(f=>({...f,prova_emprestada:x[0]})),max:100,min:0,step:5})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total dos pesos:"}),e.jsxs(P,{variant:m===100?"default":"destructive",children:[m,"%"]}),m!==100&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"(deve somar 100%)"})]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Limites de Export por Papel"}),e.jsx(L,{children:"Configure limites de exportação por tipo de usuário"})]}),e.jsx(b,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"VIEWER - Registros por export"}),e.jsx(H,{type:"number",value:c.viewer_limit,onChange:x=>i(f=>({...f,viewer_limit:parseInt(x.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"ANALYST - Registros por export"}),e.jsx(H,{type:"number",value:c.analyst_limit,onChange:x=>i(f=>({...f,analyst_limit:parseInt(x.target.value)||0}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{children:"ADMIN - Registros por export"}),e.jsxs(ne,{value:c.admin_limit===-1?"unlimited":"limited",onValueChange:x=>i(f=>({...f,admin_limit:x==="unlimited"?-1:1e4})),children:[e.jsx(ie,{children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(V,{value:"unlimited",children:"Ilimitado"}),e.jsx(V,{value:"limited",children:"Com limite"})]})]})]})]})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(y,{onClick:o,className:"flex items-center gap-2",children:[e.jsx(Da,{className:"h-4 w-4"}),"Salvar Configurações"]}),e.jsxs(y,{variant:"outline",onClick:j,className:"flex items-center gap-2",children:[e.jsx(is,{className:"h-4 w-4"}),"Restaurar Padrões"]})]})]})},yn=Object.freeze(Object.defineProperty({__proto__:null,default:Or},Symbol.toStringTag,{value:"Module"}));function Mr(){xe();const[a,n]=g.useState([]),[s,r]=g.useState([]),[t,l]=g.useState(!0),[c,i]=g.useState("all");g.useEffect(()=>{o()},[]);const o=async()=>{l(!0);try{const{data:u,error:v}=await R.from("lgpd_requests").select("*").order("created_at",{ascending:!1});v?console.error("Error fetching requests:",v):n(u||[]);const{data:h,error:N}=await R.from("data_access_logs").select("*").order("created_at",{ascending:!1}).limit(100);N?console.error("Error fetching logs:",N):r(h||[])}catch(u){console.error("Error fetching compliance data:",u),te.error("Erro ao carregar dados de compliance")}finally{l(!1)}},j=u=>{const v={PENDING:{variant:"secondary",icon:Te,text:"Pendente"},PROCESSING:{variant:"default",icon:je,text:"Processando"},COMPLETED:{variant:"default",icon:Q,text:"Concluída"},REJECTED:{variant:"destructive",icon:Hs,text:"Rejeitada"}},h=v[u]||v.PENDING,N=h.icon,d=u==="COMPLETED"?"bg-success text-success-foreground":"";return e.jsxs(P,{variant:h.variant,className:d,children:[e.jsx(N,{className:"h-3 w-3 mr-1"}),h.text]})},m=u=>({ACCESS:"Acesso aos Dados",RECTIFICATION:"Retificação",DELETION:"Exclusão",PORTABILITY:"Portabilidade"})[u]||u,x=c==="all"?a:a.filter(u=>u.status===c),f=async(u,v)=>{try{const{error:h}=await R.from("lgpd_requests").update({status:v,completed_at:v==="COMPLETED"?new Date().toISOString():null}).eq("id",u);if(h)throw h;te.success("Status atualizado com sucesso"),o()}catch(h){console.error("Error updating status:",h),te.error("Erro ao atualizar status")}};return t?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(fe,{className:"h-12 w-12 mx-auto mb-4 animate-pulse text-primary"}),e.jsx("p",{children:"Carregando dados de compliance..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(fe,{className:"h-8 w-8 text-primary"}),"Compliance LGPD"]}),e.jsx("p",{className:"text-muted-foreground",children:"Gestão de solicitações e logs de acesso conforme a Lei Geral de Proteção de Dados"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(p,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total de Solicitações"}),e.jsx("p",{className:"text-2xl font-bold",children:a.length})]}),e.jsx(ye,{className:"h-8 w-8 text-primary"})]})})}),e.jsx(p,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pendentes"}),e.jsx("p",{className:"text-2xl font-bold",children:a.filter(u=>u.status==="PENDING").length})]}),e.jsx(Te,{className:"h-8 w-8 text-orange-500"})]})})}),e.jsx(p,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Concluídas"}),e.jsx("p",{className:"text-2xl font-bold",children:a.filter(u=>u.status==="COMPLETED").length})]}),e.jsx(Q,{className:"h-8 w-8 text-success"})]})})}),e.jsx(p,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Logs de Acesso"}),e.jsx("p",{className:"text-2xl font-bold",children:s.length})]}),e.jsx(je,{className:"h-8 w-8 text-blue-500"})]})})})]}),e.jsxs(ze,{defaultValue:"requests",className:"space-y-4",children:[e.jsxs(Re,{children:[e.jsx(J,{value:"requests",children:"Solicitações LGPD"}),e.jsx(J,{value:"logs",children:"Logs de Acesso"}),e.jsx(J,{value:"settings",children:"Configurações"})]}),e.jsxs(X,{value:"requests",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ne,{value:c,onValueChange:i,children:[e.jsx(ie,{className:"w-48",children:e.jsx(oe,{placeholder:"Filtrar por status"})}),e.jsxs(ce,{children:[e.jsx(V,{value:"all",children:"Todos os Status"}),e.jsx(V,{value:"PENDING",children:"Pendentes"}),e.jsx(V,{value:"PROCESSING",children:"Processando"}),e.jsx(V,{value:"COMPLETED",children:"Concluídas"}),e.jsx(V,{value:"REJECTED",children:"Rejeitadas"})]})]}),e.jsx(y,{onClick:o,children:"Atualizar"})]}),e.jsx("div",{className:"space-y-4",children:x.length===0?e.jsx(p,{children:e.jsxs(b,{className:"p-8 text-center",children:[e.jsx(fe,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma solicitação LGPD encontrada"})]})}):x.map(u=>e.jsxs(p,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{className:"text-lg",children:m(u.request_type)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Solicitante: ",u.requested_by_email]})]}),e.jsxs("div",{className:"text-right space-y-2",children:[j(u.status),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{size:"sm",variant:"outline",onClick:()=>f(u.id,"PROCESSING"),disabled:u.status==="COMPLETED",children:"Processar"}),e.jsx(y,{size:"sm",variant:"default",onClick:()=>f(u.id,"COMPLETED"),disabled:u.status==="COMPLETED",children:"Concluir"})]})]})]})}),e.jsxs(b,{children:[u.justification&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Justificativa:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u.justification})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Criada em:"})," ",new Date(u.created_at).toLocaleString("pt-BR")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Expira em:"})," ",new Date(u.expires_at).toLocaleString("pt-BR")]}),u.completed_at&&e.jsxs("div",{children:[e.jsx("strong",{children:"Concluída em:"})," ",new Date(u.completed_at).toLocaleString("pt-BR")]})]})]})]},u.id))})]}),e.jsx(X,{value:"logs",className:"space-y-4",children:e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Logs de Acesso a Dados"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Registro de acessos para auditoria LGPD"})]}),e.jsx(b,{children:e.jsx("div",{className:"space-y-2",children:s.slice(0,20).map(u=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:u.accessed_table}),e.jsx("span",{className:"mx-2 text-muted-foreground",children:"•"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:u.access_type})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(u.created_at).toLocaleString("pt-BR")})]},u.id))})})]})}),e.jsxs(X,{value:"settings",className:"space-y-4",children:[e.jsxs(se,{children:[e.jsx(me,{className:"h-4 w-4"}),e.jsxs(ae,{children:[e.jsx("strong",{children:"Portal do Titular:"})," O portal público para solicitações LGPD está disponível em"," ",e.jsx("a",{href:"/portal-titular",className:"text-primary underline",target:"_blank",children:"/portal-titular"})]})]}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{children:"Configurações de Compliance"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Retenção de Dados"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dados são retidos por 24 meses após o fim da necessidade processual, conforme política de retenção configurada."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Anonimização Automática"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"CPFs, nomes e dados sensíveis são mascarados automaticamente em exports e relatórios por padrão."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Base Legal"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Art. 7º, VI da LGPD - Execução regular de direitos em processo judicial"})]})]})]})]})]})]})}const wn=Object.freeze(Object.defineProperty({__proto__:null,default:Mr},Symbol.toStringTag,{value:"Module"}));function Na(){const a=[{title:"Compliance LGPD 85% Automatizada",description:"Sistema com políticas de retenção automática, anonimização de PII e auditoria completa",icon:fe,metrics:["85% compliance automática","100% dados protegidos","0 vazamentos registrados"]},{title:"ROI Comprovado em Compliance",description:"Redução de 70% nos custos de adequação LGPD vs. consultoria tradicional",icon:Ge,metrics:["70% redução de custos","90% menos tempo de setup","100% auditável"]},{title:"Diferencial Competitivo",description:"Único sistema jurídico com LGPD by design para análise de testemunhas",icon:wt,metrics:["1º no mercado","Tecnologia exclusiva","Certificação própria"]}],n=[{title:"Whitepaper: LGPD para Escritórios",description:"Guia completo de adequação LGPD para escritórios de advocacia",type:"PDF",pages:"24 páginas",icon:ye,downloadUrl:"/whitepaper-assistjur.pdf"},{title:"Checklist de Compliance",description:"Lista verificação completa para auditoria LGPD interna",type:"Planilha",pages:"5 categorias",icon:Q,downloadUrl:"/checklist-compliance.xlsx"},{title:"Template de Políticas",description:"Modelos prontos de políticas de privacidade e retenção",type:"DOC",pages:"12 modelos",icon:ye,downloadUrl:"/templates-politicas.docx"}],s=[{name:"Dr. Carlos Mendes",role:"Sócio, Mendes & Associados",quote:"Com o AssistJur.IA, nossa adequação LGPD foi 3x mais rápida que o esperado.",compliance:"100% conforme"},{name:"Dra. Ana Silva",role:"Coordenadora de Compliance",quote:"A auditoria automática nos deu total controle sobre os dados dos clientes.",compliance:"0 incidentes"}];return e.jsx(Wt,{children:e.jsxs("div",{className:"container mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(yt,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Marketing Compliance"}),e.jsx("p",{className:"text-muted-foreground",children:"Argumentário comercial e lead magnets para conversão"})]})]}),e.jsxs(ze,{defaultValue:"argumentario",className:"space-y-6",children:[e.jsxs(Re,{className:"grid w-full grid-cols-4",children:[e.jsx(J,{value:"argumentario",children:"Argumentário"}),e.jsx(J,{value:"leadmagnets",children:"Lead Magnets"}),e.jsx(J,{value:"roi",children:"ROI Calculator"}),e.jsx(J,{value:"cases",children:"Cases de Sucesso"})]}),e.jsxs(X,{value:"argumentario",className:"space-y-6",children:[e.jsx("div",{className:"grid gap-6 md:grid-cols-1 lg:grid-cols-1",children:a.map((r,t)=>{const l=r.icon;return e.jsxs(p,{className:"border-l-4 border-l-primary",children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(l,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(_,{className:"text-xl",children:r.title}),e.jsx(L,{className:"mt-2",children:r.description})]})]})}),e.jsx(b,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:r.metrics.map((c,i)=>e.jsx(P,{variant:"secondary",children:c},i))})})]},t)})}),e.jsxs(p,{className:"bg-gradient-to-r from-primary/5 to-accent/5 border-primary/20",children:[e.jsx(w,{children:e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-primary"}),"Proposta de Valor Única"]})}),e.jsx(b,{children:e.jsxs("p",{className:"text-lg leading-relaxed",children:[e.jsx("strong",{children:"AssistJur.IA"})," é o único sistema jurídico com"," ",e.jsx(P,{variant:"outline",className:"mx-1",children:"LGPD by design"}),"que oferece ",e.jsx("strong",{children:"85% de compliance automatizada"})," ","para análise de testemunhas, com economia de"," ",e.jsx("strong",{children:"70% nos custos"})," e"," ",e.jsx("strong",{children:"90% menos tempo"})," de adequação."]})})]})]}),e.jsxs(X,{value:"leadmagnets",className:"space-y-6",children:[e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:n.map((r,t)=>{const l=r.icon;return e.jsxs(p,{className:"group hover:shadow-lg transition-shadow",children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-accent/10 rounded-lg",children:e.jsx(l,{className:"w-5 h-5 text-accent"})}),e.jsx("div",{children:e.jsx(P,{variant:"outline",children:r.type})})]}),e.jsx(_,{className:"text-lg",children:r.title}),e.jsx(L,{children:r.description})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["📄 ",r.pages]}),e.jsxs(y,{className:"w-full group-hover:bg-primary/90 transition-colors",onClick:()=>window.open(r.downloadUrl,"_blank"),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Download Gratuito"]})]})]},t)})}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{children:"Performance dos Lead Magnets"})}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:"1,247"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Downloads totais"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-accent",children:"32%"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Taxa de conversão"})]}),e.jsxs("div",{className:"text-center p-4 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:"89"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Leads qualificados"})]})]})})]})]}),e.jsx(X,{value:"roi",className:"space-y-6",children:e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Calculadora de ROI - Compliance LGPD"}),e.jsx(L,{children:"Compare os custos de adequação LGPD: AssistJur.IA vs. Consultoria Tradicional"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-destructive",children:"Consultoria Tradicional"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Consultoria inicial:"}),e.jsx("span",{className:"font-medium",children:"R$ 25.000"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Implementação (6 meses):"}),e.jsx("span",{className:"font-medium",children:"R$ 45.000"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Auditoria anual:"}),e.jsx("span",{className:"font-medium",children:"R$ 15.000"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Manutenção/ano:"}),e.jsx("span",{className:"font-medium",children:"R$ 12.000"})]}),e.jsx("div",{className:"border-t pt-2",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold text-destructive",children:[e.jsx("span",{children:"Total (1º ano):"}),e.jsx("span",{children:"R$ 97.000"})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary",children:"AssistJur.IA"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Setup inicial:"}),e.jsx("span",{className:"font-medium",children:"R$ 0"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Implementação (1 semana):"}),e.jsx("span",{className:"font-medium",children:"R$ 2.000"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Licença anual:"}),e.jsx("span",{className:"font-medium",children:"R$ 24.000"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Suporte incluído:"}),e.jsx("span",{className:"font-medium",children:"R$ 0"})]}),e.jsx("div",{className:"border-t pt-2",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold text-primary",children:[e.jsx("span",{children:"Total (1º ano):"}),e.jsx("span",{children:"R$ 26.000"})]})})]})]})]}),e.jsx("div",{className:"mt-8 p-6 bg-primary/5 rounded-lg border border-primary/20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary mb-2",children:"R$ 71.000 de economia"}),e.jsx("div",{className:"text-lg text-muted-foreground",children:"73% menos custos no primeiro ano"}),e.jsx("div",{className:"mt-4 text-sm text-muted-foreground",children:"+ 90% menos tempo de implementação + Compliance automática 24/7"})]})})]})]})}),e.jsxs(X,{value:"cases",className:"space-y-6",children:[e.jsx("div",{className:"grid gap-6",children:s.map((r,t)=>e.jsx(p,{className:"border-l-4 border-l-accent",children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-accent/10 rounded-full",children:e.jsx(ls,{className:"w-5 h-5 text-accent"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("blockquote",{className:"text-lg italic mb-4",children:['"',r.quote,'"']}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:r.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:r.role})]}),e.jsx(P,{variant:"outline",className:"bg-primary/10",children:r.compliance})]})]})]})})},t))}),e.jsx(p,{className:"bg-gradient-to-r from-primary to-accent text-white",children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Pronto para 85% de Compliance Automatizada?"}),e.jsx("p",{className:"text-lg opacity-90",children:"Junte-se aos escritórios que já economizam 70% em adequação LGPD"}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx(y,{variant:"secondary",size:"lg",children:"Demonstração Gratuita"}),e.jsx(y,{variant:"outline",size:"lg",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",children:"Falar com Especialista"})]})]})})})]})]})]})})}const _n=Object.freeze(Object.defineProperty({__proto__:null,MarketingCompliance:Na,default:Na},Symbol.toStringTag,{value:"Module"}));function Vr(){const{user:a}=xe(),[n,s]=g.useState([]),[r,t]=g.useState([]),[l,c]=g.useState(!0),[i,o]=g.useState(null);g.useEffect(()=>{j()},[]);const j=async()=>{c(!0);try{const{data:h,error:N}=await R.from("retention_policies").select("*").order("table_name");N?(console.error("Error fetching policies:",N),te.error("Erro ao carregar políticas de retenção")):s(h||[]);const{data:d,error:C}=await R.from("cleanup_logs").select("*").order("started_at",{ascending:!1}).limit(50);C?console.error("Error fetching logs:",C):t(d||[])}catch(h){console.error("Error fetching data:",h),te.error("Erro ao carregar dados")}finally{c(!1)}},m=async(h,N)=>{try{const{error:d}=await R.from("retention_policies").update(N).eq("id",h);if(d)throw d;te.success("Política atualizada com sucesso"),j()}catch(d){console.error("Error updating policy:",d),te.error("Erro ao atualizar política")}},x=async h=>{o(h);try{const{data:N,error:d}=await R.functions.invoke("data-retention",{body:{action:"execute_cleanup",policyId:h}});if(d)throw d;te.success(`Limpeza executada: ${N.result.records_affected} registros afetados`),j()}catch(N){console.error("Error executing cleanup:",N),te.error("Erro ao executar limpeza")}finally{o(null)}},f=async()=>{o("batch");try{const{data:h,error:N}=await R.functions.invoke("data-retention",{body:{action:"batch_cleanup",orgId:a?.user_metadata?.organization_id}});if(N)throw N;te.success(`Limpeza em lote executada: ${h.processed} políticas processadas`),j()}catch(h){console.error("Error executing batch cleanup:",h),te.error("Erro ao executar limpeza em lote")}finally{o(null)}},u=h=>({processos:"Processos",audit_logs:"Logs de Auditoria",openai_logs:"Logs OpenAI",data_access_logs:"Logs de Acesso",lgpd_requests:"Solicitações LGPD"})[h]||h,v=h=>{switch(h){case"COMPLETED":return e.jsxs(P,{className:"bg-success",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"Concluído"]});case"FAILED":return e.jsxs(P,{variant:"destructive",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),"Falhou"]});case"STARTED":return e.jsxs(P,{variant:"secondary",children:[e.jsx(Te,{className:"h-3 w-3 mr-1"}),"Iniciado"]});default:return e.jsx(P,{variant:"outline",children:h})}};return l?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(De,{className:"h-12 w-12 mx-auto mb-4 animate-pulse text-primary"}),e.jsx("p",{children:"Carregando políticas de retenção..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(De,{className:"h-8 w-8 text-primary"}),"Retenção de Dados"]}),e.jsx("p",{className:"text-muted-foreground",children:"Gestão automatizada de políticas de retenção LGPD"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{onClick:f,disabled:i==="batch",variant:"outline",children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),i==="batch"?"Executando...":"Limpeza em Lote"]}),e.jsx(y,{onClick:j,variant:"outline",children:"Atualizar"})]})]}),e.jsxs(se,{children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsxs(ae,{children:[e.jsx("strong",{children:"Compliance LGPD:"})," As políticas de retenção automatizada garantem o descarte seguro de dados após o prazo legal necessário, conforme Art. 6º, VII da LGPD."]})]}),e.jsxs(ze,{defaultValue:"policies",className:"space-y-4",children:[e.jsxs(Re,{children:[e.jsx(J,{value:"policies",children:"Políticas de Retenção"}),e.jsx(J,{value:"logs",children:"Histórico de Limpezas"}),e.jsx(J,{value:"settings",children:"Configurações"})]}),e.jsx(X,{value:"policies",className:"space-y-4",children:e.jsx("div",{className:"grid gap-4",children:n.map(h=>e.jsxs(p,{children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{className:"text-lg",children:u(h.table_name)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Retenção: ",h.retention_months," meses"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Auto-limpeza:"}),e.jsx(xs,{checked:h.auto_cleanup,onCheckedChange:N=>m(h.id,{auto_cleanup:N})})]}),e.jsxs(y,{size:"sm",onClick:()=>x(h.id),disabled:i===h.id,variant:"outline",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),i===h.id?"Executando...":"Executar Limpeza"]})]})]})}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Retenção (meses):"}),e.jsx(H,{type:"number",value:h.retention_months,onChange:N=>m(h.id,{retention_months:parseInt(N.target.value)}),className:"mt-1",min:"1",max:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Última Limpeza:"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:h.last_cleanup_at?new Date(h.last_cleanup_at).toLocaleString("pt-BR"):"Nunca executada"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Próxima Limpeza:"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:h.next_cleanup_at?new Date(h.next_cleanup_at).toLocaleString("pt-BR"):"Não agendada"})]})]})})]},h.id))})}),e.jsx(X,{value:"logs",className:"space-y-4",children:e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Histórico de Limpezas"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Registro das execuções de políticas de retenção"})]}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:r.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Nenhuma limpeza executada ainda"}):r.map(h=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:u(h.table_name)}),v(h.status)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[h.records_affected," registros afetados"]}),h.error_message&&e.jsxs("p",{className:"text-sm text-destructive",children:["Erro: ",h.error_message]})]}),e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[e.jsxs("div",{children:["Iniciado:"," ",new Date(h.started_at).toLocaleString("pt-BR")]}),h.completed_at&&e.jsxs("div",{children:["Concluído:"," ",new Date(h.completed_at).toLocaleString("pt-BR")]})]})]},h.id))})})]})}),e.jsx(X,{value:"settings",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{children:"Configurações Globais"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Períodos de Retenção Padrão"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsx("div",{children:"Processos: 60 meses (5 anos)"}),e.jsx("div",{children:"Logs de Auditoria: 24 meses"}),e.jsx("div",{children:"Logs OpenAI: 12 meses"}),e.jsx("div",{children:"Logs de Acesso: 24 meses"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Frequência de Execução"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Políticas com auto-limpeza habilitada são executadas mensalmente"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Segurança"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dados críticos (processos ativos) são protegidos contra exclusão acidental. Logs de auditoria são mantidos para compliance regulatório."})]})]})]}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{children:"Compliance e Regulamentação"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs(se,{children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsxs(ae,{children:[e.jsx("strong",{children:"Base Legal LGPD:"}),' Art. 6º, VII - "não conservação dos dados pessoais por tempo superior ao necessário para o alcance das finalidades para as quais foram coletados"']})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Critérios de Retenção"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Processos: Mantidos enquanto tramitam + 5 anos (prescrição)"}),e.jsx("li",{children:"• Logs de Auditoria: 2 anos para investigações"}),e.jsx("li",{children:"• Dados de IA: 1 ano para melhorias do serviço"}),e.jsx("li",{children:"• Solicitações LGPD: 3 anos para evidência de compliance"})]})]})]})]})]})})]})]})}const Cn=Object.freeze(Object.defineProperty({__proto__:null,default:Vr},Symbol.toStringTag,{value:"Module"})),qr=()=>{const{profile:a}=xe(),n=Ts(),{data:s,isLoading:r}=Me({queryKey:["org-settings",a?.organization_id],queryFn:async()=>{const{data:i,error:o}=await R.from("org_settings").select("*").eq("org_id",a?.organization_id).single();if(o&&o.code!=="PGRST116")throw o;return i},enabled:!!a?.organization_id}),{data:t}=Me({queryKey:["usage-stats",a?.organization_id],queryFn:async()=>{const{data:i,error:o}=await R.from("openai_logs").select("*").eq("org_id",a?.organization_id).gte("created_at",new Date(Date.now()-864e5).toISOString()).order("created_at",{ascending:!1});if(o)throw o;const j=i?.reduce((x,f)=>x+(f.cost_cents||0),0)||0,m=i?.length?i.reduce((x,f)=>x+(f.duration_ms||0),0)/i.length:0;return{requests24h:i?.length||0,cost24h:j,avgLatency:Math.round(m),activeModel:s?.model||"gpt-4o-mini"}},enabled:!!a?.organization_id&&!!s}),l=Pe({mutationFn:async i=>{const{data:o,error:j}=await R.functions.invoke("admin-openai-settings",{body:{action:"toggle",enabled:i}});if(j)throw j;return o},onSuccess:()=>{n.invalidateQueries({queryKey:["org-settings"]}),F({title:"Configuração atualizada",description:"Integração OpenAI foi alterada com sucesso."})},onError:i=>{F({title:"Erro",description:i.message||"Falha ao alterar configuração",variant:"destructive"})}});if(r)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})});const c=s?.openai_enabled||!1;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Integração OpenAI"}),e.jsx("p",{className:"text-muted-foreground",children:"Geренаre análises inteligentes com IA"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:c?"Ativo":"Desativado"}),e.jsx(xs,{checked:c,onCheckedChange:i=>l.mutate(i),disabled:l.isPending})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Status da API"}),e.jsx(as,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(P,{variant:c?"default":"secondary",children:c?"Ativa":"Desativada"})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:c?"A API da OpenAI está ativa para esta organização.":"Integração desativada"})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Modelo Ativo"}),e.jsx(Ss,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t?.activeModel||"N/A"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Latência média: ",t?.avgLatency||0,"ms"]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Uso 24h"}),e.jsx(as,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t?.requests24h||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"requisições nas últimas 24h"})]})]}),e.jsxs(p,{children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium",children:"Custo 24h"}),e.jsx(Ds,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",((t?.cost24h||0)/100).toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"estimado das últimas 24h"})]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Ações Rápidas"}),e.jsx(L,{children:"Configure e monitore sua integração OpenAI"})]}),e.jsx(b,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(y,{variant:"outline",className:"h-20 flex-col",asChild:!0,children:e.jsxs("a",{href:"/admin/ia/chaves",children:[e.jsx(Cs,{className:"h-6 w-6 mb-2"}),"Gerenciar Chaves"]})}),e.jsx(y,{variant:"outline",className:"h-20 flex-col",asChild:!0,children:e.jsxs("a",{href:"/admin/ia/modelos",children:[e.jsx(Ss,{className:"h-6 w-6 mb-2"}),"Configurar Modelos"]})}),e.jsx(y,{variant:"outline",className:"h-20 flex-col",asChild:!0,children:e.jsxs("a",{href:"/admin/ia/prompt-studio",children:[e.jsx(Cs,{className:"h-6 w-6 mb-2"}),"Prompt Studio"]})}),e.jsx(y,{variant:"outline",className:"h-20 flex-col",asChild:!0,children:e.jsxs("a",{href:"/admin/ia/testes",children:[e.jsx(as,{className:"h-6 w-6 mb-2"}),"Playground"]})})]})})]}),!c&&e.jsxs(p,{className:"border-orange-200 bg-orange-50",children:[e.jsxs(w,{children:[e.jsx(_,{className:"text-orange-800",children:"Configuração Necessária"}),e.jsx(L,{className:"text-orange-700",children:"Para usar a integração OpenAI, você precisa:"})]}),e.jsx(b,{className:"text-orange-700",children:e.jsxs("ol",{className:"list-decimal list-inside space-y-2",children:[e.jsxs("li",{children:["Adicionar uma chave API válida em"," ",e.jsx("strong",{children:"Gerenciar Chaves"})]}),e.jsxs("li",{children:["Configurar o modelo desejado em"," ",e.jsx("strong",{children:"Configurar Modelos"})]}),e.jsx("li",{children:"Ativar a integração usando o switch acima"})]})})]})]})},Sn=Object.freeze(Object.defineProperty({__proto__:null,default:qr},Symbol.toStringTag,{value:"Module"})),Fr=()=>{const{profile:a}=xe(),n=Ts(),[s,r]=g.useState(!1),[t,l]=g.useState(!1),[c,i]=g.useState({alias:"",key:"",notes:""}),[o,j]=g.useState(null),{data:m,isLoading:x}=Me({queryKey:["openai-keys",a?.organization_id],queryFn:async()=>{const{data:d,error:C}=await R.from("openai_keys").select("*").eq("org_id",a?.organization_id).order("created_at",{ascending:!1});if(C)throw C;return d||[]},enabled:!!a?.organization_id}),f=Pe({mutationFn:async d=>{try{const{data:{session:C},error:T}=await R.auth.getSession();if(T)throw new Error("Falha na autenticação: "+T.message);let q=C;if(!q||!q.access_token){const{data:{session:S}}=await R.auth.refreshSession();if(!S)throw new Error("Sessão expirada. Faça login novamente.");q=S}const $=await R.functions.invoke("admin-openai-keys",{body:{action:"create",alias:d.alias,key:d.key,notes:d.notes},headers:{Authorization:`Bearer ${q.access_token}`}});if($.error)throw new Error(`Erro na função: ${$.error.message||$.error}`);if(!$.data)throw new Error("Nenhum dado retornado da função");return $.data}catch(C){throw new Error(`Falha ao salvar chave: ${C instanceof Error?C.message:String(C)}`)}},onSuccess:()=>{n.invalidateQueries({queryKey:["openai-keys"]}),r(!1),i({alias:"",key:"",notes:""}),F({title:"Chave adicionada",description:"Chave API foi salva com sucesso."})},onError:d=>{F({title:"Erro",description:"Falha ao salvar chave: "+d.message,variant:"destructive"})}}),u=Pe({mutationFn:async d=>{const{data:C,error:T}=await R.functions.invoke("admin-openai-keys",{body:{action:"test",keyId:d}});if(T)throw T;return C},onSuccess:d=>{j(null),F({title:d.valid?"Chave válida":"Chave inválida",description:d.valid?"Conexão com OpenAI estabelecida com sucesso.":"Chave inválida (401). Verifique ou rotacione a credencial.",variant:d.valid?"default":"destructive"})},onError:d=>{j(null),F({title:"Erro no teste",description:"Falha ao testar chave: "+d.message,variant:"destructive"})}}),v=Pe({mutationFn:async d=>{const{error:C}=await R.functions.invoke("admin-openai-keys",{body:{action:"rotate",keyId:d}});if(C)throw C},onSuccess:()=>{n.invalidateQueries({queryKey:["openai-keys"]}),F({title:"Chave rotacionada",description:"Nova chave foi gerada e salva."})},onError:d=>{F({title:"Erro",description:"Falha ao rotacionar chave: "+d.message,variant:"destructive"})}}),h=Pe({mutationFn:async d=>{const{error:C}=await R.functions.invoke("admin-openai-keys",{body:{action:"delete",keyId:d}});if(C)throw C},onSuccess:()=>{n.invalidateQueries({queryKey:["openai-keys"]}),F({title:"Chave removida",description:"Chave API foi removida com sucesso."})},onError:d=>{F({title:"Erro",description:"Falha ao remover chave: "+d.message,variant:"destructive"})}}),N=d=>{j(d),u.mutate(d)};return x?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Gerenciar Chaves OpenAI"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure e monitore suas chaves da API OpenAI"})]}),e.jsxs($e,{open:s,onOpenChange:r,children:[e.jsx(oa,{asChild:!0,children:e.jsxs(y,{children:[e.jsx(Ys,{className:"h-4 w-4 mr-2"}),"Adicionar Chave"]})}),e.jsxs(Ue,{children:[e.jsxs(Ee,{children:[e.jsx(ke,{children:"Adicionar Nova Chave API"}),e.jsx(ms,{children:"As chaves são armazenadas apenas no servidor. Nunca exibimos o valor completo."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"alias",children:"Nome/Apelido"}),e.jsx(H,{id:"alias",placeholder:"Ex: Chave Principal",value:c.alias,onChange:d=>i({...c,alias:d.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"key",children:"Chave API"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{id:"key",type:t?"text":"password",placeholder:"sk-...",value:c.key,onChange:d=>i({...c,key:d.target.value})}),e.jsx(y,{type:"button",variant:"ghost",size:"sm",className:"absolute right-2 top-1/2 -translate-y-1/2",onClick:()=>l(!t),children:t?e.jsx(Sa,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"notes",children:"Notas (opcional)"}),e.jsx(Ia,{id:"notes",placeholder:"Descrição ou notas sobre esta chave...",value:c.notes,onChange:d=>i({...c,notes:d.target.value})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{variant:"outline",onClick:()=>r(!1),children:"Cancelar"}),e.jsx(y,{onClick:()=>{!c.alias||!c.key||f.mutate(c)},disabled:!c.alias||!c.key||f.isPending,children:f.isPending?"Salvando...":"Salvar Chave"})]})]})]})]}),e.jsx(p,{className:"border-blue-200 bg-blue-50",children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ma,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-blue-800 text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Segurança das Chaves"}),e.jsx("p",{children:"As chaves são armazenadas criptografadas no servidor e nunca expostas no cliente. Apenas os últimos 4 dígitos são exibidos para identificação."})]})]})})}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Chaves Cadastradas"}),e.jsxs(L,{children:[m?.length||0," chave(s) configurada(s)"]})]}),e.jsx(b,{children:m?.length?e.jsxs(we,{children:[e.jsx(_e,{children:e.jsxs(K,{children:[e.jsx(z,{children:"Nome"}),e.jsx(z,{children:"Chave"}),e.jsx(z,{children:"Status"}),e.jsx(z,{children:"Último Uso"}),e.jsx(z,{children:"Criado"}),e.jsx(z,{className:"text-right",children:"Ações"})]})}),e.jsx(ve,{children:m.map(d=>e.jsxs(K,{children:[e.jsx(E,{className:"font-medium",children:d.alias}),e.jsxs(E,{className:"font-mono",children:["***",d.last_four]}),e.jsx(E,{children:e.jsx(P,{variant:d.is_active?"default":"secondary",children:d.is_active?"Ativa":"Inativa"})}),e.jsx(E,{children:d.last_used_at?Xe(new Date(d.last_used_at),"dd/MM/yyyy HH:mm",{locale:cs}):"Nunca"}),e.jsx(E,{children:Xe(new Date(d.created_at),"dd/MM/yyyy",{locale:cs})}),e.jsx(E,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{variant:"outline",size:"sm",onClick:()=>N(d.id),disabled:o===d.id,children:o===d.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):e.jsx(_t,{className:"h-4 w-4"})}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>v.mutate(d.id),disabled:v.isPending,children:e.jsx(Ct,{className:"h-4 w-4"})}),e.jsxs(ea,{children:[e.jsx(Ra,{asChild:!0,children:e.jsx(y,{variant:"outline",size:"sm",children:e.jsx(Fe,{className:"h-4 w-4"})})}),e.jsxs(sa,{children:[e.jsxs(aa,{children:[e.jsx(ta,{children:"Remover Chave"}),e.jsxs(ra,{children:['Tem certeza que deseja remover a chave "',d.alias,'"? Esta ação não pode ser desfeita.']})]}),e.jsxs(na,{children:[e.jsx(ia,{children:"Cancelar"}),e.jsx(As,{onClick:()=>h.mutate(d.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})]})]})})]},d.id))})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ma,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma chave API configurada"}),e.jsx("p",{className:"text-sm",children:"Adicione uma chave para começar a usar a integração OpenAI"})]})})]})]})},Pn=Object.freeze(Object.defineProperty({__proto__:null,default:Fr},Symbol.toStringTag,{value:"Module"})),fs=[{id:"gpt-5-2025-08-07",name:"GPT-5",description:"Modelo mais avançado e inteligente",costPer1k:.15,speed:"Rápido",category:"flagship"},{id:"gpt-5-mini-2025-08-07",name:"GPT-5 Mini",description:"Versão otimizada do GPT-5",costPer1k:.08,speed:"Muito Rápido",category:"flagship"},{id:"gpt-4.1-2025-04-14",name:"GPT-4.1",description:"Modelo confiável para resultados consistentes",costPer1k:.1,speed:"Rápido",category:"reliable"},{id:"o3-2025-04-16",name:"O3",description:"Modelo de raciocínio para problemas complexos",costPer1k:.25,speed:"Lento",category:"reasoning"},{id:"gpt-4o-mini",name:"GPT-4o Mini",description:"Modelo legado rápido e econômico",costPer1k:.02,speed:"Muito Rápido",category:"legacy"}],$r=()=>{const{profile:a}=xe(),n=Ts(),[s,r]=g.useState({model:"gpt-4o-mini",fallback:[],temperature:.7,top_p:.9,max_output_tokens:2e3,streaming:!1,rate_per_min:60,budget_month_cents:1e4}),{data:t,isLoading:l}=Me({queryKey:["org-settings",a?.organization_id],queryFn:async()=>{const{data:j,error:m}=await R.from("org_settings").select("*").eq("org_id",a?.organization_id).single();if(m&&m.code!=="PGRST116")throw m;return j},enabled:!!a?.organization_id});Qs.useEffect(()=>{t&&r({model:t.model,fallback:t.fallback||[],temperature:t.temperature,top_p:t.top_p,max_output_tokens:t.max_output_tokens,streaming:t.streaming,rate_per_min:t.rate_per_min,budget_month_cents:t.budget_month_cents})},[t]);const c=Pe({mutationFn:async j=>{const{error:m}=await R.functions.invoke("admin-openai-settings",{body:{action:"update_models",settings:j,org_id:a?.organization_id}});if(m)throw m},onSuccess:()=>{n.invalidateQueries({queryKey:["org-settings"]}),F({title:"Configurações salvas",description:"Modelos e parâmetros foram atualizados."})},onError:j=>{F({title:"Erro",description:"Falha ao salvar: "+j.message,variant:"destructive"})}}),i=()=>{c.mutate(s)},o=fs.find(j=>j.id===s.model);return l?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Configurar Modelos"}),e.jsx("p",{className:"text-muted-foreground",children:"Selecione modelos, configure parâmetros e defina limites"})]}),e.jsx(y,{onClick:i,disabled:c.isPending,children:c.isPending?"Salvando...":"Salvar Configurações"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center space-x-2",children:[e.jsx(Ze,{className:"h-5 w-5"}),e.jsx("span",{children:"Seleção de Modelo"})]}),e.jsx(L,{children:"Escolha o modelo principal e fallbacks"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Modelo Principal"}),e.jsxs(ne,{value:s.model,onValueChange:j=>r({...s,model:j}),children:[e.jsx(ie,{children:e.jsx(oe,{})}),e.jsx(ce,{children:fs.map(j=>e.jsx(V,{value:j.id,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:j.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:j.description})]}),e.jsxs(P,{variant:"outline",className:"ml-2",children:["$",j.costPer1k,"/1k"]})]})},j.id))})]})]}),o&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ds,{className:"h-3 w-3"}),e.jsxs("span",{children:["$",o.costPer1k,"/1k tokens"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Te,{className:"h-3 w-3"}),e.jsx("span",{children:o.speed})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ss,{className:"h-3 w-3"}),e.jsx("span",{className:"capitalize",children:o.category})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:o.description})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Modelos de Fallback (ordem de prioridade)"}),e.jsxs("div",{className:"space-y-2 mt-2",children:[s.fallback.map((j,m)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[e.jsx("span",{children:fs.find(x=>x.id===j)?.name||j}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>{const x=[...s.fallback];x.splice(m,1),r({...s,fallback:x})},children:"Remover"})]},m)),e.jsxs(ne,{onValueChange:j=>{!s.fallback.includes(j)&&j!==s.model&&r({...s,fallback:[...s.fallback,j]})},children:[e.jsx(ie,{children:e.jsx(oe,{placeholder:"Adicionar fallback"})}),e.jsx(ce,{children:fs.filter(j=>j.id!==s.model&&!s.fallback.includes(j.id)).map(j=>e.jsx(V,{value:j.id,children:j.name},j.id))})]})]})]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center space-x-2",children:[e.jsx(Cs,{className:"h-5 w-5"}),e.jsx("span",{children:"Parâmetros do Modelo"})]}),e.jsx(L,{children:"Configure a personalidade e comportamento da IA"})]}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(M,{children:"Temperature"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.temperature})]}),e.jsx(Ne,{value:[s.temperature],onValueChange:([j])=>r({...s,temperature:j}),max:2,min:0,step:.1,className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"0 = mais determinístico, 2 = mais criativo"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(M,{children:"Top P"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.top_p})]}),e.jsx(Ne,{value:[s.top_p],onValueChange:([j])=>r({...s,top_p:j}),max:1,min:0,step:.1,className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Controla a diversidade da resposta"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"max_tokens",children:"Máximo de Tokens na Resposta"}),e.jsx(H,{id:"max_tokens",type:"number",value:s.max_output_tokens,onChange:j=>r({...s,max_output_tokens:parseInt(j.target.value)||2e3}),min:100,max:4e3}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Limita o tamanho da resposta (100-4000)"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Streaming"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Resposta em tempo real"})]}),e.jsx(xs,{checked:s.streaming,onCheckedChange:j=>r({...s,streaming:j})})]})]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Limites e Orçamento"}),e.jsx(L,{children:"Configure rate limiting e controles de custo"})]}),e.jsx(b,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"rate_limit",children:"Rate Limit (requisições/minuto)"}),e.jsx(H,{id:"rate_limit",type:"number",value:s.rate_per_min,onChange:j=>r({...s,rate_per_min:parseInt(j.target.value)||60}),min:1,max:1e3}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Limite de requisições por minuto por usuário"})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"budget",children:"Orçamento Mensal (centavos USD)"}),e.jsx(H,{id:"budget",type:"number",value:s.budget_month_cents,onChange:j=>r({...s,budget_month_cents:parseInt(j.target.value)||1e4}),min:100}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Limite de gasto mensal em centavos ($",(s.budget_month_cents/100).toFixed(2),")"]})]})]})})]}),e.jsxs(p,{className:"border-blue-200 bg-blue-50",children:[e.jsx(w,{children:e.jsx(_,{className:"text-blue-800",children:"Guia de Modelos"})}),e.jsxs(b,{className:"text-blue-700 space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"GPT-5:"})," Use para casos que exigem máxima inteligência e raciocínio complexo"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"GPT-5 Mini:"})," Ideal para a maioria dos casos, balanceando qualidade e velocidade"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"GPT-4.1:"})," Confiável para resultados consistentes e bem testados"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"O3:"})," Especificamente para problemas que requerem raciocínio profundo"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"GPT-4o Mini:"})," Para casos simples onde velocidade e custo são prioridade"]})]})]})]})},An=Object.freeze(Object.defineProperty({__proto__:null,default:$r},Symbol.toStringTag,{value:"Module"})),Fs=[{id:"processo",name:"Processo (CNJ)",description:"Consultas por número de processo"},{id:"testemunha",name:"Testemunha (Nome)",description:"Consultas por nome de testemunha"},{id:"general",name:"Padrões Gerais",description:"Consultas gerais na base"}],Ha=["Basear exclusivamente nos dados da planilha fornecida","Não inventar ou inferir dados não presentes na base","Sempre mascarar números de CPF no formato XXX.XXX.XXX-XX",'Responder "não consta na base fornecida" quando dados não estão disponíveis',"Incluir rodapé obrigatório sobre validação nos autos"],$s=`Você é um assistente especializado em análise de dados jurídicos. Sua função é consultar e analisar informações de uma planilha de processos e pessoas fornecida pelo usuário.

REGRAS FUNDAMENTAIS (NÃO EDITÁVEIS):
${Ha.map(a=>`- ${a}`).join(`
`)}

VARIÁVEIS DISPONÍVEIS:
- {cnj} - Número do processo
- {nome} - Nome da pessoa
- {comarca} - Comarca do processo
- {ano} - Ano de referência
- {janelaTriangulacao} - Período para análise de triangulação
- {politicaLGPD} - Diretrizes de proteção de dados

Sempre responda no formato JSON estruturado solicitado e inclua o rodapé obrigatório: "Informações baseadas na planilha carregada. Recomenda-se validação nos autos antes de qualquer medida processual."`,Ur=()=>{const{profile:a}=xe(),n=Ts(),[s,r]=g.useState(!1),[,t]=g.useState(null),[l,c]=g.useState({v1:80,v2:20}),[i,o]=g.useState({label:"",content:$s,template_type:"general"}),{data:j,isLoading:m}=Me({queryKey:["prompts",a?.organization_id],queryFn:async()=>{const{data:d,error:C}=await R.from("prompts").select("*").eq("org_id",a?.organization_id).order("created_at",{ascending:!1});if(C)throw C;return d||[]},enabled:!!a?.organization_id}),{data:x}=Me({queryKey:["org-settings",a?.organization_id],queryFn:async()=>{const{data:d,error:C}=await R.from("org_settings").select("prompt_active_id, ab_weights").eq("org_id",a?.organization_id).single();if(C&&C.code!=="PGRST116")throw C;return d},enabled:!!a?.organization_id}),f=Pe({mutationFn:async d=>{const{error:C}=await R.functions.invoke("admin-prompts",{body:{action:"create",...d,org_id:a?.organization_id}});if(C)throw C},onSuccess:()=>{n.invalidateQueries({queryKey:["prompts"]}),r(!1),o({label:"",content:$s,template_type:"general"}),F({title:"Prompt criado",description:"Nova versão de prompt foi salva."})},onError:d=>{F({title:"Erro",description:"Falha ao criar prompt: "+d.message,variant:"destructive"})}}),u=Pe({mutationFn:async d=>{const{error:C}=await R.functions.invoke("admin-prompts",{body:{action:"activate",promptId:d,org_id:a?.organization_id}});if(C)throw C},onSuccess:()=>{n.invalidateQueries({queryKey:["org-settings"]}),n.invalidateQueries({queryKey:["prompts"]}),F({title:"Prompt ativado",description:"Prompt está agora ativo para consultas."})},onError:d=>{F({title:"Erro",description:"Falha ao ativar prompt: "+d.message,variant:"destructive"})}}),v=Pe({mutationFn:async d=>{const{error:C}=await R.functions.invoke("admin-prompts",{body:{action:"update_ab_weights",weights:d,org_id:a?.organization_id}});if(C)throw C},onSuccess:()=>{n.invalidateQueries({queryKey:["org-settings"]}),F({title:"A/B Test atualizado",description:"Pesos de distribuição foram salvos."})},onError:d=>{F({title:"Erro",description:"Falha ao atualizar A/B: "+d.message,variant:"destructive"})}}),h=j?.find(d=>d.id===x?.prompt_active_id),N=j?.reduce((d,C)=>(d[C.template_type]||(d[C.template_type]=[]),d[C.template_type].push(C),d),{})||{};return m?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Prompt Studio"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie prompts do sistema, templates e testes A/B"})]}),e.jsxs($e,{open:s,onOpenChange:r,children:[e.jsx(oa,{asChild:!0,children:e.jsxs(y,{children:[e.jsx(Ys,{className:"h-4 w-4 mr-2"}),"Novo Prompt"]})}),e.jsxs(Ue,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Ee,{children:[e.jsx(ke,{children:"Criar Nova Versão de Prompt"}),e.jsx(ms,{children:"Configure um novo template de prompt para sua organização"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{htmlFor:"label",children:"Nome do Prompt"}),e.jsx(H,{id:"label",placeholder:"Ex: Análise CNJ v2.1",value:i.label,onChange:d=>o({...i,label:d.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"type",children:"Tipo de Template"}),e.jsxs(ne,{value:i.template_type,onValueChange:d=>o({...i,template_type:d}),children:[e.jsx(ie,{children:e.jsx(oe,{})}),e.jsx(ce,{children:Fs.map(d=>e.jsx(V,{value:d.id,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:d.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:d.description})]})},d.id))})]})]})]}),e.jsxs("div",{children:[e.jsx(M,{htmlFor:"content",children:"Conteúdo do Prompt"}),e.jsx(Ia,{id:"content",className:"min-h-[300px] font-mono text-sm",value:i.content,onChange:d=>o({...i,content:d.target.value})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Use variáveis como ","{cnj}",", ","{nome}",", ","{comarca}",", etc."]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{variant:"outline",onClick:()=>r(!1),children:"Cancelar"}),e.jsx(y,{onClick:()=>f.mutate(i),disabled:!i.label||!i.content||f.isPending,children:f.isPending?"Criando...":"Criar Prompt"})]})]})]})]}),e.jsxs(ze,{defaultValue:"templates",className:"space-y-4",children:[e.jsxs(Re,{children:[e.jsx(J,{value:"templates",children:"Templates"}),e.jsx(J,{value:"system",children:"Sistema Global"}),e.jsx(J,{value:"ab-testing",children:"A/B Testing"}),e.jsx(J,{value:"variables",children:"Variáveis"})]}),e.jsxs(X,{value:"templates",className:"space-y-4",children:[h&&e.jsxs(p,{className:"border-green-200 bg-green-50",children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{variant:"default",children:"Ativo"}),e.jsx(_,{className:"text-green-800",children:h.label})]}),e.jsxs("div",{className:"text-sm text-green-700",children:["v",h.version," •"," ",Fs.find(d=>d.id===h.template_type)?.name]})]})}),e.jsx(b,{children:e.jsxs("div",{className:"bg-white p-3 rounded border text-sm font-mono whitespace-pre-wrap text-green-800",children:[h.content.substring(0,200),"..."]})})]}),Fs.map(d=>e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"h-5 w-5"}),e.jsx("span",{children:d.name})]}),e.jsx(L,{children:d.description})]}),e.jsx(b,{children:N[d.id]?.length?e.jsxs(we,{children:[e.jsx(_e,{children:e.jsxs(K,{children:[e.jsx(z,{children:"Nome"}),e.jsx(z,{children:"Versão"}),e.jsx(z,{children:"Status"}),e.jsx(z,{children:"Criado"}),e.jsx(z,{className:"text-right",children:"Ações"})]})}),e.jsx(ve,{children:N[d.id].map(C=>e.jsxs(K,{children:[e.jsx(E,{className:"font-medium",children:C.label}),e.jsxs(E,{children:["v",C.version]}),e.jsx(E,{children:e.jsx(P,{variant:C.is_active?"default":"secondary",children:C.is_active?"Ativo":"Inativo"})}),e.jsx(E,{children:Xe(new Date(C.created_at),"dd/MM/yyyy",{locale:cs})}),e.jsx(E,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{variant:"outline",size:"sm",onClick:()=>t(C),children:e.jsx(Ta,{className:"h-4 w-4"})}),!C.is_active&&e.jsx(y,{variant:"outline",size:"sm",onClick:()=>u.mutate(C.id),disabled:u.isPending,children:"Ativar"})]})})]},C.id))})]}):e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(ye,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhum prompt para este tipo"})]})})]},d.id))]}),e.jsxs(X,{value:"system",className:"space-y-4",children:[e.jsxs(p,{className:"border-red-200 bg-red-50",children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center space-x-2 text-red-800",children:[e.jsx(St,{className:"h-5 w-5"}),e.jsx("span",{children:"Guards do Sistema (Não Editáveis)"})]}),e.jsx(L,{className:"text-red-700",children:"Regras de segurança aplicadas automaticamente a todos os prompts"})]}),e.jsx(b,{children:e.jsx("div",{className:"space-y-2",children:Ha.map((d,C)=>e.jsxs("div",{className:"flex items-start space-x-2 text-red-800",children:[e.jsx(fe,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:d})]},C))})})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Prompt do Sistema Global"}),e.jsx(L,{children:"Base aplicada a todos os prompts da organização"})]}),e.jsx(b,{children:e.jsx("div",{className:"bg-muted p-4 rounded-lg font-mono text-sm whitespace-pre-wrap",children:$s})})]})]}),e.jsxs(X,{value:"ab-testing",className:"space-y-4",children:[e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsxs(_,{className:"flex items-center space-x-2",children:[e.jsx(Pt,{className:"h-5 w-5"}),e.jsx("span",{children:"Teste A/B de Prompts"})]}),e.jsx(L,{children:"Configure distribuição de tráfego entre diferentes versões"})]}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(M,{children:"Versão 1 (Principal)"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[l.v1,"%"]})]}),e.jsx(Ne,{value:[l.v1],onValueChange:([d])=>c({v1:d,v2:100-d}),max:100,min:0,step:5,className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(M,{children:"Versão 2 (Teste)"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[l.v2,"%"]})]}),e.jsx(Ne,{value:[l.v2],onValueChange:([d])=>c({v1:100-d,v2:d}),max:100,min:0,step:5,className:"w-full"})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Total: ",l.v1+l.v2,"%"]}),e.jsx(y,{onClick:()=>v.mutate(l),disabled:v.isPending,children:v.isPending?"Salvando...":"Salvar Configuração"})]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Métricas de Performance"}),e.jsx(L,{children:"Comparação entre versões (últimos 7 dias)"})]}),e.jsx(b,{children:e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(At,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Dados insuficientes para análise"}),e.jsx("p",{className:"text-sm",children:"Execute mais testes para ver métricas comparativas"})]})})]})]}),e.jsx(X,{value:"variables",className:"space-y-4",children:e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Variáveis Disponíveis"}),e.jsx(L,{children:"Use estas variáveis em seus prompts para dados dinâmicos"})]}),e.jsx(b,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("code",{className:"bg-muted px-2 py-1 rounded font-mono text-sm",children:"{cnj}"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Número do processo CNJ formatado"})]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-muted px-2 py-1 rounded font-mono text-sm",children:"{nome}"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Nome da pessoa para consulta"})]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-muted px-2 py-1 rounded font-mono text-sm",children:"{comarca}"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Comarca do processo"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("code",{className:"bg-muted px-2 py-1 rounded font-mono text-sm",children:"{ano}"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Ano de referência para filtros"})]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-muted px-2 py-1 rounded font-mono text-sm",children:"{janelaTriangulacao}"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Período para análise de triangulação"})]}),e.jsxs("div",{children:[e.jsx("code",{className:"bg-muted px-2 py-1 rounded font-mono text-sm",children:"{politicaLGPD}"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Diretrizes de proteção de dados"})]})]})]})})]})})]})]})},En=Object.freeze(Object.defineProperty({__proto__:null,default:Ur},Symbol.toStringTag,{value:"Module"})),Br=()=>{const{profile:a}=xe(),[n,s]=g.useState({cnj:"",nome:"",comarca:"",ano:""}),[r,t]=g.useState(null),[l,c]=g.useState(!1),[i,o]=g.useState(null),j=async(m=!1)=>{c(!0);try{const{data:x,error:f}=await R.functions.invoke("admin-openai-test",{body:{input:n,streaming:m,org_id:a?.organization_id}});if(f)throw f;t(x.response),o(x.metrics),F({title:"Teste executado",description:`Resposta gerada em ${x.metrics?.duration_ms}ms`})}catch(x){const f=x instanceof Error?x.message:"Erro desconhecido";F({title:"Erro no teste",description:f,variant:"destructive"})}finally{c(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Playground de Testes"}),e.jsx("p",{className:"text-muted-foreground",children:"Teste a IA com dados reais da sua base"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Entrada de Teste"}),e.jsx(L,{children:"Configure os dados para teste"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(M,{children:"CNJ do Processo"}),e.jsx(H,{placeholder:"0000000-00.0000.0.00.0000",value:n.cnj,onChange:m=>s({...n,cnj:m.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Nome da Pessoa"}),e.jsx(H,{placeholder:"João da Silva",value:n.nome,onChange:m=>s({...n,nome:m.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Comarca"}),e.jsx(H,{placeholder:"São Paulo",value:n.comarca,onChange:m=>s({...n,comarca:m.target.value})})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Ano"}),e.jsx(H,{placeholder:"2024",value:n.ano,onChange:m=>s({...n,ano:m.target.value})})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(y,{onClick:()=>j(!1),disabled:l,className:"flex-1",children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),"Executar"]}),e.jsxs(y,{onClick:()=>j(!0),disabled:l,variant:"outline",className:"flex-1",children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"Streaming"]})]})]})]}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"Resultado"}),e.jsx(L,{children:"Resposta da IA"})]}),e.jsx(b,{children:l?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):r?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-muted p-4 rounded-lg",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm",children:JSON.stringify(r,null,2)})}),i&&e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Te,{className:"h-3 w-3"}),e.jsxs("span",{children:[i.duration_ms,"ms"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ds,{className:"h-3 w-3"}),e.jsxs("span",{children:[i.tokens_in+i.tokens_out," tokens"]})]}),e.jsx("div",{children:e.jsx(P,{variant:"outline",children:i.model})})]})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ns,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Execute um teste para ver o resultado"})]})})]})]})]})},kn=Object.freeze(Object.defineProperty({__proto__:null,default:Br},Symbol.toStringTag,{value:"Module"}));function Jr(){return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Validação do Corretor Inteligente"}),e.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Sistema completo de correção automática implementado com sucesso. Teste o template atualizado para validar todas as funcionalidades."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(p,{className:"border-success/20 bg-success/5",children:[e.jsx(w,{className:"pb-3",children:e.jsxs(_,{className:"flex items-center gap-2 text-success",children:[e.jsx(_s,{className:"h-5 w-5"}),"Template Corrigido"]})}),e.jsx(b,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Campos legados adicionados (reclamante_nome, reu_nome) para compatibilidade total"})})]}),e.jsxs(p,{className:"border-primary/20 bg-primary/5",children:[e.jsx(w,{className:"pb-3",children:e.jsxs(_,{className:"flex items-center gap-2 text-primary",children:[e.jsx(Ke,{className:"h-5 w-5"}),"Corretor Inteligente"]})}),e.jsx(b,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sistema de correção automática com mapeamento flexível e validação real"})})]}),e.jsxs(p,{className:"border-warning/20 bg-warning/5",children:[e.jsx(w,{className:"pb-3",children:e.jsxs(_,{className:"flex items-center gap-2 text-warning",children:[e.jsx(ye,{className:"h-5 w-5"}),"Validação Completa"]})}),e.jsx(b,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Processamento de arquivos reais CSV/XLSX com interface interativa"})})]})]}),e.jsx(Xa,{}),e.jsxs(p,{children:[e.jsxs(w,{children:[e.jsx(_,{children:"✅ Implementação Concluída"}),e.jsx(L,{children:"Resumo das funcionalidades implementadas no Corretor Inteligente"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-success",children:"🔧 Correções Implementadas"}),e.jsxs("ul",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"• Template CSV atualizado com campos legados"}),e.jsx("li",{children:"• Schema JSON expandido para compatibilidade"}),e.jsx("li",{children:"• Builder XLSX sincronizado"}),e.jsx("li",{children:"• Mapeamento inteligente de campos"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-primary",children:"⚡ Funcionalidades Novas"}),e.jsxs("ul",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"• Validação com dados reais (não mock)"}),e.jsx("li",{children:"• Correção automática de CNJ"}),e.jsx("li",{children:"• Formatação inteligente de nomes"}),e.jsx("li",{children:"• Interface interativa de correções"})]})]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:"Resultado:"})," Sistema robusto que elimina os erros de importação, permitindo que usuários importem dados com correções automáticas e interface amigável para revisar todas as modificações antes da publicação."]})})]})]})]})})}const Dn=Object.freeze(Object.defineProperty({__proto__:null,default:Jr},Symbol.toStringTag,{value:"Module"})),Gr=()=>{const[a,n]=g.useState(()=>new Date(Date.now()-6048e5).toISOString().slice(0,10)),[s,r]=g.useState(()=>new Date().toISOString().slice(0,10)),[t,l]=g.useState([]),c=async()=>{if(!await ss())return;l([{event:"page_view",count:150,unique_users:45},{event:"button_click",count:300,unique_users:80}])};return g.useEffect(()=>{c()},[]),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{children:"Metrics"})}),e.jsxs(b,{children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(H,{type:"date",value:a,onChange:i=>n(i.target.value)}),e.jsx(H,{type:"date",value:s,onChange:i=>r(i.target.value)}),e.jsx(y,{onClick:c,children:"Refresh"})]}),e.jsx("ul",{children:t.map(i=>e.jsxs("li",{className:"py-1",children:[i.event,": ",i.count]},i.event))})]})]})},Tn=Object.freeze(Object.defineProperty({__proto__:null,default:Gr},Symbol.toStringTag,{value:"Module"})),Kr=()=>{const[a,n]=g.useState([]);g.useEffect(()=>{const c=[{flag_id:"advanced-search",window:"7d",evaluations_count:150,unique_users:45,last_evaluated:new Date().toISOString()},{flag_id:"beta-features",window:"30d",evaluations_count:300,unique_users:80,last_evaluated:new Date().toISOString()}];n(c)},[]);const s=g.useMemo(()=>{const c={};for(const i of a)c[i.flag_id]||(c[i.flag_id]={flag_id:i.flag_id,eval_7d:0,eval_30d:0}),i.window==="7d"&&(c[i.flag_id].eval_7d=i.evaluations_count),i.window==="30d"&&(c[i.flag_id].eval_30d=i.evaluations_count);return Object.values(c)},[a]),r=a.filter(c=>c.window==="7d").reduce((c,i)=>c+i.evaluations_count,0),t=a.filter(c=>c.window==="30d").reduce((c,i)=>c+i.evaluations_count,0),l=a.filter(c=>c.window==="30d").reduce((c,i)=>c+i.unique_users,0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-3",children:[e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{children:"Avaliações 7d"})}),e.jsx(b,{className:"text-2xl font-bold",children:r})]}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{children:"Avaliações 30d"})}),e.jsx(b,{className:"text-2xl font-bold",children:t})]}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{children:"Usuários únicos 30d"})}),e.jsx(b,{className:"text-2xl font-bold",children:l})]})]}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(_,{children:"Avaliações por Flag"})}),e.jsx(b,{children:e.jsx(us,{className:"h-[300px]",config:{eval_7d:{label:"7d",color:"hsl(var(--chart-1))"},eval_30d:{label:"30d",color:"hsl(var(--chart-2))"}},children:e.jsxs(wa,{data:s,children:[e.jsx(Es,{strokeDasharray:"3 3"}),e.jsx(ks,{dataKey:"flag_id"}),e.jsx(rs,{}),e.jsx(hs,{content:e.jsx(Rs,{})}),e.jsx(Us,{dataKey:"eval_7d",fill:"var(--color-eval_7d)"}),e.jsx(Us,{dataKey:"eval_30d",fill:"var(--color-eval_30d)"})]})})})]})]})},zn=Object.freeze(Object.defineProperty({__proto__:null,default:Kr},Symbol.toStringTag,{value:"Module"}));function Wr(){const a=Et();return g.useEffect(()=>{a("/admin/base/processos",{replace:!0})},[a]),null}const Rn=Object.freeze(Object.defineProperty({__proto__:null,default:Wr},Symbol.toStringTag,{value:"Module"}));function Xr(){const n=kt().pathname.includes("/testemunhas")?"testemunhas":"processos";return e.jsxs("div",{className:"flex flex-col h-full bg-gradient-subtle",children:[e.jsxs("div",{className:"border-b bg-background",children:[e.jsxs("div",{className:"flex items-center justify-between p-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h1",{className:"text-2xl font-semibold text-foreground flex items-center gap-2",children:[e.jsx(De,{className:"h-6 w-6 text-primary"}),"Explorar Dados"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Revise, valide e gerencie dados pós-importação com controle de qualidade"})]}),e.jsxs(y,{variant:"outline",className:"gap-2",children:[e.jsx(ws,{className:"h-4 w-4"}),"Exportar"]})]}),e.jsx("div",{className:"px-6",children:e.jsx(ze,{value:n,className:"w-auto",children:e.jsxs(Re,{className:"grid w-fit grid-cols-2",children:[e.jsx(J,{value:"processos",asChild:!0,children:e.jsxs(xa,{to:"/admin/base/processos",className:"flex items-center gap-2",children:[e.jsx(Pa,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Processos"})]})}),e.jsx(J,{value:"testemunhas",asChild:!0,children:e.jsxs(xa,{to:"/admin/base/testemunhas",className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Testemunhas"})]})})]})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Dt,{})})]})}const In=Object.freeze(Object.defineProperty({__proto__:null,default:Xr},Symbol.toStringTag,{value:"Module"})),vs=[{cnj:"5001234-12.2024.5.02.0001",reclamante:"João da Silva Santos",reclamada:"Empresa XYZ Ltda",testemunhas_ativas:["Maria Oliveira","Carlos Pereira"],testemunhas_passivas:["Ana Costa","Pedro Lima"],qtd_testemunhas:4,classificacao:"Atenção",classificacao_estrategica:"Média complexidade",created_at:new Date().toISOString()},{cnj:"5001235-13.2024.5.02.0001",reclamante:"Ana Paula Ferreira",reclamada:"Tech Solutions S.A.",testemunhas_ativas:["Roberto Silva"],testemunhas_passivas:["Lucia Santos","Fernando Costa","Mariana Oliveira"],qtd_testemunhas:4,classificacao:"Crítico",classificacao_estrategica:"Alta complexidade",created_at:new Date(Date.now()-864e5).toISOString()},{cnj:"5001236-14.2024.5.02.0001",reclamante:"Carlos Eduardo Souza",reclamada:"Indústria ABC Ltda",testemunhas_ativas:["Patricia Lima"],testemunhas_passivas:["José Maria"],qtd_testemunhas:2,classificacao:"Normal",classificacao_estrategica:"Baixa complexidade",created_at:new Date(Date.now()-1728e5).toISOString()}],he={uuid:ge().uuid("UUID inválido"),orgId:ge().min(1,"ID da organização é obrigatório"),cnj:ge().refine(a=>{const n=a.replace(/[^\d]/g,"");return n.length===20&&/^\d{20}$/.test(n)},"CNJ deve ter 20 dígitos numéricos"),nonEmptyString:ge().min(1,"Campo obrigatório").trim(),optionalString:ge().optional(),stringArray:Ms(ge()),nonEmptyStringArray:Ms(ge()).min(1,"Pelo menos um item é necessário"),page:es().int().min(1,"Página deve ser >= 1"),limit:es().int().min(1).max(100,"Limite máximo de 100 itens"),filters:zs({search:ge().optional(),classificacao:Ms(ge()).optional(),qtdMin:es().int().min(0).optional(),qtdMax:es().int().min(0).optional()}).optional()};zs({cnj:he.cnj,reclamante:he.nonEmptyString,reclamada:he.nonEmptyString,testemunhas_ativas:he.stringArray,testemunhas_passivas:he.stringArray,qtd_testemunhas:es().int().min(0),classificacao:he.nonEmptyString,classificacao_estrategica:he.optionalString,created_at:ge()});const Hr=zs({filters:he.filters,page:he.page.default(1),limit:he.limit.default(50)});zs({id:he.uuid,organization_id:he.orgId,role:Ft(["admin","user","viewer"]),email:ge().email("E-mail inválido")});function Qr(a,n){const s=a.safeParse(n);if(!s.success){const r=s.error.issues.map(t=>`${t.path.join(".")}: ${t.message}`).join(", ");throw new Error(`Dados inválidos: ${r}`)}return s.data}function Yr(a={},n=50,s=1){const{profile:r}=xe(),[t,l]=g.useState(s),{data:c,isLoading:i,error:o,refetch:j}=Me({queryKey:["assistjur-processos",r?.organization_id,a,t,n],queryFn:async()=>{if(!Js(r?.organization_id))throw Vs.authentication("Organização não encontrada",{profile:r?.id});const m=Qr(Hr,{filters:a,page:t,limit:n});return await Ut(async()=>{const{data:{session:x}}=await R.auth.getSession();if(!x?.access_token)throw Vs.authentication("Sessão expirada");const u=await fetch("https://fgjypmlszuzkgvhuszxn.functions.supabase.co/assistjur-processos",{method:"POST",headers:{Authorization:`Bearer ${x.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(m)});if(!u.ok){const h=await u.json().catch(()=>({}));throw Vs.system(h.detail||`HTTP ${u.status}: ${u.statusText}`,{status:u.status})}const v=await u.json();return!v?.data||v.data.length===0?{data:vs,count:vs.length,totalPages:1}:v},"AssistJurProcessos",{retries:2,timeout:3e4,fallback:{data:vs,count:vs.length,totalPages:1}})},enabled:!!r?.organization_id,retry:(m,x)=>x?.message?.includes("Sessão expirada")||x?.message?.includes("Acesso negado")?!1:m<2,staleTime:300*1e3});return{data:c?.data||[],totalCount:c?.count||0,currentPage:t,totalPages:c?.totalPages||1,isLoading:i,error:o,refetch:j,setPage:l}}const Qa=({className:a,...n})=>e.jsx("nav",{role:"navigation","aria-label":"pagination",className:de("mx-auto flex w-full justify-center",a),...n});Qa.displayName="Pagination";const Ya=g.forwardRef(({className:a,...n},s)=>e.jsx("ul",{ref:s,className:de("flex flex-row items-center gap-1",a),...n}));Ya.displayName="PaginationContent";const bs=g.forwardRef(({className:a,...n},s)=>e.jsx("li",{ref:s,className:de("",a),...n}));bs.displayName="PaginationItem";const Is=({className:a,isActive:n,size:s="icon",...r})=>e.jsx("a",{"aria-current":n?"page":void 0,className:de($t({variant:n?"outline":"ghost",size:s}),a),...r});Is.displayName="PaginationLink";const Za=({className:a,...n})=>e.jsxs(Is,{"aria-label":"Go to previous page",size:"default",className:de("gap-1 pl-2.5",a),...n,children:[e.jsx(Tt,{className:"h-4 w-4"}),e.jsx("span",{children:"Previous"})]});Za.displayName="PaginationPrevious";const et=({className:a,...n})=>e.jsxs(Is,{"aria-label":"Go to next page",size:"default",className:de("gap-1 pr-2.5",a),...n,children:[e.jsx("span",{children:"Next"}),e.jsx(zt,{className:"h-4 w-4"})]});et.displayName="PaginationNext";function Zr(){const[a,n]=Rt(),s={search:a.get("search")||void 0,classificacao:a.get("classificacao")?a.get("classificacao").split(","):void 0},r=Number(a.get("page")||"1"),[t,l]=g.useState(s),[c,i]=g.useState(!1),[o,j]=g.useState(!1),{data:m,totalCount:x,currentPage:f,totalPages:u,isLoading:v,error:h,setPage:N}=Yr(t,50,r);g.useEffect(()=>{const k={};t.search&&(k.search=t.search),t.classificacao?.length&&(k.classificacao=t.classificacao.join(",")),f>1&&(k.page=String(f)),n(k,{replace:!0})},[t,f,n]);const d=k=>{l(A=>({...A,search:k.trim()||void 0})),N(1)},C=k=>{l(k==="all"?A=>({...A,classificacao:void 0}):A=>({...A,classificacao:[k]})),N(1)},T=()=>{l({}),N(1)},q=k=>{switch(k?.toLowerCase()){case"crítico":return"destructive";case"atenção":return"secondary";case"observação":return"outline";default:return"secondary"}},$=()=>{try{const A=[["CNJ","Reclamante","Reclamada","Testemunhas Ativas","Testemunhas Passivas","Qtd Total","Classificação","Data Criação"].join(","),...m.map(Z=>{const I=Z;return[I.cnj,`"${I.reclamante}"`,`"${I.reclamada}"`,`"${I.testemunhas_ativas.join("; ")}"`,`"${I.testemunhas_passivas.join("; ")}"`,I.qtd_testemunhas,`"${I.classificacao}"`,Xe(new Date(I.created_at),"dd/MM/yyyy",{locale:cs})].join(",")})].join(`
`),O=new Blob([A],{type:"text/csv;charset=utf-8;"}),U=document.createElement("a");U.href=URL.createObjectURL(O),U.download=`assistjur-processos-${Xe(new Date,"yyyy-MM-dd")}.csv`,U.click(),te.success(`Exportação concluída: ${m.length} processos`)}catch(k){console.error("Erro na exportação CSV:",k),te.error("Erro ao exportar dados. Tente novamente.")}},S=()=>{window.open("https://supabase.com/dashboard/project/fgjypmlszuzkgvhuszxn/functions/assistjur-processos/logs","_blank"),te.info("Abrindo logs da Edge Function...")};return h?e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-destructive font-medium",children:"Erro ao carregar processos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h.message})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(y,{variant:"outline",onClick:()=>window.location.reload(),children:"Tentar novamente"}),e.jsxs(y,{variant:"outline",onClick:S,size:"sm",children:[e.jsx(It,{className:"h-4 w-4 mr-2"}),"Abrir Logs"]})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Processos AssistJur.IA"}),e.jsxs("p",{className:"text-muted-foreground",children:[x," processos encontrados"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{variant:"outline",onClick:()=>j(!o),children:[e.jsx(Xs,{className:"h-4 w-4 mr-2"}),"Filtros"]}),e.jsx(y,{variant:"outline",onClick:()=>i(!c),children:c?"Mostrar Dados":"Mascarar PII"}),e.jsxs(y,{variant:"outline",onClick:$,children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Exportar CSV"]}),e.jsxs(y,{variant:"outline",onClick:S,size:"sm",children:[e.jsx(Lt,{className:"h-4 w-4 mr-2"}),"Abrir Logs"]})]})]}),o&&e.jsx("div",{className:"border-t pt-4 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Buscar"}),e.jsx(H,{placeholder:"CNJ, reclamante, reclamada...",value:t.search||"",onChange:k=>d(k.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Classificação"}),e.jsxs(ne,{value:t.classificacao?.[0]||"all",onValueChange:C,children:[e.jsx(ie,{children:e.jsx(oe,{placeholder:"Todas"})}),e.jsxs(ce,{children:[e.jsx(V,{value:"all",children:"Todas"}),e.jsx(V,{value:"crítico",children:"Crítico"}),e.jsx(V,{value:"atenção",children:"Atenção"}),e.jsx(V,{value:"observação",children:"Observação"}),e.jsx(V,{value:"normal",children:"Normal"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(y,{variant:"outline",onClick:T,children:[e.jsx(Bs,{className:"h-4 w-4 mr-2"}),"Limpar"]})})]})})]}),e.jsxs(p,{children:[e.jsx("div",{className:"border border-border/50 rounded-2xl overflow-hidden",children:e.jsxs(we,{children:[e.jsx(_e,{children:e.jsxs(K,{className:"bg-muted/30",children:[e.jsx(z,{className:"font-semibold",children:"CNJ"}),e.jsx(z,{className:"font-semibold",children:"Reclamante"}),e.jsx(z,{className:"font-semibold",children:"Reclamada"}),e.jsx(z,{className:"font-semibold",children:"Testemunhas Ativas"}),e.jsx(z,{className:"font-semibold",children:"Testemunhas Passivas"}),e.jsx(z,{className:"font-semibold text-center",children:"Qtd Total"}),e.jsx(z,{className:"font-semibold",children:"Classificação"}),e.jsx(z,{className:"font-semibold",children:"Data"}),e.jsx(z,{className:"font-semibold text-center",children:"Ações"})]})}),e.jsx(ve,{children:v?Array.from({length:5}).map((k,A)=>e.jsxs(K,{children:[e.jsx(E,{className:"h-16",children:e.jsx("div",{className:"animate-pulse bg-muted rounded h-4 w-24"})}),e.jsx(E,{className:"h-16",children:e.jsx("div",{className:"animate-pulse bg-muted rounded h-4 w-32"})}),e.jsx(E,{className:"h-16",children:e.jsx("div",{className:"animate-pulse bg-muted rounded h-4 w-28"})}),e.jsx(E,{className:"h-16",children:e.jsx("div",{className:"animate-pulse bg-muted rounded h-4 w-20"})}),e.jsx(E,{className:"h-16",children:e.jsx("div",{className:"animate-pulse bg-muted rounded h-4 w-20"})}),e.jsx(E,{className:"h-16",children:e.jsx("div",{className:"animate-pulse bg-muted rounded h-4 w-8"})}),e.jsx(E,{className:"h-16",children:e.jsx("div",{className:"animate-pulse bg-muted rounded h-4 w-16"})}),e.jsx(E,{className:"h-16",children:e.jsx("div",{className:"animate-pulse bg-muted rounded h-4 w-12"})}),e.jsx(E,{className:"h-16",children:e.jsx("div",{className:"animate-pulse bg-muted rounded h-4 w-8"})})]},A)):m.length===0?e.jsx(K,{children:e.jsxs(E,{colSpan:9,className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:"Nenhum processo encontrado"}),(t.search||t.classificacao)&&e.jsx(y,{variant:"link",onClick:T,children:"Limpar filtros"})]})}):m.map(k=>{const A=k;return e.jsxs(K,{className:"hover:bg-muted/20",children:[e.jsx(E,{className:"font-mono text-xs max-w-[120px] truncate",children:String(Ns(A.cnj,c))}),e.jsx(E,{className:"font-medium max-w-[150px] truncate",children:String(Ns(A.reclamante,c))}),e.jsx(E,{className:"max-w-[150px] truncate",children:String(Ns(A.reclamada,c))}),e.jsx(E,{className:"max-w-[200px]",children:e.jsx(Gs,{items:A.testemunhas_ativas,maxVisible:2,isPiiMasked:c})}),e.jsx(E,{className:"max-w-[200px]",children:e.jsx(Gs,{items:A.testemunhas_passivas,maxVisible:2,isPiiMasked:c})}),e.jsx(E,{className:"text-center",children:e.jsx(P,{variant:"secondary",className:"text-xs",children:A.qtd_testemunhas})}),e.jsx(E,{children:e.jsx(P,{variant:q(A.classificacao),className:"text-xs",children:A.classificacao})}),e.jsx(E,{className:"text-xs text-muted-foreground",children:Xe(new Date(A.created_at),"dd/MM/yy",{locale:cs})}),e.jsx(E,{children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(y,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(je,{className:"h-4 w-4"})})})})]},A.cnj)})})]})}),u>1&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Página ",f," de ",u," • ",x," registros"]}),e.jsx(Qa,{children:e.jsxs(Ya,{children:[e.jsx(bs,{children:e.jsx(Za,{href:"#","aria-disabled":f<=1,className:f<=1?"pointer-events-none opacity-50":"",onClick:k=>{k.preventDefault(),f>1&&N(f-1)}})}),Array.from({length:u},(k,A)=>e.jsx(bs,{children:e.jsx(Is,{href:"#",isActive:f===A+1,onClick:O=>{O.preventDefault(),N(A+1)},children:A+1})},A)),e.jsx(bs,{children:e.jsx(et,{href:"#","aria-disabled":f>=u,className:f>=u?"pointer-events-none opacity-50":"",onClick:k=>{k.preventDefault(),f<u&&N(f+1)}})})]})})]})]})]})}function st({type:a,onSuccess:n,className:s}){const{profile:r,isAdmin:t}=xe(),{toast:l}=He(),[c,i]=g.useState(!1),[o,j]=g.useState(null),[m,x]=g.useState(""),[f,u]=g.useState({understand:!1,irreversible:!1,backup:!1}),[v,h]=g.useState(!1),[N,d]=g.useState(!1),[C,T]=g.useState(0),[q,$]=g.useState("preview"),[S,k]=g.useState("soft"),[A,O]=g.useState(10);g.useEffect(()=>{},[t,r?.organization_id]);const U=r?.organization_id||"",Z=m===U,I=Object.values(f).every(Boolean),le=Z&&I&&A===0,ee=!!(t&&r?.organization_id);g.useEffect(()=>{if(q==="confirm"&&A>0){const B=setTimeout(()=>O(W=>W-1),1e3);return()=>clearTimeout(B)}},[q,A]),g.useEffect(()=>{c&&!o&&ee&&G()},[c,ee]);const G=async()=>{if(!ee){l({title:"Acesso negado",description:"Você precisa ser um administrador para executar esta operação",variant:"destructive"});return}d(!0);try{const{data:B,error:W}=await R.rpc("rpc_get_deletion_impact",{p_org_id:r.organization_id});if(W)throw W;j(B)}catch(B){l({title:"Erro ao carregar dados",description:B instanceof Error?B.message:"Não foi possível carregar o impacto da exclusão",variant:"destructive"})}finally{d(!1)}},pe=async()=>{if(r?.organization_id){h(!0),$("executing"),T(0);try{T(25);let B=null;try{const{data:W,error:Ie}=await R.functions.invoke("processes-delete-all",{body:{confirm:r.organization_id,hard_delete:S==="hard"}});if(Ie)throw Ie;if(W?.error)throw new Error(W.message||W.error);B={success:W.success,deleted_count:W.deleted_count,operation_type:W.operation_type,message:W.message}}catch{const{data:Ie,error:D}=await R.rpc("rpc_delete_all_processos",{p_org_id:r.organization_id,p_hard_delete:S==="hard"});if(D)throw D;B=Ie}if(T(75),a==="processos"&&B){const{error:W}=await R.rpc("rpc_cleanup_derived_data",{p_org_id:r.organization_id})}T(100),B&&(l({title:"Exclusão concluída",description:`${B.deleted_count} registros foram ${S==="hard"?"permanentemente excluídos":"marcados para exclusão"}`}),n?.(),i(!1),Ce())}catch(B){l({title:"Erro na exclusão",description:B instanceof Error?B.message:"Erro desconhecido durante a exclusão",variant:"destructive"})}finally{h(!1)}}},ue=async()=>{if(r?.organization_id){h(!0),$("executing"),T(0);try{T(50);const{data:B,error:W}=await R.rpc("rpc_cleanup_derived_data",{p_org_id:r.organization_id});if(W)throw W;const Ie=B;T(100),l({title:"Limpeza concluída",description:`${Ie.deleted_count} registros de testemunhas órfãs foram removidos`}),n?.(),i(!1),Ce()}catch(B){l({title:"Erro na limpeza",description:B instanceof Error?B.message:"Erro desconhecido durante a limpeza",variant:"destructive"})}finally{h(!1)}}},Ce=()=>{$("preview"),x(""),u({understand:!1,irreversible:!1,backup:!1}),T(0),O(10),j(null)},Qe=()=>{v||(i(!1),Ce())},Be=()=>{switch(a){case"processos":return"Excluir Todos os Processos";case"testemunhas":return"Limpar Dados de Testemunhas";default:return"Excluir Dados"}},Je=()=>{switch(a){case"processos":return"Exclusão em Massa - Processos";case"testemunhas":return"Limpeza de Dados - Testemunhas";default:return"Exclusão em Massa"}},Ls=()=>{switch(a){case"processos":return"Esta operação irá excluir todos os processos da organização";case"testemunhas":return"Esta operação irá limpar dados de testemunhas órfãs (sem processos associados)";default:return"Esta operação irá excluir dados da organização"}};return e.jsxs(ea,{open:c,onOpenChange:Qe,children:[e.jsx(Ra,{asChild:!0,children:e.jsxs(y,{variant:"destructive",size:"sm",className:s,onClick:()=>i(!0),disabled:!ee,title:ee?"":"Acesso negado - apenas administradores",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),Be()]})}),e.jsxs(sa,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(aa,{children:[e.jsxs(ta,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5 text-destructive"}),Je()]}),e.jsx(ra,{children:Ls()})]}),e.jsxs("div",{className:"space-y-4",children:[q==="preview"&&N&&e.jsx(p,{children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2",children:"Carregando dados..."})]})})}),q==="preview"&&!ee&&e.jsx(p,{children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-center py-8 text-destructive",children:[e.jsx(me,{className:"h-8 w-8 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Acesso Negado"}),e.jsx("div",{className:"text-sm",children:"Apenas administradores podem executar esta operação"})]})]})})}),q==="preview"&&o&&ee&&e.jsxs(p,{children:[e.jsx(w,{children:e.jsxs(_,{className:"text-base flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"Impacto da Operação"]})}),e.jsxs(b,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx(M,{children:"Processos Ativos"}),e.jsx("div",{className:"text-lg font-semibold",children:o.active_processos})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Processos Já Excluídos"}),e.jsx("div",{className:"text-lg font-semibold text-muted-foreground",children:o.soft_deleted_processos})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Registros de Pessoas"}),e.jsx("div",{className:"text-lg font-semibold",children:o.total_pessoas})]}),e.jsxs("div",{children:[e.jsx(M,{children:"Tempo Estimado"}),e.jsxs("div",{className:"text-lg font-semibold",children:[o.estimated_deletion_time_minutes," min"]})]})]}),a==="processos"&&e.jsxs("div",{className:"mt-4",children:[e.jsx(M,{children:"Tipo de Exclusão"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(y,{variant:S==="soft"?"default":"outline",size:"sm",onClick:()=>k("soft"),children:"Exclusão Reversível (Recomendado)"}),e.jsx(y,{variant:S==="hard"?"destructive":"outline",size:"sm",onClick:()=>k("hard"),children:"Exclusão Permanente"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:S==="soft"?"Os dados serão marcados como excluídos mas podem ser restaurados":"Os dados serão permanentemente removidos do banco de dados"})]})]})]}),q==="confirm"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-destructive mb-2",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:"ATENÇÃO: Operação Crítica"})]}),e.jsxs("p",{className:"text-sm text-destructive/80",children:["Esta é uma operação irreversível que afetará"," ",o?.active_processos," processos ativos.",S==="hard"&&" A exclusão será PERMANENTE."]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"confirmation",children:["Para confirmar, digite o ID da organização:"," ",e.jsx("code",{children:U})]}),e.jsx(H,{id:"confirmation",value:m,onChange:B=>x(B.target.value),placeholder:"Digite o ID da organização"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(We,{id:"understand",checked:f.understand,onCheckedChange:B=>u(W=>({...W,understand:B}))}),e.jsx(M,{htmlFor:"understand",className:"text-sm",children:"Eu entendo que esta operação não pode ser desfeita"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(We,{id:"irreversible",checked:f.irreversible,onCheckedChange:B=>u(W=>({...W,irreversible:B}))}),e.jsx(M,{htmlFor:"irreversible",className:"text-sm",children:"Eu confirmo que tenho autorização para executar esta operação"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(We,{id:"backup",checked:f.backup,onCheckedChange:B=>u(W=>({...W,backup:B}))}),e.jsx(M,{htmlFor:"backup",className:"text-sm",children:"Eu confirmo que foi feito backup dos dados (se necessário)"})]})]}),A>0&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm",children:["Aguarde ",A,"s antes de prosseguir"]})]})]})]}),q==="executing"&&e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-2",children:"Executando operação..."}),e.jsx(ds,{value:C,className:"w-full"}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[C,"% concluído"]})]})})]}),e.jsxs(na,{children:[e.jsx(ia,{onClick:Qe,disabled:v,children:"Cancelar"}),q==="preview"&&ee&&o&&e.jsx(As,{onClick:()=>$("confirm"),className:"bg-destructive hover:bg-destructive/90",children:"Continuar"}),q==="confirm"&&e.jsx(As,{onClick:a==="processos"?pe:ue,disabled:!le||v,className:"bg-destructive hover:bg-destructive/90",children:A>0?`Aguarde ${A}s`:"Executar Exclusão"})]})]})]})}function en({onSuccess:a,className:n}){const{profile:s}=xe(),{toast:r}=He(),[t,l]=g.useState(!1),c=async()=>{if(!s?.organization_id){r({title:"Erro",description:"Organização não encontrada",variant:"destructive"});return}l(!0);try{const{data:i,error:o}=await R.rpc("rpc_restore_all_processos",{p_org_id:s.organization_id});if(o)throw o;const j=i;if(j.success)r({title:"Restauração concluída",description:`${j.restored_count} processos foram restaurados com sucesso`}),a?.();else throw new Error(j.message)}catch(i){console.error("Error restoring processes:",i),r({title:"Erro na restauração",description:i instanceof Error?i.message:"Erro desconhecido durante a restauração",variant:"destructive"})}finally{l(!1)}};return e.jsxs(y,{variant:"outline",size:"sm",onClick:c,disabled:t,className:n,children:[e.jsx(is,{className:`h-4 w-4 mr-2 ${t?"animate-spin":""}`}),t?"Restaurando...":"Restaurar Excluídos"]})}function sn(){return e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{children:e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(_,{children:"Gestão de Processos - AssistJur.IA"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Visualizar e gerenciar processos do pipeline AssistJur.IA"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(en,{}),e.jsx(st,{type:"processos"})]})]})})}),e.jsx(Zr,{})]})}const Ln=Object.freeze(Object.defineProperty({__proto__:null,default:sn},Symbol.toStringTag,{value:"Module"})),ba=[{value:"ERROR",label:"Erro",color:"bg-destructive text-destructive-foreground"},{value:"WARNING",label:"Atenção",color:"bg-warning text-warning-foreground"},{value:"INFO",label:"Info",color:"bg-primary text-primary-foreground"},{value:"OK",label:"OK",color:"bg-success text-success-foreground"}];function an({searchTerm:a,onSearchChange:n,selectedSeverity:s,onSeverityChange:r,onClearFilters:t,hasActiveFilters:l}){const[c,i]=g.useState(!1),o=m=>{const x=s.includes(m)?s.filter(f=>f!==m):[...s,m];r(x)},j=m=>{r(s.filter(x=>x!==m))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Aa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(H,{placeholder:"Buscar por CNJ, reclamante, réu ou testemunha...",value:a,onChange:m=>n(m.target.value),className:"pl-10 pr-4 h-10"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs(Bt,{open:c,onOpenChange:i,children:[e.jsx(Jt,{asChild:!0,children:e.jsxs(y,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Xs,{className:"h-4 w-4"}),"Filtros",l&&e.jsx(P,{variant:"secondary",className:"ml-1 px-1.5 py-0.5 text-xs",children:s.length})]})}),e.jsx(Gt,{className:"w-80 p-4",align:"start",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Filtrar por Severidade"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ba.map(m=>e.jsxs(y,{variant:s.includes(m.value)?"default":"outline",size:"sm",onClick:()=>o(m.value),className:"justify-start gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${m.color}`}),m.label]},m.value))}),e.jsxs("div",{className:"flex justify-between pt-2 border-t",children:[e.jsxs(y,{variant:"ghost",size:"sm",className:"gap-2",children:[e.jsx(Da,{className:"h-4 w-4"}),"Salvar Filtro"]}),e.jsxs(y,{variant:"ghost",size:"sm",className:"gap-2",children:[e.jsx(Ot,{className:"h-4 w-4"}),"Filtros Salvos"]})]})]})})]}),s.map(m=>{const x=ba.find(f=>f.value===m);return e.jsxs(P,{variant:"secondary",className:"gap-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${x?.color}`}),x?.label,e.jsx(y,{variant:"ghost",size:"sm",className:"h-auto p-0 ml-1 hover:bg-transparent",onClick:()=>j(m),children:e.jsx(Bs,{className:"h-3 w-3"})})]},m)}),l&&e.jsxs(y,{variant:"ghost",size:"sm",onClick:t,className:"gap-2 text-muted-foreground",children:[e.jsx(Bs,{className:"h-4 w-4"}),"Limpar Filtros"]})]})]})}function tn({selectedCount:a,onRevalidate:n,onNormalizeCNJ:s,onFillDefaultReu:r,onMergeDuplicates:t,onDelete:l,onExport:c,isLoading:i=!1,showTestemunhaActions:o=!1}){return a===0?e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/30 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(fe,{className:"h-4 w-4"}),"Selecione registros para executar ações em massa"]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:c,className:"gap-2",children:[e.jsx(ws,{className:"h-4 w-4"}),"Exportar Todos"]})]}):e.jsxs("div",{className:"flex items-center justify-between p-4 bg-primary/5 border border-primary/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(P,{variant:"outline",className:"bg-primary/10 text-primary border-primary/30",children:[a," selecionado",a>1?"s":""]})}),e.jsx(ha,{orientation:"vertical",className:"h-6"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:n,disabled:i,className:"gap-2",children:[e.jsx(is,{className:"h-4 w-4"}),"Revalidar"]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:s,disabled:i,className:"gap-2",children:[e.jsx(Mt,{className:"h-4 w-4"}),"Normalizar CNJ"]}),o&&r&&e.jsxs(y,{variant:"outline",size:"sm",onClick:r,disabled:i,className:"gap-2",children:[e.jsx(Ea,{className:"h-4 w-4"}),"Aplicar Réu Padrão"]}),e.jsx(ha,{orientation:"vertical",className:"h-6"}),e.jsxs(y,{variant:"outline",size:"sm",onClick:t,disabled:i,className:"gap-2",children:[e.jsx(Vt,{className:"h-4 w-4"}),"Mesclar Duplicados"]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:l,disabled:i,className:"gap-2 text-destructive hover:text-destructive",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Excluir"]})]})]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:c,className:"gap-2",children:[e.jsx(ws,{className:"h-4 w-4"}),"Exportar Seleção"]})]})}const rn={OK:{icon:qt,label:"OK",className:"bg-success text-success-foreground hover:bg-success/90"},WARNING:{icon:me,label:"Atenção",className:"bg-warning text-warning-foreground hover:bg-warning/90"},ERROR:{icon:re,label:"Erro",className:"bg-destructive text-destructive-foreground hover:bg-destructive/90"},INFO:{icon:ys,label:"Info",className:"bg-primary text-primary-foreground hover:bg-primary/90"}};function nn({severity:a,score:n,className:s="",size:r="default"}){const t=rn[a],l=t.icon,c=r==="sm"?"text-xs px-2 py-0.5":"text-sm px-2.5 py-1";return e.jsxs(P,{className:`
        ${t.className} 
        ${c}
        font-semibold 
        shadow-sm 
        flex items-center gap-1.5
        ${s}
      `,children:[e.jsx(l,{className:r==="sm"?"h-3 w-3":"h-4 w-4"}),e.jsx("span",{children:t.label}),n!==void 0&&e.jsxs("span",{className:"ml-1 opacity-90",children:["(",n,")"]})]})}function on(){const{profile:a}=xe(),{toast:n}=He(),[s,r]=g.useState(""),[t,l]=g.useState([]),[c,i]=g.useState(new Set),[o,j]=g.useState(1),[m]=g.useState(50),[x,f]=g.useState(!1),{data:u,isLoading:v,error:h,refetch:N}=Me({queryKey:["admin-testemunhas",a?.organization_id,s,o,m],queryFn:async()=>{if(!a?.organization_id)throw new Error("Organização não encontrada");const{data:I}=await R.auth.getSession(),le=I?.session?.access_token;if(!le)throw new Error("Usuário não autenticado");const{data:ee,error:G}=await R.functions.invoke("mapa-testemunhas-testemunhas",{body:{paginacao:{page:o,limit:m},filtros:{search:s.trim()||void 0}},headers:{"Content-Type":"application/json",Authorization:`Bearer ${le}`}});if(G)throw G;return ee},enabled:!!a?.organization_id,staleTime:300*1e3}),d=u?.data||[],C=u?.total_witnesses||0,T=u?.total_processos||0,q=async()=>{if(c.size!==0)try{n({title:"Funcionalidade em desenvolvimento",description:"Aplicar réu padrão será implementado em breve"})}catch(I){n({title:"Erro ao aplicar réu padrão",description:I instanceof Error?I.message:"Erro desconhecido",variant:"destructive"})}},$=I=>{const le=new Set(c);le.has(I)?le.delete(I):le.add(I),i(le)},S=()=>{c.size===d?.length?i(new Set):i(new Set(d?.map(I=>I.nome_testemunha)))},k=s.trim()!=="",A=()=>{r(""),l([]),j(1)},O=({value:I})=>I===null?e.jsx("span",{className:"text-muted-foreground",children:"—"}):I?e.jsx(Q,{className:"h-4 w-4 text-success"}):e.jsx(Hs,{className:"h-4 w-4 text-muted-foreground"}),U=I=>{switch(I?.toLowerCase()){case"crítico":return"destructive";case"atenção":return"secondary";case"observação":return"outline";default:return"secondary"}},Z=I=>{switch(I?.toLowerCase()){case"crítico":return"ERROR";case"atenção":return"WARNING";case"observação":return"INFO";default:return"OK"}};return h?e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("p",{className:"text-destructive",children:["Erro ao carregar dados: ",h.message]}),e.jsx(y,{variant:"outline",onClick:()=>N(),children:"Tentar novamente"})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gestão de Testemunhas"}),e.jsxs("p",{className:"text-muted-foreground",children:[C," testemunhas encontradas em ",T," ","processos da organização"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(st,{type:"testemunhas",onSuccess:()=>N()}),e.jsx(y,{variant:"outline",onClick:()=>f(!x),children:x?"Mostrar Dados":"Mascarar PII"})]})]})}),e.jsx(an,{searchTerm:s,onSearchChange:r,selectedSeverity:t,onSeverityChange:l,onClearFilters:A,hasActiveFilters:k}),e.jsx(tn,{selectedCount:c.size,onRevalidate:()=>N(),onNormalizeCNJ:()=>{},onFillDefaultReu:q,onMergeDuplicates:()=>{},onDelete:()=>{},onExport:()=>{},isLoading:v,showTestemunhaActions:!0}),e.jsx("div",{className:"border border-border/50 rounded-2xl overflow-hidden",children:e.jsxs(we,{children:[e.jsx(_e,{children:e.jsxs(K,{className:"bg-muted/30",children:[e.jsx(z,{className:"w-12",children:e.jsx(We,{checked:d?.length>0&&c.size===d.length,onCheckedChange:S})}),e.jsx(z,{className:"font-semibold",children:"Nome da Testemunha"}),e.jsx(z,{className:"font-semibold text-center",children:"Qtd Depoimentos"}),e.jsx(z,{className:"font-semibold text-center",children:"Ambos os Polos"}),e.jsx(z,{className:"font-semibold text-center",children:"Já Foi Reclamante"}),e.jsx(z,{className:"font-semibold",children:"CNJs como Testemunha"}),e.jsx(z,{className:"font-semibold",children:"Classificação"}),e.jsx(z,{className:"font-semibold",children:"Qualidade"}),e.jsx(z,{className:"font-semibold text-center",children:"Ações"})]})}),e.jsx(ve,{children:v?Array.from({length:5}).map((I,le)=>e.jsx(K,{children:e.jsx(E,{colSpan:9,className:"h-16",children:e.jsx("div",{className:"animate-pulse bg-muted rounded h-4 w-full"})})},le)):d?.length===0?e.jsx(K,{children:e.jsxs(E,{colSpan:9,className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma testemunha encontrada"}),k&&e.jsx(y,{variant:"link",onClick:A,children:"Limpar filtros"})]})}):d?.map(I=>e.jsxs(K,{className:"hover:bg-muted/20",children:[e.jsx(E,{children:e.jsx(We,{checked:c.has(I.nome_testemunha),onCheckedChange:()=>$(I.nome_testemunha)})}),e.jsx(E,{className:"font-medium max-w-[200px] truncate",children:String(Ns(I.nome_testemunha,x))}),e.jsx(E,{className:"text-center",children:e.jsx(P,{variant:"secondary",className:"text-xs",children:I.qtd_depoimentos||0})}),e.jsx(E,{className:"text-center",children:e.jsx(O,{value:I.foi_testemunha_em_ambos_polos})}),e.jsx(E,{className:"text-center",children:e.jsx(O,{value:I.ja_foi_reclamante})}),e.jsx(E,{children:e.jsx(Gs,{items:I.cnjs_como_testemunha??null,maxVisible:2,isPiiMasked:x})}),e.jsx(E,{children:e.jsx(P,{variant:U(I.classificacao_estrategica??null),className:"text-xs",children:I.classificacao_estrategica||"Normal"})}),e.jsx(E,{children:e.jsx(nn,{severity:Z(I.classificacao_estrategica??null),score:I.qtd_depoimentos?Math.min(100,I.qtd_depoimentos*20):50,size:"sm"})}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(y,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Ta,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:e.jsx(Fe,{className:"h-4 w-4"})})]})})]},I.nome_testemunha))})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Mostrando ",d?.length||0," de ",C," ","testemunhas"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{variant:"outline",size:"sm",onClick:()=>j(Math.max(1,o-1)),disabled:o<=1,children:"Anterior"}),e.jsxs("span",{className:"text-sm",children:["Página ",o," de ",Math.ceil(C/m)]}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>j(o+1),disabled:o>=Math.ceil(C/m),children:"Próxima"})]})]})]})}const On=Object.freeze(Object.defineProperty({__proto__:null,default:on},Symbol.toStringTag,{value:"Module"}));export{gn as A,In as B,wn as C,pn as D,zn as F,vn as I,Pn as K,_n as M,bn as O,En as P,yn as S,On as T,Nn as V,Cn as a,Sn as b,An as c,kn as d,Dn as e,Tn as f,Rn as g,Ln as h,fn as i};
