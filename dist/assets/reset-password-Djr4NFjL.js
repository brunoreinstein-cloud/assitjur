import{r as a,u as b,j as e}from"./vendor-B4dDctVk.js";import{s as o}from"./page-About-BOeQq8Je.js";import"./page-Login-foFjYdyQ.js";function R(){const[p,m]=a.useState(!1),[i,h]=a.useState(""),[u,f]=a.useState(""),[l,t]=a.useState(null),[c,x]=a.useState(null),[d,r]=a.useState(!1),g=b();a.useEffect(()=>{window.location.hash&&history.replaceState(null,"",window.location.pathname);const{data:{subscription:s}}=o.auth.onAuthStateChange(n=>{n==="PASSWORD_RECOVERY"?m(!0):t("Link inválido ou expirado. Solicite novamente.")});return o.auth.getSession().then(({data:{session:n}})=>{n||t("Link inválido ou expirado. Solicite novamente.")}),()=>s.unsubscribe()},[]);const v=async s=>{if(s.preventDefault(),t(null),r(!0),!i||i!==u){t("As senhas não conferem."),r(!1);return}const{data:n,error:w}=await o.auth.getUser();if(w||!n?.user){t("Link inválido ou expirado. Solicite novamente."),r(!1);return}const{error:S}=await o.auth.updateUser({password:i});if(S){t("Não foi possível redefinir a senha."),r(!1);return}await o.auth.signOut(),x("Senha atualizada com sucesso. Redirecionando para login..."),r(!1),setTimeout(()=>g("/login"),1500)};return p?e.jsxs("form",{onSubmit:v,className:"space-y-4 max-w-md mx-auto p-4",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Nova senha"}),e.jsx("input",{type:"password",value:i,onChange:s=>h(s.target.value),required:!0,className:"border p-2 w-full",placeholder:"Nova senha"})]}),e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Confirmar senha"}),e.jsx("input",{type:"password",value:u,onChange:s=>f(s.target.value),required:!0,className:"border p-2 w-full",placeholder:"Confirme a senha"})]}),e.jsx("button",{type:"submit",disabled:d,className:`bg-primary text-white px-4 py-2 rounded ${d?"opacity-50 cursor-not-allowed":""}`,children:"Atualizar senha"}),l&&e.jsx("p",{className:"text-destructive text-sm",children:l}),c&&e.jsx("p",{className:"text-sm",children:c})]}):l?e.jsx("p",{className:"text-destructive text-sm text-center",children:l}):null}export{R as default};
