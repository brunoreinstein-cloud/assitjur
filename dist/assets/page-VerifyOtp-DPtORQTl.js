import{r as d,F as w,j as e,ck as x,L as j,P as g,u as F,ah as V}from"./vendor-B8znzfp2.js";import{L as E,I as k,u as p,d as D,f as T,g as y,A as C}from"./page-Login-C96z17Ba.js";import{q as S,r as _,B as b,v as O}from"./page-About-Cx_WpGeO.js";import{v as A}from"./page-TwoFactorSetup-DVpJ3fYV.js";const I=_({code:O().length(6,"Código deve ter 6 dígitos").regex(/^\d{6}$/,"Código deve conter apenas números")}),L=({onBack:t,onSuccess:l,userEmail:i,secret:s,backupCode:f})=>{const[m,r]=d.useState(!1),[u,N]=d.useState(0),a=w({resolver:S(I),defaultValues:{code:""}}),n=async c=>{r(!0);try{await A(c.code,s)||f&&c.code===f?(p.success("Verificação concluída!",{description:"Acesso autorizado com sucesso."}),l()):(N(v=>v+1),u>=2?(p.error("Muitas tentativas",{description:"Conta temporariamente bloqueada. Tente novamente em 15 minutos."}),t()):(p.error("Código inválido",{description:`Código incorreto. Tentativas restantes: ${3-u-1}`}),a.reset()))}catch(o){console.error("2FA verification error:",o),p.error("Erro na verificação",{description:"Não foi possível verificar o código. Tente novamente."})}finally{r(!1)}},h=c=>{const o=c.replace(/\D/g,"").slice(0,6);return o.length<=3?o:`${o.slice(0,3)} ${o.slice(3)}`};return e.jsxDEV("div",{className:"space-y-6",children:[e.jsxDEV("div",{className:"text-center space-y-2",children:[e.jsxDEV("div",{className:"mx-auto p-3 bg-primary/10 rounded-full w-fit",children:e.jsxDEV(x,{className:"h-6 w-6 text-primary"},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:95,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:94,columnNumber:9},void 0),e.jsxDEV("h3",{className:"text-lg font-semibold",children:"Verificação em duas etapas"},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:97,columnNumber:9},void 0),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Digite o código de 6 dígitos do seu aplicativo autenticador"},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:98,columnNumber:9},void 0),i&&e.jsxDEV("p",{className:"text-xs text-muted-foreground",children:["Entrando como: ",e.jsxDEV("strong",{children:i},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:103,columnNumber:28},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:102,columnNumber:11},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:93,columnNumber:7},void 0),e.jsxDEV("form",{onSubmit:a.handleSubmit(n),className:"space-y-4",children:[e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(E,{htmlFor:"code",children:"Código de verificação"},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:113,columnNumber:11},void 0),e.jsxDEV(k,{id:"code",placeholder:"000 000",...a.register("code"),onChange:c=>{const o=h(c.target.value);a.setValue("code",o.replace(" ","")),c.target.value=o},className:`text-center text-2xl font-mono tracking-widest ${a.formState.errors.code?"border-destructive":""}`,maxLength:7,autoFocus:!0,autoComplete:"one-time-code"},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:114,columnNumber:11},void 0),a.formState.errors.code&&e.jsxDEV("p",{className:"text-sm text-destructive",children:a.formState.errors.code.message},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:131,columnNumber:13},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:112,columnNumber:9},void 0),e.jsxDEV("div",{className:"space-y-3",children:[e.jsxDEV(b,{type:"submit",className:"w-full",disabled:m||a.watch("code").length!==6,children:m?e.jsxDEV(e.Fragment,{children:[e.jsxDEV(j,{className:"h-4 w-4 animate-spin mr-2"},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:145,columnNumber:17},void 0),"Verificando..."]},void 0,!0,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:144,columnNumber:15},void 0):e.jsxDEV(e.Fragment,{children:[e.jsxDEV(x,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:150,columnNumber:17},void 0),"Verificar código"]},void 0,!0,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:149,columnNumber:15},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:138,columnNumber:11},void 0),e.jsxDEV("div",{className:"flex justify-center",children:e.jsxDEV(b,{type:"button",variant:"ghost",onClick:t,disabled:m,className:"text-xs",children:[e.jsxDEV(g,{className:"h-3 w-3 mr-1"},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:164,columnNumber:15},void 0),"Voltar"]},void 0,!0,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:157,columnNumber:13},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:156,columnNumber:11},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:137,columnNumber:9},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:108,columnNumber:7},void 0),e.jsxDEV("div",{className:"text-center text-xs text-muted-foreground",children:e.jsxDEV("p",{children:"Não consegue acessar seu autenticador? Utilize o código de backup fornecido ao habilitar o 2FA."},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:173,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:172,columnNumber:7},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:92,columnNumber:5},void 0)},R=()=>{const t=F(),[l]=V(),{user:i,profile:s}=D(),[f,m]=d.useState(""),r=l.get("next"),u=l.get("email");d.useEffect(()=>{if(i&&s&&!s.two_factor_enabled){const n=r?decodeURIComponent(r):"/dados/mapa";t(n)}},[i,s,t,r]),d.useEffect(()=>{u?m(u):i?.email&&m(i.email)},[u,i]),d.useEffect(()=>{if(s&&!s.two_factor_enabled){const n=r?decodeURIComponent(r):"/dados/mapa";t(n)}},[s,t,r]);const N=()=>{sessionStorage.setItem("mfa_verified","true");const n=r?decodeURIComponent(r):"/dados/mapa";t(n)},a=()=>{t("/login")};return!s?.two_factor_enabled||!s.two_factor_secret?null:e.jsxDEV("div",{className:"min-h-screen bg-gradient-subtle flex flex-col justify-center px-6 py-12",children:e.jsxDEV("div",{className:"mx-auto w-full max-w-md",children:[e.jsxDEV("div",{className:"flex items-center justify-center mb-8",children:e.jsxDEV(T,{size:"lg",className:"gap-3"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/VerifyOtp.tsx",lineNumber:61,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/VerifyOtp.tsx",lineNumber:60,columnNumber:9},void 0),e.jsxDEV("div",{className:"mb-6",children:e.jsxDEV(y,{variant:"info",title:"Verificação adicional necessária",children:"Sua conta possui verificação em duas etapas ativada para maior segurança."},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/VerifyOtp.tsx",lineNumber:66,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/VerifyOtp.tsx",lineNumber:65,columnNumber:9},void 0),e.jsxDEV(C,{title:"Verificação em duas etapas",description:"Confirme sua identidade para continuar",children:e.jsxDEV(L,{onBack:a,onSuccess:N,userEmail:f,secret:s.two_factor_secret,backupCode:s.two_factor_backup_code??void 0},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/VerifyOtp.tsx",lineNumber:76,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/VerifyOtp.tsx",lineNumber:72,columnNumber:9},void 0),e.jsxDEV("div",{className:"mt-8 text-center",children:e.jsxDEV("p",{className:"text-xs text-muted-foreground",children:"Esta verificação adicional protege sua conta e dados sensíveis."},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/VerifyOtp.tsx",lineNumber:87,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/VerifyOtp.tsx",lineNumber:86,columnNumber:9},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/VerifyOtp.tsx",lineNumber:58,columnNumber:7},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/VerifyOtp.tsx",lineNumber:57,columnNumber:5},void 0)};export{R as default};
