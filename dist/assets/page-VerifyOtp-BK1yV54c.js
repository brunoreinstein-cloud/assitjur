import{r as d,y as h,j as e,ck as v,L as j,N as g,u as F,ag as V}from"./vendor-Dx8Do5_C.js";import{L as C,I as O,u as b,d as w,f as E,g as U,A as H}from"./page-Login-DUMc8B3X.js";import{r as T,u as G,B as x,w as y}from"./page-About-B_AWXTGA.js";import{v as S}from"./page-TwoFactorSetup-KQHoq_Hf.js";const _=G({code:y().length(6,"Código deve ter 6 dígitos").regex(/^\d{6}$/,"Código deve conter apenas números")}),A=({onBack:n,onSuccess:l,userEmail:i,secret:s,backupCode:f})=>{const[c,r]=d.useState(!1),[m,N]=d.useState(0),o=h({resolver:T(_),defaultValues:{code:""}}),a=async u=>{r(!0);try{await S(u.code,s)||f&&u.code===f?(b.success("Verificação concluída!",{description:"Acesso autorizado com sucesso."}),l()):(N(D=>D+1),m>=2?(b.error("Muitas tentativas",{description:"Conta temporariamente bloqueada. Tente novamente em 15 minutos."}),n()):(b.error("Código inválido",{description:`Código incorreto. Tentativas restantes: ${3-m-1}`}),o.reset()))}catch(t){console.error("2FA verification error:",t),b.error("Erro na verificação",{description:"Não foi possível verificar o código. Tente novamente."})}finally{r(!1)}},p=u=>{const t=u.replace(/\D/g,"").slice(0,6);return t.length<=3?t:`${t.slice(0,3)} ${t.slice(3)}`};return e.jsxDEV("div",{className:"space-y-6",children:[e.jsxDEV("div",{className:"text-center space-y-2",children:[e.jsxDEV("div",{className:"mx-auto p-3 bg-primary/10 rounded-full w-fit",children:e.jsxDEV(v,{className:"h-6 w-6 text-primary"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:95,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:94,columnNumber:9},void 0),e.jsxDEV("h3",{className:"text-lg font-semibold",children:"Verificação em duas etapas"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:97,columnNumber:9},void 0),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Digite o código de 6 dígitos do seu aplicativo autenticador"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:98,columnNumber:9},void 0),i&&e.jsxDEV("p",{className:"text-xs text-muted-foreground",children:["Entrando como: ",e.jsxDEV("strong",{children:i},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:103,columnNumber:28},void 0)]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:102,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:93,columnNumber:7},void 0),e.jsxDEV("form",{onSubmit:o.handleSubmit(a),className:"space-y-4",children:[e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(C,{htmlFor:"code",children:"Código de verificação"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:113,columnNumber:11},void 0),e.jsxDEV(O,{id:"code",placeholder:"000 000",...o.register("code"),onChange:u=>{const t=p(u.target.value);o.setValue("code",t.replace(" ","")),u.target.value=t},className:`text-center text-2xl font-mono tracking-widest ${o.formState.errors.code?"border-destructive":""}`,maxLength:7,autoFocus:!0,autoComplete:"one-time-code"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:114,columnNumber:11},void 0),o.formState.errors.code&&e.jsxDEV("p",{className:"text-sm text-destructive",children:o.formState.errors.code.message},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:131,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:112,columnNumber:9},void 0),e.jsxDEV("div",{className:"space-y-3",children:[e.jsxDEV(x,{type:"submit",className:"w-full",disabled:c||o.watch("code").length!==6,children:c?e.jsxDEV(e.Fragment,{children:[e.jsxDEV(j,{className:"h-4 w-4 animate-spin mr-2"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:145,columnNumber:17},void 0),"Verificando..."]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:144,columnNumber:15},void 0):e.jsxDEV(e.Fragment,{children:[e.jsxDEV(v,{className:"h-4 w-4 mr-2"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:150,columnNumber:17},void 0),"Verificar código"]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:149,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:138,columnNumber:11},void 0),e.jsxDEV("div",{className:"flex justify-center",children:e.jsxDEV(x,{type:"button",variant:"ghost",onClick:n,disabled:c,className:"text-xs",children:[e.jsxDEV(g,{className:"h-3 w-3 mr-1"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:164,columnNumber:15},void 0),"Voltar"]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:157,columnNumber:13},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:156,columnNumber:11},void 0)]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:137,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:108,columnNumber:7},void 0),e.jsxDEV("div",{className:"text-center text-xs text-muted-foreground",children:e.jsxDEV("p",{children:"Não consegue acessar seu autenticador? Utilize o código de backup fornecido ao habilitar o 2FA."},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:173,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:172,columnNumber:7},void 0)]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/components/auth/TwoFactorForm.tsx",lineNumber:92,columnNumber:5},void 0)},$=()=>{const n=F(),[l]=V(),{user:i,profile:s}=w(),[f,c]=d.useState(""),r=l.get("next"),m=l.get("email");d.useEffect(()=>{if(i&&s&&!s.two_factor_enabled){const a=r?decodeURIComponent(r):"/dados/mapa";n(a)}},[i,s,n,r]),d.useEffect(()=>{m?c(m):i?.email&&c(i.email)},[m,i]),d.useEffect(()=>{if(s&&!s.two_factor_enabled){const a=r?decodeURIComponent(r):"/dados/mapa";n(a)}},[s,n,r]);const N=()=>{sessionStorage.setItem("mfa_verified","true");const a=r?decodeURIComponent(r):"/dados/mapa";n(a)},o=()=>{n("/login")};return!s?.two_factor_enabled||!s.two_factor_secret?null:e.jsxDEV("div",{className:"min-h-screen bg-gradient-subtle flex flex-col justify-center px-6 py-12",children:e.jsxDEV("div",{className:"mx-auto w-full max-w-md",children:[e.jsxDEV("div",{className:"flex items-center justify-center mb-8",children:e.jsxDEV(E,{size:"lg",className:"gap-3"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/VerifyOtp.tsx",lineNumber:61,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/VerifyOtp.tsx",lineNumber:60,columnNumber:9},void 0),e.jsxDEV("div",{className:"mb-6",children:e.jsxDEV(U,{variant:"info",title:"Verificação adicional necessária",children:"Sua conta possui verificação em duas etapas ativada para maior segurança."},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/VerifyOtp.tsx",lineNumber:66,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/VerifyOtp.tsx",lineNumber:65,columnNumber:9},void 0),e.jsxDEV(H,{title:"Verificação em duas etapas",description:"Confirme sua identidade para continuar",children:e.jsxDEV(A,{onBack:o,onSuccess:N,userEmail:f,secret:s.two_factor_secret,backupCode:s.two_factor_backup_code??void 0},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/VerifyOtp.tsx",lineNumber:76,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/VerifyOtp.tsx",lineNumber:72,columnNumber:9},void 0),e.jsxDEV("div",{className:"mt-8 text-center",children:e.jsxDEV("p",{className:"text-xs text-muted-foreground",children:"Esta verificação adicional protege sua conta e dados sensíveis."},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/VerifyOtp.tsx",lineNumber:87,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/VerifyOtp.tsx",lineNumber:86,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/VerifyOtp.tsx",lineNumber:58,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/VerifyOtp.tsx",lineNumber:57,columnNumber:5},void 0)};export{$ as default};
