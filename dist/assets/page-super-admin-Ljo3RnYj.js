import{r as d,j as e,cf as D,U as C,bu as H,cg as de,i as xe,K as me,V as he,cn as ue,cP as je,a9 as F,h as ge,bK as P,cQ as pe,u as G,f as fe,af as K,L as $,bw as J,bB as ve,cR as Ne,cs as be,v as we,N as ye}from"./vendor-DjGBFEeb.js";import{e as Q,L as z,I as _e}from"./page-Login-BicjLTnC.js";import{D as _,s as w,C as v,B as y,j as I,a as S,n as W,p as X,b as k,c as B,d as V}from"./page-About-C9AEn_cr.js";import{S as j}from"./page-Profile-Hyp4xwlb.js";import{B as Y,E as Z,F as ee,a1 as se,H as A,G as T,D as ae,n as re,o as te,p as ie,Z as ne,X as le,S as U,a as O,b as L,c as M,d as f}from"./page-MapaPage-CmIl7tuY.js";import{a as q,p as R,f as Se}from"./page-ReportDemo-oW25uBYe.js";import{T as Ce,c as Te,d as E,e as b,f as ze,g as p}from"./page-DemoMapaTestemunhas-DGvz_qiH.js";import{T as oe}from"./page-PortalTitular-BP0o5ubO.js";function Ae(){const[s,n]=d.useState(null),[l,m]=d.useState(!0),{toast:t}=_();d.useEffect(()=>{u()},[]);const u=async()=>{try{const{data:c,error:o}=await w.rpc("get_global_metrics");if(o)throw o;n(c)}catch(c){t({title:"Erro ao carregar métricas",description:c.message,variant:"destructive"})}finally{m(!1)}};if(l)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:8}).map((c,o)=>e.jsx(j,{className:"h-24"},o))});if(!s)return e.jsx("div",{className:"text-center p-8 text-muted-foreground",children:"Não foi possível carregar as métricas globais."});const h=[{title:"Organizações",value:s.total_organizations,icon:D,color:"text-blue-500",bgColor:"bg-blue-500/10"},{title:"Usuários Ativos",value:s.total_users,icon:C,color:"text-green-500",bgColor:"bg-green-500/10"},{title:"Processos",value:s.total_processos,icon:H,color:"text-purple-500",bgColor:"bg-purple-500/10"},{title:"Pessoas",value:s.total_pessoas,icon:C,color:"text-orange-500",bgColor:"bg-orange-500/10"},{title:"Conversas",value:s.total_conversations,icon:de,color:"text-pink-500",bgColor:"bg-pink-500/10"},{title:"Sessões Hoje",value:s.active_sessions_today,icon:xe,color:"text-cyan-500",bgColor:"bg-cyan-500/10"},{title:"Storage (MB)",value:s.storage_usage_mb.toFixed(2),icon:me,color:"text-yellow-500",bgColor:"bg-yellow-500/10"},{title:"Requests IA Hoje",value:s.openai_requests_today,icon:he,color:"text-indigo-500",bgColor:"bg-indigo-500/10",subtitle:`${s.avg_response_time_ms}ms avg`}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:h.map((c,o)=>{const r=c.icon;return e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:c.title}),e.jsx("p",{className:"text-2xl font-bold",children:c.value}),c.subtitle&&e.jsx("p",{className:"text-xs text-muted-foreground",children:c.subtitle})]}),e.jsx("div",{className:`p-2 rounded-lg ${c.bgColor}`,children:e.jsx(r,{className:`w-5 h-5 ${c.color}`})})]})},o)})}),s.openai_cost_today_cents>0&&e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Custo IA Hoje"}),e.jsxs("p",{className:"text-xl font-bold",children:["R$ ",(s.openai_cost_today_cents/100).toFixed(2)]})]})]})})]})}function De({onOrgChange:s,selectedOrgId:n}){const[l,m]=d.useState([]),[t,u]=d.useState(!0),{toast:h}=_();d.useEffect(()=>{c()},[]);const c=async()=>{try{const{data:a,error:g}=await w.from("organizations").select("id, name, code, is_active").eq("is_active",!0).order("name");if(g)throw g;m(a||[])}catch(a){h({title:"Erro ao carregar organizações",description:a.message,variant:"destructive"})}finally{u(!1)}},o=a=>{s?.(a)},r=l.find(a=>a.id===n);return e.jsxs(Y,{children:[e.jsx(Z,{asChild:!0,children:e.jsxs(y,{variant:"outline",role:"combobox",className:"w-[250px] justify-between",disabled:t,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:t?"Carregando...":r?.name||"Todas as organizações"})]}),e.jsx(je,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsxs(ee,{className:"w-[250px]",children:[e.jsx(se,{children:"Filtrar por organização"}),e.jsx(A,{}),e.jsxs(T,{onClick:()=>o(null),className:"cursor-pointer",children:[e.jsx(F,{className:I("mr-2 h-4 w-4",n?"opacity-0":"opacity-100")}),"Todas as organizações"]}),e.jsx(A,{}),l.map(a=>e.jsxs(T,{onClick:()=>o(a.id),className:"cursor-pointer",children:[e.jsx(F,{className:I("mr-2 h-4 w-4",n===a.id?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:a.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.code})]})]},a.id))]})]})}function Ee(){const[s,n]=d.useState([]),[l,m]=d.useState(!0),[t,u]=d.useState(null),{toast:h}=_();d.useEffect(()=>{c()},[]);const c=async()=>{try{const{data:r,error:a}=await w.rpc("get_all_orgs_summary");if(a)throw a;n(r||[])}catch(r){h({title:"Erro ao carregar organizações",description:r.message,variant:"destructive"})}finally{m(!1)}},o=t?s.filter(r=>r.org_id===t):s;return l?e.jsxs(v,{className:"p-6",children:[e.jsx(j,{className:"h-8 w-48 mb-4"}),e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((r,a)=>e.jsx(j,{className:"h-24"},a))})]}):e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Organizações"}),e.jsx(S,{variant:"secondary",children:o.length})]}),e.jsx(De,{onOrgChange:u,selectedOrgId:t})]}),o.length===0?e.jsx("div",{className:"text-center p-8 text-muted-foreground",children:"Nenhuma organização encontrada."}):e.jsx("div",{className:"space-y-4",children:o.map(r=>e.jsx(v,{className:"p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r.org_name}),e.jsx(S,{variant:"outline",children:r.org_code}),r.is_active?e.jsx(S,{variant:"default",className:"bg-green-500/10 text-green-600 hover:bg-green-500/20",children:"Ativa"}):e.jsx(S,{variant:"secondary",children:"Inativa"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsxs("span",{children:["Criada"," ",q(new Date(r.created_at),{addSuffix:!0,locale:R})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsxs("span",{children:["Última atividade"," ",q(new Date(r.last_activity),{addSuffix:!0,locale:R})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(C,{className:"w-4 h-4 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Membros"}),e.jsx("p",{className:"text-lg font-semibold",children:r.total_members})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-500/10",children:e.jsx(H,{className:"w-4 h-4 text-purple-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Processos"}),e.jsx("p",{className:"text-lg font-semibold",children:r.total_processos})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-500/10",children:e.jsx(pe,{className:"w-4 h-4 text-orange-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pessoas"}),e.jsx("p",{className:"text-lg font-semibold",children:r.total_pessoas})]})]})]})]})},r.org_id))})]})}function Ue(){const{isSuperAdmin:s}=Q(),{toast:n}=_(),l=G(),[m,t]=d.useState(!0);return d.useEffect(()=>{s?t(!1):(n({title:"Acesso negado",description:"Você não tem permissão para acessar esta área.",variant:"destructive"}),l("/dashboard"))},[s,l,n]),m?e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsx(j,{className:"h-32 w-full"}),e.jsx(j,{className:"h-64 w-full"})]}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-lg bg-primary/10",children:e.jsx(fe,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Super Admin Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Visão global de todas as organizações do sistema"})]})]}),e.jsxs(y,{onClick:()=>l("/super-admin/users"),className:"gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),"Gerenciar Usuários"]})]}),e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(P,{className:"w-5 h-5 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Métricas Globais"})]}),e.jsx(Ae,{})]}),e.jsx(Ee,{})]})}const Ke=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));function Oe({open:s,onOpenChange:n,user:l,onSuccess:m}){const[t,u]=d.useState(""),[h,c]=d.useState(!1),{toast:o}=_(),r=async()=>{if(t.trim().length<10){o({title:"Erro",description:"A justificativa deve ter no mínimo 10 caracteres",variant:"destructive"});return}c(!0);try{const{data:a,error:g}=await w.functions.invoke("super-admin-reset-password",{body:{targetUserId:l.user_id,reason:t.trim()}});if(g)throw g;o({title:"Sucesso",description:a.message||"Email de reset de senha enviado"}),m(),n(!1),u("")}catch(a){console.error("Error resetting password:",a),o({title:"Erro ao resetar senha",description:a.message||"Ocorreu um erro ao enviar o email",variant:"destructive"})}finally{c(!1)}};return e.jsx(ae,{open:s,onOpenChange:n,children:e.jsxs(re,{children:[e.jsxs(te,{children:[e.jsx(ie,{children:"Resetar Senha"}),e.jsxs(ne,{children:["Enviar email de reset de senha para ",e.jsx("strong",{children:l.email})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(W,{children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx(X,{children:"Um email com link de reset será enviado para o usuário. Esta ação será registrada no log de auditoria."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{htmlFor:"reason",children:["Justificativa ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(oe,{id:"reason",placeholder:"Explique o motivo do reset de senha (mínimo 10 caracteres)...",value:t,onChange:a=>u(a.target.value),rows:4,disabled:h}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.length,"/10 caracteres mínimos"]})]})]}),e.jsxs(le,{children:[e.jsx(y,{variant:"outline",onClick:()=>n(!1),disabled:h,children:"Cancelar"}),e.jsxs(y,{onClick:r,disabled:h||t.trim().length<10,children:[h&&e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviar Email de Reset"]})]})]})})}function Le({open:s,onOpenChange:n,user:l,onSuccess:m}){const[t,u]=d.useState(""),[h,c]=d.useState(""),[o,r]=d.useState(!1),{toast:a}=_(),{data:g}=J({queryKey:["organizations-for-transfer"],queryFn:async()=>{const{data:x,error:N}=await w.from("organizations").select("id, name, code, is_active").eq("is_active",!0).order("name");if(N)throw N;return x},enabled:s}),i=async()=>{if(!t){a({title:"Erro",description:"Selecione uma organização de destino",variant:"destructive"});return}if(h.trim().length<10){a({title:"Erro",description:"A justificativa deve ter no mínimo 10 caracteres",variant:"destructive"});return}r(!0);try{const{data:x,error:N}=await w.functions.invoke("super-admin-transfer-user",{body:{targetUserId:l.user_id,newOrgId:t,reason:h.trim()}});if(N)throw N;a({title:"Sucesso",description:x.message||"Usuário transferido com sucesso"}),m(),n(!1),u(""),c("")}catch(x){console.error("Error transferring user:",x),a({title:"Erro ao transferir usuário",description:x.message||"Ocorreu um erro durante a transferência",variant:"destructive"})}finally{r(!1)}};return e.jsx(ae,{open:s,onOpenChange:n,children:e.jsxs(re,{children:[e.jsxs(te,{children:[e.jsx(ie,{children:"Transferir Usuário"}),e.jsxs(ne,{children:["Transferir ",e.jsx("strong",{children:l.email})," para outra organização"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(W,{children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx(X,{children:"O usuário será removido da organização atual e adicionado à nova organização. Esta ação será registrada no log de auditoria."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Organização Atual"}),e.jsx("div",{className:"px-3 py-2 border rounded-md bg-muted",children:l.organization_name||"Sem organização"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{htmlFor:"new-org",children:["Nova Organização ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(U,{value:t,onValueChange:u,disabled:o,children:[e.jsx(O,{id:"new-org",children:e.jsx(L,{placeholder:"Selecione a organização destino"})}),e.jsx(M,{children:g?.map(x=>e.jsxs(f,{value:x.id,children:[x.name," (",x.code,")"]},x.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{htmlFor:"reason",children:["Justificativa ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(oe,{id:"reason",placeholder:"Explique o motivo da transferência (mínimo 10 caracteres)...",value:h,onChange:x=>c(x.target.value),rows:4,disabled:o}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[h.length,"/10 caracteres mínimos"]})]})]}),e.jsxs(le,{children:[e.jsx(y,{variant:"outline",onClick:()=>n(!1),disabled:o,children:"Cancelar"}),e.jsxs(y,{onClick:i,disabled:o||!t||h.trim().length<10,children:[o&&e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Transferir Usuário"]})]})]})})}function Me({user:s,onSuccess:n}){const[l,m]=d.useState(!1),[t,u]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",children:e.jsx(ve,{className:"h-4 w-4"})})}),e.jsxs(ee,{align:"end",children:[e.jsx(se,{children:"Ações do Usuário"}),e.jsx(A,{}),e.jsxs(T,{onClick:()=>m(!0),children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Resetar Senha"]}),e.jsxs(T,{onClick:()=>u(!0),children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Transferir Organização"]}),e.jsx(A,{}),e.jsx(T,{disabled:!0,children:s.is_active?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Desativar Usuário"]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Ativar Usuário"]})})]})]}),e.jsx(Oe,{open:l,onOpenChange:m,user:s,onSuccess:n}),e.jsx(Le,{open:t,onOpenChange:u,user:s,onSuccess:n})]})}function Re(){const[s,n]=d.useState(""),[l,m]=d.useState("all"),[t,u]=d.useState("all"),{data:h,isLoading:c,refetch:o}=J({queryKey:["all-users"],queryFn:async()=>{const{data:i,error:x}=await w.rpc("get_all_users_summary");if(x)throw x;return i}}),r=h?.filter(i=>{const x=i.email.toLowerCase().includes(s.toLowerCase())||i.full_name?.toLowerCase().includes(s.toLowerCase())||i.organization_name?.toLowerCase().includes(s.toLowerCase()),N=l==="all"||i.role===l,ce=t==="all"||t==="active"&&i.is_active||t==="inactive"&&!i.is_active;return x&&N&&ce}),a=i=>{const x={ADMIN:"default",ANALYST:"secondary",VIEWER:"outline"};return e.jsx(S,{variant:x[i]||"outline",children:i})},g=i=>e.jsx(S,{variant:i?"default":"destructive",children:i?"Ativo":"Inativo"});return c?e.jsxs(v,{children:[e.jsx(k,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"Todos os Usuários"]})}),e.jsx(V,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{className:"h-10 w-full"}),e.jsx(j,{className:"h-64 w-full"})]})})]}):e.jsxs(v,{children:[e.jsx(k,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"Todos os Usuários (",r?.length||0,")"]})}),e.jsx(V,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(_e,{placeholder:"Buscar por email, nome ou organização...",value:s,onChange:i=>n(i.target.value),className:"pl-10"})]})}),e.jsxs(U,{value:l,onValueChange:m,children:[e.jsx(O,{className:"w-[180px]",children:e.jsx(L,{placeholder:"Filtrar por Role"})}),e.jsxs(M,{children:[e.jsx(f,{value:"all",children:"Todos os Roles"}),e.jsx(f,{value:"ADMIN",children:"Admin"}),e.jsx(f,{value:"ANALYST",children:"Analyst"}),e.jsx(f,{value:"VIEWER",children:"Viewer"})]})]}),e.jsxs(U,{value:t,onValueChange:u,children:[e.jsx(O,{className:"w-[180px]",children:e.jsx(L,{placeholder:"Filtrar por Status"})}),e.jsxs(M,{children:[e.jsx(f,{value:"all",children:"Todos os Status"}),e.jsx(f,{value:"active",children:"Ativo"}),e.jsx(f,{value:"inactive",children:"Inativo"})]})]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Ce,{children:[e.jsx(Te,{children:e.jsxs(E,{children:[e.jsx(b,{children:"Email"}),e.jsx(b,{children:"Nome"}),e.jsx(b,{children:"Organização"}),e.jsx(b,{children:"Role"}),e.jsx(b,{children:"Status"}),e.jsx(b,{children:"Último Login"}),e.jsx(b,{children:"Ações"})]})}),e.jsx(ze,{children:r?.length===0?e.jsx(E,{children:e.jsx(p,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"Nenhum usuário encontrado"})}):r?.map(i=>e.jsxs(E,{children:[e.jsx(p,{className:"font-medium",children:i.email}),e.jsx(p,{children:i.full_name||"—"}),e.jsx(p,{children:i.organization_name||e.jsx("span",{className:"text-muted-foreground italic",children:"Sem organização"})}),e.jsx(p,{children:a(i.role)}),e.jsx(p,{children:g(i.is_active)}),e.jsx(p,{children:i.last_login_at?Se(new Date(i.last_login_at),"dd/MM/yyyy 'às' HH:mm",{locale:R}):"—"}),e.jsx(p,{children:e.jsx(Me,{user:i,onSuccess:o})})]},i.user_id))})]})})]})})]})}function Fe(){const{isSuperAdmin:s,loading:n}=Q(),l=G(),{toast:m}=_();return d.useEffect(()=>{!n&&!s&&(m({title:"Acesso Negado",description:"Apenas super admins podem acessar esta página",variant:"destructive"}),l("/"))},[s,n,l,m]),n?e.jsxs("div",{className:"container mx-auto py-8 space-y-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"h-8 w-64"}),e.jsx(j,{className:"h-4 w-96"})]}),e.jsx(j,{className:"h-96 w-full"})]}):s?e.jsxs("div",{className:"container mx-auto py-8 space-y-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Gerenciamento de Usuários"}),e.jsx("p",{className:"text-muted-foreground",children:"Visualize e gerencie todos os usuários do sistema"})]}),e.jsx(Re,{})]}):null}const $e=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"}));export{Ke as D,$e as U};
