import{r as l,j as e,a7 as E,al as M,u as F,y as R,L as y,v as _,ac as k,t as S,a0 as w}from"./vendor-DQ51ZVM5.js";import{r as O,x as d,B as h,u as B,s as m,w as P}from"./page-About-B5Vdotiw.js";import{A as C,e as I,L as T,I as L,M as z}from"./page-Login-CdZ6XTTe.js";import{U as V}from"./page-MapaPage-CRg6elzo.js";import"./page-DemoMapaTestemunhas-DzB41b3E.js";const g=[{label:"Pelo menos 6 caracteres",test:s=>s.length>=6}],D=({password:s})=>{const c=l.useMemo(()=>{if(!s)return{score:0,percentage:0,strength:"Muito fraca",color:"bg-gray-300",requirements:g.map(i=>({...i,met:!1}))};const t=g.map(i=>({...i,met:i.test(s)})),a=t.filter(i=>i.met).length,x=a/g.length*100,n=a>=1?"Forte":"Muito fraca",f=a>=1?"bg-green-500":"bg-red-500";return{score:a,percentage:x,strength:n,color:f,requirements:t}},[s]);return s?e.jsxs("div",{className:"space-y-3 p-3 bg-muted/30 rounded-lg border",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Força da senha:"}),e.jsx("span",{className:"font-medium",children:c.strength})]}),e.jsx(V,{value:c.percentage,className:"h-2"})]}),e.jsx("div",{className:"space-y-1",children:c.requirements.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[t.met?e.jsx(E,{className:"h-3 w-3 text-green-600","aria-hidden":"true",focusable:"false"}):e.jsx(M,{className:"h-3 w-3 text-muted-foreground","aria-hidden":"true",focusable:"false"}),e.jsx("span",{className:t.met?"text-green-600":"text-muted-foreground",children:t.label})]},a))})]}):null},U=B({password:P().min(z,`Mínimo de ${z} caracteres`),confirmPassword:P()}).refine(s=>s.password===s.confirmPassword,{message:"Senhas não conferem",path:["confirmPassword"]}),$=()=>{const s=F(),[c,t]=l.useState(!1),[a,x]=l.useState(!1),[n,f]=l.useState(!1),[i,u]=l.useState(null),v=new URLSearchParams(window.location.hash.slice(1)),p=v.get("access_token"),j=v.get("refresh_token");l.useEffect(()=>{window.location.hash.includes("access_token")&&(window.location.hash="")},[]);const r=R({resolver:O(U),defaultValues:{password:"",confirmPassword:""}}),N=r.watch("password");l.useEffect(()=>{(async()=>{if(!p||!j){u(!1);return}if(!m){u(!0);return}try{const{error:o}=await m.auth.setSession({access_token:p,refresh_token:j});u(!o)}catch(o){console.error("Token validation error:",o),u(!1)}})()},[p,j]);const A=async b=>{t(!0);try{if(!m){w.success("Senha atualizada!",{description:"Sua senha foi redefinida com sucesso (modo demo)."}),s("/login");return}const{error:o}=await m.auth.updateUser({password:b.password});if(o)throw o;w.success("Senha atualizada!",{description:"Sua senha foi redefinida com sucesso. Faça login com a nova senha."});try{await m.auth.refreshSession()}catch{}await m.auth.signOut(),s("/login")}catch(o){console.error("Password update error:",o),w.error("Erro ao atualizar senha",{description:"Não foi possível atualizar a senha. Tente novamente."})}finally{t(!1)}};return i===null?e.jsx("div",{className:"min-h-screen bg-gradient-subtle flex flex-col justify-center px-6 py-12",children:e.jsx("div",{className:"mx-auto w-full max-w-md",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(y,{className:"h-8 w-8 animate-spin mx-auto text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Validando link de redefinição..."})]})})}):i?e.jsx("div",{className:"min-h-screen bg-gradient-subtle flex flex-col justify-center px-6 py-12",children:e.jsxs("div",{className:"mx-auto w-full max-w-md",children:[e.jsx("div",{className:"flex items-center justify-center mb-8",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:d.logo.mark,alt:d.name,className:"w-10 h-10 object-contain",loading:"lazy"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:d.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Assistente de Testemunhas"})]})]})}),e.jsx(C,{title:"Nova senha",description:"Defina uma senha segura para sua conta",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto p-3 bg-primary/10 rounded-full w-fit mb-4",children:e.jsx(_,{className:"h-6 w-6 text-primary"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Link válido. Defina sua nova senha abaixo."})]}),e.jsxs("form",{onSubmit:r.handleSubmit(A),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"password",children:"Nova senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"password",type:a?"text":"password",placeholder:"••••••••","aria-invalid":!!r.formState.errors.password,"aria-describedby":"reset-password-error",...r.register("password"),className:r.formState.errors.password?"border-destructive pr-10":"pr-10"}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>x(!a),"aria-label":a?"Ocultar senha":"Mostrar senha","aria-pressed":a,children:a?e.jsx(k,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",focusable:"false"}):e.jsx(S,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",focusable:"false"})})]}),r.formState.errors.password&&e.jsx("p",{id:"reset-password-error",className:"text-sm text-destructive",role:"alert","aria-live":"polite",children:r.formState.errors.password.message})]}),N&&e.jsx(D,{password:N}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"confirmPassword",children:"Confirmar nova senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"confirmPassword",type:n?"text":"password",placeholder:"••••••••","aria-invalid":!!r.formState.errors.confirmPassword,"aria-describedby":"reset-confirm-password-error",...r.register("confirmPassword"),className:r.formState.errors.confirmPassword?"border-destructive pr-10":"pr-10"}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>f(!n),"aria-label":n?"Ocultar senha":"Mostrar senha","aria-pressed":n,children:n?e.jsx(k,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",focusable:"false"}):e.jsx(S,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",focusable:"false"})})]}),r.formState.errors.confirmPassword&&e.jsx("p",{id:"reset-confirm-password-error",className:"text-sm text-destructive",role:"alert","aria-live":"polite",children:r.formState.errors.confirmPassword.message})]}),e.jsx(h,{type:"submit",className:"w-full",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-4 w-4 animate-spin mr-2"}),"Atualizando senha..."]}):"Atualizar senha"})]})]})})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-subtle flex flex-col justify-center px-6 py-12",children:e.jsxs("div",{className:"mx-auto w-full max-w-md",children:[e.jsx("div",{className:"flex items-center justify-center mb-8",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:d.logo.mark,alt:d.name,className:"w-10 h-10 object-contain",loading:"lazy"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:d.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Assistente de Testemunhas"})]})]})}),e.jsx(C,{title:"Link inválido",description:"O link de redefinição não é válido",children:e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx(I,{variant:"error",title:"Link expirado ou inválido",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("p",{children:"Este link pode ter expirado ou já foi usado."}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-left",children:[e.jsx("li",{children:"Links de redefinição expiram em 1 hora"}),e.jsx("li",{children:"Cada link só pode ser usado uma vez"}),e.jsx("li",{children:"Certifique-se de usar o link mais recente"})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(h,{onClick:()=>s("/reset"),className:"w-full",children:"Solicitar novo link"}),e.jsx(h,{variant:"ghost",onClick:()=>s("/login"),className:"w-full",children:"Voltar ao login"})]})]})})]})})};export{$ as default};
