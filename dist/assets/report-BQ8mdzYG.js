import{_}from"./page-About-RKuI2z9S.js";import{i as f}from"./page-admin-DM-ktkz1.js";import"./vendor-xNGbxDip.js";import"./page-Login-5_M3Gm0y.js";import"./page-MapaPage-DdhKmZnw.js";import"./page-DemoMapaTestemunhas-CBcv0AZO.js";import"./page-PublicHome-De_9pnWE.js";import"./page-NotFound-cpOlfL10.js";import"./page-ReportDemo-BWE1-LYm.js";async function U(e,s,i,t){const o=`Aba,Linha,Coluna,Severidade,Regra,Valor,Auto-preenchido
`,n=e.issues.map(r=>`"${r.sheet}",${r.row},"${r.column}","${r.severity}","${r.rule}","${String(r.value).replace(/"/g,'""')}",${r.autofilled||!1}`).join(`
`),a=o+n,l=new Blob([a],{type:"text/csv"}),c=URL.createObjectURL(l),p={arquivo:s,dataHora:new Date().toISOString(),resumo:e.summary,issues:e.issues,correcoes:t?Object.fromEntries(t):{}},m=new Blob([JSON.stringify(p,null,2)],{type:"application/json"}),u=URL.createObjectURL(m);return{fixedXlsx:await g(e.normalizedData,t,s),reportCsv:c,reportJson:u}}async function g(e,s,i){const t=await _(()=>import("./xlsx-BBMPxr6S.js"),[]),o=t.utils.book_new();console.log("游늵 Generating corrected XLSX with data:",{processos:e.processos?.length||0,testemunhas:e.testemunhas?.length||0,corrections:s?.size||0});const n=e.processos?.length>0?e.processos:[{cnj:"",reclamante_nome:"",reu_nome:"",comarca:"",tribunal:"",vara:"",fase:"",status:"",observacoes:"Nenhum processo v치lido encontrado - utilize este template para adicionar dados"}],a=t.utils.json_to_sheet(n);s&&e.processos?.length>0&&d(a,s),t.utils.book_append_sheet(o,a,"Por Processo");const l=e.testemunhas?.length>0?e.testemunhas:[{cnj:"",nome_testemunha:"",reclamante_nome:"",reu_nome:"",observacoes:"Nenhuma testemunha v치lida encontrada - utilize este template para adicionar dados"}],c=t.utils.json_to_sheet(l);s&&e.testemunhas?.length>0&&d(c,s),t.utils.book_append_sheet(o,c,"Por Testemunha");const p=[{Arquivo_Original:i||"Desconhecido",Data_Processamento:new Date().toISOString(),Processos_V치lidos:e.processos?.length||0,Testemunhas_V치lidas:e.testemunhas?.length||0,Corre칞칫es_Aplicadas:s?.size||0,Status:e.processos?.length>0||e.testemunhas?.length>0?"Dados v치lidos encontrados":"Apenas estrutura template - adicione dados v치lidos"}],m=t.utils.json_to_sheet(p);t.utils.book_append_sheet(o,m,"Resumo");const u=t.write(o,{type:"buffer",bookType:"xlsx",compression:!0}),h=new Blob([u],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});return URL.createObjectURL(h)}function d(e,s,i){e["!cols"]||(e["!cols"]=[]),e["!comments"]||(e["!comments"]=[]),s.forEach((t,o)=>{const n=o.includes("!")?o.split("!")[1]:o;f(n)&&e[n]&&(e["!comments"].push({ref:n,a:"Sistema",t:`Corrigido automaticamente: ${t.reason}
Original: ${t.original}
Novo: ${t.corrected}`}),e[n].s||(e[n].s={}),e[n].s.fill={fgColor:{rgb:"FFFACD"},patternType:"solid"})})}export{U as generateReports};
