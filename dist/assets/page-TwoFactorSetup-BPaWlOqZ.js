import{u as S,r as d,j as n,a0 as b}from"./vendor-9yOeyDvF.js";import{u as w,A as j,L as C,I as U}from"./page-Login-BUjHIVpT.js";import{B as y,s as E}from"./page-About-GdMw0SZK.js";const f="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";function D(e){const t=new Uint8Array(e);return crypto.getRandomValues(t),t}async function T(e,t){const r=await crypto.subtle.importKey("raw",e,{name:"HMAC",hash:"SHA-1"},!1,["sign"]),s=await crypto.subtle.sign("HMAC",r,t);return new Uint8Array(s)}function F(e=20){const t=D(e);let r="";for(let s=0;s<t.length;s++)r+=f[t[s]%f.length];return r}function O(e){let t="";const r=e.replace(/=+$/g,"").toUpperCase();for(const o of r){const i=f.indexOf(o);i!==-1&&(t+=i.toString(2).padStart(5,"0"))}const s=[];for(let o=0;o+8<=t.length;o+=8)s.push(parseInt(t.substring(o,o+8),2));return new Uint8Array(s)}function v(e,t,r){e[r]=t>>>24&255,e[r+1]=t>>>16&255,e[r+2]=t>>>8&255,e[r+3]=t&255}function A(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}async function H(e,t=30,r=6,s=Date.now()){const o=O(e),i=Math.floor(s/1e3/t),a=new Uint8Array(8);v(a,Math.floor(i/4294967296),0),v(a,i%4294967296,4);const u=await T(o,a),l=u[u.length-1]&15;return((A(u,l)&2147483647)%10**r).toString().padStart(r,"0")}async function V(e,t,r=1,s=30,o=6){const i=Date.now();for(let a=-r;a<=r;a++){const u=i+a*s*1e3;if(await H(t,s,o,u)===e)return!0}return!1}function G(){const e=D(4);return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("").toUpperCase()}function I(e,t,r){return`otpauth://totp/${encodeURIComponent(t)}:${encodeURIComponent(e)}?secret=${r}&issuer=${encodeURIComponent(t)}`}const B=()=>{const{profile:e}=w(),t=S(),[r,s]=d.useState(""),[o,i]=d.useState(""),[a,u]=d.useState(""),[l,N]=d.useState(""),[g,p]=d.useState(!1);d.useEffect(()=>{if(e){const c=F();s(c);const m=G();i(m);const h=I(e.email,"AssistJur",c);u(`https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(h)}`)}},[e]);const x=async()=>{if(e){p(!0);try{if(!await V(l,r)){b.error("Código inválido"),p(!1);return}const{error:m}=await E.from("profiles").update({updated_at:new Date().toISOString()}).eq("id",e.id);if(m)throw m;sessionStorage.setItem("mfa_verified","true"),b.success("2FA habilitado"),t("/dados/mapa")}catch(c){console.error("Enable 2FA error:",c),b.error("Erro ao habilitar 2FA")}finally{p(!1)}}};return e?n.jsxDEV("div",{className:"min-h-screen bg-gradient-subtle flex flex-col justify-center px-6 py-12",children:n.jsxDEV("div",{className:"mx-auto w-full max-w-md",children:n.jsxDEV(j,{title:"Ativar verificação em duas etapas",description:"Use um aplicativo autenticador",children:n.jsxDEV("div",{className:"space-y-4",children:[a&&n.jsxDEV("img",{src:a,alt:"QR code",className:"mx-auto"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:79,columnNumber:23},void 0),n.jsxDEV("div",{className:"text-sm text-center",children:n.jsxDEV("p",{children:["Escaneie o QR code ou use o código:",n.jsxDEV("code",{className:"font-mono ml-1",children:r},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:83,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:81,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:80,columnNumber:13},void 0),n.jsxDEV("div",{className:"text-sm text-center",children:n.jsxDEV("p",{children:["Guarde seu código de backup:",n.jsxDEV("code",{className:"font-mono ml-1",children:o},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:89,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:87,columnNumber:15},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:86,columnNumber:13},void 0),n.jsxDEV("div",{className:"space-y-2",children:[n.jsxDEV(C,{htmlFor:"code",children:"Código do aplicativo"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:93,columnNumber:15},void 0),n.jsxDEV(U,{id:"code",value:l,onChange:c=>N(c.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",autoComplete:"one-time-code"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:94,columnNumber:15},void 0)]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:92,columnNumber:13},void 0),n.jsxDEV(y,{className:"w-full",onClick:x,disabled:g||l.length!==6,children:g?"Verificando...":"Ativar 2FA"},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:104,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:78,columnNumber:11},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:74,columnNumber:9},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:73,columnNumber:7},void 0)},void 0,!1,{fileName:"C:/Users/bruno/OneDrive/Documentos/GitHub/assitjur/src/pages/TwoFactorSetup.tsx",lineNumber:72,columnNumber:5},void 0):null},L=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{L as T,V as v};
