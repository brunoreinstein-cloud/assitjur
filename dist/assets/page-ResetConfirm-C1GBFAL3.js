import{r as m,j as e,a7 as T,ao as L,u as z,x as A,y as M,L as k,t as F,ac as E,s as D,a0 as h}from"./vendor-BifU-Y_Y.js";import{v as u,B as d,q as _,s as c,u as V}from"./page-About-BHlfFeQG.js";import{A as C,f as O,L as R,I as y,M as S}from"./page-Login-Cb2wXJhK.js";import{R as B}from"./page-MapaPage-bU2RdKPx.js";import"./page-DemoMapaTestemunhas-BREju1Qp.js";const w=[{label:"Pelo menos 6 caracteres",test:s=>s.length>=6}],I=({password:s})=>{const l=m.useMemo(()=>{if(!s)return{score:0,percentage:0,strength:"Muito fraca",color:"bg-gray-300",requirements:w.map(n=>({...n,met:!1}))};const i=w.map(n=>({...n,met:n.test(s)})),r=i.filter(n=>n.met).length,N=r/w.length*100,o=r>=1?"Forte":"Muito fraca",p=r>=1?"bg-green-500":"bg-red-500";return{score:r,percentage:N,strength:o,color:p,requirements:i}},[s]);return s?e.jsxDEV("div",{className:"space-y-3 p-3 bg-muted/30 rounded-lg border",children:[e.jsxDEV("div",{className:"space-y-1",children:[e.jsxDEV("div",{className:"flex justify-between text-sm",children:[e.jsxDEV("span",{className:"text-muted-foreground",children:"Força da senha:"},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/PasswordStrength.tsx",lineNumber:59,columnNumber:11},void 0),e.jsxDEV("span",{className:"font-medium",children:l.strength},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/PasswordStrength.tsx",lineNumber:60,columnNumber:11},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/components/auth/PasswordStrength.tsx",lineNumber:58,columnNumber:9},void 0),e.jsxDEV(B,{value:l.percentage,className:"h-2"},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/PasswordStrength.tsx",lineNumber:62,columnNumber:9},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/components/auth/PasswordStrength.tsx",lineNumber:57,columnNumber:7},void 0),e.jsxDEV("div",{className:"space-y-1",children:l.requirements.map((i,r)=>e.jsxDEV("div",{className:"flex items-center gap-2 text-xs",children:[i.met?e.jsxDEV(T,{className:"h-3 w-3 text-green-600","aria-hidden":"true",focusable:"false"},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/PasswordStrength.tsx",lineNumber:69,columnNumber:15},void 0):e.jsxDEV(L,{className:"h-3 w-3 text-muted-foreground","aria-hidden":"true",focusable:"false"},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/PasswordStrength.tsx",lineNumber:75,columnNumber:15},void 0),e.jsxDEV("span",{className:i.met?"text-green-600":"text-muted-foreground",children:i.label},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/PasswordStrength.tsx",lineNumber:81,columnNumber:13},void 0)]},r,!0,{fileName:"/workspaces/assitjur/src/components/auth/PasswordStrength.tsx",lineNumber:67,columnNumber:11},void 0))},void 0,!1,{fileName:"/workspaces/assitjur/src/components/auth/PasswordStrength.tsx",lineNumber:65,columnNumber:7},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/components/auth/PasswordStrength.tsx",lineNumber:56,columnNumber:5},void 0):null},q=_({password:V().min(S,`Mínimo de ${S} caracteres`),confirmPassword:V()}).refine(s=>s.password===s.confirmPassword,{message:"Senhas não conferem",path:["confirmPassword"]}),$=()=>{const s=z(),[l,i]=m.useState(!1),[r,N]=m.useState(!1),[o,p]=m.useState(!1),[n,f]=m.useState(null),j=new URLSearchParams(window.location.hash.slice(1)),x=j.get("access_token"),b=j.get("refresh_token");m.useEffect(()=>{window.location.hash.includes("access_token")&&(window.location.hash="")},[]);const a=A({resolver:M(q),defaultValues:{password:"",confirmPassword:""}}),g=a.watch("password");m.useEffect(()=>{(async()=>{if(!x||!b){f(!1);return}if(!c){f(!0);return}try{const{error:t}=await c.auth.setSession({access_token:x,refresh_token:b});f(!t)}catch(t){console.error("Token validation error:",t),f(!1)}})()},[x,b]);const P=async v=>{i(!0);try{if(!c){h.success("Senha atualizada!",{description:"Sua senha foi redefinida com sucesso (modo demo)."}),s("/login");return}const{error:t}=await c.auth.updateUser({password:v.password});if(t)throw t;h.success("Senha atualizada!",{description:"Sua senha foi redefinida com sucesso. Faça login com a nova senha."});try{await c.auth.refreshSession()}catch{}await c.auth.signOut(),s("/login")}catch(t){console.error("Password update error:",t),h.error("Erro ao atualizar senha",{description:"Não foi possível atualizar a senha. Tente novamente."})}finally{i(!1)}};return n===null?e.jsxDEV("div",{className:"min-h-screen bg-gradient-subtle flex flex-col justify-center px-6 py-12",children:e.jsxDEV("div",{className:"mx-auto w-full max-w-md",children:e.jsxDEV("div",{className:"text-center space-y-4",children:[e.jsxDEV(k,{className:"h-8 w-8 animate-spin mx-auto text-primary"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:138,columnNumber:13},void 0),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Validando link de redefinição..."},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:139,columnNumber:13},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:137,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:136,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:135,columnNumber:7},void 0):n?e.jsxDEV("div",{className:"min-h-screen bg-gradient-subtle flex flex-col justify-center px-6 py-12",children:e.jsxDEV("div",{className:"mx-auto w-full max-w-md",children:[e.jsxDEV("div",{className:"flex items-center justify-center mb-8",children:e.jsxDEV("div",{className:"flex items-center space-x-3",children:[e.jsxDEV("img",{src:u.logo.mark,alt:u.name,className:"w-10 h-10 object-contain",loading:"lazy"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:215,columnNumber:13},void 0),e.jsxDEV("div",{children:[e.jsxDEV("h1",{className:"text-2xl font-bold text-foreground",children:u.name},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:222,columnNumber:15},void 0),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Assistente de Testemunhas"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:225,columnNumber:15},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:221,columnNumber:13},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:214,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:213,columnNumber:9},void 0),e.jsxDEV(C,{title:"Nova senha",description:"Defina uma senha segura para sua conta",children:e.jsxDEV("div",{className:"space-y-6",children:[e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV("div",{className:"mx-auto p-3 bg-primary/10 rounded-full w-fit mb-4",children:e.jsxDEV(F,{className:"h-6 w-6 text-primary"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:239,columnNumber:17},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:238,columnNumber:15},void 0),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Link válido. Defina sua nova senha abaixo."},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:241,columnNumber:15},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:237,columnNumber:13},void 0),e.jsxDEV("form",{onSubmit:a.handleSubmit(P),className:"space-y-4",children:[e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(R,{htmlFor:"password",children:"Nova senha"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:252,columnNumber:17},void 0),e.jsxDEV("div",{className:"relative",children:[e.jsxDEV(y,{id:"password",type:r?"text":"password",placeholder:"••••••••","aria-invalid":!!a.formState.errors.password,"aria-describedby":"reset-password-error",...a.register("password"),className:a.formState.errors.password?"border-destructive pr-10":"pr-10"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:254,columnNumber:19},void 0),e.jsxDEV(d,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>N(!r),"aria-label":r?"Ocultar senha":"Mostrar senha","aria-pressed":r,children:r?e.jsxDEV(E,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",focusable:"false"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:279,columnNumber:23},void 0):e.jsxDEV(D,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",focusable:"false"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:285,columnNumber:23},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:267,columnNumber:19},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:253,columnNumber:17},void 0),a.formState.errors.password&&e.jsxDEV("p",{id:"reset-password-error",className:"text-sm text-destructive",role:"alert","aria-live":"polite",children:a.formState.errors.password.message},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:294,columnNumber:19},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:251,columnNumber:15},void 0),g&&e.jsxDEV(I,{password:g},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:306,columnNumber:33},void 0),e.jsxDEV("div",{className:"space-y-2",children:[e.jsxDEV(R,{htmlFor:"confirmPassword",children:"Confirmar nova senha"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:310,columnNumber:17},void 0),e.jsxDEV("div",{className:"relative",children:[e.jsxDEV(y,{id:"confirmPassword",type:o?"text":"password",placeholder:"••••••••","aria-invalid":!!a.formState.errors.confirmPassword,"aria-describedby":"reset-confirm-password-error",...a.register("confirmPassword"),className:a.formState.errors.confirmPassword?"border-destructive pr-10":"pr-10"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:312,columnNumber:19},void 0),e.jsxDEV(d,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>p(!o),"aria-label":o?"Ocultar senha":"Mostrar senha","aria-pressed":o,children:o?e.jsxDEV(E,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",focusable:"false"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:337,columnNumber:23},void 0):e.jsxDEV(D,{className:"h-4 w-4 text-muted-foreground","aria-hidden":"true",focusable:"false"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:343,columnNumber:23},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:325,columnNumber:19},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:311,columnNumber:17},void 0),a.formState.errors.confirmPassword&&e.jsxDEV("p",{id:"reset-confirm-password-error",className:"text-sm text-destructive",role:"alert","aria-live":"polite",children:a.formState.errors.confirmPassword.message},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:352,columnNumber:19},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:309,columnNumber:15},void 0),e.jsxDEV(d,{type:"submit",className:"w-full",disabled:l,children:l?e.jsxDEV(e.Fragment,{children:[e.jsxDEV(k,{className:"h-4 w-4 animate-spin mr-2"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:366,columnNumber:21},void 0),"Atualizando senha..."]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:365,columnNumber:19},void 0):"Atualizar senha"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:363,columnNumber:15},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:246,columnNumber:13},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:236,columnNumber:11},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:232,columnNumber:9},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:211,columnNumber:7},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:210,columnNumber:5},void 0):e.jsxDEV("div",{className:"min-h-screen bg-gradient-subtle flex flex-col justify-center px-6 py-12",children:e.jsxDEV("div",{className:"mx-auto w-full max-w-md",children:[e.jsxDEV("div",{className:"flex items-center justify-center mb-8",children:e.jsxDEV("div",{className:"flex items-center space-x-3",children:[e.jsxDEV("img",{src:u.logo.mark,alt:u.name,className:"w-10 h-10 object-contain",loading:"lazy"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:156,columnNumber:15},void 0),e.jsxDEV("div",{children:[e.jsxDEV("h1",{className:"text-2xl font-bold text-foreground",children:u.name},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:163,columnNumber:17},void 0),e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:"Assistente de Testemunhas"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:166,columnNumber:17},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:162,columnNumber:15},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:155,columnNumber:13},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:154,columnNumber:11},void 0),e.jsxDEV(C,{title:"Link inválido",description:"O link de redefinição não é válido",children:e.jsxDEV("div",{className:"text-center space-y-6",children:[e.jsxDEV(O,{variant:"error",title:"Link expirado ou inválido",children:e.jsxDEV("div",{className:"space-y-2 text-sm",children:[e.jsxDEV("p",{children:"Este link pode ter expirado ou já foi usado."},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:180,columnNumber:19},void 0),e.jsxDEV("ul",{className:"list-disc list-inside space-y-1 text-left",children:[e.jsxDEV("li",{children:"Links de redefinição expiram em 1 hora"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:182,columnNumber:21},void 0),e.jsxDEV("li",{children:"Cada link só pode ser usado uma vez"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:183,columnNumber:21},void 0),e.jsxDEV("li",{children:"Certifique-se de usar o link mais recente"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:184,columnNumber:21},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:181,columnNumber:19},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:179,columnNumber:17},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:178,columnNumber:15},void 0),e.jsxDEV("div",{className:"space-y-3",children:[e.jsxDEV(d,{onClick:()=>s("/reset"),className:"w-full",children:"Solicitar novo link"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:190,columnNumber:17},void 0),e.jsxDEV(d,{variant:"ghost",onClick:()=>s("/login"),className:"w-full",children:"Voltar ao login"},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:194,columnNumber:17},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:189,columnNumber:15},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:177,columnNumber:13},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:173,columnNumber:11},void 0)]},void 0,!0,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:152,columnNumber:9},void 0)},void 0,!1,{fileName:"/workspaces/assitjur/src/pages/ResetConfirm.tsx",lineNumber:151,columnNumber:7},void 0)};export{$ as default};
