import{bT as R,bw as Q,bU as P,a0 as N,r as v,y as K,bq as J,j as e,cX as V,B as k,cY as Z,G as W,bu as X,cZ as U,c_ as A,c$ as E,d0 as Y,U as L,i as q,d1 as T,cd as F}from"./vendor-C7obwuys.js";import{L as p,I as h,T as H,a as ee,b as x,c as g}from"./page-Login-Cbmauuqh.js";import{s as d,r as se,C as S,B as u}from"./page-About-lfGzthLV.js";import{A as ae,b as re,a as te,o as oe}from"./page-Profile-R2vyD5Xq.js";import{P as I,a as G,b as O}from"./page-DemoMapaTestemunhas-sM7vksPb.js";import{u as ie}from"./page-ReportDemo-DzPYRZKP.js";import"./page-MapaPage-B23KUQ8r.js";import"./page-PortalTitular-B8zNl0Zp.js";function D(){const s=R(),{data:j,isLoading:o,error:l}=Q({queryKey:["organization-settings"],queryFn:async()=>{const{data:a}=await d.from("profiles").select("organization_id").single();if(!a?.organization_id)throw new Error("Organização não encontrada");const{data:t,error:n}=await d.from("organizations").select("*").eq("id",a.organization_id).single();if(n)throw n;return t}}),i=P({mutationFn:async a=>{const{data:t}=await d.from("profiles").select("organization_id").single();if(!t?.organization_id)throw new Error("Organização não encontrada");const{data:n,error:r}=await d.from("organizations").update(a).eq("id",t.organization_id).select().single();if(r)throw r;return n},onSuccess:()=>{s.invalidateQueries({queryKey:["organization-settings"]}),N.success("Configurações atualizadas com sucesso!")},onError:a=>{N.error(`Erro ao atualizar configurações: ${a.message}`)}}),m=P({mutationFn:async a=>{const{data:t}=await d.from("profiles").select("organization_id").single();if(!t?.organization_id)throw new Error("Organização não encontrada");const n=t.organization_id,r=a.name.split(".").pop(),c=`${n}/logo.${r}`,{error:b}=await d.storage.from("org-logos").upload(c,a,{upsert:!0});if(b)throw b;const{data:{publicUrl:y}}=d.storage.from("org-logos").getPublicUrl(c),{error:w}=await d.from("organizations").update({logo_url:y}).eq("id",n);if(w)throw w;return y},onSuccess:()=>{s.invalidateQueries({queryKey:["organization-settings"]}),N.success("Logo atualizado com sucesso!")},onError:a=>{N.error(`Erro ao fazer upload do logo: ${a.message}`)}});return{settings:j,isLoading:o,error:l,updateSettings:i,uploadAvatar:m}}function ne(){const{settings:s,updateSettings:j,uploadAvatar:o}=D(),[l,i]=v.useState(!1),[m,a]=v.useState(null),{register:t,handleSubmit:n,formState:{errors:r,isDirty:c}}=K({resolver:se(oe),values:{name:s?.name||"",code:s?.code||"",domain:s?.domain||"",cnpj:s?.cnpj||"",primary_color:s?.primary_color||"#2563eb",secondary_color:s?.secondary_color||"#1e40af",session_timeout_minutes:s?.session_timeout_minutes||60,allow_concurrent_sessions:s?.allow_concurrent_sessions??!0}}),b=async f=>{i(!0);try{await j.mutateAsync(f)}finally{i(!1)}},y=async f=>{const z=f[0];if(!z)return;if(z.size>5*1024*1024){N.error("Arquivo muito grande. Tamanho máximo: 5MB");return}const C=new FileReader;C.onloadend=()=>{a(C.result)},C.readAsDataURL(z),o.mutate(z)},{getRootProps:w,getInputProps:B,isDragActive:_}=J({onDrop:y,accept:{"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/webp":[".webp"],"image/svg+xml":[".svg"]},maxSize:5*1024*1024,multiple:!1}),$=m||s?.logo_url,M=s?.name?s.name.split(" ").slice(0,2).map(f=>f[0]).join("").toUpperCase():"ORG";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Logo da Organização"}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(ae,{className:"h-32 w-32",children:[e.jsx(re,{src:$||void 0,alt:"Logo"}),e.jsx(te,{className:"text-2xl bg-primary text-primary-foreground",children:M})]}),e.jsxs("div",{...w(),className:`
              border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors w-full
              ${_?"border-primary bg-primary/5":"border-border hover:border-primary"}
              ${o.isPending?"opacity-50 pointer-events-none":""}
            `,children:[e.jsx("input",{...B()}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(V,{className:"h-8 w-8 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:o.isPending?"Fazendo upload...":_?"Solte o logo aqui":"Clique ou arraste o logo"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"JPEG, PNG, WebP ou SVG (máx. 5MB)"})]})]})]})]})]}),e.jsxs(S,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Informações da Organização"}),e.jsxs("form",{onSubmit:n(b),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"name",children:"Nome da Organização *"}),e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(h,{id:"name",...t("name"),placeholder:"Minha Empresa LTDA",className:"pl-10"})]}),r.name&&e.jsx("p",{className:"text-sm text-destructive",children:r.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"code",children:"Código *"}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(h,{id:"code",...t("code"),placeholder:"MEMP",className:"pl-10"})]}),r.code&&e.jsx("p",{className:"text-sm text-destructive",children:r.code.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"domain",children:"Domínio"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(h,{id:"domain",...t("domain"),placeholder:"https://minhaempresa.com.br",className:"pl-10"})]}),r.domain&&e.jsx("p",{className:"text-sm text-destructive",children:r.domain.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cnpj",children:"CNPJ"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(h,{id:"cnpj",...t("cnpj"),placeholder:"12.345.678/0001-90",className:"pl-10"})]}),r.cnpj&&e.jsx("p",{className:"text-sm text-destructive",children:r.cnpj.message})]})]}),e.jsx("div",{className:"flex justify-end gap-2 pt-4",children:e.jsx(u,{type:"submit",disabled:!c||l,isLoading:l,children:"Salvar Alterações"})})]})]})]})}function le(){const{settings:s,updateSettings:j}=D(),[o,l]=v.useState(s?.primary_color||"#2563eb"),[i,m]=v.useState(s?.secondary_color||"#1e40af"),[a,t]=v.useState(!1),n=async()=>{t(!0);try{await j.mutateAsync({primary_color:o,secondary_color:i})}finally{t(!1)}},r=o!==s?.primary_color||i!==s?.secondary_color;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(U,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cores do Sistema"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Personalize as cores principais da interface do sistema"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(p,{children:"Cor Primária"}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(I,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-3",children:[e.jsx("div",{className:"h-6 w-6 rounded border",style:{backgroundColor:o}}),e.jsx("span",{className:"font-mono text-sm",children:o}),e.jsx(A,{className:"ml-auto h-4 w-4"})]})}),e.jsxs(O,{className:"w-auto p-3",children:[e.jsx(E,{color:o,onChange:l}),e.jsx(h,{value:o,onChange:c=>l(c.target.value),className:"mt-2 font-mono"})]})]})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Cor principal usada em botões, links e destaques"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(p,{children:"Cor Secundária"}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(I,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-3",children:[e.jsx("div",{className:"h-6 w-6 rounded border",style:{backgroundColor:i}}),e.jsx("span",{className:"font-mono text-sm",children:i}),e.jsx(A,{className:"ml-auto h-4 w-4"})]})}),e.jsxs(O,{className:"w-auto p-3",children:[e.jsx(E,{color:i,onChange:m}),e.jsx(h,{value:i,onChange:c=>m(c.target.value),className:"mt-2 font-mono"})]})]})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Cor secundária usada em elementos de apoio"})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-3",children:"Pré-visualização"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{style:{backgroundColor:o},children:"Primário"}),e.jsx(u,{variant:"secondary",style:{backgroundColor:i},children:"Secundário"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{variant:"outline",onClick:()=>{l(s?.primary_color||"#2563eb"),m(s?.secondary_color||"#1e40af")},disabled:!r,children:"Resetar"}),e.jsx(u,{onClick:n,disabled:!r||a,isLoading:a,children:"Salvar Alterações"})]})]})}function je(){const{isAdmin:s}=ie();return s?e.jsxs("div",{className:"container mx-auto p-6 max-w-6xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Configurações da Organização"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Gerencie as configurações e preferências da organização (visível apenas para administradores)"})]}),e.jsxs(H,{defaultValue:"general",className:"space-y-6",children:[e.jsxs(ee,{className:"grid w-full grid-cols-6",children:[e.jsxs(x,{value:"general",className:"gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Geral"})]}),e.jsxs(x,{value:"users",className:"gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Usuários"})]}),e.jsxs(x,{value:"security",className:"gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Segurança"})]}),e.jsxs(x,{value:"integrations",className:"gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Integrações"})]}),e.jsxs(x,{value:"notifications",className:"gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Notificações"})]}),e.jsxs(x,{value:"appearance",className:"gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Aparência"})]})]}),e.jsx(g,{value:"general",children:e.jsx(ne,{})}),e.jsx(g,{value:"users",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Gestão de Usuários"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Acesse"," ",e.jsx("a",{href:"/admin/organization",className:"text-primary hover:underline",children:"Organização"})," ","para gerenciar usuários"]})]})}),e.jsx(g,{value:"security",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Configurações de Segurança"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Em desenvolvimento"})]})}),e.jsx(g,{value:"integrations",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Integrações"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Acesse"," ",e.jsx("a",{href:"/admin/config",className:"text-primary hover:underline",children:"Configurações do Sistema"})," ","para gerenciar integrações"]})]})}),e.jsx(g,{value:"notifications",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Notificações do Sistema"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Em desenvolvimento"})]})}),e.jsx(g,{value:"appearance",children:e.jsx(le,{})})]})]}):e.jsx(Y,{to:"/dashboard",replace:!0})}export{je as default};
